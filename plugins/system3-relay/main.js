/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var XS=Object.create;var fa=Object.defineProperty;var QS=Object.getOwnPropertyDescriptor;var ZS=Object.getOwnPropertyNames;var e0=Object.getPrototypeOf,t0=Object.prototype.hasOwnProperty;var r0=(o,e,t)=>e in o?fa(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var Di=(o,e)=>()=>(e||o((e={exports:{}}).exports,e),e.exports),Xc=(o,e)=>{for(var t in e)fa(o,t,{get:e[t],enumerable:!0})},Gm=(o,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of ZS(e))!t0.call(o,n)&&n!==t&&fa(o,n,{get:()=>e[n],enumerable:!(r=QS(e,n))||r.enumerable});return o};var bn=(o,e,t)=>(t=o!=null?XS(e0(o)):{},Gm(e||!o||!o.__esModule?fa(t,"default",{value:o,enumerable:!0}):t,o)),o0=o=>Gm(fa({},"__esModule",{value:!0}),o);var dt=(o,e,t)=>(r0(o,typeof e!="symbol"?e+"":e,t),t);var ua=Di((lE,Ym)=>{"use strict";function Qr(o){if(typeof o!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(o))}function jm(o,e){for(var t="",r=0,n=-1,s=0,a,i=0;i<=o.length;++i){if(i<o.length)a=o.charCodeAt(i);else{if(a===47)break;a=47}if(a===47){if(!(n===i-1||s===1))if(n!==i-1&&s===2){if(t.length<2||r!==2||t.charCodeAt(t.length-1)!==46||t.charCodeAt(t.length-2)!==46){if(t.length>2){var l=t.lastIndexOf("/");if(l!==t.length-1){l===-1?(t="",r=0):(t=t.slice(0,l),r=t.length-1-t.lastIndexOf("/")),n=i,s=0;continue}}else if(t.length===2||t.length===1){t="",r=0,n=i,s=0;continue}}e&&(t.length>0?t+="/..":t="..",r=2)}else t.length>0?t+="/"+o.slice(n+1,i):t=o.slice(n+1,i),r=i-n-1;n=i,s=0}else a===46&&s!==-1?++s:s=-1}return t}function n0(o,e){var t=e.dir||e.root,r=e.base||(e.name||"")+(e.ext||"");return t?t===e.root?t+r:t+o+r:r}var Qn={resolve:function(){for(var e="",t=!1,r,n=arguments.length-1;n>=-1&&!t;n--){var s;n>=0?s=arguments[n]:(r===void 0&&(r=process.cwd()),s=r),Qr(s),s.length!==0&&(e=s+"/"+e,t=s.charCodeAt(0)===47)}return e=jm(e,!t),t?e.length>0?"/"+e:"/":e.length>0?e:"."},normalize:function(e){if(Qr(e),e.length===0)return".";var t=e.charCodeAt(0)===47,r=e.charCodeAt(e.length-1)===47;return e=jm(e,!t),e.length===0&&!t&&(e="."),e.length>0&&r&&(e+="/"),t?"/"+e:e},isAbsolute:function(e){return Qr(e),e.length>0&&e.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var e,t=0;t<arguments.length;++t){var r=arguments[t];Qr(r),r.length>0&&(e===void 0?e=r:e+="/"+r)}return e===void 0?".":Qn.normalize(e)},relative:function(e,t){if(Qr(e),Qr(t),e===t||(e=Qn.resolve(e),t=Qn.resolve(t),e===t))return"";for(var r=1;r<e.length&&e.charCodeAt(r)===47;++r);for(var n=e.length,s=n-r,a=1;a<t.length&&t.charCodeAt(a)===47;++a);for(var i=t.length,l=i-a,f=s<l?s:l,u=-1,d=0;d<=f;++d){if(d===f){if(l>f){if(t.charCodeAt(a+d)===47)return t.slice(a+d+1);if(d===0)return t.slice(a+d)}else s>f&&(e.charCodeAt(r+d)===47?u=d:d===0&&(u=0));break}var m=e.charCodeAt(r+d),x=t.charCodeAt(a+d);if(m!==x)break;m===47&&(u=d)}var h="";for(d=r+u+1;d<=n;++d)(d===n||e.charCodeAt(d)===47)&&(h.length===0?h+="..":h+="/..");return h.length>0?h+t.slice(a+u):(a+=u,t.charCodeAt(a)===47&&++a,t.slice(a))},_makeLong:function(e){return e},dirname:function(e){if(Qr(e),e.length===0)return".";for(var t=e.charCodeAt(0),r=t===47,n=-1,s=!0,a=e.length-1;a>=1;--a)if(t=e.charCodeAt(a),t===47){if(!s){n=a;break}}else s=!1;return n===-1?r?"/":".":r&&n===1?"//":e.slice(0,n)},basename:function(e,t){if(t!==void 0&&typeof t!="string")throw new TypeError('"ext" argument must be a string');Qr(e);var r=0,n=-1,s=!0,a;if(t!==void 0&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";var i=t.length-1,l=-1;for(a=e.length-1;a>=0;--a){var f=e.charCodeAt(a);if(f===47){if(!s){r=a+1;break}}else l===-1&&(s=!1,l=a+1),i>=0&&(f===t.charCodeAt(i)?--i===-1&&(n=a):(i=-1,n=l))}return r===n?n=l:n===-1&&(n=e.length),e.slice(r,n)}else{for(a=e.length-1;a>=0;--a)if(e.charCodeAt(a)===47){if(!s){r=a+1;break}}else n===-1&&(s=!1,n=a+1);return n===-1?"":e.slice(r,n)}},extname:function(e){Qr(e);for(var t=-1,r=0,n=-1,s=!0,a=0,i=e.length-1;i>=0;--i){var l=e.charCodeAt(i);if(l===47){if(!s){r=i+1;break}continue}n===-1&&(s=!1,n=i+1),l===46?t===-1?t=i:a!==1&&(a=1):t!==-1&&(a=-1)}return t===-1||n===-1||a===0||a===1&&t===n-1&&t===r+1?"":e.slice(t,n)},format:function(e){if(e===null||typeof e!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return n0("/",e)},parse:function(e){Qr(e);var t={root:"",dir:"",base:"",ext:"",name:""};if(e.length===0)return t;var r=e.charCodeAt(0),n=r===47,s;n?(t.root="/",s=1):s=0;for(var a=-1,i=0,l=-1,f=!0,u=e.length-1,d=0;u>=s;--u){if(r=e.charCodeAt(u),r===47){if(!f){i=u+1;break}continue}l===-1&&(f=!1,l=u+1),r===46?a===-1?a=u:d!==1&&(d=1):a!==-1&&(d=-1)}return a===-1||l===-1||d===0||d===1&&a===l-1&&a===i+1?l!==-1&&(i===0&&n?t.base=t.name=e.slice(1,l):t.base=t.name=e.slice(i,l)):(i===0&&n?(t.name=e.slice(1,a),t.base=e.slice(1,l)):(t.name=e.slice(i,a),t.base=e.slice(i,l)),t.ext=e.slice(a,l)),i>0?t.dir=e.slice(0,i-1):n&&(t.dir="/"),t},sep:"/",delimiter:":",win32:null,posix:null};Qn.posix=Qn;Ym.exports=Qn});var md=Di((O4,Hs)=>{var ae=function(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32},et=-1,rt=1,Ue=0;ae.Diff=function(o,e){return[o,e]};ae.prototype.diff_main=function(o,e,t,r){typeof r=="undefined"&&(this.Diff_Timeout<=0?r=Number.MAX_VALUE:r=new Date().getTime()+this.Diff_Timeout*1e3);var n=r;if(o==null||e==null)throw new Error("Null input. (diff_main)");if(o==e)return o?[new ae.Diff(Ue,o)]:[];typeof t=="undefined"&&(t=!0);var s=t,a=this.diff_commonPrefix(o,e),i=o.substring(0,a);o=o.substring(a),e=e.substring(a),a=this.diff_commonSuffix(o,e);var l=o.substring(o.length-a);o=o.substring(0,o.length-a),e=e.substring(0,e.length-a);var f=this.diff_compute_(o,e,s,n);return i&&f.unshift(new ae.Diff(Ue,i)),l&&f.push(new ae.Diff(Ue,l)),this.diff_cleanupMerge(f),f};ae.prototype.diff_compute_=function(o,e,t,r){var n;if(!o)return[new ae.Diff(rt,e)];if(!e)return[new ae.Diff(et,o)];var s=o.length>e.length?o:e,a=o.length>e.length?e:o,i=s.indexOf(a);if(i!=-1)return n=[new ae.Diff(rt,s.substring(0,i)),new ae.Diff(Ue,a),new ae.Diff(rt,s.substring(i+a.length))],o.length>e.length&&(n[0][0]=n[2][0]=et),n;if(a.length==1)return[new ae.Diff(et,o),new ae.Diff(rt,e)];var l=this.diff_halfMatch_(o,e);if(l){var f=l[0],u=l[1],d=l[2],m=l[3],x=l[4],h=this.diff_main(f,d,t,r),_=this.diff_main(u,m,t,r);return h.concat([new ae.Diff(Ue,x)],_)}return t&&o.length>100&&e.length>100?this.diff_lineMode_(o,e,r):this.diff_bisect_(o,e,r)};ae.prototype.diff_lineMode_=function(o,e,t){var r=this.diff_linesToChars_(o,e);o=r.chars1,e=r.chars2;var n=r.lineArray,s=this.diff_main(o,e,!1,t);this.diff_charsToLines_(s,n),this.diff_cleanupSemantic(s),s.push(new ae.Diff(Ue,""));for(var a=0,i=0,l=0,f="",u="";a<s.length;){switch(s[a][0]){case rt:l++,u+=s[a][1];break;case et:i++,f+=s[a][1];break;case Ue:if(i>=1&&l>=1){s.splice(a-i-l,i+l),a=a-i-l;for(var d=this.diff_main(f,u,!1,t),m=d.length-1;m>=0;m--)s.splice(a,0,d[m]);a=a+d.length}l=0,i=0,f="",u="";break}a++}return s.pop(),s};ae.prototype.diff_bisect_=function(o,e,t){for(var r=o.length,n=e.length,s=Math.ceil((r+n)/2),a=s,i=2*s,l=new Array(i),f=new Array(i),u=0;u<i;u++)l[u]=-1,f[u]=-1;l[a+1]=0,f[a+1]=0;for(var d=r-n,m=d%2!=0,x=0,h=0,_=0,w=0,v=0;v<s&&!(new Date().getTime()>t);v++){for(var A=-v+x;A<=v-h;A+=2){var U=a+A,I;A==-v||A!=v&&l[U-1]<l[U+1]?I=l[U+1]:I=l[U-1]+1;for(var F=I-A;I<r&&F<n&&o.charAt(I)==e.charAt(F);)I++,F++;if(l[U]=I,I>r)h+=2;else if(F>n)x+=2;else if(m){var $=a+d-A;if($>=0&&$<i&&f[$]!=-1){var E=r-f[$];if(I>=E)return this.diff_bisectSplit_(o,e,I,F,t)}}}for(var M=-v+_;M<=v-w;M+=2){var $=a+M,E;M==-v||M!=v&&f[$-1]<f[$+1]?E=f[$+1]:E=f[$-1]+1;for(var R=E-M;E<r&&R<n&&o.charAt(r-E-1)==e.charAt(n-R-1);)E++,R++;if(f[$]=E,E>r)w+=2;else if(R>n)_+=2;else if(!m){var U=a+d-M;if(U>=0&&U<i&&l[U]!=-1){var I=l[U],F=a+I-U;if(E=r-E,I>=E)return this.diff_bisectSplit_(o,e,I,F,t)}}}}return[new ae.Diff(et,o),new ae.Diff(rt,e)]};ae.prototype.diff_bisectSplit_=function(o,e,t,r,n){var s=o.substring(0,t),a=e.substring(0,r),i=o.substring(t),l=e.substring(r),f=this.diff_main(s,a,!1,n),u=this.diff_main(i,l,!1,n);return f.concat(u)};ae.prototype.diff_linesToChars_=function(o,e){var t=[],r={};t[0]="";function n(l){for(var f="",u=0,d=-1,m=t.length;d<l.length-1;){d=l.indexOf(`
`,u),d==-1&&(d=l.length-1);var x=l.substring(u,d+1);(r.hasOwnProperty?r.hasOwnProperty(x):r[x]!==void 0)?f+=String.fromCharCode(r[x]):(m==s&&(x=l.substring(u),d=l.length),f+=String.fromCharCode(m),r[x]=m,t[m++]=x),u=d+1}return f}var s=4e4,a=n(o);s=65535;var i=n(e);return{chars1:a,chars2:i,lineArray:t}};ae.prototype.diff_charsToLines_=function(o,e){for(var t=0;t<o.length;t++){for(var r=o[t][1],n=[],s=0;s<r.length;s++)n[s]=e[r.charCodeAt(s)];o[t][1]=n.join("")}};ae.prototype.diff_commonPrefix=function(o,e){if(!o||!e||o.charAt(0)!=e.charAt(0))return 0;for(var t=0,r=Math.min(o.length,e.length),n=r,s=0;t<n;)o.substring(s,n)==e.substring(s,n)?(t=n,s=t):r=n,n=Math.floor((r-t)/2+t);return n};ae.prototype.diff_commonSuffix=function(o,e){if(!o||!e||o.charAt(o.length-1)!=e.charAt(e.length-1))return 0;for(var t=0,r=Math.min(o.length,e.length),n=r,s=0;t<n;)o.substring(o.length-n,o.length-s)==e.substring(e.length-n,e.length-s)?(t=n,s=t):r=n,n=Math.floor((r-t)/2+t);return n};ae.prototype.diff_commonOverlap_=function(o,e){var t=o.length,r=e.length;if(t==0||r==0)return 0;t>r?o=o.substring(t-r):t<r&&(e=e.substring(0,t));var n=Math.min(t,r);if(o==e)return n;for(var s=0,a=1;;){var i=o.substring(n-a),l=e.indexOf(i);if(l==-1)return s;a+=l,(l==0||o.substring(n-a)==e.substring(0,a))&&(s=a,a++)}};ae.prototype.diff_halfMatch_=function(o,e){if(this.Diff_Timeout<=0)return null;var t=o.length>e.length?o:e,r=o.length>e.length?e:o;if(t.length<4||r.length*2<t.length)return null;var n=this;function s(h,_,w){for(var v=h.substring(w,w+Math.floor(h.length/4)),A=-1,U="",I,F,$,E;(A=_.indexOf(v,A+1))!=-1;){var M=n.diff_commonPrefix(h.substring(w),_.substring(A)),R=n.diff_commonSuffix(h.substring(0,w),_.substring(0,A));U.length<R+M&&(U=_.substring(A-R,A)+_.substring(A,A+M),I=h.substring(0,w-R),F=h.substring(w+M),$=_.substring(0,A-R),E=_.substring(A+M))}return U.length*2>=h.length?[I,F,$,E,U]:null}var a=s(t,r,Math.ceil(t.length/4)),i=s(t,r,Math.ceil(t.length/2)),l;if(!a&&!i)return null;i?a?l=a[4].length>i[4].length?a:i:l=i:l=a;var f,u,d,m;o.length>e.length?(f=l[0],u=l[1],d=l[2],m=l[3]):(d=l[0],m=l[1],f=l[2],u=l[3]);var x=l[4];return[f,u,d,m,x]};ae.prototype.diff_cleanupSemantic=function(o){for(var e=!1,t=[],r=0,n=null,s=0,a=0,i=0,l=0,f=0;s<o.length;)o[s][0]==Ue?(t[r++]=s,a=l,i=f,l=0,f=0,n=o[s][1]):(o[s][0]==rt?l+=o[s][1].length:f+=o[s][1].length,n&&n.length<=Math.max(a,i)&&n.length<=Math.max(l,f)&&(o.splice(t[r-1],0,new ae.Diff(et,n)),o[t[r-1]+1][0]=rt,r--,r--,s=r>0?t[r-1]:-1,a=0,i=0,l=0,f=0,n=null,e=!0)),s++;for(e&&this.diff_cleanupMerge(o),this.diff_cleanupSemanticLossless(o),s=1;s<o.length;){if(o[s-1][0]==et&&o[s][0]==rt){var u=o[s-1][1],d=o[s][1],m=this.diff_commonOverlap_(u,d),x=this.diff_commonOverlap_(d,u);m>=x?(m>=u.length/2||m>=d.length/2)&&(o.splice(s,0,new ae.Diff(Ue,d.substring(0,m))),o[s-1][1]=u.substring(0,u.length-m),o[s+1][1]=d.substring(m),s++):(x>=u.length/2||x>=d.length/2)&&(o.splice(s,0,new ae.Diff(Ue,u.substring(0,x))),o[s-1][0]=rt,o[s-1][1]=d.substring(0,d.length-x),o[s+1][0]=et,o[s+1][1]=u.substring(x),s++),s++}s++}};ae.prototype.diff_cleanupSemanticLossless=function(o){function e(x,h){if(!x||!h)return 6;var _=x.charAt(x.length-1),w=h.charAt(0),v=_.match(ae.nonAlphaNumericRegex_),A=w.match(ae.nonAlphaNumericRegex_),U=v&&_.match(ae.whitespaceRegex_),I=A&&w.match(ae.whitespaceRegex_),F=U&&_.match(ae.linebreakRegex_),$=I&&w.match(ae.linebreakRegex_),E=F&&x.match(ae.blanklineEndRegex_),M=$&&h.match(ae.blanklineStartRegex_);return E||M?5:F||$?4:v&&!U&&I?3:U||I?2:v||A?1:0}for(var t=1;t<o.length-1;){if(o[t-1][0]==Ue&&o[t+1][0]==Ue){var r=o[t-1][1],n=o[t][1],s=o[t+1][1],a=this.diff_commonSuffix(r,n);if(a){var i=n.substring(n.length-a);r=r.substring(0,r.length-a),n=i+n.substring(0,n.length-a),s=i+s}for(var l=r,f=n,u=s,d=e(r,n)+e(n,s);n.charAt(0)===s.charAt(0);){r+=n.charAt(0),n=n.substring(1)+s.charAt(0),s=s.substring(1);var m=e(r,n)+e(n,s);m>=d&&(d=m,l=r,f=n,u=s)}o[t-1][1]!=l&&(l?o[t-1][1]=l:(o.splice(t-1,1),t--),o[t][1]=f,u?o[t+1][1]=u:(o.splice(t+1,1),t--))}t++}};ae.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/;ae.whitespaceRegex_=/\s/;ae.linebreakRegex_=/[\r\n]/;ae.blanklineEndRegex_=/\n\r?\n$/;ae.blanklineStartRegex_=/^\r?\n\r?\n/;ae.prototype.diff_cleanupEfficiency=function(o){for(var e=!1,t=[],r=0,n=null,s=0,a=!1,i=!1,l=!1,f=!1;s<o.length;)o[s][0]==Ue?(o[s][1].length<this.Diff_EditCost&&(l||f)?(t[r++]=s,a=l,i=f,n=o[s][1]):(r=0,n=null),l=f=!1):(o[s][0]==et?f=!0:l=!0,n&&(a&&i&&l&&f||n.length<this.Diff_EditCost/2&&a+i+l+f==3)&&(o.splice(t[r-1],0,new ae.Diff(et,n)),o[t[r-1]+1][0]=rt,r--,n=null,a&&i?(l=f=!0,r=0):(r--,s=r>0?t[r-1]:-1,l=f=!1),e=!0)),s++;e&&this.diff_cleanupMerge(o)};ae.prototype.diff_cleanupMerge=function(o){o.push(new ae.Diff(Ue,""));for(var e=0,t=0,r=0,n="",s="",a;e<o.length;)switch(o[e][0]){case rt:r++,s+=o[e][1],e++;break;case et:t++,n+=o[e][1],e++;break;case Ue:t+r>1?(t!==0&&r!==0&&(a=this.diff_commonPrefix(s,n),a!==0&&(e-t-r>0&&o[e-t-r-1][0]==Ue?o[e-t-r-1][1]+=s.substring(0,a):(o.splice(0,0,new ae.Diff(Ue,s.substring(0,a))),e++),s=s.substring(a),n=n.substring(a)),a=this.diff_commonSuffix(s,n),a!==0&&(o[e][1]=s.substring(s.length-a)+o[e][1],s=s.substring(0,s.length-a),n=n.substring(0,n.length-a))),e-=t+r,o.splice(e,t+r),n.length&&(o.splice(e,0,new ae.Diff(et,n)),e++),s.length&&(o.splice(e,0,new ae.Diff(rt,s)),e++),e++):e!==0&&o[e-1][0]==Ue?(o[e-1][1]+=o[e][1],o.splice(e,1)):e++,r=0,t=0,n="",s="";break}o[o.length-1][1]===""&&o.pop();var i=!1;for(e=1;e<o.length-1;)o[e-1][0]==Ue&&o[e+1][0]==Ue&&(o[e][1].substring(o[e][1].length-o[e-1][1].length)==o[e-1][1]?(o[e][1]=o[e-1][1]+o[e][1].substring(0,o[e][1].length-o[e-1][1].length),o[e+1][1]=o[e-1][1]+o[e+1][1],o.splice(e-1,1),i=!0):o[e][1].substring(0,o[e+1][1].length)==o[e+1][1]&&(o[e-1][1]+=o[e+1][1],o[e][1]=o[e][1].substring(o[e+1][1].length)+o[e+1][1],o.splice(e+1,1),i=!0)),e++;i&&this.diff_cleanupMerge(o)};ae.prototype.diff_xIndex=function(o,e){var t=0,r=0,n=0,s=0,a;for(a=0;a<o.length&&(o[a][0]!==rt&&(t+=o[a][1].length),o[a][0]!==et&&(r+=o[a][1].length),!(t>e));a++)n=t,s=r;return o.length!=a&&o[a][0]===et?s:s+(e-n)};ae.prototype.diff_prettyHtml=function(o){for(var e=[],t=/&/g,r=/</g,n=/>/g,s=/\n/g,a=0;a<o.length;a++){var i=o[a][0],l=o[a][1],f=l.replace(t,"&amp;").replace(r,"&lt;").replace(n,"&gt;").replace(s,"&para;<br>");switch(i){case rt:e[a]='<ins style="background:#e6ffe6;">'+f+"</ins>";break;case et:e[a]='<del style="background:#ffe6e6;">'+f+"</del>";break;case Ue:e[a]="<span>"+f+"</span>";break}}return e.join("")};ae.prototype.diff_text1=function(o){for(var e=[],t=0;t<o.length;t++)o[t][0]!==rt&&(e[t]=o[t][1]);return e.join("")};ae.prototype.diff_text2=function(o){for(var e=[],t=0;t<o.length;t++)o[t][0]!==et&&(e[t]=o[t][1]);return e.join("")};ae.prototype.diff_levenshtein=function(o){for(var e=0,t=0,r=0,n=0;n<o.length;n++){var s=o[n][0],a=o[n][1];switch(s){case rt:t+=a.length;break;case et:r+=a.length;break;case Ue:e+=Math.max(t,r),t=0,r=0;break}}return e+=Math.max(t,r),e};ae.prototype.diff_toDelta=function(o){for(var e=[],t=0;t<o.length;t++)switch(o[t][0]){case rt:e[t]="+"+encodeURI(o[t][1]);break;case et:e[t]="-"+o[t][1].length;break;case Ue:e[t]="="+o[t][1].length;break}return e.join("	").replace(/%20/g," ")};ae.prototype.diff_fromDelta=function(o,e){for(var t=[],r=0,n=0,s=e.split(/\t/g),a=0;a<s.length;a++){var i=s[a].substring(1);switch(s[a].charAt(0)){case"+":try{t[r++]=new ae.Diff(rt,decodeURI(i))}catch(u){throw new Error("Illegal escape in diff_fromDelta: "+i)}break;case"-":case"=":var l=parseInt(i,10);if(isNaN(l)||l<0)throw new Error("Invalid number in diff_fromDelta: "+i);var f=o.substring(n,n+=l);s[a].charAt(0)=="="?t[r++]=new ae.Diff(Ue,f):t[r++]=new ae.Diff(et,f);break;default:if(s[a])throw new Error("Invalid diff operation in diff_fromDelta: "+s[a])}}if(n!=o.length)throw new Error("Delta length ("+n+") does not equal source text length ("+o.length+").");return t};ae.prototype.match_main=function(o,e,t){if(o==null||e==null||t==null)throw new Error("Null input. (match_main)");return t=Math.max(0,Math.min(t,o.length)),o==e?0:o.length?o.substring(t,t+e.length)==e?t:this.match_bitap_(o,e,t):-1};ae.prototype.match_bitap_=function(o,e,t){if(e.length>this.Match_MaxBits)throw new Error("Pattern too long for this browser.");var r=this.match_alphabet_(e),n=this;function s(I,F){var $=I/e.length,E=Math.abs(t-F);return n.Match_Distance?$+E/n.Match_Distance:E?1:$}var a=this.Match_Threshold,i=o.indexOf(e,t);i!=-1&&(a=Math.min(s(0,i),a),i=o.lastIndexOf(e,t+e.length),i!=-1&&(a=Math.min(s(0,i),a)));var l=1<<e.length-1;i=-1;for(var f,u,d=e.length+o.length,m,x=0;x<e.length;x++){for(f=0,u=d;f<u;)s(x,t+u)<=a?f=u:d=u,u=Math.floor((d-f)/2+f);d=u;var h=Math.max(1,t-u+1),_=Math.min(t+u,o.length)+e.length,w=Array(_+2);w[_+1]=(1<<x)-1;for(var v=_;v>=h;v--){var A=r[o.charAt(v-1)];if(x===0?w[v]=(w[v+1]<<1|1)&A:w[v]=(w[v+1]<<1|1)&A|((m[v+1]|m[v])<<1|1)|m[v+1],w[v]&l){var U=s(x,v-1);if(U<=a)if(a=U,i=v-1,i>t)h=Math.max(1,2*t-i);else break}}if(s(x+1,t)>a)break;m=w}return i};ae.prototype.match_alphabet_=function(o){for(var e={},t=0;t<o.length;t++)e[o.charAt(t)]=0;for(var t=0;t<o.length;t++)e[o.charAt(t)]|=1<<o.length-t-1;return e};ae.prototype.patch_addContext_=function(o,e){if(e.length!=0){if(o.start2===null)throw Error("patch not initialized");for(var t=e.substring(o.start2,o.start2+o.length1),r=0;e.indexOf(t)!=e.lastIndexOf(t)&&t.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)r+=this.Patch_Margin,t=e.substring(o.start2-r,o.start2+o.length1+r);r+=this.Patch_Margin;var n=e.substring(o.start2-r,o.start2);n&&o.diffs.unshift(new ae.Diff(Ue,n));var s=e.substring(o.start2+o.length1,o.start2+o.length1+r);s&&o.diffs.push(new ae.Diff(Ue,s)),o.start1-=n.length,o.start2-=n.length,o.length1+=n.length+s.length,o.length2+=n.length+s.length}};ae.prototype.patch_make=function(o,e,t){var r,n;if(typeof o=="string"&&typeof e=="string"&&typeof t=="undefined")r=o,n=this.diff_main(r,e,!0),n.length>2&&(this.diff_cleanupSemantic(n),this.diff_cleanupEfficiency(n));else if(o&&typeof o=="object"&&typeof e=="undefined"&&typeof t=="undefined")n=o,r=this.diff_text1(n);else if(typeof o=="string"&&e&&typeof e=="object"&&typeof t=="undefined")r=o,n=e;else if(typeof o=="string"&&typeof e=="string"&&t&&typeof t=="object")r=o,n=t;else throw new Error("Unknown call format to patch_make.");if(n.length===0)return[];for(var s=[],a=new ae.patch_obj,i=0,l=0,f=0,u=r,d=r,m=0;m<n.length;m++){var x=n[m][0],h=n[m][1];switch(!i&&x!==Ue&&(a.start1=l,a.start2=f),x){case rt:a.diffs[i++]=n[m],a.length2+=h.length,d=d.substring(0,f)+h+d.substring(f);break;case et:a.length1+=h.length,a.diffs[i++]=n[m],d=d.substring(0,f)+d.substring(f+h.length);break;case Ue:h.length<=2*this.Patch_Margin&&i&&n.length!=m+1?(a.diffs[i++]=n[m],a.length1+=h.length,a.length2+=h.length):h.length>=2*this.Patch_Margin&&i&&(this.patch_addContext_(a,u),s.push(a),a=new ae.patch_obj,i=0,u=d,l=f);break}x!==rt&&(l+=h.length),x!==et&&(f+=h.length)}return i&&(this.patch_addContext_(a,u),s.push(a)),s};ae.prototype.patch_deepCopy=function(o){for(var e=[],t=0;t<o.length;t++){var r=o[t],n=new ae.patch_obj;n.diffs=[];for(var s=0;s<r.diffs.length;s++)n.diffs[s]=new ae.Diff(r.diffs[s][0],r.diffs[s][1]);n.start1=r.start1,n.start2=r.start2,n.length1=r.length1,n.length2=r.length2,e[t]=n}return e};ae.prototype.patch_apply=function(o,e){if(o.length==0)return[e,[]];o=this.patch_deepCopy(o);var t=this.patch_addPadding(o);e=t+e+t,this.patch_splitMax(o);for(var r=0,n=[],s=0;s<o.length;s++){var a=o[s].start2+r,i=this.diff_text1(o[s].diffs),l,f=-1;if(i.length>this.Match_MaxBits?(l=this.match_main(e,i.substring(0,this.Match_MaxBits),a),l!=-1&&(f=this.match_main(e,i.substring(i.length-this.Match_MaxBits),a+i.length-this.Match_MaxBits),(f==-1||l>=f)&&(l=-1))):l=this.match_main(e,i,a),l==-1)n[s]=!1,r-=o[s].length2-o[s].length1;else{n[s]=!0,r=l-a;var u;if(f==-1?u=e.substring(l,l+i.length):u=e.substring(l,f+this.Match_MaxBits),i==u)e=e.substring(0,l)+this.diff_text2(o[s].diffs)+e.substring(l+i.length);else{var d=this.diff_main(i,u,!1);if(i.length>this.Match_MaxBits&&this.diff_levenshtein(d)/i.length>this.Patch_DeleteThreshold)n[s]=!1;else{this.diff_cleanupSemanticLossless(d);for(var m=0,x,h=0;h<o[s].diffs.length;h++){var _=o[s].diffs[h];_[0]!==Ue&&(x=this.diff_xIndex(d,m)),_[0]===rt?e=e.substring(0,l+x)+_[1]+e.substring(l+x):_[0]===et&&(e=e.substring(0,l+x)+e.substring(l+this.diff_xIndex(d,m+_[1].length))),_[0]!==et&&(m+=_[1].length)}}}}}return e=e.substring(t.length,e.length-t.length),[e,n]};ae.prototype.patch_addPadding=function(o){for(var e=this.Patch_Margin,t="",r=1;r<=e;r++)t+=String.fromCharCode(r);for(var r=0;r<o.length;r++)o[r].start1+=e,o[r].start2+=e;var n=o[0],s=n.diffs;if(s.length==0||s[0][0]!=Ue)s.unshift(new ae.Diff(Ue,t)),n.start1-=e,n.start2-=e,n.length1+=e,n.length2+=e;else if(e>s[0][1].length){var a=e-s[0][1].length;s[0][1]=t.substring(s[0][1].length)+s[0][1],n.start1-=a,n.start2-=a,n.length1+=a,n.length2+=a}if(n=o[o.length-1],s=n.diffs,s.length==0||s[s.length-1][0]!=Ue)s.push(new ae.Diff(Ue,t)),n.length1+=e,n.length2+=e;else if(e>s[s.length-1][1].length){var a=e-s[s.length-1][1].length;s[s.length-1][1]+=t.substring(0,a),n.length1+=a,n.length2+=a}return t};ae.prototype.patch_splitMax=function(o){for(var e=this.Match_MaxBits,t=0;t<o.length;t++)if(!(o[t].length1<=e)){var r=o[t];o.splice(t--,1);for(var n=r.start1,s=r.start2,a="";r.diffs.length!==0;){var i=new ae.patch_obj,l=!0;for(i.start1=n-a.length,i.start2=s-a.length,a!==""&&(i.length1=i.length2=a.length,i.diffs.push(new ae.Diff(Ue,a)));r.diffs.length!==0&&i.length1<e-this.Patch_Margin;){var f=r.diffs[0][0],u=r.diffs[0][1];f===rt?(i.length2+=u.length,s+=u.length,i.diffs.push(r.diffs.shift()),l=!1):f===et&&i.diffs.length==1&&i.diffs[0][0]==Ue&&u.length>2*e?(i.length1+=u.length,n+=u.length,l=!1,i.diffs.push(new ae.Diff(f,u)),r.diffs.shift()):(u=u.substring(0,e-i.length1-this.Patch_Margin),i.length1+=u.length,n+=u.length,f===Ue?(i.length2+=u.length,s+=u.length):l=!1,i.diffs.push(new ae.Diff(f,u)),u==r.diffs[0][1]?r.diffs.shift():r.diffs[0][1]=r.diffs[0][1].substring(u.length))}a=this.diff_text2(i.diffs),a=a.substring(a.length-this.Patch_Margin);var d=this.diff_text1(r.diffs).substring(0,this.Patch_Margin);d!==""&&(i.length1+=d.length,i.length2+=d.length,i.diffs.length!==0&&i.diffs[i.diffs.length-1][0]===Ue?i.diffs[i.diffs.length-1][1]+=d:i.diffs.push(new ae.Diff(Ue,d))),l||o.splice(++t,0,i)}}};ae.prototype.patch_toText=function(o){for(var e=[],t=0;t<o.length;t++)e[t]=o[t];return e.join("")};ae.prototype.patch_fromText=function(o){var e=[];if(!o)return e;for(var t=o.split(`
`),r=0,n=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;r<t.length;){var s=t[r].match(n);if(!s)throw new Error("Invalid patch string: "+t[r]);var a=new ae.patch_obj;for(e.push(a),a.start1=parseInt(s[1],10),s[2]===""?(a.start1--,a.length1=1):s[2]=="0"?a.length1=0:(a.start1--,a.length1=parseInt(s[2],10)),a.start2=parseInt(s[3],10),s[4]===""?(a.start2--,a.length2=1):s[4]=="0"?a.length2=0:(a.start2--,a.length2=parseInt(s[4],10)),r++;r<t.length;){var i=t[r].charAt(0);try{var l=decodeURI(t[r].substring(1))}catch(f){throw new Error("Illegal escape in patch_fromText: "+l)}if(i=="-")a.diffs.push(new ae.Diff(et,l));else if(i=="+")a.diffs.push(new ae.Diff(rt,l));else if(i==" ")a.diffs.push(new ae.Diff(Ue,l));else{if(i=="@")break;if(i!=="")throw new Error('Invalid patch mode "'+i+'" in: '+l)}r++}}return e};ae.patch_obj=function(){this.diffs=[],this.start1=null,this.start2=null,this.length1=0,this.length2=0};ae.patch_obj.prototype.toString=function(){var o,e;this.length1===0?o=this.start1+",0":this.length1==1?o=this.start1+1:o=this.start1+1+","+this.length1,this.length2===0?e=this.start2+",0":this.length2==1?e=this.start2+1:e=this.start2+1+","+this.length2;for(var t=["@@ -"+o+" +"+e+` @@
`],r,n=0;n<this.diffs.length;n++){switch(this.diffs[n][0]){case rt:r="+";break;case et:r="-";break;case Ue:r=" ";break}t[n+1]=r+encodeURI(this.diffs[n][1])+`
`}return t.join("").replace(/%20/g," ")};Hs.exports=ae;Hs.exports.diff_match_patch=ae;Hs.exports.DIFF_DELETE=et;Hs.exports.DIFF_INSERT=rt;Hs.exports.DIFF_EQUAL=Ue});var Ly=Di((y8,Iy)=>{var _y=require("url").parse,bT=require("events"),wT=require("https"),_T=require("http"),vT=require("util"),ST=["pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","secureProtocol","servername","checkServerIdentity"],ky=[239,187,191],kT=58,IT=32,vy=10,LT=13,Sy=1024*256,CT=/^(cookie|authorization)$/i;function TT(o){return ky.every(function(e,t){return o[t]===e})}function xt(o,e){var t=xt.CONNECTING,r=e&&e.headers,n=!1;Object.defineProperty(this,"readyState",{get:function(){return t}}),Object.defineProperty(this,"url",{get:function(){return o}});var s=this;s.reconnectInterval=1e3,s.connectionInProgress=!1;function a(w){t!==xt.CLOSED&&(t=xt.CONNECTING,h("error",new Za("error",{message:w})),m&&(o=m,m=null,n=!1),setTimeout(function(){t!==xt.CONNECTING||s.connectionInProgress||(s.connectionInProgress=!0,x())},s.reconnectInterval))}var i,l="";r&&r["Last-Event-ID"]&&(l=r["Last-Event-ID"],delete r["Last-Event-ID"]);var f=!1,u="",d="",m=null;function x(){var w=_y(o),v=w.protocol==="https:";if(w.headers={"Cache-Control":"no-cache",Accept:"text/event-stream"},l&&(w.headers["Last-Event-ID"]=l),r){var A=n?DT(r):r;for(var U in A){var I=A[U];I&&(w.headers[U]=I)}}w.rejectUnauthorized=!(e&&!e.rejectUnauthorized),e&&e.createConnection!==void 0&&(w.createConnection=e.createConnection);var F=e&&e.proxy;if(F){var $=_y(e.proxy);v=$.protocol==="https:",w.protocol=v?"https:":"http:",w.path=o,w.headers.Host=w.host,w.hostname=$.hostname,w.host=$.host,w.port=$.port}if(e&&e.https){for(var E in e.https)if(ST.indexOf(E)!==-1){var M=e.https[E];M!==void 0&&(w[E]=M)}}e&&e.withCredentials!==void 0&&(w.withCredentials=e.withCredentials),i=(v?wT:_T).request(w,function(R){if(s.connectionInProgress=!1,R.statusCode===500||R.statusCode===502||R.statusCode===503||R.statusCode===504){h("error",new Za("error",{status:R.statusCode,message:R.statusMessage})),a();return}if(R.statusCode===301||R.statusCode===302||R.statusCode===307){var q=R.headers.location;if(!q){h("error",new Za("error",{status:R.statusCode,message:R.statusMessage}));return}var J=new URL(o).origin,G=new URL(q).origin;n=J!==G,R.statusCode===307&&(m=o),o=q,process.nextTick(x);return}if(R.statusCode!==200)return h("error",new Za("error",{status:R.statusCode,message:R.statusMessage})),s.close();t=xt.OPEN,R.on("close",function(){R.removeAllListeners("close"),R.removeAllListeners("end"),a()}),R.on("end",function(){R.removeAllListeners("close"),R.removeAllListeners("end"),a()}),h("open",new Za("open"));var z,W,oe=0,Ie=-1,De=0,Me=0;R.on("data",function(Ye){z?(Ye.length>z.length-Me&&(De=z.length*2+Ye.length,De>Sy&&(De=z.length+Ye.length+Sy),W=Buffer.alloc(De),z.copy(W,0,0,Me),z=W),Ye.copy(z,Me),Me+=Ye.length):(z=Ye,TT(z)&&(z=z.slice(ky.length)),Me=z.length);for(var Re=0,de=Me;Re<de;){f&&(z[Re]===vy&&++Re,f=!1);for(var ce=-1,te=Ie,$e,Lt=oe;ce<0&&Lt<de;++Lt)$e=z[Lt],$e===kT?te<0&&(te=Lt-Re):$e===LT?(f=!0,ce=Lt-Re):$e===vy&&(ce=Lt-Re);if(ce<0){oe=de-Re,Ie=te;break}else oe=0,Ie=-1;_(z,Re,te,ce),Re+=ce+1}Re===de?(z=void 0,Me=0):Re>0&&(z=z.slice(Re,Me),Me=z.length)})}),i.on("error",function(R){s.connectionInProgress=!1,a(R.message)}),i.setNoDelay&&i.setNoDelay(!0),i.end()}x();function h(){s.listeners(arguments[0]).length>0&&s.emit.apply(s,arguments)}this._close=function(){t!==xt.CLOSED&&(t=xt.CLOSED,i.abort&&i.abort(),i.xhr&&i.xhr.abort&&i.xhr.abort())};function _(w,v,A,U){if(U===0){if(u.length>0){var I=d||"message";h(I,new PT(I,{data:u.slice(0,-1),lastEventId:l,origin:new URL(o).origin})),u=""}d=void 0}else if(A>0){var F=A<0,$=0,E=w.slice(v,v+(F?U:A)).toString();F?$=U:w[v+A+1]!==IT?$=A+1:$=A+2,v+=$;var M=U-$,R=w.slice(v,v+M).toString();if(E==="data")u+=R+`
`;else if(E==="event")d=R;else if(E==="id")l=R;else if(E==="retry"){var q=parseInt(R,10);Number.isNaN(q)||(s.reconnectInterval=q)}}}}Iy.exports=xt;vT.inherits(xt,bT.EventEmitter);xt.prototype.constructor=xt;["open","error","message"].forEach(function(o){Object.defineProperty(xt.prototype,"on"+o,{get:function(){var t=this.listeners(o)[0];return t?t._listener?t._listener:t:void 0},set:function(t){this.removeAllListeners(o),this.addEventListener(o,t)}})});Object.defineProperty(xt,"CONNECTING",{enumerable:!0,value:0});Object.defineProperty(xt,"OPEN",{enumerable:!0,value:1});Object.defineProperty(xt,"CLOSED",{enumerable:!0,value:2});xt.prototype.CONNECTING=0;xt.prototype.OPEN=1;xt.prototype.CLOSED=2;xt.prototype.close=function(){this._close()};xt.prototype.addEventListener=function(e,t){typeof t=="function"&&(t._listener=t,this.on(e,t))};xt.prototype.dispatchEvent=function(e){if(!e.type)throw new Error("UNSPECIFIED_EVENT_TYPE_ERR");this.emit(e.type,e.detail)};xt.prototype.removeEventListener=function(e,t){typeof t=="function"&&(t._listener=void 0,this.removeListener(e,t))};function Za(o,e){if(Object.defineProperty(this,"type",{writable:!1,value:o,enumerable:!0}),e)for(var t in e)e.hasOwnProperty(t)&&Object.defineProperty(this,t,{writable:!1,value:e[t],enumerable:!0})}function PT(o,e){Object.defineProperty(this,"type",{writable:!1,value:o,enumerable:!0});for(var t in e)e.hasOwnProperty(t)&&Object.defineProperty(this,t,{writable:!1,value:e[t],enumerable:!0})}function DT(o){var e={};for(var t in o)CT.test(t)||(e[t]=o[t]);return e}});var Zy=Di((yp,js)=>{(function(o,e){typeof yp=="object"&&typeof js!="undefined"?js.exports=e():typeof define=="function"&&define.amd?define(e):o.moment=e()})(yp,function(){"use strict";var o;function e(){return o.apply(null,arguments)}function t(c){o=c}function r(c){return c instanceof Array||Object.prototype.toString.call(c)==="[object Array]"}function n(c){return c!=null&&Object.prototype.toString.call(c)==="[object Object]"}function s(c,p){return Object.prototype.hasOwnProperty.call(c,p)}function a(c){if(Object.getOwnPropertyNames)return Object.getOwnPropertyNames(c).length===0;var p;for(p in c)if(s(c,p))return!1;return!0}function i(c){return c===void 0}function l(c){return typeof c=="number"||Object.prototype.toString.call(c)==="[object Number]"}function f(c){return c instanceof Date||Object.prototype.toString.call(c)==="[object Date]"}function u(c,p){var g=[],y,S=c.length;for(y=0;y<S;++y)g.push(p(c[y],y));return g}function d(c,p){for(var g in p)s(p,g)&&(c[g]=p[g]);return s(p,"toString")&&(c.toString=p.toString),s(p,"valueOf")&&(c.valueOf=p.valueOf),c}function m(c,p,g,y){return Im(c,p,g,y,!0).utc()}function x(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidEra:null,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1,parsedDateParts:[],era:null,meridiem:null,rfc2822:!1,weekdayMismatch:!1}}function h(c){return c._pf==null&&(c._pf=x()),c._pf}var _;Array.prototype.some?_=Array.prototype.some:_=function(c){var p=Object(this),g=p.length>>>0,y;for(y=0;y<g;y++)if(y in p&&c.call(this,p[y],y,p))return!0;return!1};function w(c){if(c._isValid==null){var p=h(c),g=_.call(p.parsedDateParts,function(S){return S!=null}),y=!isNaN(c._d.getTime())&&p.overflow<0&&!p.empty&&!p.invalidEra&&!p.invalidMonth&&!p.invalidWeekday&&!p.weekdayMismatch&&!p.nullInput&&!p.invalidFormat&&!p.userInvalidated&&(!p.meridiem||p.meridiem&&g);if(c._strict&&(y=y&&p.charsLeftOver===0&&p.unusedTokens.length===0&&p.bigHour===void 0),Object.isFrozen==null||!Object.isFrozen(c))c._isValid=y;else return y}return c._isValid}function v(c){var p=m(NaN);return c!=null?d(h(p),c):h(p).userInvalidated=!0,p}var A=e.momentProperties=[],U=!1;function I(c,p){var g,y,S,O=A.length;if(i(p._isAMomentObject)||(c._isAMomentObject=p._isAMomentObject),i(p._i)||(c._i=p._i),i(p._f)||(c._f=p._f),i(p._l)||(c._l=p._l),i(p._strict)||(c._strict=p._strict),i(p._tzm)||(c._tzm=p._tzm),i(p._isUTC)||(c._isUTC=p._isUTC),i(p._offset)||(c._offset=p._offset),i(p._pf)||(c._pf=h(p)),i(p._locale)||(c._locale=p._locale),O>0)for(g=0;g<O;g++)y=A[g],S=p[y],i(S)||(c[y]=S);return c}function F(c){I(this,c),this._d=new Date(c._d!=null?c._d.getTime():NaN),this.isValid()||(this._d=new Date(NaN)),U===!1&&(U=!0,e.updateOffset(this),U=!1)}function $(c){return c instanceof F||c!=null&&c._isAMomentObject!=null}function E(c){e.suppressDeprecationWarnings===!1&&typeof console!="undefined"&&console.warn&&console.warn("Deprecation warning: "+c)}function M(c,p){var g=!0;return d(function(){if(e.deprecationHandler!=null&&e.deprecationHandler(null,c),g){var y=[],S,O,j,Se=arguments.length;for(O=0;O<Se;O++){if(S="",typeof arguments[O]=="object"){S+=`
[`+O+"] ";for(j in arguments[0])s(arguments[0],j)&&(S+=j+": "+arguments[0][j]+", ");S=S.slice(0,-2)}else S=arguments[O];y.push(S)}E(c+`
Arguments: `+Array.prototype.slice.call(y).join("")+`
`+new Error().stack),g=!1}return p.apply(this,arguments)},p)}var R={};function q(c,p){e.deprecationHandler!=null&&e.deprecationHandler(c,p),R[c]||(E(p),R[c]=!0)}e.suppressDeprecationWarnings=!1,e.deprecationHandler=null;function J(c){return typeof Function!="undefined"&&c instanceof Function||Object.prototype.toString.call(c)==="[object Function]"}function G(c){var p,g;for(g in c)s(c,g)&&(p=c[g],J(p)?this[g]=p:this["_"+g]=p);this._config=c,this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)}function z(c,p){var g=d({},c),y;for(y in p)s(p,y)&&(n(c[y])&&n(p[y])?(g[y]={},d(g[y],c[y]),d(g[y],p[y])):p[y]!=null?g[y]=p[y]:delete g[y]);for(y in c)s(c,y)&&!s(p,y)&&n(c[y])&&(g[y]=d({},g[y]));return g}function W(c){c!=null&&this.set(c)}var oe;Object.keys?oe=Object.keys:oe=function(c){var p,g=[];for(p in c)s(c,p)&&g.push(p);return g};var Ie={sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"};function De(c,p,g){var y=this._calendar[c]||this._calendar.sameElse;return J(y)?y.call(p,g):y}function Me(c,p,g){var y=""+Math.abs(c),S=p-y.length,O=c>=0;return(O?g?"+":"":"-")+Math.pow(10,Math.max(0,S)).toString().substr(1)+y}var Ye=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,Re=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,de={},ce={};function te(c,p,g,y){var S=y;typeof y=="string"&&(S=function(){return this[y]()}),c&&(ce[c]=S),p&&(ce[p[0]]=function(){return Me(S.apply(this,arguments),p[1],p[2])}),g&&(ce[g]=function(){return this.localeData().ordinal(S.apply(this,arguments),c)})}function $e(c){return c.match(/\[[\s\S]/)?c.replace(/^\[|\]$/g,""):c.replace(/\\/g,"")}function Lt(c){var p=c.match(Ye),g,y;for(g=0,y=p.length;g<y;g++)ce[p[g]]?p[g]=ce[p[g]]:p[g]=$e(p[g]);return function(S){var O="",j;for(j=0;j<y;j++)O+=J(p[j])?p[j].call(S,c):p[j];return O}}function Mt(c,p){return c.isValid()?(p=Et(p,c.localeData()),de[p]=de[p]||Lt(p),de[p](c)):c.localeData().invalidDate()}function Et(c,p){var g=5;function y(S){return p.longDateFormat(S)||S}for(Re.lastIndex=0;g>=0&&Re.test(c);)c=c.replace(Re,y),Re.lastIndex=0,g-=1;return c}var ht={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"};function gt(c){var p=this._longDateFormat[c],g=this._longDateFormat[c.toUpperCase()];return p||!g?p:(this._longDateFormat[c]=g.match(Ye).map(function(y){return y==="MMMM"||y==="MM"||y==="DD"||y==="dddd"?y.slice(1):y}).join(""),this._longDateFormat[c])}var ut="Invalid date";function Wt(){return this._invalidDate}var mn="%d",Wn=/\d{1,2}/;function Qs(c){return this._ordinal.replace("%d",c)}var Zs={future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",w:"a week",ww:"%d weeks",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function zn(c,p,g,y){var S=this._relativeTime[g];return J(S)?S(c,p,g,y):S.replace(/%d/i,c)}function ea(c,p){var g=this._relativeTime[c>0?"future":"past"];return J(g)?g(p):g.replace(/%s/i,p)}var kr={};function ot(c,p){var g=c.toLowerCase();kr[g]=kr[g+"s"]=kr[p]=c}function Ht(c){return typeof c=="string"?kr[c]||kr[c.toLowerCase()]:void 0}function ho(c){var p={},g,y;for(y in c)s(c,y)&&(g=Ht(y),g&&(p[g]=c[y]));return p}var hn={};function ne(c,p){hn[c]=p}function We(c){var p=[],g;for(g in c)s(c,g)&&p.push({unit:g,priority:hn[g]});return p.sort(function(y,S){return y.priority-S.priority}),p}function nt(c){return c%4===0&&c%100!==0||c%400===0}function tt(c){return c<0?Math.ceil(c)||0:Math.floor(c)}function Ae(c){var p=+c,g=0;return p!==0&&isFinite(p)&&(g=tt(p)),g}function Yr(c,p){return function(g){return g!=null?(ui(this,c,g),e.updateOffset(this,p),this):Jr(this,c)}}function Jr(c,p){return c.isValid()?c._d["get"+(c._isUTC?"UTC":"")+p]():NaN}function ui(c,p,g){c.isValid()&&!isNaN(g)&&(p==="FullYear"&&nt(c.year())&&c.month()===1&&c.date()===29?(g=Ae(g),c._d["set"+(c._isUTC?"UTC":"")+p](g,c.month(),yi(g,c.month()))):c._d["set"+(c._isUTC?"UTC":"")+p](g))}function Dc(c){return c=Ht(c),J(this[c])?this[c]():this}function Ac(c,p){if(typeof c=="object"){c=ho(c);var g=We(c),y,S=g.length;for(y=0;y<S;y++)this[g[y].unit](c[g[y].unit])}else if(c=Ht(c),J(this[c]))return this[c](p);return this}var di=/\d/,zt=/\d\d/,pi=/\d{3}/,ta=/\d{4}/,Y=/[+-]?\d{6}/,fe=/\d\d?/,st=/\d\d\d\d?/,go=/\d\d\d\d\d\d?/,nr=/\d{1,3}/,Mc=/\d{1,4}/,mi=/[+-]?\d{1,6}/,Kn=/\d+/,hi=/[+-]?\d+/,x_=/Z|[+-]\d\d:?\d\d/gi,gi=/Z|[+-]\d\d(?::?\d\d)?/gi,y_=/[+-]?\d+(\.\d{1,3})?/,ra=/[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFF07\uFF10-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i,xi;xi={};function pe(c,p,g){xi[c]=J(p)?p:function(y,S){return y&&g?g:p}}function b_(c,p){return s(xi,c)?xi[c](p._strict,p._locale):new RegExp(w_(c))}function w_(c){return dr(c.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(p,g,y,S,O){return g||y||S||O}))}function dr(c){return c.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}var Ec={};function Xe(c,p){var g,y=p,S;for(typeof c=="string"&&(c=[c]),l(p)&&(y=function(O,j){j[p]=Ae(O)}),S=c.length,g=0;g<S;g++)Ec[c[g]]=y}function oa(c,p){Xe(c,function(g,y,S,O){S._w=S._w||{},p(g,S._w,S,O)})}function __(c,p,g){p!=null&&s(Ec,c)&&Ec[c](p,g._a,g,c)}var Vt=0,xo=1,Xr=2,kt=3,Fr=4,yo=5,gn=6,v_=7,S_=8;function k_(c,p){return(c%p+p)%p}var yt;Array.prototype.indexOf?yt=Array.prototype.indexOf:yt=function(c){var p;for(p=0;p<this.length;++p)if(this[p]===c)return p;return-1};function yi(c,p){if(isNaN(c)||isNaN(p))return NaN;var g=k_(p,12);return c+=(p-g)/12,g===1?nt(c)?29:28:31-g%7%2}te("M",["MM",2],"Mo",function(){return this.month()+1}),te("MMM",0,0,function(c){return this.localeData().monthsShort(this,c)}),te("MMMM",0,0,function(c){return this.localeData().months(this,c)}),ot("month","M"),ne("month",8),pe("M",fe),pe("MM",fe,zt),pe("MMM",function(c,p){return p.monthsShortRegex(c)}),pe("MMMM",function(c,p){return p.monthsRegex(c)}),Xe(["M","MM"],function(c,p){p[xo]=Ae(c)-1}),Xe(["MMM","MMMM"],function(c,p,g,y){var S=g._locale.monthsParse(c,y,g._strict);S!=null?p[xo]=S:h(g).invalidMonth=c});var I_="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),fm="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),um=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/,L_=ra,C_=ra;function T_(c,p){return c?r(this._months)?this._months[c.month()]:this._months[(this._months.isFormat||um).test(p)?"format":"standalone"][c.month()]:r(this._months)?this._months:this._months.standalone}function P_(c,p){return c?r(this._monthsShort)?this._monthsShort[c.month()]:this._monthsShort[um.test(p)?"format":"standalone"][c.month()]:r(this._monthsShort)?this._monthsShort:this._monthsShort.standalone}function D_(c,p,g){var y,S,O,j=c.toLocaleLowerCase();if(!this._monthsParse)for(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[],y=0;y<12;++y)O=m([2e3,y]),this._shortMonthsParse[y]=this.monthsShort(O,"").toLocaleLowerCase(),this._longMonthsParse[y]=this.months(O,"").toLocaleLowerCase();return g?p==="MMM"?(S=yt.call(this._shortMonthsParse,j),S!==-1?S:null):(S=yt.call(this._longMonthsParse,j),S!==-1?S:null):p==="MMM"?(S=yt.call(this._shortMonthsParse,j),S!==-1?S:(S=yt.call(this._longMonthsParse,j),S!==-1?S:null)):(S=yt.call(this._longMonthsParse,j),S!==-1?S:(S=yt.call(this._shortMonthsParse,j),S!==-1?S:null))}function A_(c,p,g){var y,S,O;if(this._monthsParseExact)return D_.call(this,c,p,g);for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),y=0;y<12;y++){if(S=m([2e3,y]),g&&!this._longMonthsParse[y]&&(this._longMonthsParse[y]=new RegExp("^"+this.months(S,"").replace(".","")+"$","i"),this._shortMonthsParse[y]=new RegExp("^"+this.monthsShort(S,"").replace(".","")+"$","i")),!g&&!this._monthsParse[y]&&(O="^"+this.months(S,"")+"|^"+this.monthsShort(S,""),this._monthsParse[y]=new RegExp(O.replace(".",""),"i")),g&&p==="MMMM"&&this._longMonthsParse[y].test(c))return y;if(g&&p==="MMM"&&this._shortMonthsParse[y].test(c))return y;if(!g&&this._monthsParse[y].test(c))return y}}function dm(c,p){var g;if(!c.isValid())return c;if(typeof p=="string"){if(/^\d+$/.test(p))p=Ae(p);else if(p=c.localeData().monthsParse(p),!l(p))return c}return g=Math.min(c.date(),yi(c.year(),p)),c._d["set"+(c._isUTC?"UTC":"")+"Month"](p,g),c}function pm(c){return c!=null?(dm(this,c),e.updateOffset(this,!0),this):Jr(this,"Month")}function M_(){return yi(this.year(),this.month())}function E_(c){return this._monthsParseExact?(s(this,"_monthsRegex")||mm.call(this),c?this._monthsShortStrictRegex:this._monthsShortRegex):(s(this,"_monthsShortRegex")||(this._monthsShortRegex=L_),this._monthsShortStrictRegex&&c?this._monthsShortStrictRegex:this._monthsShortRegex)}function F_(c){return this._monthsParseExact?(s(this,"_monthsRegex")||mm.call(this),c?this._monthsStrictRegex:this._monthsRegex):(s(this,"_monthsRegex")||(this._monthsRegex=C_),this._monthsStrictRegex&&c?this._monthsStrictRegex:this._monthsRegex)}function mm(){function c(j,Se){return Se.length-j.length}var p=[],g=[],y=[],S,O;for(S=0;S<12;S++)O=m([2e3,S]),p.push(this.monthsShort(O,"")),g.push(this.months(O,"")),y.push(this.months(O,"")),y.push(this.monthsShort(O,""));for(p.sort(c),g.sort(c),y.sort(c),S=0;S<12;S++)p[S]=dr(p[S]),g[S]=dr(g[S]);for(S=0;S<24;S++)y[S]=dr(y[S]);this._monthsRegex=new RegExp("^("+y.join("|")+")","i"),this._monthsShortRegex=this._monthsRegex,this._monthsStrictRegex=new RegExp("^("+g.join("|")+")","i"),this._monthsShortStrictRegex=new RegExp("^("+p.join("|")+")","i")}te("Y",0,0,function(){var c=this.year();return c<=9999?Me(c,4):"+"+c}),te(0,["YY",2],0,function(){return this.year()%100}),te(0,["YYYY",4],0,"year"),te(0,["YYYYY",5],0,"year"),te(0,["YYYYYY",6,!0],0,"year"),ot("year","y"),ne("year",1),pe("Y",hi),pe("YY",fe,zt),pe("YYYY",Mc,ta),pe("YYYYY",mi,Y),pe("YYYYYY",mi,Y),Xe(["YYYYY","YYYYYY"],Vt),Xe("YYYY",function(c,p){p[Vt]=c.length===2?e.parseTwoDigitYear(c):Ae(c)}),Xe("YY",function(c,p){p[Vt]=e.parseTwoDigitYear(c)}),Xe("Y",function(c,p){p[Vt]=parseInt(c,10)});function na(c){return nt(c)?366:365}e.parseTwoDigitYear=function(c){return Ae(c)+(Ae(c)>68?1900:2e3)};var hm=Yr("FullYear",!0);function R_(){return nt(this.year())}function O_(c,p,g,y,S,O,j){var Se;return c<100&&c>=0?(Se=new Date(c+400,p,g,y,S,O,j),isFinite(Se.getFullYear())&&Se.setFullYear(c)):Se=new Date(c,p,g,y,S,O,j),Se}function sa(c){var p,g;return c<100&&c>=0?(g=Array.prototype.slice.call(arguments),g[0]=c+400,p=new Date(Date.UTC.apply(null,g)),isFinite(p.getUTCFullYear())&&p.setUTCFullYear(c)):p=new Date(Date.UTC.apply(null,arguments)),p}function bi(c,p,g){var y=7+p-g,S=(7+sa(c,0,y).getUTCDay()-p)%7;return-S+y-1}function gm(c,p,g,y,S){var O=(7+g-y)%7,j=bi(c,y,S),Se=1+7*(p-1)+O+j,Be,Qe;return Se<=0?(Be=c-1,Qe=na(Be)+Se):Se>na(c)?(Be=c+1,Qe=Se-na(c)):(Be=c,Qe=Se),{year:Be,dayOfYear:Qe}}function aa(c,p,g){var y=bi(c.year(),p,g),S=Math.floor((c.dayOfYear()-y-1)/7)+1,O,j;return S<1?(j=c.year()-1,O=S+bo(j,p,g)):S>bo(c.year(),p,g)?(O=S-bo(c.year(),p,g),j=c.year()+1):(j=c.year(),O=S),{week:O,year:j}}function bo(c,p,g){var y=bi(c,p,g),S=bi(c+1,p,g);return(na(c)-y+S)/7}te("w",["ww",2],"wo","week"),te("W",["WW",2],"Wo","isoWeek"),ot("week","w"),ot("isoWeek","W"),ne("week",5),ne("isoWeek",5),pe("w",fe),pe("ww",fe,zt),pe("W",fe),pe("WW",fe,zt),oa(["w","ww","W","WW"],function(c,p,g,y){p[y.substr(0,1)]=Ae(c)});function U_(c){return aa(c,this._week.dow,this._week.doy).week}var $_={dow:0,doy:6};function B_(){return this._week.dow}function N_(){return this._week.doy}function H_(c){var p=this.localeData().week(this);return c==null?p:this.add((c-p)*7,"d")}function V_(c){var p=aa(this,1,4).week;return c==null?p:this.add((c-p)*7,"d")}te("d",0,"do","day"),te("dd",0,0,function(c){return this.localeData().weekdaysMin(this,c)}),te("ddd",0,0,function(c){return this.localeData().weekdaysShort(this,c)}),te("dddd",0,0,function(c){return this.localeData().weekdays(this,c)}),te("e",0,0,"weekday"),te("E",0,0,"isoWeekday"),ot("day","d"),ot("weekday","e"),ot("isoWeekday","E"),ne("day",11),ne("weekday",11),ne("isoWeekday",11),pe("d",fe),pe("e",fe),pe("E",fe),pe("dd",function(c,p){return p.weekdaysMinRegex(c)}),pe("ddd",function(c,p){return p.weekdaysShortRegex(c)}),pe("dddd",function(c,p){return p.weekdaysRegex(c)}),oa(["dd","ddd","dddd"],function(c,p,g,y){var S=g._locale.weekdaysParse(c,y,g._strict);S!=null?p.d=S:h(g).invalidWeekday=c}),oa(["d","e","E"],function(c,p,g,y){p[y]=Ae(c)});function q_(c,p){return typeof c!="string"?c:isNaN(c)?(c=p.weekdaysParse(c),typeof c=="number"?c:null):parseInt(c,10)}function W_(c,p){return typeof c=="string"?p.weekdaysParse(c)%7||7:isNaN(c)?null:c}function Fc(c,p){return c.slice(p,7).concat(c.slice(0,p))}var z_="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),xm="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),K_="Su_Mo_Tu_We_Th_Fr_Sa".split("_"),G_=ra,j_=ra,Y_=ra;function J_(c,p){var g=r(this._weekdays)?this._weekdays:this._weekdays[c&&c!==!0&&this._weekdays.isFormat.test(p)?"format":"standalone"];return c===!0?Fc(g,this._week.dow):c?g[c.day()]:g}function X_(c){return c===!0?Fc(this._weekdaysShort,this._week.dow):c?this._weekdaysShort[c.day()]:this._weekdaysShort}function Q_(c){return c===!0?Fc(this._weekdaysMin,this._week.dow):c?this._weekdaysMin[c.day()]:this._weekdaysMin}function Z_(c,p,g){var y,S,O,j=c.toLocaleLowerCase();if(!this._weekdaysParse)for(this._weekdaysParse=[],this._shortWeekdaysParse=[],this._minWeekdaysParse=[],y=0;y<7;++y)O=m([2e3,1]).day(y),this._minWeekdaysParse[y]=this.weekdaysMin(O,"").toLocaleLowerCase(),this._shortWeekdaysParse[y]=this.weekdaysShort(O,"").toLocaleLowerCase(),this._weekdaysParse[y]=this.weekdays(O,"").toLocaleLowerCase();return g?p==="dddd"?(S=yt.call(this._weekdaysParse,j),S!==-1?S:null):p==="ddd"?(S=yt.call(this._shortWeekdaysParse,j),S!==-1?S:null):(S=yt.call(this._minWeekdaysParse,j),S!==-1?S:null):p==="dddd"?(S=yt.call(this._weekdaysParse,j),S!==-1||(S=yt.call(this._shortWeekdaysParse,j),S!==-1)?S:(S=yt.call(this._minWeekdaysParse,j),S!==-1?S:null)):p==="ddd"?(S=yt.call(this._shortWeekdaysParse,j),S!==-1||(S=yt.call(this._weekdaysParse,j),S!==-1)?S:(S=yt.call(this._minWeekdaysParse,j),S!==-1?S:null)):(S=yt.call(this._minWeekdaysParse,j),S!==-1||(S=yt.call(this._weekdaysParse,j),S!==-1)?S:(S=yt.call(this._shortWeekdaysParse,j),S!==-1?S:null))}function ev(c,p,g){var y,S,O;if(this._weekdaysParseExact)return Z_.call(this,c,p,g);for(this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]),y=0;y<7;y++){if(S=m([2e3,1]).day(y),g&&!this._fullWeekdaysParse[y]&&(this._fullWeekdaysParse[y]=new RegExp("^"+this.weekdays(S,"").replace(".","\\.?")+"$","i"),this._shortWeekdaysParse[y]=new RegExp("^"+this.weekdaysShort(S,"").replace(".","\\.?")+"$","i"),this._minWeekdaysParse[y]=new RegExp("^"+this.weekdaysMin(S,"").replace(".","\\.?")+"$","i")),this._weekdaysParse[y]||(O="^"+this.weekdays(S,"")+"|^"+this.weekdaysShort(S,"")+"|^"+this.weekdaysMin(S,""),this._weekdaysParse[y]=new RegExp(O.replace(".",""),"i")),g&&p==="dddd"&&this._fullWeekdaysParse[y].test(c))return y;if(g&&p==="ddd"&&this._shortWeekdaysParse[y].test(c))return y;if(g&&p==="dd"&&this._minWeekdaysParse[y].test(c))return y;if(!g&&this._weekdaysParse[y].test(c))return y}}function tv(c){if(!this.isValid())return c!=null?this:NaN;var p=this._isUTC?this._d.getUTCDay():this._d.getDay();return c!=null?(c=q_(c,this.localeData()),this.add(c-p,"d")):p}function rv(c){if(!this.isValid())return c!=null?this:NaN;var p=(this.day()+7-this.localeData()._week.dow)%7;return c==null?p:this.add(c-p,"d")}function ov(c){if(!this.isValid())return c!=null?this:NaN;if(c!=null){var p=W_(c,this.localeData());return this.day(this.day()%7?p:p-7)}else return this.day()||7}function nv(c){return this._weekdaysParseExact?(s(this,"_weekdaysRegex")||Rc.call(this),c?this._weekdaysStrictRegex:this._weekdaysRegex):(s(this,"_weekdaysRegex")||(this._weekdaysRegex=G_),this._weekdaysStrictRegex&&c?this._weekdaysStrictRegex:this._weekdaysRegex)}function sv(c){return this._weekdaysParseExact?(s(this,"_weekdaysRegex")||Rc.call(this),c?this._weekdaysShortStrictRegex:this._weekdaysShortRegex):(s(this,"_weekdaysShortRegex")||(this._weekdaysShortRegex=j_),this._weekdaysShortStrictRegex&&c?this._weekdaysShortStrictRegex:this._weekdaysShortRegex)}function av(c){return this._weekdaysParseExact?(s(this,"_weekdaysRegex")||Rc.call(this),c?this._weekdaysMinStrictRegex:this._weekdaysMinRegex):(s(this,"_weekdaysMinRegex")||(this._weekdaysMinRegex=Y_),this._weekdaysMinStrictRegex&&c?this._weekdaysMinStrictRegex:this._weekdaysMinRegex)}function Rc(){function c(Kt,ko){return ko.length-Kt.length}var p=[],g=[],y=[],S=[],O,j,Se,Be,Qe;for(O=0;O<7;O++)j=m([2e3,1]).day(O),Se=dr(this.weekdaysMin(j,"")),Be=dr(this.weekdaysShort(j,"")),Qe=dr(this.weekdays(j,"")),p.push(Se),g.push(Be),y.push(Qe),S.push(Se),S.push(Be),S.push(Qe);p.sort(c),g.sort(c),y.sort(c),S.sort(c),this._weekdaysRegex=new RegExp("^("+S.join("|")+")","i"),this._weekdaysShortRegex=this._weekdaysRegex,this._weekdaysMinRegex=this._weekdaysRegex,this._weekdaysStrictRegex=new RegExp("^("+y.join("|")+")","i"),this._weekdaysShortStrictRegex=new RegExp("^("+g.join("|")+")","i"),this._weekdaysMinStrictRegex=new RegExp("^("+p.join("|")+")","i")}function Oc(){return this.hours()%12||12}function iv(){return this.hours()||24}te("H",["HH",2],0,"hour"),te("h",["hh",2],0,Oc),te("k",["kk",2],0,iv),te("hmm",0,0,function(){return""+Oc.apply(this)+Me(this.minutes(),2)}),te("hmmss",0,0,function(){return""+Oc.apply(this)+Me(this.minutes(),2)+Me(this.seconds(),2)}),te("Hmm",0,0,function(){return""+this.hours()+Me(this.minutes(),2)}),te("Hmmss",0,0,function(){return""+this.hours()+Me(this.minutes(),2)+Me(this.seconds(),2)});function ym(c,p){te(c,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),p)})}ym("a",!0),ym("A",!1),ot("hour","h"),ne("hour",13);function bm(c,p){return p._meridiemParse}pe("a",bm),pe("A",bm),pe("H",fe),pe("h",fe),pe("k",fe),pe("HH",fe,zt),pe("hh",fe,zt),pe("kk",fe,zt),pe("hmm",st),pe("hmmss",go),pe("Hmm",st),pe("Hmmss",go),Xe(["H","HH"],kt),Xe(["k","kk"],function(c,p,g){var y=Ae(c);p[kt]=y===24?0:y}),Xe(["a","A"],function(c,p,g){g._isPm=g._locale.isPM(c),g._meridiem=c}),Xe(["h","hh"],function(c,p,g){p[kt]=Ae(c),h(g).bigHour=!0}),Xe("hmm",function(c,p,g){var y=c.length-2;p[kt]=Ae(c.substr(0,y)),p[Fr]=Ae(c.substr(y)),h(g).bigHour=!0}),Xe("hmmss",function(c,p,g){var y=c.length-4,S=c.length-2;p[kt]=Ae(c.substr(0,y)),p[Fr]=Ae(c.substr(y,2)),p[yo]=Ae(c.substr(S)),h(g).bigHour=!0}),Xe("Hmm",function(c,p,g){var y=c.length-2;p[kt]=Ae(c.substr(0,y)),p[Fr]=Ae(c.substr(y))}),Xe("Hmmss",function(c,p,g){var y=c.length-4,S=c.length-2;p[kt]=Ae(c.substr(0,y)),p[Fr]=Ae(c.substr(y,2)),p[yo]=Ae(c.substr(S))});function lv(c){return(c+"").toLowerCase().charAt(0)==="p"}var cv=/[ap]\.?m?\.?/i,fv=Yr("Hours",!0);function uv(c,p,g){return c>11?g?"pm":"PM":g?"am":"AM"}var wm={calendar:Ie,longDateFormat:ht,invalidDate:ut,ordinal:mn,dayOfMonthOrdinalParse:Wn,relativeTime:Zs,months:I_,monthsShort:fm,week:$_,weekdays:z_,weekdaysMin:K_,weekdaysShort:xm,meridiemParse:cv},lt={},ia={},la;function dv(c,p){var g,y=Math.min(c.length,p.length);for(g=0;g<y;g+=1)if(c[g]!==p[g])return g;return y}function _m(c){return c&&c.toLowerCase().replace("_","-")}function pv(c){for(var p=0,g,y,S,O;p<c.length;){for(O=_m(c[p]).split("-"),g=O.length,y=_m(c[p+1]),y=y?y.split("-"):null;g>0;){if(S=wi(O.slice(0,g).join("-")),S)return S;if(y&&y.length>=g&&dv(O,y)>=g-1)break;g--}p++}return la}function mv(c){return c.match("^[^/\\\\]*$")!=null}function wi(c){var p=null,g;if(lt[c]===void 0&&typeof js!="undefined"&&js&&js.exports&&mv(c))try{p=la._abbr,g=require,g("./locale/"+c),zo(p)}catch(y){lt[c]=null}return lt[c]}function zo(c,p){var g;return c&&(i(p)?g=wo(c):g=Uc(c,p),g?la=g:typeof console!="undefined"&&console.warn&&console.warn("Locale "+c+" not found. Did you forget to load it?")),la._abbr}function Uc(c,p){if(p!==null){var g,y=wm;if(p.abbr=c,lt[c]!=null)q("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale See http://momentjs.com/guides/#/warnings/define-locale/ for more info."),y=lt[c]._config;else if(p.parentLocale!=null)if(lt[p.parentLocale]!=null)y=lt[p.parentLocale]._config;else if(g=wi(p.parentLocale),g!=null)y=g._config;else return ia[p.parentLocale]||(ia[p.parentLocale]=[]),ia[p.parentLocale].push({name:c,config:p}),null;return lt[c]=new W(z(y,p)),ia[c]&&ia[c].forEach(function(S){Uc(S.name,S.config)}),zo(c),lt[c]}else return delete lt[c],null}function hv(c,p){if(p!=null){var g,y,S=wm;lt[c]!=null&&lt[c].parentLocale!=null?lt[c].set(z(lt[c]._config,p)):(y=wi(c),y!=null&&(S=y._config),p=z(S,p),y==null&&(p.abbr=c),g=new W(p),g.parentLocale=lt[c],lt[c]=g),zo(c)}else lt[c]!=null&&(lt[c].parentLocale!=null?(lt[c]=lt[c].parentLocale,c===zo()&&zo(c)):lt[c]!=null&&delete lt[c]);return lt[c]}function wo(c){var p;if(c&&c._locale&&c._locale._abbr&&(c=c._locale._abbr),!c)return la;if(!r(c)){if(p=wi(c),p)return p;c=[c]}return pv(c)}function gv(){return oe(lt)}function $c(c){var p,g=c._a;return g&&h(c).overflow===-2&&(p=g[xo]<0||g[xo]>11?xo:g[Xr]<1||g[Xr]>yi(g[Vt],g[xo])?Xr:g[kt]<0||g[kt]>24||g[kt]===24&&(g[Fr]!==0||g[yo]!==0||g[gn]!==0)?kt:g[Fr]<0||g[Fr]>59?Fr:g[yo]<0||g[yo]>59?yo:g[gn]<0||g[gn]>999?gn:-1,h(c)._overflowDayOfYear&&(p<Vt||p>Xr)&&(p=Xr),h(c)._overflowWeeks&&p===-1&&(p=v_),h(c)._overflowWeekday&&p===-1&&(p=S_),h(c).overflow=p),c}var xv=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,yv=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d|))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,bv=/Z|[+-]\d\d(?::?\d\d)?/,_i=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/],["YYYYMM",/\d{6}/,!1],["YYYY",/\d{4}/,!1]],Bc=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],wv=/^\/?Date\((-?\d+)/i,_v=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/,vv={UT:0,GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function vm(c){var p,g,y=c._i,S=xv.exec(y)||yv.exec(y),O,j,Se,Be,Qe=_i.length,Kt=Bc.length;if(S){for(h(c).iso=!0,p=0,g=Qe;p<g;p++)if(_i[p][1].exec(S[1])){j=_i[p][0],O=_i[p][2]!==!1;break}if(j==null){c._isValid=!1;return}if(S[3]){for(p=0,g=Kt;p<g;p++)if(Bc[p][1].exec(S[3])){Se=(S[2]||" ")+Bc[p][0];break}if(Se==null){c._isValid=!1;return}}if(!O&&Se!=null){c._isValid=!1;return}if(S[4])if(bv.exec(S[4]))Be="Z";else{c._isValid=!1;return}c._f=j+(Se||"")+(Be||""),Hc(c)}else c._isValid=!1}function Sv(c,p,g,y,S,O){var j=[kv(c),fm.indexOf(p),parseInt(g,10),parseInt(y,10),parseInt(S,10)];return O&&j.push(parseInt(O,10)),j}function kv(c){var p=parseInt(c,10);return p<=49?2e3+p:p<=999?1900+p:p}function Iv(c){return c.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function Lv(c,p,g){if(c){var y=xm.indexOf(c),S=new Date(p[0],p[1],p[2]).getDay();if(y!==S)return h(g).weekdayMismatch=!0,g._isValid=!1,!1}return!0}function Cv(c,p,g){if(c)return vv[c];if(p)return 0;var y=parseInt(g,10),S=y%100,O=(y-S)/100;return O*60+S}function Sm(c){var p=_v.exec(Iv(c._i)),g;if(p){if(g=Sv(p[4],p[3],p[2],p[5],p[6],p[7]),!Lv(p[1],g,c))return;c._a=g,c._tzm=Cv(p[8],p[9],p[10]),c._d=sa.apply(null,c._a),c._d.setUTCMinutes(c._d.getUTCMinutes()-c._tzm),h(c).rfc2822=!0}else c._isValid=!1}function Tv(c){var p=wv.exec(c._i);if(p!==null){c._d=new Date(+p[1]);return}if(vm(c),c._isValid===!1)delete c._isValid;else return;if(Sm(c),c._isValid===!1)delete c._isValid;else return;c._strict?c._isValid=!1:e.createFromInputFallback(c)}e.createFromInputFallback=M("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are discouraged. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.",function(c){c._d=new Date(c._i+(c._useUTC?" UTC":""))});function Gn(c,p,g){return c!=null?c:p!=null?p:g}function Pv(c){var p=new Date(e.now());return c._useUTC?[p.getUTCFullYear(),p.getUTCMonth(),p.getUTCDate()]:[p.getFullYear(),p.getMonth(),p.getDate()]}function Nc(c){var p,g,y=[],S,O,j;if(!c._d){for(S=Pv(c),c._w&&c._a[Xr]==null&&c._a[xo]==null&&Dv(c),c._dayOfYear!=null&&(j=Gn(c._a[Vt],S[Vt]),(c._dayOfYear>na(j)||c._dayOfYear===0)&&(h(c)._overflowDayOfYear=!0),g=sa(j,0,c._dayOfYear),c._a[xo]=g.getUTCMonth(),c._a[Xr]=g.getUTCDate()),p=0;p<3&&c._a[p]==null;++p)c._a[p]=y[p]=S[p];for(;p<7;p++)c._a[p]=y[p]=c._a[p]==null?p===2?1:0:c._a[p];c._a[kt]===24&&c._a[Fr]===0&&c._a[yo]===0&&c._a[gn]===0&&(c._nextDay=!0,c._a[kt]=0),c._d=(c._useUTC?sa:O_).apply(null,y),O=c._useUTC?c._d.getUTCDay():c._d.getDay(),c._tzm!=null&&c._d.setUTCMinutes(c._d.getUTCMinutes()-c._tzm),c._nextDay&&(c._a[kt]=24),c._w&&typeof c._w.d!="undefined"&&c._w.d!==O&&(h(c).weekdayMismatch=!0)}}function Dv(c){var p,g,y,S,O,j,Se,Be,Qe;p=c._w,p.GG!=null||p.W!=null||p.E!=null?(O=1,j=4,g=Gn(p.GG,c._a[Vt],aa(at(),1,4).year),y=Gn(p.W,1),S=Gn(p.E,1),(S<1||S>7)&&(Be=!0)):(O=c._locale._week.dow,j=c._locale._week.doy,Qe=aa(at(),O,j),g=Gn(p.gg,c._a[Vt],Qe.year),y=Gn(p.w,Qe.week),p.d!=null?(S=p.d,(S<0||S>6)&&(Be=!0)):p.e!=null?(S=p.e+O,(p.e<0||p.e>6)&&(Be=!0)):S=O),y<1||y>bo(g,O,j)?h(c)._overflowWeeks=!0:Be!=null?h(c)._overflowWeekday=!0:(Se=gm(g,y,S,O,j),c._a[Vt]=Se.year,c._dayOfYear=Se.dayOfYear)}e.ISO_8601=function(){},e.RFC_2822=function(){};function Hc(c){if(c._f===e.ISO_8601){vm(c);return}if(c._f===e.RFC_2822){Sm(c);return}c._a=[],h(c).empty=!0;var p=""+c._i,g,y,S,O,j,Se=p.length,Be=0,Qe,Kt;for(S=Et(c._f,c._locale).match(Ye)||[],Kt=S.length,g=0;g<Kt;g++)O=S[g],y=(p.match(b_(O,c))||[])[0],y&&(j=p.substr(0,p.indexOf(y)),j.length>0&&h(c).unusedInput.push(j),p=p.slice(p.indexOf(y)+y.length),Be+=y.length),ce[O]?(y?h(c).empty=!1:h(c).unusedTokens.push(O),__(O,y,c)):c._strict&&!y&&h(c).unusedTokens.push(O);h(c).charsLeftOver=Se-Be,p.length>0&&h(c).unusedInput.push(p),c._a[kt]<=12&&h(c).bigHour===!0&&c._a[kt]>0&&(h(c).bigHour=void 0),h(c).parsedDateParts=c._a.slice(0),h(c).meridiem=c._meridiem,c._a[kt]=Av(c._locale,c._a[kt],c._meridiem),Qe=h(c).era,Qe!==null&&(c._a[Vt]=c._locale.erasConvertYear(Qe,c._a[Vt])),Nc(c),$c(c)}function Av(c,p,g){var y;return g==null?p:c.meridiemHour!=null?c.meridiemHour(p,g):(c.isPM!=null&&(y=c.isPM(g),y&&p<12&&(p+=12),!y&&p===12&&(p=0)),p)}function Mv(c){var p,g,y,S,O,j,Se=!1,Be=c._f.length;if(Be===0){h(c).invalidFormat=!0,c._d=new Date(NaN);return}for(S=0;S<Be;S++)O=0,j=!1,p=I({},c),c._useUTC!=null&&(p._useUTC=c._useUTC),p._f=c._f[S],Hc(p),w(p)&&(j=!0),O+=h(p).charsLeftOver,O+=h(p).unusedTokens.length*10,h(p).score=O,Se?O<y&&(y=O,g=p):(y==null||O<y||j)&&(y=O,g=p,j&&(Se=!0));d(c,g||p)}function Ev(c){if(!c._d){var p=ho(c._i),g=p.day===void 0?p.date:p.day;c._a=u([p.year,p.month,g,p.hour,p.minute,p.second,p.millisecond],function(y){return y&&parseInt(y,10)}),Nc(c)}}function Fv(c){var p=new F($c(km(c)));return p._nextDay&&(p.add(1,"d"),p._nextDay=void 0),p}function km(c){var p=c._i,g=c._f;return c._locale=c._locale||wo(c._l),p===null||g===void 0&&p===""?v({nullInput:!0}):(typeof p=="string"&&(c._i=p=c._locale.preparse(p)),$(p)?new F($c(p)):(f(p)?c._d=p:r(g)?Mv(c):g?Hc(c):Rv(c),w(c)||(c._d=null),c))}function Rv(c){var p=c._i;i(p)?c._d=new Date(e.now()):f(p)?c._d=new Date(p.valueOf()):typeof p=="string"?Tv(c):r(p)?(c._a=u(p.slice(0),function(g){return parseInt(g,10)}),Nc(c)):n(p)?Ev(c):l(p)?c._d=new Date(p):e.createFromInputFallback(c)}function Im(c,p,g,y,S){var O={};return(p===!0||p===!1)&&(y=p,p=void 0),(g===!0||g===!1)&&(y=g,g=void 0),(n(c)&&a(c)||r(c)&&c.length===0)&&(c=void 0),O._isAMomentObject=!0,O._useUTC=O._isUTC=S,O._l=g,O._i=c,O._f=p,O._strict=y,Fv(O)}function at(c,p,g,y){return Im(c,p,g,y,!1)}var Ov=M("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var c=at.apply(null,arguments);return this.isValid()&&c.isValid()?c<this?this:c:v()}),Uv=M("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var c=at.apply(null,arguments);return this.isValid()&&c.isValid()?c>this?this:c:v()});function Lm(c,p){var g,y;if(p.length===1&&r(p[0])&&(p=p[0]),!p.length)return at();for(g=p[0],y=1;y<p.length;++y)(!p[y].isValid()||p[y][c](g))&&(g=p[y]);return g}function $v(){var c=[].slice.call(arguments,0);return Lm("isBefore",c)}function Bv(){var c=[].slice.call(arguments,0);return Lm("isAfter",c)}var Nv=function(){return Date.now?Date.now():+new Date},ca=["year","quarter","month","week","day","hour","minute","second","millisecond"];function Hv(c){var p,g=!1,y,S=ca.length;for(p in c)if(s(c,p)&&!(yt.call(ca,p)!==-1&&(c[p]==null||!isNaN(c[p]))))return!1;for(y=0;y<S;++y)if(c[ca[y]]){if(g)return!1;parseFloat(c[ca[y]])!==Ae(c[ca[y]])&&(g=!0)}return!0}function Vv(){return this._isValid}function qv(){return Rr(NaN)}function vi(c){var p=ho(c),g=p.year||0,y=p.quarter||0,S=p.month||0,O=p.week||p.isoWeek||0,j=p.day||0,Se=p.hour||0,Be=p.minute||0,Qe=p.second||0,Kt=p.millisecond||0;this._isValid=Hv(p),this._milliseconds=+Kt+Qe*1e3+Be*6e4+Se*1e3*60*60,this._days=+j+O*7,this._months=+S+y*3+g*12,this._data={},this._locale=wo(),this._bubble()}function Si(c){return c instanceof vi}function Vc(c){return c<0?Math.round(-1*c)*-1:Math.round(c)}function Wv(c,p,g){var y=Math.min(c.length,p.length),S=Math.abs(c.length-p.length),O=0,j;for(j=0;j<y;j++)(g&&c[j]!==p[j]||!g&&Ae(c[j])!==Ae(p[j]))&&O++;return O+S}function Cm(c,p){te(c,0,0,function(){var g=this.utcOffset(),y="+";return g<0&&(g=-g,y="-"),y+Me(~~(g/60),2)+p+Me(~~g%60,2)})}Cm("Z",":"),Cm("ZZ",""),pe("Z",gi),pe("ZZ",gi),Xe(["Z","ZZ"],function(c,p,g){g._useUTC=!0,g._tzm=qc(gi,c)});var zv=/([\+\-]|\d\d)/gi;function qc(c,p){var g=(p||"").match(c),y,S,O;return g===null?null:(y=g[g.length-1]||[],S=(y+"").match(zv)||["-",0,0],O=+(S[1]*60)+Ae(S[2]),O===0?0:S[0]==="+"?O:-O)}function Wc(c,p){var g,y;return p._isUTC?(g=p.clone(),y=($(c)||f(c)?c.valueOf():at(c).valueOf())-g.valueOf(),g._d.setTime(g._d.valueOf()+y),e.updateOffset(g,!1),g):at(c).local()}function zc(c){return-Math.round(c._d.getTimezoneOffset())}e.updateOffset=function(){};function Kv(c,p,g){var y=this._offset||0,S;if(!this.isValid())return c!=null?this:NaN;if(c!=null){if(typeof c=="string"){if(c=qc(gi,c),c===null)return this}else Math.abs(c)<16&&!g&&(c=c*60);return!this._isUTC&&p&&(S=zc(this)),this._offset=c,this._isUTC=!0,S!=null&&this.add(S,"m"),y!==c&&(!p||this._changeInProgress?Am(this,Rr(c-y,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,e.updateOffset(this,!0),this._changeInProgress=null)),this}else return this._isUTC?y:zc(this)}function Gv(c,p){return c!=null?(typeof c!="string"&&(c=-c),this.utcOffset(c,p),this):-this.utcOffset()}function jv(c){return this.utcOffset(0,c)}function Yv(c){return this._isUTC&&(this.utcOffset(0,c),this._isUTC=!1,c&&this.subtract(zc(this),"m")),this}function Jv(){if(this._tzm!=null)this.utcOffset(this._tzm,!1,!0);else if(typeof this._i=="string"){var c=qc(x_,this._i);c!=null?this.utcOffset(c):this.utcOffset(0,!0)}return this}function Xv(c){return this.isValid()?(c=c?at(c).utcOffset():0,(this.utcOffset()-c)%60===0):!1}function Qv(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()}function Zv(){if(!i(this._isDSTShifted))return this._isDSTShifted;var c={},p;return I(c,this),c=km(c),c._a?(p=c._isUTC?m(c._a):at(c._a),this._isDSTShifted=this.isValid()&&Wv(c._a,p.toArray())>0):this._isDSTShifted=!1,this._isDSTShifted}function e1(){return this.isValid()?!this._isUTC:!1}function t1(){return this.isValid()?this._isUTC:!1}function Tm(){return this.isValid()?this._isUTC&&this._offset===0:!1}var r1=/^(-|\+)?(?:(\d*)[. ])?(\d+):(\d+)(?::(\d+)(\.\d*)?)?$/,o1=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;function Rr(c,p){var g=c,y=null,S,O,j;return Si(c)?g={ms:c._milliseconds,d:c._days,M:c._months}:l(c)||!isNaN(+c)?(g={},p?g[p]=+c:g.milliseconds=+c):(y=r1.exec(c))?(S=y[1]==="-"?-1:1,g={y:0,d:Ae(y[Xr])*S,h:Ae(y[kt])*S,m:Ae(y[Fr])*S,s:Ae(y[yo])*S,ms:Ae(Vc(y[gn]*1e3))*S}):(y=o1.exec(c))?(S=y[1]==="-"?-1:1,g={y:xn(y[2],S),M:xn(y[3],S),w:xn(y[4],S),d:xn(y[5],S),h:xn(y[6],S),m:xn(y[7],S),s:xn(y[8],S)}):g==null?g={}:typeof g=="object"&&("from"in g||"to"in g)&&(j=n1(at(g.from),at(g.to)),g={},g.ms=j.milliseconds,g.M=j.months),O=new vi(g),Si(c)&&s(c,"_locale")&&(O._locale=c._locale),Si(c)&&s(c,"_isValid")&&(O._isValid=c._isValid),O}Rr.fn=vi.prototype,Rr.invalid=qv;function xn(c,p){var g=c&&parseFloat(c.replace(",","."));return(isNaN(g)?0:g)*p}function Pm(c,p){var g={};return g.months=p.month()-c.month()+(p.year()-c.year())*12,c.clone().add(g.months,"M").isAfter(p)&&--g.months,g.milliseconds=+p-+c.clone().add(g.months,"M"),g}function n1(c,p){var g;return c.isValid()&&p.isValid()?(p=Wc(p,c),c.isBefore(p)?g=Pm(c,p):(g=Pm(p,c),g.milliseconds=-g.milliseconds,g.months=-g.months),g):{milliseconds:0,months:0}}function Dm(c,p){return function(g,y){var S,O;return y!==null&&!isNaN(+y)&&(q(p,"moment()."+p+"(period, number) is deprecated. Please use moment()."+p+"(number, period). See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info."),O=g,g=y,y=O),S=Rr(g,y),Am(this,S,c),this}}function Am(c,p,g,y){var S=p._milliseconds,O=Vc(p._days),j=Vc(p._months);c.isValid()&&(y=y==null?!0:y,j&&dm(c,Jr(c,"Month")+j*g),O&&ui(c,"Date",Jr(c,"Date")+O*g),S&&c._d.setTime(c._d.valueOf()+S*g),y&&e.updateOffset(c,O||j))}var s1=Dm(1,"add"),a1=Dm(-1,"subtract");function Mm(c){return typeof c=="string"||c instanceof String}function i1(c){return $(c)||f(c)||Mm(c)||l(c)||c1(c)||l1(c)||c===null||c===void 0}function l1(c){var p=n(c)&&!a(c),g=!1,y=["years","year","y","months","month","M","days","day","d","dates","date","D","hours","hour","h","minutes","minute","m","seconds","second","s","milliseconds","millisecond","ms"],S,O,j=y.length;for(S=0;S<j;S+=1)O=y[S],g=g||s(c,O);return p&&g}function c1(c){var p=r(c),g=!1;return p&&(g=c.filter(function(y){return!l(y)&&Mm(c)}).length===0),p&&g}function f1(c){var p=n(c)&&!a(c),g=!1,y=["sameDay","nextDay","lastDay","nextWeek","lastWeek","sameElse"],S,O;for(S=0;S<y.length;S+=1)O=y[S],g=g||s(c,O);return p&&g}function u1(c,p){var g=c.diff(p,"days",!0);return g<-6?"sameElse":g<-1?"lastWeek":g<0?"lastDay":g<1?"sameDay":g<2?"nextDay":g<7?"nextWeek":"sameElse"}function d1(c,p){arguments.length===1&&(arguments[0]?i1(arguments[0])?(c=arguments[0],p=void 0):f1(arguments[0])&&(p=arguments[0],c=void 0):(c=void 0,p=void 0));var g=c||at(),y=Wc(g,this).startOf("day"),S=e.calendarFormat(this,y)||"sameElse",O=p&&(J(p[S])?p[S].call(this,g):p[S]);return this.format(O||this.localeData().calendar(S,this,at(g)))}function p1(){return new F(this)}function m1(c,p){var g=$(c)?c:at(c);return this.isValid()&&g.isValid()?(p=Ht(p)||"millisecond",p==="millisecond"?this.valueOf()>g.valueOf():g.valueOf()<this.clone().startOf(p).valueOf()):!1}function h1(c,p){var g=$(c)?c:at(c);return this.isValid()&&g.isValid()?(p=Ht(p)||"millisecond",p==="millisecond"?this.valueOf()<g.valueOf():this.clone().endOf(p).valueOf()<g.valueOf()):!1}function g1(c,p,g,y){var S=$(c)?c:at(c),O=$(p)?p:at(p);return this.isValid()&&S.isValid()&&O.isValid()?(y=y||"()",(y[0]==="("?this.isAfter(S,g):!this.isBefore(S,g))&&(y[1]===")"?this.isBefore(O,g):!this.isAfter(O,g))):!1}function x1(c,p){var g=$(c)?c:at(c),y;return this.isValid()&&g.isValid()?(p=Ht(p)||"millisecond",p==="millisecond"?this.valueOf()===g.valueOf():(y=g.valueOf(),this.clone().startOf(p).valueOf()<=y&&y<=this.clone().endOf(p).valueOf())):!1}function y1(c,p){return this.isSame(c,p)||this.isAfter(c,p)}function b1(c,p){return this.isSame(c,p)||this.isBefore(c,p)}function w1(c,p,g){var y,S,O;if(!this.isValid())return NaN;if(y=Wc(c,this),!y.isValid())return NaN;switch(S=(y.utcOffset()-this.utcOffset())*6e4,p=Ht(p),p){case"year":O=ki(this,y)/12;break;case"month":O=ki(this,y);break;case"quarter":O=ki(this,y)/3;break;case"second":O=(this-y)/1e3;break;case"minute":O=(this-y)/6e4;break;case"hour":O=(this-y)/36e5;break;case"day":O=(this-y-S)/864e5;break;case"week":O=(this-y-S)/6048e5;break;default:O=this-y}return g?O:tt(O)}function ki(c,p){if(c.date()<p.date())return-ki(p,c);var g=(p.year()-c.year())*12+(p.month()-c.month()),y=c.clone().add(g,"months"),S,O;return p-y<0?(S=c.clone().add(g-1,"months"),O=(p-y)/(y-S)):(S=c.clone().add(g+1,"months"),O=(p-y)/(S-y)),-(g+O)||0}e.defaultFormat="YYYY-MM-DDTHH:mm:ssZ",e.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";function _1(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")}function v1(c){if(!this.isValid())return null;var p=c!==!0,g=p?this.clone().utc():this;return g.year()<0||g.year()>9999?Mt(g,p?"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYYYY-MM-DD[T]HH:mm:ss.SSSZ"):J(Date.prototype.toISOString)?p?this.toDate().toISOString():new Date(this.valueOf()+this.utcOffset()*60*1e3).toISOString().replace("Z",Mt(g,"Z")):Mt(g,p?"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYY-MM-DD[T]HH:mm:ss.SSSZ")}function S1(){if(!this.isValid())return"moment.invalid(/* "+this._i+" */)";var c="moment",p="",g,y,S,O;return this.isLocal()||(c=this.utcOffset()===0?"moment.utc":"moment.parseZone",p="Z"),g="["+c+'("]',y=0<=this.year()&&this.year()<=9999?"YYYY":"YYYYYY",S="-MM-DD[T]HH:mm:ss.SSS",O=p+'[")]',this.format(g+y+S+O)}function k1(c){c||(c=this.isUtc()?e.defaultFormatUtc:e.defaultFormat);var p=Mt(this,c);return this.localeData().postformat(p)}function I1(c,p){return this.isValid()&&($(c)&&c.isValid()||at(c).isValid())?Rr({to:this,from:c}).locale(this.locale()).humanize(!p):this.localeData().invalidDate()}function L1(c){return this.from(at(),c)}function C1(c,p){return this.isValid()&&($(c)&&c.isValid()||at(c).isValid())?Rr({from:this,to:c}).locale(this.locale()).humanize(!p):this.localeData().invalidDate()}function T1(c){return this.to(at(),c)}function Em(c){var p;return c===void 0?this._locale._abbr:(p=wo(c),p!=null&&(this._locale=p),this)}var Fm=M("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(c){return c===void 0?this.localeData():this.locale(c)});function Rm(){return this._locale}var Ii=1e3,jn=60*Ii,Li=60*jn,Om=(365*400+97)*24*Li;function Yn(c,p){return(c%p+p)%p}function Um(c,p,g){return c<100&&c>=0?new Date(c+400,p,g)-Om:new Date(c,p,g).valueOf()}function $m(c,p,g){return c<100&&c>=0?Date.UTC(c+400,p,g)-Om:Date.UTC(c,p,g)}function P1(c){var p,g;if(c=Ht(c),c===void 0||c==="millisecond"||!this.isValid())return this;switch(g=this._isUTC?$m:Um,c){case"year":p=g(this.year(),0,1);break;case"quarter":p=g(this.year(),this.month()-this.month()%3,1);break;case"month":p=g(this.year(),this.month(),1);break;case"week":p=g(this.year(),this.month(),this.date()-this.weekday());break;case"isoWeek":p=g(this.year(),this.month(),this.date()-(this.isoWeekday()-1));break;case"day":case"date":p=g(this.year(),this.month(),this.date());break;case"hour":p=this._d.valueOf(),p-=Yn(p+(this._isUTC?0:this.utcOffset()*jn),Li);break;case"minute":p=this._d.valueOf(),p-=Yn(p,jn);break;case"second":p=this._d.valueOf(),p-=Yn(p,Ii);break}return this._d.setTime(p),e.updateOffset(this,!0),this}function D1(c){var p,g;if(c=Ht(c),c===void 0||c==="millisecond"||!this.isValid())return this;switch(g=this._isUTC?$m:Um,c){case"year":p=g(this.year()+1,0,1)-1;break;case"quarter":p=g(this.year(),this.month()-this.month()%3+3,1)-1;break;case"month":p=g(this.year(),this.month()+1,1)-1;break;case"week":p=g(this.year(),this.month(),this.date()-this.weekday()+7)-1;break;case"isoWeek":p=g(this.year(),this.month(),this.date()-(this.isoWeekday()-1)+7)-1;break;case"day":case"date":p=g(this.year(),this.month(),this.date()+1)-1;break;case"hour":p=this._d.valueOf(),p+=Li-Yn(p+(this._isUTC?0:this.utcOffset()*jn),Li)-1;break;case"minute":p=this._d.valueOf(),p+=jn-Yn(p,jn)-1;break;case"second":p=this._d.valueOf(),p+=Ii-Yn(p,Ii)-1;break}return this._d.setTime(p),e.updateOffset(this,!0),this}function A1(){return this._d.valueOf()-(this._offset||0)*6e4}function M1(){return Math.floor(this.valueOf()/1e3)}function E1(){return new Date(this.valueOf())}function F1(){var c=this;return[c.year(),c.month(),c.date(),c.hour(),c.minute(),c.second(),c.millisecond()]}function R1(){var c=this;return{years:c.year(),months:c.month(),date:c.date(),hours:c.hours(),minutes:c.minutes(),seconds:c.seconds(),milliseconds:c.milliseconds()}}function O1(){return this.isValid()?this.toISOString():null}function U1(){return w(this)}function $1(){return d({},h(this))}function B1(){return h(this).overflow}function N1(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}}te("N",0,0,"eraAbbr"),te("NN",0,0,"eraAbbr"),te("NNN",0,0,"eraAbbr"),te("NNNN",0,0,"eraName"),te("NNNNN",0,0,"eraNarrow"),te("y",["y",1],"yo","eraYear"),te("y",["yy",2],0,"eraYear"),te("y",["yyy",3],0,"eraYear"),te("y",["yyyy",4],0,"eraYear"),pe("N",Kc),pe("NN",Kc),pe("NNN",Kc),pe("NNNN",X1),pe("NNNNN",Q1),Xe(["N","NN","NNN","NNNN","NNNNN"],function(c,p,g,y){var S=g._locale.erasParse(c,y,g._strict);S?h(g).era=S:h(g).invalidEra=c}),pe("y",Kn),pe("yy",Kn),pe("yyy",Kn),pe("yyyy",Kn),pe("yo",Z1),Xe(["y","yy","yyy","yyyy"],Vt),Xe(["yo"],function(c,p,g,y){var S;g._locale._eraYearOrdinalRegex&&(S=c.match(g._locale._eraYearOrdinalRegex)),g._locale.eraYearOrdinalParse?p[Vt]=g._locale.eraYearOrdinalParse(c,S):p[Vt]=parseInt(c,10)});function H1(c,p){var g,y,S,O=this._eras||wo("en")._eras;for(g=0,y=O.length;g<y;++g){switch(typeof O[g].since){case"string":S=e(O[g].since).startOf("day"),O[g].since=S.valueOf();break}switch(typeof O[g].until){case"undefined":O[g].until=1/0;break;case"string":S=e(O[g].until).startOf("day").valueOf(),O[g].until=S.valueOf();break}}return O}function V1(c,p,g){var y,S,O=this.eras(),j,Se,Be;for(c=c.toUpperCase(),y=0,S=O.length;y<S;++y)if(j=O[y].name.toUpperCase(),Se=O[y].abbr.toUpperCase(),Be=O[y].narrow.toUpperCase(),g)switch(p){case"N":case"NN":case"NNN":if(Se===c)return O[y];break;case"NNNN":if(j===c)return O[y];break;case"NNNNN":if(Be===c)return O[y];break}else if([j,Se,Be].indexOf(c)>=0)return O[y]}function q1(c,p){var g=c.since<=c.until?1:-1;return p===void 0?e(c.since).year():e(c.since).year()+(p-c.offset)*g}function W1(){var c,p,g,y=this.localeData().eras();for(c=0,p=y.length;c<p;++c)if(g=this.clone().startOf("day").valueOf(),y[c].since<=g&&g<=y[c].until||y[c].until<=g&&g<=y[c].since)return y[c].name;return""}function z1(){var c,p,g,y=this.localeData().eras();for(c=0,p=y.length;c<p;++c)if(g=this.clone().startOf("day").valueOf(),y[c].since<=g&&g<=y[c].until||y[c].until<=g&&g<=y[c].since)return y[c].narrow;return""}function K1(){var c,p,g,y=this.localeData().eras();for(c=0,p=y.length;c<p;++c)if(g=this.clone().startOf("day").valueOf(),y[c].since<=g&&g<=y[c].until||y[c].until<=g&&g<=y[c].since)return y[c].abbr;return""}function G1(){var c,p,g,y,S=this.localeData().eras();for(c=0,p=S.length;c<p;++c)if(g=S[c].since<=S[c].until?1:-1,y=this.clone().startOf("day").valueOf(),S[c].since<=y&&y<=S[c].until||S[c].until<=y&&y<=S[c].since)return(this.year()-e(S[c].since).year())*g+S[c].offset;return this.year()}function j1(c){return s(this,"_erasNameRegex")||Gc.call(this),c?this._erasNameRegex:this._erasRegex}function Y1(c){return s(this,"_erasAbbrRegex")||Gc.call(this),c?this._erasAbbrRegex:this._erasRegex}function J1(c){return s(this,"_erasNarrowRegex")||Gc.call(this),c?this._erasNarrowRegex:this._erasRegex}function Kc(c,p){return p.erasAbbrRegex(c)}function X1(c,p){return p.erasNameRegex(c)}function Q1(c,p){return p.erasNarrowRegex(c)}function Z1(c,p){return p._eraYearOrdinalRegex||Kn}function Gc(){var c=[],p=[],g=[],y=[],S,O,j=this.eras();for(S=0,O=j.length;S<O;++S)p.push(dr(j[S].name)),c.push(dr(j[S].abbr)),g.push(dr(j[S].narrow)),y.push(dr(j[S].name)),y.push(dr(j[S].abbr)),y.push(dr(j[S].narrow));this._erasRegex=new RegExp("^("+y.join("|")+")","i"),this._erasNameRegex=new RegExp("^("+p.join("|")+")","i"),this._erasAbbrRegex=new RegExp("^("+c.join("|")+")","i"),this._erasNarrowRegex=new RegExp("^("+g.join("|")+")","i")}te(0,["gg",2],0,function(){return this.weekYear()%100}),te(0,["GG",2],0,function(){return this.isoWeekYear()%100});function Ci(c,p){te(0,[c,c.length],0,p)}Ci("gggg","weekYear"),Ci("ggggg","weekYear"),Ci("GGGG","isoWeekYear"),Ci("GGGGG","isoWeekYear"),ot("weekYear","gg"),ot("isoWeekYear","GG"),ne("weekYear",1),ne("isoWeekYear",1),pe("G",hi),pe("g",hi),pe("GG",fe,zt),pe("gg",fe,zt),pe("GGGG",Mc,ta),pe("gggg",Mc,ta),pe("GGGGG",mi,Y),pe("ggggg",mi,Y),oa(["gggg","ggggg","GGGG","GGGGG"],function(c,p,g,y){p[y.substr(0,2)]=Ae(c)}),oa(["gg","GG"],function(c,p,g,y){p[y]=e.parseTwoDigitYear(c)});function eS(c){return Bm.call(this,c,this.week(),this.weekday(),this.localeData()._week.dow,this.localeData()._week.doy)}function tS(c){return Bm.call(this,c,this.isoWeek(),this.isoWeekday(),1,4)}function rS(){return bo(this.year(),1,4)}function oS(){return bo(this.isoWeekYear(),1,4)}function nS(){var c=this.localeData()._week;return bo(this.year(),c.dow,c.doy)}function sS(){var c=this.localeData()._week;return bo(this.weekYear(),c.dow,c.doy)}function Bm(c,p,g,y,S){var O;return c==null?aa(this,y,S).year:(O=bo(c,y,S),p>O&&(p=O),aS.call(this,c,p,g,y,S))}function aS(c,p,g,y,S){var O=gm(c,p,g,y,S),j=sa(O.year,0,O.dayOfYear);return this.year(j.getUTCFullYear()),this.month(j.getUTCMonth()),this.date(j.getUTCDate()),this}te("Q",0,"Qo","quarter"),ot("quarter","Q"),ne("quarter",7),pe("Q",di),Xe("Q",function(c,p){p[xo]=(Ae(c)-1)*3});function iS(c){return c==null?Math.ceil((this.month()+1)/3):this.month((c-1)*3+this.month()%3)}te("D",["DD",2],"Do","date"),ot("date","D"),ne("date",9),pe("D",fe),pe("DD",fe,zt),pe("Do",function(c,p){return c?p._dayOfMonthOrdinalParse||p._ordinalParse:p._dayOfMonthOrdinalParseLenient}),Xe(["D","DD"],Xr),Xe("Do",function(c,p){p[Xr]=Ae(c.match(fe)[0])});var Nm=Yr("Date",!0);te("DDD",["DDDD",3],"DDDo","dayOfYear"),ot("dayOfYear","DDD"),ne("dayOfYear",4),pe("DDD",nr),pe("DDDD",pi),Xe(["DDD","DDDD"],function(c,p,g){g._dayOfYear=Ae(c)});function lS(c){var p=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return c==null?p:this.add(c-p,"d")}te("m",["mm",2],0,"minute"),ot("minute","m"),ne("minute",14),pe("m",fe),pe("mm",fe,zt),Xe(["m","mm"],Fr);var cS=Yr("Minutes",!1);te("s",["ss",2],0,"second"),ot("second","s"),ne("second",15),pe("s",fe),pe("ss",fe,zt),Xe(["s","ss"],yo);var fS=Yr("Seconds",!1);te("S",0,0,function(){return~~(this.millisecond()/100)}),te(0,["SS",2],0,function(){return~~(this.millisecond()/10)}),te(0,["SSS",3],0,"millisecond"),te(0,["SSSS",4],0,function(){return this.millisecond()*10}),te(0,["SSSSS",5],0,function(){return this.millisecond()*100}),te(0,["SSSSSS",6],0,function(){return this.millisecond()*1e3}),te(0,["SSSSSSS",7],0,function(){return this.millisecond()*1e4}),te(0,["SSSSSSSS",8],0,function(){return this.millisecond()*1e5}),te(0,["SSSSSSSSS",9],0,function(){return this.millisecond()*1e6}),ot("millisecond","ms"),ne("millisecond",16),pe("S",nr,di),pe("SS",nr,zt),pe("SSS",nr,pi);var Ko,Hm;for(Ko="SSSS";Ko.length<=9;Ko+="S")pe(Ko,Kn);function uS(c,p){p[gn]=Ae(("0."+c)*1e3)}for(Ko="S";Ko.length<=9;Ko+="S")Xe(Ko,uS);Hm=Yr("Milliseconds",!1),te("z",0,0,"zoneAbbr"),te("zz",0,0,"zoneName");function dS(){return this._isUTC?"UTC":""}function pS(){return this._isUTC?"Coordinated Universal Time":""}var ie=F.prototype;ie.add=s1,ie.calendar=d1,ie.clone=p1,ie.diff=w1,ie.endOf=D1,ie.format=k1,ie.from=I1,ie.fromNow=L1,ie.to=C1,ie.toNow=T1,ie.get=Dc,ie.invalidAt=B1,ie.isAfter=m1,ie.isBefore=h1,ie.isBetween=g1,ie.isSame=x1,ie.isSameOrAfter=y1,ie.isSameOrBefore=b1,ie.isValid=U1,ie.lang=Fm,ie.locale=Em,ie.localeData=Rm,ie.max=Uv,ie.min=Ov,ie.parsingFlags=$1,ie.set=Ac,ie.startOf=P1,ie.subtract=a1,ie.toArray=F1,ie.toObject=R1,ie.toDate=E1,ie.toISOString=v1,ie.inspect=S1,typeof Symbol!="undefined"&&Symbol.for!=null&&(ie[Symbol.for("nodejs.util.inspect.custom")]=function(){return"Moment<"+this.format()+">"}),ie.toJSON=O1,ie.toString=_1,ie.unix=M1,ie.valueOf=A1,ie.creationData=N1,ie.eraName=W1,ie.eraNarrow=z1,ie.eraAbbr=K1,ie.eraYear=G1,ie.year=hm,ie.isLeapYear=R_,ie.weekYear=eS,ie.isoWeekYear=tS,ie.quarter=ie.quarters=iS,ie.month=pm,ie.daysInMonth=M_,ie.week=ie.weeks=H_,ie.isoWeek=ie.isoWeeks=V_,ie.weeksInYear=nS,ie.weeksInWeekYear=sS,ie.isoWeeksInYear=rS,ie.isoWeeksInISOWeekYear=oS,ie.date=Nm,ie.day=ie.days=tv,ie.weekday=rv,ie.isoWeekday=ov,ie.dayOfYear=lS,ie.hour=ie.hours=fv,ie.minute=ie.minutes=cS,ie.second=ie.seconds=fS,ie.millisecond=ie.milliseconds=Hm,ie.utcOffset=Kv,ie.utc=jv,ie.local=Yv,ie.parseZone=Jv,ie.hasAlignedHourOffset=Xv,ie.isDST=Qv,ie.isLocal=e1,ie.isUtcOffset=t1,ie.isUtc=Tm,ie.isUTC=Tm,ie.zoneAbbr=dS,ie.zoneName=pS,ie.dates=M("dates accessor is deprecated. Use date instead.",Nm),ie.months=M("months accessor is deprecated. Use month instead",pm),ie.years=M("years accessor is deprecated. Use year instead",hm),ie.zone=M("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",Gv),ie.isDSTShifted=M("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",Zv);function mS(c){return at(c*1e3)}function hS(){return at.apply(null,arguments).parseZone()}function Vm(c){return c}var je=W.prototype;je.calendar=De,je.longDateFormat=gt,je.invalidDate=Wt,je.ordinal=Qs,je.preparse=Vm,je.postformat=Vm,je.relativeTime=zn,je.pastFuture=ea,je.set=G,je.eras=H1,je.erasParse=V1,je.erasConvertYear=q1,je.erasAbbrRegex=Y1,je.erasNameRegex=j1,je.erasNarrowRegex=J1,je.months=T_,je.monthsShort=P_,je.monthsParse=A_,je.monthsRegex=F_,je.monthsShortRegex=E_,je.week=U_,je.firstDayOfYear=N_,je.firstDayOfWeek=B_,je.weekdays=J_,je.weekdaysMin=Q_,je.weekdaysShort=X_,je.weekdaysParse=ev,je.weekdaysRegex=nv,je.weekdaysShortRegex=sv,je.weekdaysMinRegex=av,je.isPM=lv,je.meridiem=uv;function Ti(c,p,g,y){var S=wo(),O=m().set(y,p);return S[g](O,c)}function qm(c,p,g){if(l(c)&&(p=c,c=void 0),c=c||"",p!=null)return Ti(c,p,g,"month");var y,S=[];for(y=0;y<12;y++)S[y]=Ti(c,y,g,"month");return S}function jc(c,p,g,y){typeof c=="boolean"?(l(p)&&(g=p,p=void 0),p=p||""):(p=c,g=p,c=!1,l(p)&&(g=p,p=void 0),p=p||"");var S=wo(),O=c?S._week.dow:0,j,Se=[];if(g!=null)return Ti(p,(g+O)%7,y,"day");for(j=0;j<7;j++)Se[j]=Ti(p,(j+O)%7,y,"day");return Se}function gS(c,p){return qm(c,p,"months")}function xS(c,p){return qm(c,p,"monthsShort")}function yS(c,p,g){return jc(c,p,g,"weekdays")}function bS(c,p,g){return jc(c,p,g,"weekdaysShort")}function wS(c,p,g){return jc(c,p,g,"weekdaysMin")}zo("en",{eras:[{since:"0001-01-01",until:1/0,offset:1,name:"Anno Domini",narrow:"AD",abbr:"AD"},{since:"0000-12-31",until:-1/0,offset:1,name:"Before Christ",narrow:"BC",abbr:"BC"}],dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(c){var p=c%10,g=Ae(c%100/10)===1?"th":p===1?"st":p===2?"nd":p===3?"rd":"th";return c+g}}),e.lang=M("moment.lang is deprecated. Use moment.locale instead.",zo),e.langData=M("moment.langData is deprecated. Use moment.localeData instead.",wo);var _o=Math.abs;function _S(){var c=this._data;return this._milliseconds=_o(this._milliseconds),this._days=_o(this._days),this._months=_o(this._months),c.milliseconds=_o(c.milliseconds),c.seconds=_o(c.seconds),c.minutes=_o(c.minutes),c.hours=_o(c.hours),c.months=_o(c.months),c.years=_o(c.years),this}function Wm(c,p,g,y){var S=Rr(p,g);return c._milliseconds+=y*S._milliseconds,c._days+=y*S._days,c._months+=y*S._months,c._bubble()}function vS(c,p){return Wm(this,c,p,1)}function SS(c,p){return Wm(this,c,p,-1)}function zm(c){return c<0?Math.floor(c):Math.ceil(c)}function kS(){var c=this._milliseconds,p=this._days,g=this._months,y=this._data,S,O,j,Se,Be;return c>=0&&p>=0&&g>=0||c<=0&&p<=0&&g<=0||(c+=zm(Yc(g)+p)*864e5,p=0,g=0),y.milliseconds=c%1e3,S=tt(c/1e3),y.seconds=S%60,O=tt(S/60),y.minutes=O%60,j=tt(O/60),y.hours=j%24,p+=tt(j/24),Be=tt(Km(p)),g+=Be,p-=zm(Yc(Be)),Se=tt(g/12),g%=12,y.days=p,y.months=g,y.years=Se,this}function Km(c){return c*4800/146097}function Yc(c){return c*146097/4800}function IS(c){if(!this.isValid())return NaN;var p,g,y=this._milliseconds;if(c=Ht(c),c==="month"||c==="quarter"||c==="year")switch(p=this._days+y/864e5,g=this._months+Km(p),c){case"month":return g;case"quarter":return g/3;case"year":return g/12}else switch(p=this._days+Math.round(Yc(this._months)),c){case"week":return p/7+y/6048e5;case"day":return p+y/864e5;case"hour":return p*24+y/36e5;case"minute":return p*1440+y/6e4;case"second":return p*86400+y/1e3;case"millisecond":return Math.floor(p*864e5)+y;default:throw new Error("Unknown unit "+c)}}function LS(){return this.isValid()?this._milliseconds+this._days*864e5+this._months%12*2592e6+Ae(this._months/12)*31536e6:NaN}function vo(c){return function(){return this.as(c)}}var CS=vo("ms"),TS=vo("s"),PS=vo("m"),DS=vo("h"),AS=vo("d"),MS=vo("w"),ES=vo("M"),FS=vo("Q"),RS=vo("y");function OS(){return Rr(this)}function US(c){return c=Ht(c),this.isValid()?this[c+"s"]():NaN}function yn(c){return function(){return this.isValid()?this._data[c]:NaN}}var $S=yn("milliseconds"),BS=yn("seconds"),NS=yn("minutes"),HS=yn("hours"),VS=yn("days"),qS=yn("months"),WS=yn("years");function zS(){return tt(this.days()/7)}var So=Math.round,Jn={ss:44,s:45,m:45,h:22,d:26,w:null,M:11};function KS(c,p,g,y,S){return S.relativeTime(p||1,!!g,c,y)}function GS(c,p,g,y){var S=Rr(c).abs(),O=So(S.as("s")),j=So(S.as("m")),Se=So(S.as("h")),Be=So(S.as("d")),Qe=So(S.as("M")),Kt=So(S.as("w")),ko=So(S.as("y")),Go=O<=g.ss&&["s",O]||O<g.s&&["ss",O]||j<=1&&["m"]||j<g.m&&["mm",j]||Se<=1&&["h"]||Se<g.h&&["hh",Se]||Be<=1&&["d"]||Be<g.d&&["dd",Be];return g.w!=null&&(Go=Go||Kt<=1&&["w"]||Kt<g.w&&["ww",Kt]),Go=Go||Qe<=1&&["M"]||Qe<g.M&&["MM",Qe]||ko<=1&&["y"]||["yy",ko],Go[2]=p,Go[3]=+c>0,Go[4]=y,KS.apply(null,Go)}function jS(c){return c===void 0?So:typeof c=="function"?(So=c,!0):!1}function YS(c,p){return Jn[c]===void 0?!1:p===void 0?Jn[c]:(Jn[c]=p,c==="s"&&(Jn.ss=p-1),!0)}function JS(c,p){if(!this.isValid())return this.localeData().invalidDate();var g=!1,y=Jn,S,O;return typeof c=="object"&&(p=c,c=!1),typeof c=="boolean"&&(g=c),typeof p=="object"&&(y=Object.assign({},Jn,p),p.s!=null&&p.ss==null&&(y.ss=p.s-1)),S=this.localeData(),O=GS(this,!g,y,S),g&&(O=S.pastFuture(+this,O)),S.postformat(O)}var Jc=Math.abs;function Xn(c){return(c>0)-(c<0)||+c}function Pi(){if(!this.isValid())return this.localeData().invalidDate();var c=Jc(this._milliseconds)/1e3,p=Jc(this._days),g=Jc(this._months),y,S,O,j,Se=this.asSeconds(),Be,Qe,Kt,ko;return Se?(y=tt(c/60),S=tt(y/60),c%=60,y%=60,O=tt(g/12),g%=12,j=c?c.toFixed(3).replace(/\.?0+$/,""):"",Be=Se<0?"-":"",Qe=Xn(this._months)!==Xn(Se)?"-":"",Kt=Xn(this._days)!==Xn(Se)?"-":"",ko=Xn(this._milliseconds)!==Xn(Se)?"-":"",Be+"P"+(O?Qe+O+"Y":"")+(g?Qe+g+"M":"")+(p?Kt+p+"D":"")+(S||y||c?"T":"")+(S?ko+S+"H":"")+(y?ko+y+"M":"")+(c?ko+j+"S":"")):"P0D"}var Ke=vi.prototype;Ke.isValid=Vv,Ke.abs=_S,Ke.add=vS,Ke.subtract=SS,Ke.as=IS,Ke.asMilliseconds=CS,Ke.asSeconds=TS,Ke.asMinutes=PS,Ke.asHours=DS,Ke.asDays=AS,Ke.asWeeks=MS,Ke.asMonths=ES,Ke.asQuarters=FS,Ke.asYears=RS,Ke.valueOf=LS,Ke._bubble=kS,Ke.clone=OS,Ke.get=US,Ke.milliseconds=$S,Ke.seconds=BS,Ke.minutes=NS,Ke.hours=HS,Ke.days=VS,Ke.weeks=zS,Ke.months=qS,Ke.years=WS,Ke.humanize=JS,Ke.toISOString=Pi,Ke.toString=Pi,Ke.toJSON=Pi,Ke.locale=Em,Ke.localeData=Rm,Ke.toIsoString=M("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",Pi),Ke.lang=Fm,te("X",0,0,"unix"),te("x",0,0,"valueOf"),pe("x",hi),pe("X",y_),Xe("X",function(c,p,g){g._d=new Date(parseFloat(c)*1e3)}),Xe("x",function(c,p,g){g._d=new Date(Ae(c))});return e.version="2.29.4",t(at),e.fn=ie,e.min=$v,e.max=Bv,e.now=Nv,e.utc=m,e.unix=mS,e.months=gS,e.isDate=f,e.locale=zo,e.invalid=v,e.duration=Rr,e.isMoment=$,e.weekdays=yS,e.parseZone=hS,e.localeData=wo,e.isDuration=Si,e.monthsShort=xS,e.weekdaysMin=wS,e.defineLocale=Uc,e.updateLocale=hv,e.locales=gv,e.weekdaysShort=bS,e.normalizeUnits=Ht,e.relativeTimeRounding=jS,e.relativeTimeThreshold=YS,e.calendarFormat=u1,e.prototype=ie,e.HTML5_FMT={DATETIME_LOCAL:"YYYY-MM-DDTHH:mm",DATETIME_LOCAL_SECONDS:"YYYY-MM-DDTHH:mm:ss",DATETIME_LOCAL_MS:"YYYY-MM-DDTHH:mm:ss.SSS",DATE:"YYYY-MM-DD",TIME:"HH:mm",TIME_SECONDS:"HH:mm:ss",TIME_MS:"HH:mm:ss.SSS",WEEK:"GGGG-[W]WW",MONTH:"YYYY-MM"},e})});var aE={};Xc(aE,{default:()=>Pc});module.exports=o0(aE);var Nt=require("obsidian"),m_=require("obsidian"),h_=bn(ua());var pt=require("obsidian");var Ct=()=>new Map,Ai=o=>{let e=Ct();return o.forEach((t,r)=>{e.set(r,t)}),e},Or=(o,e,t)=>{let r=o.get(e);return r===void 0&&o.set(e,r=t()),r},Jm=(o,e)=>{let t=[];for(let[r,n]of o)t.push(e(n,r));return t},Xm=(o,e)=>{for(let[t,r]of o)if(e(r,t))return!0;return!1};var Zr=()=>new Set;var Mi=o=>o[o.length-1];var Qm=(o,e)=>{for(let t=0;t<e.length;t++)o.push(e[t])},Ur=Array.from;var Zc=Array.isArray;var Ei=class{constructor(){this._observers=Ct()}on(e,t){return Or(this._observers,e,Zr).add(t),t}once(e,t){let r=(...n)=>{this.off(e,r),t(...n)};this.on(e,r)}off(e,t){let r=this._observers.get(e);r!==void 0&&(r.delete(t),r.size===0&&this._observers.delete(e))}emit(e,t){return Ur((this._observers.get(e)||Ct()).values()).forEach(r=>r(...t))}destroy(){this._observers=Ct()}},Zn=class{constructor(){this._observers=Ct()}on(e,t){Or(this._observers,e,Zr).add(t)}once(e,t){let r=(...n)=>{this.off(e,r),t(...n)};this.on(e,r)}off(e,t){let r=this._observers.get(e);r!==void 0&&(r.delete(t),r.size===0&&this._observers.delete(e))}emit(e,t){return Ur((this._observers.get(e)||Ct()).values()).forEach(r=>r(...t))}destroy(){this._observers=Ct()}};var sr=Math.floor;var es=Math.abs;var ts=(o,e)=>o<e?o:e,$r=(o,e)=>o>e?o:e,fE=Number.isNaN;var Fi=o=>o!==0?o<0:1/o<0;var tf=Number.MAX_SAFE_INTEGER,uE=Number.MIN_SAFE_INTEGER,dE=1<<31;var Zm=Number.isInteger||(o=>typeof o=="number"&&isFinite(o)&&sr(o)===o),pE=Number.isNaN,mE=Number.parseInt;var s0=String.fromCharCode,hE=String.fromCodePoint,gE=s0(65535),a0=o=>o.toLowerCase(),i0=/^\s*/g,l0=o=>o.replace(i0,""),c0=/([A-Z])/g,rf=(o,e)=>l0(o.replace(c0,t=>`${e}${a0(t)}`));var f0=o=>{let e=unescape(encodeURIComponent(o)),t=e.length,r=new Uint8Array(t);for(let n=0;n<t;n++)r[n]=e.codePointAt(n);return r},ns=typeof TextEncoder!="undefined"?new TextEncoder:null,u0=o=>ns.encode(o),th=ns?u0:f0;var os=typeof TextDecoder=="undefined"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});os&&os.decode(new Uint8Array).length===1&&(os=null);var wn=class{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}},vn=()=>new wn;var d0=o=>{let e=o.cpos;for(let t=0;t<o.bufs.length;t++)e+=o.bufs[t].length;return e};var pr=o=>{let e=new Uint8Array(d0(o)),t=0;for(let r=0;r<o.bufs.length;r++){let n=o.bufs[r];e.set(n,t),t+=n.length}return e.set(new Uint8Array(o.cbuf.buffer,0,o.cpos),t),e},p0=(o,e)=>{let t=o.cbuf.length;t-o.cpos<e&&(o.bufs.push(new Uint8Array(o.cbuf.buffer,0,o.cpos)),o.cbuf=new Uint8Array($r(t,e)*2),o.cpos=0)},Tt=(o,e)=>{let t=o.cbuf.length;o.cpos===t&&(o.bufs.push(o.cbuf),o.cbuf=new Uint8Array(t*2),o.cpos=0),o.cbuf[o.cpos++]=e};var Oi=Tt;var Ee=(o,e)=>{for(;e>127;)Tt(o,128|127&e),e=sr(e/128);Tt(o,127&e)},Ui=(o,e)=>{let t=Fi(e);for(t&&(e=-e),Tt(o,(e>63?128:0)|(t?64:0)|63&e),e=sr(e/64);e>0;)Tt(o,(e>127?128:0)|127&e),e=sr(e/128)},nf=new Uint8Array(3e4),m0=nf.length/3,h0=(o,e)=>{if(e.length<m0){let t=ns.encodeInto(e,nf).written||0;Ee(o,t);for(let r=0;r<t;r++)Tt(o,nf[r])}else Pt(o,th(e))},g0=(o,e)=>{let t=unescape(encodeURIComponent(e)),r=t.length;Ee(o,r);for(let n=0;n<r;n++)Tt(o,t.codePointAt(n))},Io=ns&&ns.encodeInto?h0:g0;var ma=(o,e)=>{let t=o.cbuf.length,r=o.cpos,n=ts(t-r,e.length),s=e.length-n;o.cbuf.set(e.subarray(0,n),r),o.cpos+=n,s>0&&(o.bufs.push(o.cbuf),o.cbuf=new Uint8Array($r(t*2,s)),o.cbuf.set(e.subarray(n)),o.cpos=s)},Pt=(o,e)=>{Ee(o,e.byteLength),ma(o,e)},sf=(o,e)=>{p0(o,e);let t=new DataView(o.cbuf.buffer,o.cpos,e);return o.cpos+=e,t},x0=(o,e)=>sf(o,4).setFloat32(0,e,!1),y0=(o,e)=>sf(o,8).setFloat64(0,e,!1),b0=(o,e)=>sf(o,8).setBigInt64(0,e,!1);var oh=new DataView(new ArrayBuffer(4)),w0=o=>(oh.setFloat32(0,o),oh.getFloat32(0)===o),as=(o,e)=>{switch(typeof e){case"string":Tt(o,119),Io(o,e);break;case"number":Zm(e)&&es(e)<=2147483647?(Tt(o,125),Ui(o,e)):w0(e)?(Tt(o,124),x0(o,e)):(Tt(o,123),y0(o,e));break;case"bigint":Tt(o,122),b0(o,e);break;case"object":if(e===null)Tt(o,126);else if(Zc(e)){Tt(o,117),Ee(o,e.length);for(let t=0;t<e.length;t++)as(o,e[t])}else if(e instanceof Uint8Array)Tt(o,116),Pt(o,e);else{Tt(o,118);let t=Object.keys(e);Ee(o,t.length);for(let r=0;r<t.length;r++){let n=t[r];Io(o,n),as(o,e[n])}}break;case"boolean":Tt(o,e?120:121);break;default:Tt(o,127)}},pa=class extends wn{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&Ee(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}};var nh=o=>{o.count>0&&(Ui(o.encoder,o.count===1?o.s:-o.s),o.count>1&&Ee(o.encoder,o.count-2))},_n=class{constructor(){this.encoder=new wn,this.s=0,this.count=0}write(e){this.s===e?this.count++:(nh(this),this.count=1,this.s=e)}toUint8Array(){return nh(this),pr(this.encoder)}};var sh=o=>{if(o.count>0){let e=o.diff*2+(o.count===1?0:1);Ui(o.encoder,e),o.count>1&&Ee(o.encoder,o.count-2)}},is=class{constructor(){this.encoder=new wn,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(sh(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return sh(this),pr(this.encoder)}},Ri=class{constructor(){this.sarr=[],this.s="",this.lensE=new _n}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){let e=new wn;return this.sarr.push(this.s),this.s="",Io(e,this.sarr.join("")),ma(e,this.lensE.toUint8Array()),pr(e)}};var Lr=o=>new Error(o),Br=()=>{throw Lr("Method unimplemented")},Cr=()=>{throw Lr("Unexpected case")};var ah=Lr("Unexpected end of array"),ih=Lr("Integer out of Range"),ls=class{constructor(e){this.arr=e,this.pos=0}},Hr=o=>new ls(o),lh=o=>o.pos!==o.arr.length;var _0=(o,e)=>{let t=new Uint8Array(o.arr.buffer,o.pos+o.arr.byteOffset,e);return o.pos+=e,t},Ft=o=>_0(o,Te(o));var Sn=o=>o.arr[o.pos++];var Te=o=>{let e=0,t=1,r=o.arr.length;for(;o.pos<r;){let n=o.arr[o.pos++];if(e=e+(n&127)*t,t*=128,n<128)return e;if(e>tf)throw ih}throw ah},Bi=o=>{let e=o.arr[o.pos++],t=e&63,r=64,n=(e&64)>0?-1:1;if(!(e&128))return n*t;let s=o.arr.length;for(;o.pos<s;){if(e=o.arr[o.pos++],t=t+(e&127)*r,r*=128,e<128)return n*t;if(t>tf)throw ih}throw ah};var v0=o=>{let e=Te(o);if(e===0)return"";{let t=String.fromCodePoint(Sn(o));if(--e<100)for(;e--;)t+=String.fromCodePoint(Sn(o));else for(;e>0;){let r=e<1e4?e:1e4,n=o.arr.subarray(o.pos,o.pos+r);o.pos+=r,t+=String.fromCodePoint.apply(null,n),e-=r}return decodeURIComponent(escape(t))}},S0=o=>os.decode(Ft(o)),Nr=os?S0:v0;var cf=(o,e)=>{let t=new DataView(o.arr.buffer,o.arr.byteOffset+o.pos,e);return o.pos+=e,t},k0=o=>cf(o,4).getFloat32(0,!1),I0=o=>cf(o,8).getFloat64(0,!1),L0=o=>cf(o,8).getBigInt64(0,!1);var C0=[o=>{},o=>null,Bi,k0,I0,L0,o=>!1,o=>!0,Nr,o=>{let e=Te(o),t={};for(let r=0;r<e;r++){let n=Nr(o);t[n]=cs(o)}return t},o=>{let e=Te(o),t=[];for(let r=0;r<e;r++)t.push(cs(o));return t},Ft],cs=o=>C0[127-Sn(o)](o),ha=class extends ls{constructor(e,t){super(e),this.reader=t,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),lh(this)?this.count=Te(this)+1:this.count=-1),this.count--,this.s}};var kn=class extends ls{constructor(e){super(e),this.s=0,this.count=0}read(){if(this.count===0){this.s=Bi(this);let e=Fi(this.s);this.count=1,e&&(this.s=-this.s,this.count=Te(this)+2)}return this.count--,this.s}};var fs=class extends ls{constructor(e){super(e),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){let e=Bi(this),t=e&1;this.diff=sr(e/2),this.count=1,t&&(this.count=Te(this)+2)}return this.s+=this.diff,this.count--,this.s}},$i=class{constructor(e){this.decoder=new kn(e),this.str=Nr(this.decoder),this.spos=0}read(){let e=this.spos+this.decoder.read(),t=this.str.slice(this.spos,e);return this.spos=e,t}};var bE=crypto.subtle,ch=crypto.getRandomValues.bind(crypto);var ga=()=>ch(new Uint32Array(1))[0];var T0=[1e7]+-1e3+-4e3+-8e3+-1e11,us=()=>T0.replace(/[018]/g,o=>(o^ga()&15>>o/4).toString(16));var In=Date.now;var Lo=o=>new Promise(o);var P0=Promise.all.bind(Promise);var uf=o=>o===void 0?null:o;var df=class{constructor(){this.map=new Map}setItem(e,t){this.map.set(e,t)}getItem(e){return this.map.get(e)}},dh=new df,A0=!0;try{typeof localStorage!="undefined"&&localStorage&&(dh=localStorage,A0=!1)}catch(o){}var ph=dh;var mh=Object.assign,E0=Object.keys,hh=(o,e)=>{for(let t in o)e(o[t],t)};var xa=o=>E0(o).length;var gh=o=>{for(let e in o)return!1;return!0},F0=(o,e)=>{for(let t in o)if(!e(o[t],t))return!1;return!0},pf=(o,e)=>Object.prototype.hasOwnProperty.call(o,e),mf=(o,e)=>o===e||xa(o)===xa(e)&&F0(o,(t,r)=>(t!==void 0||pf(e,r))&&e[r]===t);var ya=(o,e,t=0)=>{try{for(;t<o.length;t++)o[t](...e)}finally{t<o.length&&ya(o,e,t+1)}};var yh=o=>o,R0=(o,e)=>o===e;var ds=(o,e)=>{if(o==null||e==null)return R0(o,e);if(o.constructor!==e.constructor)return!1;if(o===e)return!0;switch(o.constructor){case ArrayBuffer:o=new Uint8Array(o),e=new Uint8Array(e);case Uint8Array:{if(o.byteLength!==e.byteLength)return!1;for(let t=0;t<o.length;t++)if(o[t]!==e[t])return!1;break}case Set:{if(o.size!==e.size)return!1;for(let t of o)if(!e.has(t))return!1;break}case Map:{if(o.size!==e.size)return!1;for(let t of o.keys())if(!e.has(t)||!ds(o.get(t),e.get(t)))return!1;break}case Object:if(xa(o)!==xa(e))return!1;for(let t in o)if(!pf(o,t)||!ds(o[t],e[t]))return!1;break;case Array:if(o.length!==e.length)return!1;for(let t=0;t<o.length;t++)if(!ds(o[t],e[t]))return!1;break;default:return!1}return!0},bh=(o,e)=>e.includes(o);var ba=typeof process!="undefined"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process!="undefined"?process:0)==="[object process]";var vE=typeof navigator!="undefined"?/Mac/.test(navigator.platform):!1,eo,O0=[],U0=()=>{if(eo===void 0)if(ba){eo=Ct();let o=process.argv,e=null;for(let t=0;t<o.length;t++){let r=o[t];r[0]==="-"?(e!==null&&eo.set(e,""),e=r):e!==null?(eo.set(e,r),e=null):O0.push(r)}e!==null&&eo.set(e,"")}else typeof location=="object"?(eo=Ct(),(location.search||"?").slice(1).split("&").forEach(o=>{if(o.length!==0){let[e,t]=o.split("=");eo.set(`--${rf(e,"-")}`,t),eo.set(`-${rf(e,"-")}`,t)}})):eo=Ct();return eo},gf=o=>U0().has(o);var xf=o=>ba?uf(process.env[o.toUpperCase().replaceAll("-","_")]):uf(ph.getItem(o));var $0=o=>gf("--"+o)||xf(o)!==null,SE=$0("production"),wh=ba&&bh(process.env.FORCE_COLOR,["true","1","2"]),_h=!gf("no-colors")&&(!ba||process.stdout.isTTY||wh)&&(!ba||gf("color")||wh||xf("COLORTERM")!==null||(xf("TERM")||"").includes("color"));var N0=o=>new Uint8Array(o);var vh=o=>{let e=N0(o.byteLength);return e.set(o),e};var yf=class{constructor(e,t){this.left=e,this.right=t}},Gt=(o,e)=>new yf(o,e);var Sh=(o,e)=>o.forEach(t=>e(t.left,t.right));var to=typeof document!="undefined"?document:{},V0=o=>to.createElement(o),q0=()=>to.createDocumentFragment(),W0=o=>to.createTextNode(o),kE=typeof DOMParser!="undefined"?new DOMParser:null;var z0=(o,e)=>(Sh(e,(t,r)=>{r===!1?o.removeAttribute(t):r===!0?o.setAttribute(t,""):o.setAttribute(t,r)}),o);var K0=o=>{let e=q0();for(let t=0;t<o.length;t++)Lh(e,o[t]);return e},kh=(o,e)=>(Lh(o,K0(e)),o);var wa=(o,e=[],t=[])=>kh(z0(V0(o),e),t);var ps=W0;var Ih=o=>Jm(o,(e,t)=>`${t}:${e};`).join("");var Lh=(o,e)=>o.appendChild(e),IE=to.ELEMENT_NODE,LE=to.TEXT_NODE,CE=to.CDATA_SECTION_NODE,TE=to.COMMENT_NODE,PE=to.DOCUMENT_NODE,DE=to.DOCUMENT_TYPE_NODE,AE=to.DOCUMENT_FRAGMENT_NODE;var ro=Symbol;var _a=ro(),va=ro(),wf=ro(),_f=ro(),vf=ro(),Sa=ro(),Sf=ro(),ka=ro(),kf=ro(),Th=o=>{var n;o.length===1&&((n=o[0])==null?void 0:n.constructor)===Function&&(o=o[0]());let e=[],t=[],r=0;for(;r<o.length;r++){let s=o[r];s===void 0?e.push("undefined"):s.constructor===String||s.constructor===Number?e.push(s):s.constructor===Object&&t.push(JSON.stringify(s))}return t};var ME=In();var Y0={[_a]:Gt("font-weight","bold"),[va]:Gt("font-weight","normal"),[wf]:Gt("color","blue"),[vf]:Gt("color","green"),[_f]:Gt("color","grey"),[Sa]:Gt("color","red"),[Sf]:Gt("color","purple"),[ka]:Gt("color","orange"),[kf]:Gt("color","black")},J0=o=>{var a;o.length===1&&((a=o[0])==null?void 0:a.constructor)===Function&&(o=o[0]());let e=[],t=[],r=Ct(),n=[],s=0;for(;s<o.length;s++){let i=o[s],l=Y0[i];if(l!==void 0)r.set(l.left,l.right);else{if(i===void 0)break;if(i.constructor===String||i.constructor===Number){let f=Ih(r);s>0||f.length>0?(e.push("%c"+i),t.push(f)):e.push(i)}else break}}for(s>0&&(n=t,n.unshift(e.join("")));s<o.length;s++){let i=o[s];i instanceof Symbol||n.push(i)}return n},X0=_h?J0:Th,Ph=(...o)=>{console.log(...X0(o)),Q0.forEach(e=>e.print(o))};var Q0=Zr();var Dh=o=>({[Symbol.iterator](){return this},next:o}),Ah=(o,e)=>Dh(()=>{let t;do t=o.next();while(!t.done&&!e(t.value));return t}),Hi=(o,e)=>Dh(()=>{let{done:t,value:r}=o.next();return{done:t,value:t?void 0:e(r)}});var La=class{constructor(e,t){this.clock=e,this.len=t}},Ln=class{constructor(){this.clients=new Map}},Kh=(o,e,t)=>e.clients.forEach((r,n)=>{let s=o.doc.store.clients.get(n);for(let a=0;a<r.length;a++){let i=r[a];tg(o,s,i.clock,i.len,t)}}),ok=(o,e)=>{let t=0,r=o.length-1;for(;t<=r;){let n=sr((t+r)/2),s=o[n],a=s.clock;if(a<=e){if(e<a+s.len)return n;t=n+1}else r=n-1}return null},Nf=(o,e)=>{let t=o.clients.get(e.client);return t!==void 0&&ok(t,e.clock)!==null},Hf=o=>{o.clients.forEach(e=>{e.sort((n,s)=>n.clock-s.clock);let t,r;for(t=1,r=1;t<e.length;t++){let n=e[r-1],s=e[t];n.clock+n.len>=s.clock?n.len=$r(n.len,s.clock+s.len-n.clock):(r<t&&(e[r]=s),r++)}e.length=r})},Lf=o=>{let e=new Ln;for(let t=0;t<o.length;t++)o[t].clients.forEach((r,n)=>{if(!e.clients.has(n)){let s=r.slice();for(let a=t+1;a<o.length;a++)Qm(s,o[a].clients.get(n)||[]);e.clients.set(n,s)}});return Hf(e),e},ji=(o,e,t,r)=>{Or(o.clients,e,()=>[]).push(new La(t,r))},Vf=()=>new Ln,nk=o=>{let e=Vf();return o.clients.forEach((t,r)=>{let n=[];for(let s=0;s<t.length;s++){let a=t[s];if(a.deleted){let i=a.id.clock,l=a.length;if(s+1<t.length)for(let f=t[s+1];s+1<t.length&&f.deleted;f=t[++s+1])l+=f.length;n.push(new La(i,l))}}n.length>0&&e.clients.set(r,n)}),e},Qo=(o,e)=>{Ee(o.restEncoder,e.clients.size),Ur(e.clients.entries()).sort((t,r)=>r[0]-t[0]).forEach(([t,r])=>{o.resetDsCurVal(),Ee(o.restEncoder,t);let n=r.length;Ee(o.restEncoder,n);for(let s=0;s<n;s++){let a=r[s];o.writeDsClock(a.clock),o.writeDsLen(a.len)}})},Ca=o=>{let e=new Ln,t=Te(o.restDecoder);for(let r=0;r<t;r++){o.resetDsCurVal();let n=Te(o.restDecoder),s=Te(o.restDecoder);if(s>0){let a=Or(e.clients,n,()=>[]);for(let i=0;i<s;i++)a.push(new La(o.readDsClock(),o.readDsLen()))}}return e},Fh=(o,e,t)=>{let r=new Ln,n=Te(o.restDecoder);for(let s=0;s<n;s++){o.resetDsCurVal();let a=Te(o.restDecoder),i=Te(o.restDecoder),l=t.clients.get(a)||[],f=vt(t,a);for(let u=0;u<i;u++){let d=o.readDsClock(),m=d+o.readDsLen();if(d<f){f<m&&ji(r,a,f,m-f);let x=no(l,d),h=l[x];for(!h.deleted&&h.id.clock<d&&(l.splice(x+1,0,ol(e,h,d-h.id.clock)),x++);x<l.length&&(h=l[x++],h.id.clock<m);)h.deleted||(m<h.id.clock+h.length&&l.splice(x,0,ol(e,h,m-h.id.clock)),h.delete(e))}else ji(r,a,d,m-d)}}if(r.clients.size>0){let s=new Co;return Ee(s.restEncoder,0),Qo(s,r),s.toUint8Array()}return null};var Gh=ga,mr=class extends Ei{constructor({guid:e=us(),collectionid:t=null,gc:r=!0,gcFilter:n=()=>!0,meta:s=null,autoLoad:a=!1,shouldLoad:i=!0}={}){super(),this.gc=r,this.gcFilter=n,this.clientID=Gh(),this.guid=e,this.collectionid=t,this.share=new Map,this.store=new Zi,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=i,this.autoLoad=a,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.whenLoaded=Lo(f=>{this.on("load",()=>{this.isLoaded=!0,f(this)})});let l=()=>Lo(f=>{let u=d=>{(d===void 0||d===!0)&&(this.off("sync",u),f())};this.on("sync",u)});this.on("sync",f=>{f===!1&&this.isSynced&&(this.whenSynced=l()),this.isSynced=f===void 0||f===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=l()}load(){let e=this._item;e!==null&&!this.shouldLoad&&Ze(e.parent.doc,t=>{t.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(Ur(this.subdocs).map(e=>e.guid))}transact(e,t=null){return Ze(this,e,t)}get(e,t=It){let r=Or(this.share,e,()=>{let s=new t;return s._integrate(this,null),s}),n=r.constructor;if(t!==It&&n!==t)if(n===It){let s=new t;s._map=r._map,r._map.forEach(a=>{for(;a!==null;a=a.left)a.parent=s}),s._start=r._start;for(let a=s._start;a!==null;a=a.right)a.parent=s;return s._length=r._length,this.share.set(e,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return r}getArray(e=""){return this.get(e,oo)}getText(e=""){return this.get(e,tn)}getMap(e=""){return this.get(e,To)}getXmlElement(e=""){return this.get(e,rn)}getXmlFragment(e=""){return this.get(e,Po)}toJSON(){let e={};return this.share.forEach((t,r)=>{e[r]=t.toJSON()}),e}destroy(){Ur(this.subdocs).forEach(t=>t.destroy());let e=this._item;if(e!==null){this._item=null;let t=e.content;t.doc=new mr({guid:this.guid,...t.opts,shouldLoad:!1}),t.doc._item=e,Ze(e.parent.doc,r=>{let n=t.doc;e.deleted||r.subdocsAdded.add(n),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}},gs=class{constructor(e){this.restDecoder=e}resetDsCurVal(){}readDsClock(){return Te(this.restDecoder)}readDsLen(){return Te(this.restDecoder)}},Yi=class extends gs{readLeftID(){return Ne(Te(this.restDecoder),Te(this.restDecoder))}readRightID(){return Ne(Te(this.restDecoder),Te(this.restDecoder))}readClient(){return Te(this.restDecoder)}readInfo(){return Sn(this.restDecoder)}readString(){return Nr(this.restDecoder)}readParentInfo(){return Te(this.restDecoder)===1}readTypeRef(){return Te(this.restDecoder)}readLen(){return Te(this.restDecoder)}readAny(){return cs(this.restDecoder)}readBuf(){return vh(Ft(this.restDecoder))}readJSON(){return JSON.parse(Nr(this.restDecoder))}readKey(){return Nr(this.restDecoder)}},Cf=class{constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=Te(this.restDecoder),this.dsCurrVal}readDsLen(){let e=Te(this.restDecoder)+1;return this.dsCurrVal+=e,e}},Zo=class extends Cf{constructor(e){super(e),this.keys=[],Te(e),this.keyClockDecoder=new fs(Ft(e)),this.clientDecoder=new kn(Ft(e)),this.leftClockDecoder=new fs(Ft(e)),this.rightClockDecoder=new fs(Ft(e)),this.infoDecoder=new ha(Ft(e),Sn),this.stringDecoder=new $i(Ft(e)),this.parentInfoDecoder=new ha(Ft(e),Sn),this.typeRefDecoder=new kn(Ft(e)),this.lenDecoder=new kn(Ft(e))}readLeftID(){return new Xo(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new Xo(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return cs(this.restDecoder)}readBuf(){return Ft(this.restDecoder)}readJSON(){return cs(this.restDecoder)}readKey(){let e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{let t=this.stringDecoder.read();return this.keys.push(t),t}}},xs=class{constructor(){this.restEncoder=vn()}toUint8Array(){return pr(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){Ee(this.restEncoder,e)}writeDsLen(e){Ee(this.restEncoder,e)}},Cn=class extends xs{writeLeftID(e){Ee(this.restEncoder,e.client),Ee(this.restEncoder,e.clock)}writeRightID(e){Ee(this.restEncoder,e.client),Ee(this.restEncoder,e.clock)}writeClient(e){Ee(this.restEncoder,e)}writeInfo(e){Oi(this.restEncoder,e)}writeString(e){Io(this.restEncoder,e)}writeParentInfo(e){Ee(this.restEncoder,e?1:0)}writeTypeRef(e){Ee(this.restEncoder,e)}writeLen(e){Ee(this.restEncoder,e)}writeAny(e){as(this.restEncoder,e)}writeBuf(e){Pt(this.restEncoder,e)}writeJSON(e){Io(this.restEncoder,JSON.stringify(e))}writeKey(e){Io(this.restEncoder,e)}},Ji=class{constructor(){this.restEncoder=vn(),this.dsCurrVal=0}toUint8Array(){return pr(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){let t=e-this.dsCurrVal;this.dsCurrVal=e,Ee(this.restEncoder,t)}writeDsLen(e){e===0&&Cr(),Ee(this.restEncoder,e-1),this.dsCurrVal+=e}},Co=class extends Ji{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new is,this.clientEncoder=new _n,this.leftClockEncoder=new is,this.rightClockEncoder=new is,this.infoEncoder=new pa(Oi),this.stringEncoder=new Ri,this.parentInfoEncoder=new pa(Oi),this.typeRefEncoder=new _n,this.lenEncoder=new _n}toUint8Array(){let e=vn();return Ee(e,0),Pt(e,this.keyClockEncoder.toUint8Array()),Pt(e,this.clientEncoder.toUint8Array()),Pt(e,this.leftClockEncoder.toUint8Array()),Pt(e,this.rightClockEncoder.toUint8Array()),Pt(e,pr(this.infoEncoder)),Pt(e,this.stringEncoder.toUint8Array()),Pt(e,pr(this.parentInfoEncoder)),Pt(e,this.typeRefEncoder.toUint8Array()),Pt(e,this.lenEncoder.toUint8Array()),ma(e,pr(this.restEncoder)),pr(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){as(this.restEncoder,e)}writeBuf(e){Pt(this.restEncoder,e)}writeJSON(e){as(this.restEncoder,e)}writeKey(e){let t=this.keyMap.get(e);t===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(t)}},sk=(o,e,t,r)=>{r=$r(r,e[0].id.clock);let n=no(e,r);Ee(o.restEncoder,e.length-n),o.writeClient(t),Ee(o.restEncoder,r);let s=e[n];s.write(o,r-s.id.clock);for(let a=n+1;a<e.length;a++)e[a].write(o,0)},qf=(o,e,t)=>{let r=new Map;t.forEach((n,s)=>{vt(e,s)>n&&r.set(s,n)}),nl(e).forEach((n,s)=>{t.has(s)||r.set(s,0)}),Ee(o.restEncoder,r.size),Ur(r.entries()).sort((n,s)=>s[0]-n[0]).forEach(([n,s])=>{sk(o,e.clients.get(n),n,s)})},ak=(o,e)=>{let t=Ct(),r=Te(o.restDecoder);for(let n=0;n<r;n++){let s=Te(o.restDecoder),a=new Array(s),i=o.readClient(),l=Te(o.restDecoder);t.set(i,{i:0,refs:a});for(let f=0;f<s;f++){let u=o.readInfo();switch(31&u){case 0:{let d=o.readLen();a[f]=new ar(Ne(i,l),d),l+=d;break}case 10:{let d=Te(o.restDecoder);a[f]=new ir(Ne(i,l),d),l+=d;break}default:{let d=(u&192)===0,m=new ct(Ne(i,l),null,(u&128)===128?o.readLeftID():null,null,(u&64)===64?o.readRightID():null,d?o.readParentInfo()?e.get(o.readString()):o.readLeftID():null,d&&(u&32)===32?o.readString():null,wg(o,u));a[f]=m,l+=m.length}}}}return t},ik=(o,e,t)=>{let r=[],n=Ur(t.keys()).sort((x,h)=>x-h);if(n.length===0)return null;let s=()=>{if(n.length===0)return null;let x=t.get(n[n.length-1]);for(;x.refs.length===x.i;)if(n.pop(),n.length>0)x=t.get(n[n.length-1]);else return null;return x},a=s();if(a===null)return null;let i=new Zi,l=new Map,f=(x,h)=>{let _=l.get(x);(_==null||_>h)&&l.set(x,h)},u=a.refs[a.i++],d=new Map,m=()=>{for(let x of r){let h=x.id.client,_=t.get(h);_?(_.i--,i.clients.set(h,_.refs.slice(_.i)),t.delete(h),_.i=0,_.refs=[]):i.clients.set(h,[x]),n=n.filter(w=>w!==h)}r.length=0};for(;;){if(u.constructor!==ir){let h=Or(d,u.id.client,()=>vt(e,u.id.client))-u.id.clock;if(h<0)r.push(u),f(u.id.client,u.id.clock-1),m();else{let _=u.getMissing(o,e);if(_!==null){r.push(u);let w=t.get(_)||{refs:[],i:0};if(w.refs.length===w.i)f(_,vt(e,_)),m();else{u=w.refs[w.i++];continue}}else(h===0||h<u.length)&&(u.integrate(o,h),d.set(u.id.client,u.id.clock+u.length))}}if(r.length>0)u=r.pop();else if(a!==null&&a.i<a.refs.length)u=a.refs[a.i++];else{if(a=s(),a===null)break;u=a.refs[a.i++]}}if(i.clients.size>0){let x=new Co;return qf(x,i,new Map),Ee(x.restEncoder,0),{missing:l,update:x.toUint8Array()}}return null},lk=(o,e)=>qf(o,e.doc.store,e.beforeState),ck=(o,e,t,r=new Zo(o))=>Ze(e,n=>{n.local=!1;let s=!1,a=n.doc,i=a.store,l=ak(r,a),f=ik(n,i,l),u=i.pendingStructs;if(u){for(let[m,x]of u.missing)if(x<vt(i,m)){s=!0;break}if(f){for(let[m,x]of f.missing){let h=u.missing.get(m);(h==null||h>x)&&u.missing.set(m,x)}u.update=el([u.update,f.update])}}else i.pendingStructs=f;let d=Fh(r,n,i);if(i.pendingDs){let m=new Zo(Hr(i.pendingDs));Te(m.restDecoder);let x=Fh(m,n,i);d&&x?i.pendingDs=el([d,x]):i.pendingDs=d||x}else i.pendingDs=d;if(s){let m=i.pendingStructs.update;i.pendingStructs=null,jh(n.doc,m)}},t,!1);var jh=(o,e,t,r=Zo)=>{let n=Hr(e);ck(n,o,t,new r(n))},Mo=(o,e,t)=>jh(o,e,t,Yi),fk=(o,e,t=new Map)=>{qf(o,e.store,t),Qo(o,nk(e.store))},uk=(o,e=new Uint8Array([0]),t=new Co)=>{let r=Yh(e);fk(t,o,r);let n=[t.toUint8Array()];if(o.store.pendingDs&&n.push(o.store.pendingDs),o.store.pendingStructs&&n.push(kk(o.store.pendingStructs.update,e)),n.length>1){if(t.constructor===Cn)return vk(n.map((s,a)=>a===0?s:Lk(s)));if(t.constructor===Co)return el(n)}return n[0]},An=(o,e)=>uk(o,e,new Cn),dk=o=>{let e=new Map,t=Te(o.restDecoder);for(let r=0;r<t;r++){let n=Te(o.restDecoder),s=Te(o.restDecoder);e.set(n,s)}return e},Yh=o=>dk(new gs(Hr(o))),Jh=(o,e)=>(Ee(o.restEncoder,e.size),Ur(e.entries()).sort((t,r)=>r[0]-t[0]).forEach(([t,r])=>{Ee(o.restEncoder,t),Ee(o.restEncoder,r)}),o),pk=(o,e)=>Jh(o,nl(e.store)),mk=(o,e=new Ji)=>(o instanceof Map?Jh(e,o):pk(e,o),e.toUint8Array()),Xh=o=>mk(o,new xs),Tf=class{constructor(){this.l=[]}},Rh=()=>new Tf,Oh=(o,e)=>o.l.push(e),Uh=(o,e)=>{let t=o.l,r=t.length;o.l=t.filter(n=>e!==n),r===o.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},Qh=(o,e,t)=>ya(o.l,[e,t]),Xo=class{constructor(e,t){this.client=e,this.clock=t}},hs=(o,e)=>o===e||o!==null&&e!==null&&o.client===e.client&&o.clock===e.clock,Ne=(o,e)=>new Xo(o,e);var Zh=o=>{for(let[e,t]of o.doc.share.entries())if(t===o)return e;throw Cr()};var Xi=class{constructor(e,t=e.getMap("users")){let r=new Map;this.yusers=t,this.doc=e,this.clients=new Map,this.dss=r;let n=(s,a)=>{let i=s.get("ds"),l=s.get("ids"),f=u=>this.clients.set(u,a);i.observe(u=>{u.changes.added.forEach(d=>{d.content.getContent().forEach(m=>{m instanceof Uint8Array&&this.dss.set(a,Lf([this.dss.get(a)||Vf(),Ca(new gs(Hr(m)))]))})})}),this.dss.set(a,Lf(i.map(u=>Ca(new gs(Hr(u)))))),l.observe(u=>u.changes.added.forEach(d=>d.content.getContent().forEach(f))),l.forEach(f)};t.observe(s=>{s.keysChanged.forEach(a=>n(t.get(a),a))}),t.forEach(n)}setUserMapping(e,t,r,{filter:n=()=>!0}={}){let s=this.yusers,a=s.get(r);a||(a=new To,a.set("ids",new oo),a.set("ds",new oo),s.set(r,a)),a.get("ids").push([t]),s.observe(i=>{setTimeout(()=>{let l=s.get(r);if(l!==a){a=l,this.clients.forEach((d,m)=>{r===d&&a.get("ids").push([m])});let f=new xs,u=this.dss.get(r);u&&(Qo(f,u),a.get("ds").push([f.toUint8Array()]))}},0)}),e.on("afterTransaction",i=>{setTimeout(()=>{let l=a.get("ds"),f=i.deleteSet;if(i.local&&f.clients.size>0&&n(i,f)){let u=new xs;Qo(u,f),l.push([u.toUint8Array()])}})})}getUserByClientId(e){return this.clients.get(e)||null}getUserByDeletedId(e){for(let[t,r]of this.dss.entries())if(Nf(r,e))return t;return null}},Qi=class{constructor(e,t,r,n=0){this.type=e,this.tname=t,this.item=r,this.assoc=n}};var Wf=o=>new Qi(o.type==null?null:Ne(o.type.client,o.type.clock),o.tname||null,o.item==null?null:Ne(o.item.client,o.item.clock),o.assoc==null?0:o.assoc),Pf=class{constructor(e,t,r=0){this.type=e,this.index=t,this.assoc=r}},hk=(o,e,t=0)=>new Pf(o,e,t),Vi=(o,e,t)=>{let r=null,n=null;return o._item===null?n=Zh(o):r=Ne(o._item.id.client,o._item.id.clock),new Qi(r,n,e,t)},zf=(o,e,t=0)=>{let r=o._start;if(t<0){if(e===0)return Vi(o,null,t);e--}for(;r!==null;){if(!r.deleted&&r.countable){if(r.length>e)return Vi(o,Ne(r.id.client,r.id.clock+e),t);e-=r.length}if(r.right===null&&t<0)return Vi(o,r.lastId,t);r=r.right}return Vi(o,null,t)};var Kf=(o,e)=>{let t=e.store,r=o.item,n=o.type,s=o.tname,a=o.assoc,i=null,l=0;if(r!==null){if(vt(t,r.client)<=r.clock)return null;let f=zh(t,r),u=f.item;if(!(u instanceof ct))return null;if(i=u.parent,i._item===null||!i._item.deleted){l=u.deleted||!u.countable?0:f.diff+(a>=0?0:1);let d=u.left;for(;d!==null;)!d.deleted&&d.countable&&(l+=d.length),d=d.left}}else{if(s!==null)i=e.get(s);else if(n!==null){if(vt(t,n.client)<=n.clock)return null;let{item:f}=zh(t,n);if(f instanceof ct&&f.content instanceof Pr)i=f.content.type;else return null}else throw Cr();a>=0?l=i._length:l=0}return hk(i,l,o.assoc)},Gf=(o,e)=>o===e||o!==null&&e!==null&&o.tname===e.tname&&hs(o.item,e.item)&&hs(o.type,e.type)&&o.assoc===e.assoc,Df=class{constructor(e,t){this.ds=e,this.sv=t}};var gk=(o,e)=>new Df(o,e),VE=gk(Vf(),new Map);var ms=(o,e)=>e===void 0?!o.deleted:e.sv.has(o.id.client)&&(e.sv.get(o.id.client)||0)>o.id.clock&&!Nf(e.ds,o.id),Af=(o,e)=>{let t=Or(o.meta,Af,Zr),r=o.doc.store;t.has(e)||(e.sv.forEach((n,s)=>{n<vt(r,s)&&en(o,Ne(s,n))}),Kh(o,e.ds,n=>{}),t.add(e))};var Zi=class{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}},nl=o=>{let e=new Map;return o.clients.forEach((t,r)=>{let n=t[t.length-1];e.set(r,n.id.clock+n.length)}),e},vt=(o,e)=>{let t=o.clients.get(e);if(t===void 0)return 0;let r=t[t.length-1];return r.id.clock+r.length},eg=(o,e)=>{let t=o.clients.get(e.id.client);if(t===void 0)t=[],o.clients.set(e.id.client,t);else{let r=t[t.length-1];if(r.id.clock+r.length!==e.id.clock)throw Cr()}t.push(e)},no=(o,e)=>{let t=0,r=o.length-1,n=o[r],s=n.id.clock;if(s===e)return r;let a=sr(e/(s+n.length-1)*r);for(;t<=r;){if(n=o[a],s=n.id.clock,s<=e){if(e<s+n.length)return a;t=a+1}else r=a-1;a=sr((t+r)/2)}throw Cr()},xk=(o,e)=>{let t=o.clients.get(e.client);return t[no(t,e.clock)]},zi=xk,Mf=(o,e,t)=>{let r=no(e,t),n=e[r];return n.id.clock<t&&n instanceof ct?(e.splice(r+1,0,ol(o,n,t-n.id.clock)),r+1):r},en=(o,e)=>{let t=o.doc.store.clients.get(e.client);return t[Mf(o,t,e.clock)]},$h=(o,e,t)=>{let r=e.clients.get(t.client),n=no(r,t.clock),s=r[n];return t.clock!==s.id.clock+s.length-1&&s.constructor!==ar&&r.splice(n+1,0,ol(o,s,t.clock-s.id.clock+1)),s},yk=(o,e,t)=>{let r=o.clients.get(e.id.client);r[no(r,e.id.clock)]=t},tg=(o,e,t,r,n)=>{if(r===0)return;let s=t+r,a=Mf(o,e,t),i;do i=e[a++],s<i.id.clock+i.length&&Mf(o,e,s),n(i);while(a<e.length&&e[a].id.clock<s)},Ef=class{constructor(e,t,r){this.doc=e,this.deleteSet=new Ln,this.beforeState=nl(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=t,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}},Bh=(o,e)=>e.deleteSet.clients.size===0&&!Xm(e.afterState,(t,r)=>e.beforeState.get(r)!==t)?!1:(Hf(e.deleteSet),lk(o,e),Qo(o,e.deleteSet),!0),Nh=(o,e,t)=>{let r=e._item;(r===null||r.id.clock<(o.beforeState.get(r.id.client)||0)&&!r.deleted)&&Or(o.changed,e,Zr).add(t)},Ki=(o,e)=>{let t=o[e],r=o[e-1],n=e;for(;n>0;t=r,r=o[--n-1]){if(r.deleted===t.deleted&&r.constructor===t.constructor&&r.mergeWith(t)){t instanceof ct&&t.parentSub!==null&&t.parent._map.get(t.parentSub)===t&&t.parent._map.set(t.parentSub,r);continue}break}let s=e-n;return s&&o.splice(e+1-s,s),s},bk=(o,e,t)=>{for(let[r,n]of o.clients.entries()){let s=e.clients.get(r);for(let a=n.length-1;a>=0;a--){let i=n[a],l=i.clock+i.len;for(let f=no(s,i.clock),u=s[f];f<s.length&&u.id.clock<l;u=s[++f]){let d=s[f];if(i.clock+i.len<=d.id.clock)break;d instanceof ct&&d.deleted&&!d.keep&&t(d)&&d.gc(e,!1)}}}},wk=(o,e)=>{o.clients.forEach((t,r)=>{let n=e.clients.get(r);for(let s=t.length-1;s>=0;s--){let a=t[s],i=ts(n.length-1,1+no(n,a.clock+a.len-1));for(let l=i,f=n[l];l>0&&f.id.clock>=a.clock;f=n[l])l-=1+Ki(n,l)}})};var rg=(o,e)=>{if(e<o.length){let t=o[e],r=t.doc,n=r.store,s=t.deleteSet,a=t._mergeStructs;try{Hf(s),t.afterState=nl(t.doc.store),r.emit("beforeObserverCalls",[t,r]);let i=[];t.changed.forEach((l,f)=>i.push(()=>{(f._item===null||!f._item.deleted)&&f._callObserver(t,l)})),i.push(()=>{t.changedParentTypes.forEach((l,f)=>{f._dEH.l.length>0&&(f._item===null||!f._item.deleted)&&(l=l.filter(u=>u.target._item===null||!u.target._item.deleted),l.forEach(u=>{u.currentTarget=f,u._path=null}),l.sort((u,d)=>u.path.length-d.path.length),Qh(f._dEH,l,t))})}),i.push(()=>r.emit("afterTransaction",[t,r])),ya(i,[]),t._needFormattingCleanup&&Uk(t)}finally{r.gc&&bk(s,n,r.gcFilter),wk(s,n),t.afterState.forEach((u,d)=>{let m=t.beforeState.get(d)||0;if(m!==u){let x=n.clients.get(d),h=$r(no(x,m),1);for(let _=x.length-1;_>=h;)_-=1+Ki(x,_)}});for(let u=a.length-1;u>=0;u--){let{client:d,clock:m}=a[u].id,x=n.clients.get(d),h=no(x,m);h+1<x.length&&Ki(x,h+1)>1||h>0&&Ki(x,h)}if(!t.local&&t.afterState.get(r.clientID)!==t.beforeState.get(r.clientID)&&(Ph(ka,_a,"[yjs] ",va,Sa,"Changed the client-id because another client seems to be using it."),r.clientID=Gh()),r.emit("afterTransactionCleanup",[t,r]),r._observers.has("update")){let u=new Cn;Bh(u,t)&&r.emit("update",[u.toUint8Array(),t.origin,r,t])}if(r._observers.has("updateV2")){let u=new Co;Bh(u,t)&&r.emit("updateV2",[u.toUint8Array(),t.origin,r,t])}let{subdocsAdded:i,subdocsLoaded:l,subdocsRemoved:f}=t;(i.size>0||f.size>0||l.size>0)&&(i.forEach(u=>{u.clientID=r.clientID,u.collectionid==null&&(u.collectionid=r.collectionid),r.subdocs.add(u)}),f.forEach(u=>r.subdocs.delete(u)),r.emit("subdocs",[{loaded:l,added:i,removed:f},r,t]),f.forEach(u=>u.destroy())),o.length<=e+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,o])):rg(o,e+1)}}},Ze=(o,e,t=null,r=!0)=>{let n=o._transactionCleanups,s=!1,a=null;o._transaction===null&&(s=!0,o._transaction=new Ef(o,t,r),n.push(o._transaction),n.length===1&&o.emit("beforeAllTransactions",[o]),o.emit("beforeTransaction",[o._transaction,o]));try{a=e(o._transaction)}finally{if(s){let i=o._transaction===n[0];o._transaction=null,i&&rg(n,0)}}return a};function*_k(o){let e=Te(o.restDecoder);for(let t=0;t<e;t++){let r=Te(o.restDecoder),n=o.readClient(),s=Te(o.restDecoder);for(let a=0;a<r;a++){let i=o.readInfo();if(i===10){let l=Te(o.restDecoder);yield new ir(Ne(n,s),l),s+=l}else if(31&i){let l=(i&192)===0,f=new ct(Ne(n,s),null,(i&128)===128?o.readLeftID():null,null,(i&64)===64?o.readRightID():null,l?o.readParentInfo()?o.readString():o.readLeftID():null,l&&(i&32)===32?o.readString():null,wg(o,i));yield f,s+=f.length}else{let l=o.readLen();yield new ar(Ne(n,s),l),s+=l}}}}var Ta=class{constructor(e,t){this.gen=_k(e),this.curr=null,this.done=!1,this.filterSkips=t,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===ir);return this.curr}};var Pa=class{constructor(e){this.currClient=0,this.startClock=0,this.written=0,this.encoder=e,this.clientStructs=[]}},vk=o=>el(o,Yi,Cn);var Sk=(o,e)=>{if(o.constructor===ar){let{client:t,clock:r}=o.id;return new ar(Ne(t,r+e),o.length-e)}else if(o.constructor===ir){let{client:t,clock:r}=o.id;return new ir(Ne(t,r+e),o.length-e)}else{let t=o,{client:r,clock:n}=t.id;return new ct(Ne(r,n+e),null,Ne(r,n+e-1),null,t.rightOrigin,t.parent,t.parentSub,t.content.splice(e))}},el=(o,e=Zo,t=Co)=>{if(o.length===1)return o[0];let r=o.map(u=>new e(Hr(u))),n=r.map(u=>new Ta(u,!0)),s=null,a=new t,i=new Pa(a);for(;n=n.filter(m=>m.curr!==null),n.sort((m,x)=>{if(m.curr.id.client===x.curr.id.client){let h=m.curr.id.clock-x.curr.id.clock;return h===0?m.curr.constructor===x.curr.constructor?0:m.curr.constructor===ir?1:-1:h}else return x.curr.id.client-m.curr.id.client}),n.length!==0;){let u=n[0],d=u.curr.id.client;if(s!==null){let m=u.curr,x=!1;for(;m!==null&&m.id.clock+m.length<=s.struct.id.clock+s.struct.length&&m.id.client>=s.struct.id.client;)m=u.next(),x=!0;if(m===null||m.id.client!==d||x&&m.id.clock>s.struct.id.clock+s.struct.length)continue;if(d!==s.struct.id.client)Yo(i,s.struct,s.offset),s={struct:m,offset:0},u.next();else if(s.struct.id.clock+s.struct.length<m.id.clock)if(s.struct.constructor===ir)s.struct.length=m.id.clock+m.length-s.struct.id.clock;else{Yo(i,s.struct,s.offset);let h=m.id.clock-s.struct.id.clock-s.struct.length;s={struct:new ir(Ne(d,s.struct.id.clock+s.struct.length),h),offset:0}}else{let h=s.struct.id.clock+s.struct.length-m.id.clock;h>0&&(s.struct.constructor===ir?s.struct.length-=h:m=Sk(m,h)),s.struct.mergeWith(m)||(Yo(i,s.struct,s.offset),s={struct:m,offset:0},u.next())}}else s={struct:u.curr,offset:0},u.next();for(let m=u.curr;m!==null&&m.id.client===d&&m.id.clock===s.struct.id.clock+s.struct.length&&m.constructor!==ir;m=u.next())Yo(i,s.struct,s.offset),s={struct:m,offset:0}}s!==null&&(Yo(i,s.struct,s.offset),s=null),jf(i);let l=r.map(u=>Ca(u)),f=Lf(l);return Qo(a,f),a.toUint8Array()},kk=(o,e,t=Zo,r=Co)=>{let n=Yh(e),s=new r,a=new Pa(s),i=new t(Hr(o)),l=new Ta(i,!1);for(;l.curr;){let u=l.curr,d=u.id.client,m=n.get(d)||0;if(l.curr.constructor===ir){l.next();continue}if(u.id.clock+u.length>m)for(Yo(a,u,$r(m-u.id.clock,0)),l.next();l.curr&&l.curr.id.client===d;)Yo(a,l.curr,0),l.next();else for(;l.curr&&l.curr.id.client===d&&l.curr.id.clock+l.curr.length<=m;)l.next()}jf(a);let f=Ca(i);return Qo(s,f),s.toUint8Array()};var og=o=>{o.written>0&&(o.clientStructs.push({written:o.written,restEncoder:pr(o.encoder.restEncoder)}),o.encoder.restEncoder=vn(),o.written=0)},Yo=(o,e,t)=>{o.written>0&&o.currClient!==e.id.client&&og(o),o.written===0&&(o.currClient=e.id.client,o.encoder.writeClient(e.id.client),Ee(o.encoder.restEncoder,e.id.clock+t)),e.write(o.encoder,t),o.written++},jf=o=>{og(o);let e=o.encoder.restEncoder;Ee(e,o.clientStructs.length);for(let t=0;t<o.clientStructs.length;t++){let r=o.clientStructs[t];Ee(e,r.written),ma(e,r.restEncoder)}},Ik=(o,e,t,r)=>{let n=new t(Hr(o)),s=new Ta(n,!1),a=new r,i=new Pa(a);for(let f=s.curr;f!==null;f=s.next())Yo(i,e(f),0);jf(i);let l=Ca(n);return Qo(a,l),a.toUint8Array()};var Lk=o=>Ik(o,yh,Zo,Cn),Hh="You must not compute changes after the event-handler fired.",ys=class{constructor(e,t){this.target=e,this.currentTarget=e,this.transaction=t,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=Ck(this.currentTarget,this.target))}deletes(e){return Nf(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw Lr(Hh);let e=new Map,t=this.target;this.transaction.changed.get(t).forEach(n=>{if(n!==null){let s=t._map.get(n),a,i;if(this.adds(s)){let l=s.left;for(;l!==null&&this.adds(l);)l=l.left;if(this.deletes(s))if(l!==null&&this.deletes(l))a="delete",i=Mi(l.content.getContent());else return;else l!==null&&this.deletes(l)?(a="update",i=Mi(l.content.getContent())):(a="add",i=void 0)}else if(this.deletes(s))a="delete",i=Mi(s.content.getContent());else return;e.set(n,{action:a,oldValue:i})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw Lr(Hh);let t=this.target,r=Zr(),n=Zr(),s=[];if(e={added:r,deleted:n,delta:s,keys:this.keys},this.transaction.changed.get(t).has(null)){let i=null,l=()=>{i&&s.push(i)};for(let f=t._start;f!==null;f=f.right)f.deleted?this.deletes(f)&&!this.adds(f)&&((i===null||i.delete===void 0)&&(l(),i={delete:0}),i.delete+=f.length,n.add(f)):this.adds(f)?((i===null||i.insert===void 0)&&(l(),i={insert:[]}),i.insert=i.insert.concat(f.content.getContent()),r.add(f)):((i===null||i.retain===void 0)&&(l(),i={retain:0}),i.retain+=f.length);i!==null&&i.retain===void 0&&l()}this._changes=e}return e}},Ck=(o,e)=>{let t=[];for(;e._item!==null&&e!==o;){if(e._item.parentSub!==null)t.unshift(e._item.parentSub);else{let r=0,n=e._item.parent._start;for(;n!==e._item&&n!==null;)n.deleted||r++,n=n.right;t.unshift(r)}e=e._item.parent}return t},ng=80,Yf=0,Ff=class{constructor(e,t){e.marker=!0,this.p=e,this.index=t,this.timestamp=Yf++}},Tk=o=>{o.timestamp=Yf++},sg=(o,e,t)=>{o.p.marker=!1,o.p=e,e.marker=!0,o.index=t,o.timestamp=Yf++},Pk=(o,e,t)=>{if(o.length>=ng){let r=o.reduce((n,s)=>n.timestamp<s.timestamp?n:s);return sg(r,e,t),r}else{let r=new Ff(e,t);return o.push(r),r}},sl=(o,e)=>{if(o._start===null||e===0||o._searchMarker===null)return null;let t=o._searchMarker.length===0?null:o._searchMarker.reduce((s,a)=>es(e-s.index)<es(e-a.index)?s:a),r=o._start,n=0;for(t!==null&&(r=t.p,n=t.index,Tk(t));r.right!==null&&n<e;){if(!r.deleted&&r.countable){if(e<n+r.length)break;n+=r.length}r=r.right}for(;r.left!==null&&n>e;)r=r.left,!r.deleted&&r.countable&&(n-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(n-=r.length);return t!==null&&es(t.index-n)<r.parent.length/ng?(sg(t,r,n),t):Pk(o._searchMarker,r,n)},Da=(o,e,t)=>{for(let r=o.length-1;r>=0;r--){let n=o[r];if(t>0){let s=n.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(n.index-=s.length);if(s===null||s.marker===!0){o.splice(r,1);continue}n.p=s,s.marker=!0}(e<n.index||t>0&&e===n.index)&&(n.index=$r(e,n.index+t))}};var al=(o,e,t)=>{let r=o,n=e.changedParentTypes;for(;Or(n,o,()=>[]).push(t),o._item!==null;)o=o._item.parent;Qh(r._eH,t,e)},It=class{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=Rh(),this._dEH=Rh(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,t){this.doc=e,this._item=t}_copy(){throw Br()}clone(){throw Br()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,t){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){Oh(this._eH,e)}observeDeep(e){Oh(this._dEH,e)}unobserve(e){Uh(this._eH,e)}unobserveDeep(e){Uh(this._dEH,e)}toJSON(){}},ag=(o,e,t)=>{e<0&&(e=o._length+e),t<0&&(t=o._length+t);let r=t-e,n=[],s=o._start;for(;s!==null&&r>0;){if(s.countable&&!s.deleted){let a=s.content.getContent();if(a.length<=e)e-=a.length;else{for(let i=e;i<a.length&&r>0;i++)n.push(a[i]),r--;e=0}}s=s.right}return n},ig=o=>{let e=[],t=o._start;for(;t!==null;){if(t.countable&&!t.deleted){let r=t.content.getContent();for(let n=0;n<r.length;n++)e.push(r[n])}t=t.right}return e};var Aa=(o,e)=>{let t=0,r=o._start;for(;r!==null;){if(r.countable&&!r.deleted){let n=r.content.getContent();for(let s=0;s<n.length;s++)e(n[s],t++,o)}r=r.right}},lg=(o,e)=>{let t=[];return Aa(o,(r,n)=>{t.push(e(r,n,o))}),t},Dk=o=>{let e=o._start,t=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(t===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};t=e.content.getContent(),r=0,e=e.right}let n=t[r++];return t.length<=r&&(t=null),{done:!1,value:n}}}},cg=(o,e)=>{let t=sl(o,e),r=o._start;for(t!==null&&(r=t.p,e-=t.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(e<r.length)return r.content.getContent()[e];e-=r.length}},tl=(o,e,t,r)=>{let n=t,s=o.doc,a=s.clientID,i=s.store,l=t===null?e._start:t.right,f=[],u=()=>{f.length>0&&(n=new ct(Ne(a,vt(i,a)),n,n&&n.lastId,l,l&&l.id,e,null,new Ao(f)),n.integrate(o,0),f=[])};r.forEach(d=>{if(d===null)f.push(d);else switch(d.constructor){case Number:case Object:case Boolean:case Array:case String:f.push(d);break;default:switch(u(),d.constructor){case Uint8Array:case ArrayBuffer:n=new ct(Ne(a,vt(i,a)),n,n&&n.lastId,l,l&&l.id,e,null,new Tn(new Uint8Array(d))),n.integrate(o,0);break;case mr:n=new ct(Ne(a,vt(i,a)),n,n&&n.lastId,l,l&&l.id,e,null,new Dn(d)),n.integrate(o,0);break;default:if(d instanceof It)n=new ct(Ne(a,vt(i,a)),n,n&&n.lastId,l,l&&l.id,e,null,new Pr(d)),n.integrate(o,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},fg=()=>Lr("Length exceeded!"),ug=(o,e,t,r)=>{if(t>e._length)throw fg();if(t===0)return e._searchMarker&&Da(e._searchMarker,t,r.length),tl(o,e,null,r);let n=t,s=sl(e,t),a=e._start;for(s!==null&&(a=s.p,t-=s.index,t===0&&(a=a.prev,t+=a&&a.countable&&!a.deleted?a.length:0));a!==null;a=a.right)if(!a.deleted&&a.countable){if(t<=a.length){t<a.length&&en(o,Ne(a.id.client,a.id.clock+t));break}t-=a.length}return e._searchMarker&&Da(e._searchMarker,n,r.length),tl(o,e,a,r)},Ak=(o,e,t)=>{let n=(e._searchMarker||[]).reduce((s,a)=>a.index>s.index?a:s,{index:0,p:e._start}).p;if(n)for(;n.right;)n=n.right;return tl(o,e,n,t)},dg=(o,e,t,r)=>{if(r===0)return;let n=t,s=r,a=sl(e,t),i=e._start;for(a!==null&&(i=a.p,t-=a.index);i!==null&&t>0;i=i.right)!i.deleted&&i.countable&&(t<i.length&&en(o,Ne(i.id.client,i.id.clock+t)),t-=i.length);for(;r>0&&i!==null;)i.deleted||(r<i.length&&en(o,Ne(i.id.client,i.id.clock+r)),i.delete(o),r-=i.length),i=i.right;if(r>0)throw fg();e._searchMarker&&Da(e._searchMarker,n,-s+r)},rl=(o,e,t)=>{let r=e._map.get(t);r!==void 0&&r.delete(o)},Jf=(o,e,t,r)=>{let n=e._map.get(t)||null,s=o.doc,a=s.clientID,i;if(r==null)i=new Ao([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:i=new Ao([r]);break;case Uint8Array:i=new Tn(r);break;case mr:i=new Dn(r);break;default:if(r instanceof It)i=new Pr(r);else throw new Error("Unexpected content type")}new ct(Ne(a,vt(s.store,a)),n,n&&n.lastId,null,null,e,t,i).integrate(o,0)},Xf=(o,e)=>{let t=o._map.get(e);return t!==void 0&&!t.deleted?t.content.getContent()[t.length-1]:void 0},pg=o=>{let e={};return o._map.forEach((t,r)=>{t.deleted||(e[r]=t.content.getContent()[t.length-1])}),e},mg=(o,e)=>{let t=o._map.get(e);return t!==void 0&&!t.deleted};var Mk=(o,e)=>{let t={};return o._map.forEach((r,n)=>{let s=r;for(;s!==null&&(!e.sv.has(s.id.client)||s.id.clock>=(e.sv.get(s.id.client)||0));)s=s.left;s!==null&&ms(s,e)&&(t[n]=s.content.getContent()[s.length-1])}),t},qi=o=>Ah(o.entries(),e=>!e[1].deleted),Rf=class extends ys{constructor(e,t){super(e,t),this._transaction=t}},oo=class extends It{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){let t=new oo;return t.push(e),t}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new oo}clone(){let e=new oo;return e.insert(0,this.toArray().map(t=>t instanceof It?t.clone():t)),e}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}_callObserver(e,t){super._callObserver(e,t),al(this,e,new Rf(this,e))}insert(e,t){this.doc!==null?Ze(this.doc,r=>{ug(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}push(e){this.doc!==null?Ze(this.doc,t=>{Ak(t,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,t=1){this.doc!==null?Ze(this.doc,r=>{dg(r,this,e,t)}):this._prelimContent.splice(e,t)}get(e){return cg(this,e)}toArray(){return ig(this)}slice(e=0,t=this.length){return ag(this,e,t)}toJSON(){return this.map(e=>e instanceof It?e.toJSON():e)}map(e){return lg(this,e)}forEach(e){Aa(this,e)}[Symbol.iterator](){return Dk(this)}_write(e){e.writeTypeRef(Zk)}},Ek=o=>new oo,Of=class extends ys{constructor(e,t,r){super(e,t),this.keysChanged=r}},To=class extends It{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,t){super._integrate(e,t),this._prelimContent.forEach((r,n)=>{this.set(n,r)}),this._prelimContent=null}_copy(){return new To}clone(){let e=new To;return this.forEach((t,r)=>{e.set(r,t instanceof It?t.clone():t)}),e}_callObserver(e,t){al(this,e,new Of(this,e,t))}toJSON(){let e={};return this._map.forEach((t,r)=>{if(!t.deleted){let n=t.content.getContent()[t.length-1];e[r]=n instanceof It?n.toJSON():n}}),e}get size(){return[...qi(this._map)].length}keys(){return Hi(qi(this._map),e=>e[0])}values(){return Hi(qi(this._map),e=>e[1].content.getContent()[e[1].length-1])}entries(){return Hi(qi(this._map),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this._map.forEach((t,r)=>{t.deleted||e(t.content.getContent()[t.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?Ze(this.doc,t=>{rl(t,this,e)}):this._prelimContent.delete(e)}set(e,t){return this.doc!==null?Ze(this.doc,r=>{Jf(r,this,e,t)}):this._prelimContent.set(e,t),t}get(e){return Xf(this,e)}has(e){return mg(this,e)}clear(){this.doc!==null?Ze(this.doc,e=>{this.forEach(function(t,r,n){rl(e,n,r)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(eI)}},Fk=o=>new To,Jo=(o,e)=>o===e||typeof o=="object"&&typeof e=="object"&&o&&e&&mf(o,e),Ma=class{constructor(e,t,r,n){this.left=e,this.right=t,this.index=r,this.currentAttributes=n}forward(){switch(this.right===null&&Cr(),this.right.content.constructor){case bt:this.right.deleted||vs(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}},Vh=(o,e,t)=>{for(;e.right!==null&&t>0;){switch(e.right.content.constructor){case bt:e.right.deleted||vs(e.currentAttributes,e.right.content);break;default:e.right.deleted||(t<e.right.length&&en(o,Ne(e.right.id.client,e.right.id.clock+t)),e.index+=e.right.length,t-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},Wi=(o,e,t,r)=>{let n=new Map,s=r?sl(e,t):null;if(s){let a=new Ma(s.p.left,s.p,s.index,n);return Vh(o,a,t-s.index)}else{let a=new Ma(null,e._start,0,n);return Vh(o,a,t)}},hg=(o,e,t,r)=>{for(;t.right!==null&&(t.right.deleted===!0||t.right.content.constructor===bt&&Jo(r.get(t.right.content.key),t.right.content.value));)t.right.deleted||r.delete(t.right.content.key),t.forward();let n=o.doc,s=n.clientID;r.forEach((a,i)=>{let l=t.left,f=t.right,u=new ct(Ne(s,vt(n.store,s)),l,l&&l.lastId,f,f&&f.id,e,null,new bt(i,a));u.integrate(o,0),t.right=u,t.forward()})},vs=(o,e)=>{let{key:t,value:r}=e;r===null?o.delete(t):o.set(t,r)},gg=(o,e)=>{var t;for(;o.right!==null;){if(!(o.right.deleted||o.right.content.constructor===bt&&Jo((t=e[o.right.content.key])!=null?t:null,o.right.content.value)))break;o.forward()}},xg=(o,e,t,r)=>{var i;let n=o.doc,s=n.clientID,a=new Map;for(let l in r){let f=r[l],u=(i=t.currentAttributes.get(l))!=null?i:null;if(!Jo(u,f)){a.set(l,u);let{left:d,right:m}=t;t.right=new ct(Ne(s,vt(n.store,s)),d,d&&d.lastId,m,m&&m.id,e,null,new bt(l,f)),t.right.integrate(o,0),t.forward()}}return a},If=(o,e,t,r,n)=>{t.currentAttributes.forEach((m,x)=>{n[x]===void 0&&(n[x]=null)});let s=o.doc,a=s.clientID;gg(t,n);let i=xg(o,e,t,n),l=r.constructor===String?new Tr(r):r instanceof It?new Pr(r):new Do(r),{left:f,right:u,index:d}=t;e._searchMarker&&Da(e._searchMarker,t.index,l.getLength()),u=new ct(Ne(a,vt(s.store,a)),f,f&&f.lastId,u,u&&u.id,e,null,l),u.integrate(o,0),t.right=u,t.index=d,t.forward(),hg(o,e,t,i)},qh=(o,e,t,r,n)=>{let s=o.doc,a=s.clientID;gg(t,n);let i=xg(o,e,t,n);e:for(;t.right!==null&&(r>0||i.size>0&&(t.right.deleted||t.right.content.constructor===bt));){if(!t.right.deleted)switch(t.right.content.constructor){case bt:{let{key:l,value:f}=t.right.content,u=n[l];if(u!==void 0){if(Jo(u,f))i.delete(l);else{if(r===0)break e;i.set(l,f)}t.right.delete(o)}else t.currentAttributes.set(l,f);break}default:r<t.right.length&&en(o,Ne(t.right.id.client,t.right.id.clock+r)),r-=t.right.length;break}t.forward()}if(r>0){let l="";for(;r>0;r--)l+=`
`;t.right=new ct(Ne(a,vt(s.store,a)),t.left,t.left&&t.left.lastId,t.right,t.right&&t.right.id,e,null,new Tr(l)),t.right.integrate(o,0),t.forward()}hg(o,e,t,i)},yg=(o,e,t,r,n)=>{var f,u;let s=e,a=Ct();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===bt){let d=s.content;a.set(d.key,d)}s=s.right}let i=0,l=!1;for(;e!==s;){if(t===e&&(l=!0),!e.deleted){let d=e.content;switch(d.constructor){case bt:{let{key:m,value:x}=d,h=(f=r.get(m))!=null?f:null;(a.get(m)!==d||h===x)&&(e.delete(o),i++,!l&&((u=n.get(m))!=null?u:null)===x&&h!==x&&(h===null?n.delete(m):n.set(m,h))),!l&&!e.deleted&&vs(n,d);break}}}e=e.right}return i},Rk=(o,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;let t=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===bt){let r=e.content.key;t.has(r)?e.delete(o):t.add(r)}e=e.left}},Ok=o=>{let e=0;return Ze(o.doc,t=>{let r=o._start,n=o._start,s=Ct(),a=Ai(s);for(;n;){if(n.deleted===!1)switch(n.content.constructor){case bt:vs(a,n.content);break;default:e+=yg(t,r,n,s,a),s=Ai(a),r=n;break}n=n.right}}),e},Uk=o=>{let e=new Set,t=o.doc;for(let[r,n]of o.afterState.entries()){let s=o.beforeState.get(r)||0;n!==s&&tg(o,t.store.clients.get(r),s,n,a=>{!a.deleted&&a.content.constructor===bt&&a.constructor!==ar&&e.add(a.parent)})}Ze(t,r=>{Kh(o,o.deleteSet,n=>{if(n instanceof ar||!n.parent._hasFormatting||e.has(n.parent))return;let s=n.parent;n.content.constructor===bt?e.add(s):Rk(r,n)});for(let n of e)Ok(n)})},Wh=(o,e,t)=>{let r=t,n=Ai(e.currentAttributes),s=e.right;for(;t>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case Pr:case Do:case Tr:t<e.right.length&&en(o,Ne(e.right.id.client,e.right.id.clock+t)),t-=e.right.length,e.right.delete(o);break}e.forward()}s&&yg(o,s,e.right,n,e.currentAttributes);let a=(e.left||e.right).parent;return a._searchMarker&&Da(a._searchMarker,e.index,-r+t),e},Uf=class extends ys{constructor(e,t,r){super(e,t),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(n=>{n===null?this.childListChanged=!0:this.keysChanged.add(n)})}get changes(){if(this._changes===null){let e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){let e=this.target.doc,t=[];Ze(e,r=>{var x,h,_;let n=new Map,s=new Map,a=this.target._start,i=null,l={},f="",u=0,d=0,m=()=>{if(i!==null){let w=null;switch(i){case"delete":d>0&&(w={delete:d}),d=0;break;case"insert":(typeof f=="object"||f.length>0)&&(w={insert:f},n.size>0&&(w.attributes={},n.forEach((v,A)=>{v!==null&&(w.attributes[A]=v)}))),f="";break;case"retain":u>0&&(w={retain:u},gh(l)||(w.attributes=mh({},l))),u=0;break}w&&t.push(w),i=null}};for(;a!==null;){switch(a.content.constructor){case Pr:case Do:this.adds(a)?this.deletes(a)||(m(),i="insert",f=a.content.getContent()[0],m()):this.deletes(a)?(i!=="delete"&&(m(),i="delete"),d+=1):a.deleted||(i!=="retain"&&(m(),i="retain"),u+=1);break;case Tr:this.adds(a)?this.deletes(a)||(i!=="insert"&&(m(),i="insert"),f+=a.content.str):this.deletes(a)?(i!=="delete"&&(m(),i="delete"),d+=a.length):a.deleted||(i!=="retain"&&(m(),i="retain"),u+=a.length);break;case bt:{let{key:w,value:v}=a.content;if(this.adds(a)){if(!this.deletes(a)){let A=(x=n.get(w))!=null?x:null;Jo(A,v)?v!==null&&a.delete(r):(i==="retain"&&m(),Jo(v,(h=s.get(w))!=null?h:null)?delete l[w]:l[w]=v)}}else if(this.deletes(a)){s.set(w,v);let A=(_=n.get(w))!=null?_:null;Jo(A,v)||(i==="retain"&&m(),l[w]=A)}else if(!a.deleted){s.set(w,v);let A=l[w];A!==void 0&&(Jo(A,v)?A!==null&&a.delete(r):(i==="retain"&&m(),v===null?delete l[w]:l[w]=v))}a.deleted||(i==="insert"&&m(),vs(n,a.content));break}}a=a.right}for(m();t.length>0;){let w=t[t.length-1];if(w.retain!==void 0&&w.attributes===void 0)t.pop();else break}}),this._delta=t}return this._delta}},tn=class extends It{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this._length}_integrate(e,t){super._integrate(e,t);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new tn}clone(){let e=new tn;return e.applyDelta(this.toDelta()),e}_callObserver(e,t){super._callObserver(e,t);let r=new Uf(this,e,t);al(this,e,r),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){let e="",t=this._start;for(;t!==null;)!t.deleted&&t.countable&&t.content.constructor===Tr&&(e+=t.content.str),t=t.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:t=!0}={}){this.doc!==null?Ze(this.doc,r=>{let n=new Ma(null,this._start,0,new Map);for(let s=0;s<e.length;s++){let a=e[s];if(a.insert!==void 0){let i=!t&&typeof a.insert=="string"&&s===e.length-1&&n.right===null&&a.insert.slice(-1)===`
`?a.insert.slice(0,-1):a.insert;(typeof i!="string"||i.length>0)&&If(r,this,n,i,a.attributes||{})}else a.retain!==void 0?qh(r,this,n,a.retain,a.attributes||{}):a.delete!==void 0&&Wh(r,n,a.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,t,r){let n=[],s=new Map,a=this.doc,i="",l=this._start;function f(){if(i.length>0){let d={},m=!1;s.forEach((h,_)=>{m=!0,d[_]=h});let x={insert:i};m&&(x.attributes=d),n.push(x),i=""}}let u=()=>{for(;l!==null;){if(ms(l,e)||t!==void 0&&ms(l,t))switch(l.content.constructor){case Tr:{let d=s.get("ychange");e!==void 0&&!ms(l,e)?(d===void 0||d.user!==l.id.client||d.type!=="removed")&&(f(),s.set("ychange",r?r("removed",l.id):{type:"removed"})):t!==void 0&&!ms(l,t)?(d===void 0||d.user!==l.id.client||d.type!=="added")&&(f(),s.set("ychange",r?r("added",l.id):{type:"added"})):d!==void 0&&(f(),s.delete("ychange")),i+=l.content.str;break}case Pr:case Do:{f();let d={insert:l.content.getContent()[0]};if(s.size>0){let m={};d.attributes=m,s.forEach((x,h)=>{m[h]=x})}n.push(d);break}case bt:ms(l,e)&&(f(),vs(s,l.content));break}l=l.right}f()};return e||t?Ze(a,d=>{e&&Af(d,e),t&&Af(d,t),u()},"cleanup"):u(),n}insert(e,t,r){if(t.length<=0)return;let n=this.doc;n!==null?Ze(n,s=>{let a=Wi(s,this,e,!r);r||(r={},a.currentAttributes.forEach((i,l)=>{r[l]=i})),If(s,this,a,t,r)}):this._pending.push(()=>this.insert(e,t,r))}insertEmbed(e,t,r){let n=this.doc;n!==null?Ze(n,s=>{let a=Wi(s,this,e,!r);If(s,this,a,t,r||{})}):this._pending.push(()=>this.insertEmbed(e,t,r||{}))}delete(e,t){if(t===0)return;let r=this.doc;r!==null?Ze(r,n=>{Wh(n,Wi(n,this,e,!0),t)}):this._pending.push(()=>this.delete(e,t))}format(e,t,r){if(t===0)return;let n=this.doc;n!==null?Ze(n,s=>{let a=Wi(s,this,e,!1);a.right!==null&&qh(s,this,a,t,r)}):this._pending.push(()=>this.format(e,t,r))}removeAttribute(e){this.doc!==null?Ze(this.doc,t=>{rl(t,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,t){this.doc!==null?Ze(this.doc,r=>{Jf(r,this,e,t)}):this._pending.push(()=>this.setAttribute(e,t))}getAttribute(e){return Xf(this,e)}getAttributes(){return pg(this)}_write(e){e.writeTypeRef(tI)}},$k=o=>new tn,Ia=class{constructor(e,t=()=>!0){this._filter=t,this._root=e,this._currentNode=e._start,this._firstCall=!0}[Symbol.iterator](){return this}next(){let e=this._currentNode,t=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(t)))do if(t=e.content.type,!e.deleted&&(t.constructor===rn||t.constructor===Po)&&t._start!==null)e=t._start;else for(;e!==null;)if(e.right!==null){e=e.right;break}else e.parent===this._root?e=null:e=e.parent._item;while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}},Po=class extends It{constructor(){super(),this._prelimContent=[]}get firstChild(){let e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Po}clone(){let e=new Po;return e.insert(0,this.toArray().map(t=>t instanceof It?t.clone():t)),e}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new Ia(this,e)}querySelector(e){e=e.toUpperCase();let r=new Ia(this,n=>n.nodeName&&n.nodeName.toUpperCase()===e).next();return r.done?null:r.value}querySelectorAll(e){return e=e.toUpperCase(),Ur(new Ia(this,t=>t.nodeName&&t.nodeName.toUpperCase()===e))}_callObserver(e,t){al(this,e,new $f(this,t,e))}toString(){return lg(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,t={},r){let n=e.createDocumentFragment();return r!==void 0&&r._createAssociation(n,this),Aa(this,s=>{n.insertBefore(s.toDOM(e,t,r),null)}),n}insert(e,t){this.doc!==null?Ze(this.doc,r=>{ug(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}insertAfter(e,t){if(this.doc!==null)Ze(this.doc,r=>{let n=e&&e instanceof It?e._item:e;tl(r,this,n,t)});else{let r=this._prelimContent,n=e===null?0:r.findIndex(s=>s===e)+1;if(n===0&&e!==null)throw Lr("Reference item not found");r.splice(n,0,...t)}}delete(e,t=1){this.doc!==null?Ze(this.doc,r=>{dg(r,this,e,t)}):this._prelimContent.splice(e,t)}toArray(){return ig(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return cg(this,e)}slice(e=0,t=this.length){return ag(this,e,t)}forEach(e){Aa(this,e)}_write(e){e.writeTypeRef(oI)}},Bk=o=>new Po,rn=class extends Po{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){let e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){let e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,t){super._integrate(e,t),this._prelimAttrs.forEach((r,n)=>{this.setAttribute(n,r)}),this._prelimAttrs=null}_copy(){return new rn(this.nodeName)}clone(){let e=new rn(this.nodeName),t=this.getAttributes();return hh(t,(r,n)=>{typeof r=="string"&&e.setAttribute(n,r)}),e.insert(0,this.toArray().map(r=>r instanceof It?r.clone():r)),e}toString(){let e=this.getAttributes(),t=[],r=[];for(let i in e)r.push(i);r.sort();let n=r.length;for(let i=0;i<n;i++){let l=r[i];t.push(l+'="'+e[l]+'"')}let s=this.nodeName.toLocaleLowerCase(),a=t.length>0?" "+t.join(" "):"";return`<${s}${a}>${super.toString()}</${s}>`}removeAttribute(e){this.doc!==null?Ze(this.doc,t=>{rl(t,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,t){this.doc!==null?Ze(this.doc,r=>{Jf(r,this,e,t)}):this._prelimAttrs.set(e,t)}getAttribute(e){return Xf(this,e)}hasAttribute(e){return mg(this,e)}getAttributes(e){return e?Mk(this,e):pg(this)}toDOM(e=document,t={},r){let n=e.createElement(this.nodeName),s=this.getAttributes();for(let a in s){let i=s[a];typeof i=="string"&&n.setAttribute(a,i)}return Aa(this,a=>{n.appendChild(a.toDOM(e,t,r))}),r!==void 0&&r._createAssociation(n,this),n}_write(e){e.writeTypeRef(rI),e.writeKey(this.nodeName)}},Nk=o=>new rn(o.readKey()),$f=class extends ys{constructor(e,t,r){super(e,r),this.childListChanged=!1,this.attributesChanged=new Set,t.forEach(n=>{n===null?this.childListChanged=!0:this.attributesChanged.add(n)})}},bs=class extends To{constructor(e){super(),this.hookName=e}_copy(){return new bs(this.hookName)}clone(){let e=new bs(this.hookName);return this.forEach((t,r)=>{e.set(r,t)}),e}toDOM(e=document,t={},r){let n=t[this.hookName],s;return n!==void 0?s=n.createDom(this):s=document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(s,this),s}_write(e){e.writeTypeRef(nI),e.writeKey(this.hookName)}},Hk=o=>new bs(o.readKey()),ws=class extends tn{get nextSibling(){let e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){let e=this._item?this._item.prev:null;return e?e.content.type:null}_copy(){return new ws}clone(){let e=new ws;return e.applyDelta(this.toDelta()),e}toDOM(e=document,t,r){let n=e.createTextNode(this.toString());return r!==void 0&&r._createAssociation(n,this),n}toString(){return this.toDelta().map(e=>{let t=[];for(let n in e.attributes){let s=[];for(let a in e.attributes[n])s.push({key:a,value:e.attributes[n][a]});s.sort((a,i)=>a.key<i.key?-1:1),t.push({nodeName:n,attrs:s})}t.sort((n,s)=>n.nodeName<s.nodeName?-1:1);let r="";for(let n=0;n<t.length;n++){let s=t[n];r+=`<${s.nodeName}`;for(let a=0;a<s.attrs.length;a++){let i=s.attrs[a];r+=` ${i.key}="${i.value}"`}r+=">"}r+=e.insert;for(let n=t.length-1;n>=0;n--)r+=`</${t[n].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef(sI)}},Vk=o=>new ws,Ea=class{constructor(e,t){this.id=e,this.length=t}get deleted(){throw Br()}mergeWith(e){return!1}write(e,t,r){throw Br()}integrate(e,t){throw Br()}},qk=0,ar=class extends Ea{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,t){t>0&&(this.id.clock+=t,this.length-=t),eg(e.doc.store,this)}write(e,t){e.writeInfo(qk),e.writeLen(this.length-t)}getMissing(e,t){return null}},Tn=class{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Tn(this.content)}splice(e){throw Br()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeBuf(this.content)}getRef(){return 3}},Wk=o=>new Tn(o.readBuf()),Pn=class{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Pn(this.len)}splice(e){let t=new Pn(this.len-e);return this.len=e,t}mergeWith(e){return this.len+=e.len,!0}integrate(e,t){ji(e.deleteSet,t.id.client,t.id.clock,this.len),t.markDeleted()}delete(e){}gc(e){}write(e,t){e.writeLen(this.len-t)}getRef(){return 1}},zk=o=>new Pn(o.readLen()),bg=(o,e)=>new mr({guid:o,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1}),Dn=class{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;let t={};this.opts=t,e.gc||(t.gc=!1),e.autoLoad&&(t.autoLoad=!0),e.meta!==null&&(t.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Dn(bg(this.doc.guid,this.opts))}splice(e){throw Br()}mergeWith(e){return!1}integrate(e,t){this.doc._item=t,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,t){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}},Kk=o=>new Dn(bg(o.readString(),o.readAny())),Do=class{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new Do(this.embed)}splice(e){throw Br()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeJSON(this.embed)}getRef(){return 5}},Gk=o=>new Do(o.readJSON()),bt=class{constructor(e,t){this.key=e,this.value=t}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new bt(this.key,this.value)}splice(e){throw Br()}mergeWith(e){return!1}integrate(e,t){let r=t.parent;r._searchMarker=null,r._hasFormatting=!0}delete(e){}gc(e){}write(e,t){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}},jk=o=>new bt(o.readKey(),o.readJSON()),_s=class{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new _s(this.arr)}splice(e){let t=new _s(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){let r=this.arr.length;e.writeLen(r-t);for(let n=t;n<r;n++){let s=this.arr[n];e.writeString(s===void 0?"undefined":JSON.stringify(s))}}getRef(){return 2}},Yk=o=>{let e=o.readLen(),t=[];for(let r=0;r<e;r++){let n=o.readString();n==="undefined"?t.push(void 0):t.push(JSON.parse(n))}return new _s(t)},Ao=class{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Ao(this.arr)}splice(e){let t=new Ao(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){let r=this.arr.length;e.writeLen(r-t);for(let n=t;n<r;n++){let s=this.arr[n];e.writeAny(s)}}getRef(){return 8}},Jk=o=>{let e=o.readLen(),t=[];for(let r=0;r<e;r++)t.push(o.readAny());return new Ao(t)},Tr=class{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Tr(this.str)}splice(e){let t=new Tr(this.str.slice(e));this.str=this.str.slice(0,e);let r=this.str.charCodeAt(e-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,e-1)+"\uFFFD",t.str="\uFFFD"+t.str.slice(1)),t}mergeWith(e){return this.str+=e.str,!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeString(t===0?this.str:this.str.slice(t))}getRef(){return 4}},Xk=o=>new Tr(o.readString()),Qk=[Ek,Fk,$k,Nk,Bk,Hk,Vk],Zk=0,eI=1,tI=2,rI=3,oI=4,nI=5,sI=6,Pr=class{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new Pr(this.type._copy())}splice(e){throw Br()}mergeWith(e){return!1}integrate(e,t){this.type._integrate(e.doc,t)}delete(e){let t=this.type._start;for(;t!==null;)t.deleted?t.id.clock<(e.beforeState.get(t.id.client)||0)&&e._mergeStructs.push(t):t.delete(e),t=t.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(e.beforeState.get(r.id.client)||0)&&e._mergeStructs.push(r):r.delete(e)}),e.changed.delete(this.type)}gc(e){let t=this.type._start;for(;t!==null;)t.gc(e,!0),t=t.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(e,!0),r=r.left}),this.type._map=new Map}write(e,t){this.type._write(e)}getRef(){return 7}},aI=o=>new Pr(Qk[o.readTypeRef()](o)),zh=(o,e)=>{let t=e,r=0,n;do r>0&&(t=Ne(t.client,t.clock+r)),n=zi(o,t),r=t.clock-n.id.clock,t=n.redone;while(t!==null&&n instanceof ct);return{item:n,diff:r}};var ol=(o,e,t)=>{let{client:r,clock:n}=e.id,s=new ct(Ne(r,n+t),e,Ne(r,n+t-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(t));return e.deleted&&s.markDeleted(),e.keep&&(s.keep=!0),e.redone!==null&&(s.redone=Ne(e.redone.client,e.redone.clock+t)),e.right=s,s.right!==null&&(s.right.left=s),o._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),e.length=t,s};var ct=class extends Ea{constructor(e,t,r,n,s,a,i,l){super(e,l.getLength()),this.origin=r,this.left=t,this.right=n,this.rightOrigin=s,this.parent=a,this.parentSub=i,this.redone=null,this.content=l,this.info=this.content.isCountable()?2:0}set marker(e){(this.info&8)>0!==e&&(this.info^=8)}get marker(){return(this.info&8)>0}get keep(){return(this.info&1)>0}set keep(e){this.keep!==e&&(this.info^=1)}get countable(){return(this.info&2)>0}get deleted(){return(this.info&4)>0}set deleted(e){this.deleted!==e&&(this.info^=4)}markDeleted(){this.info|=4}getMissing(e,t){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=vt(t,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=vt(t,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===Xo&&this.id.client!==this.parent.client&&this.parent.clock>=vt(t,this.parent.client))return this.parent.client;if(this.origin&&(this.left=$h(e,t,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=en(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===ar||this.right&&this.right.constructor===ar)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===ct&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===ct&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===Xo){let r=zi(t,this.parent);r.constructor===ar?this.parent=null:this.parent=r.content.type}return null}integrate(e,t){if(t>0&&(this.id.clock+=t,this.left=$h(e,e.doc.store,Ne(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(t),this.length-=t),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,n;if(r!==null)n=r.right;else if(this.parentSub!==null)for(n=this.parent._map.get(this.parentSub)||null;n!==null&&n.left!==null;)n=n.left;else n=this.parent._start;let s=new Set,a=new Set;for(;n!==null&&n!==this.right;){if(a.add(n),s.add(n),hs(this.origin,n.origin)){if(n.id.client<this.id.client)r=n,s.clear();else if(hs(this.rightOrigin,n.rightOrigin))break}else if(n.origin!==null&&a.has(zi(e.doc.store,n.origin)))s.has(zi(e.doc.store,n.origin))||(r=n,s.clear());else break;n=n.right}this.left=r}if(this.left!==null){let r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),eg(e.doc.store,this),this.content.integrate(e,this),Nh(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new ar(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:Ne(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&hs(e.origin,this.lastId)&&this.right===e&&hs(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){let t=this.parent._searchMarker;return t&&t.forEach(r=>{r.p===e&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){let t=this.parent;this.countable&&this.parentSub===null&&(t._length-=this.length),this.markDeleted(),ji(e.deleteSet,this.id.client,this.id.clock,this.length),Nh(e,t,this.parentSub),this.content.delete(e)}}gc(e,t){if(!this.deleted)throw Cr();this.content.gc(e),t?yk(e,this,new ar(this.id,this.length)):this.content=new Pn(this.length)}write(e,t){let r=t>0?Ne(this.id.client,this.id.clock+t-1):this.origin,n=this.rightOrigin,s=this.parentSub,a=this.content.getRef()&31|(r===null?0:128)|(n===null?0:64)|(s===null?0:32);if(e.writeInfo(a),r!==null&&e.writeLeftID(r),n!==null&&e.writeRightID(n),r===null&&n===null){let i=this.parent;if(i._item!==void 0){let l=i._item;if(l===null){let f=Zh(i);e.writeParentInfo(!0),e.writeString(f)}else e.writeParentInfo(!1),e.writeLeftID(l.id)}else i.constructor===String?(e.writeParentInfo(!0),e.writeString(i)):i.constructor===Xo?(e.writeParentInfo(!1),e.writeLeftID(i)):Cr();s!==null&&e.writeString(s)}this.content.write(e,t)}},wg=(o,e)=>iI[e&31](o),iI=[()=>{Cr()},zk,Yk,Wk,Xk,Gk,jk,aI,Jk,Kk,()=>{Cr()}],lI=10,ir=class extends Ea{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,t){Cr()}write(e,t){e.writeInfo(lI),Ee(e.restEncoder,this.length-t)}getMissing(e,t){return null}},_g=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:{},vg="__ $YJS$ __";_g[vg]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");_g[vg]=!0;var Mn=o=>Lo((e,t)=>{o.onerror=r=>t(new Error(r.target.error)),o.onsuccess=r=>e(r.target.result)}),Sg=(o,e)=>Lo((t,r)=>{let n=indexedDB.open(o);n.onupgradeneeded=s=>e(s.target.result),n.onerror=s=>r(Lr(s.target.error)),n.onsuccess=s=>{let a=s.target.result;a.onversionchange=()=>{a.close()},t(a)}}),kg=o=>Mn(indexedDB.deleteDatabase(o)),Ig=(o,e)=>e.forEach(t=>o.createObjectStore.apply(o,t)),so=(o,e,t="readwrite")=>{let r=o.transaction(e,t);return e.map(n=>dI(r,n))},En=(o,e)=>Mn(o.count(e)),Lg=(o,e)=>Mn(o.get(e)),Qf=(o,e)=>Mn(o.delete(e)),Cg=(o,e,t)=>Mn(o.put(e,t));var il=(o,e)=>Mn(o.add(e)),Tg=(o,e,t)=>Mn(o.getAll(e,t));var cI=(o,e,t)=>{let r=null;return uI(o,e,n=>(r=n,!1),t).then(()=>r)},Pg=(o,e=null)=>cI(o,e,"prev");var fI=(o,e)=>Lo((t,r)=>{o.onerror=r,o.onsuccess=async n=>{let s=n.target.result;if(s===null||await e(s)===!1)return t();s.continue()}});var uI=(o,e,t,r="next")=>fI(o.openKeyCursor(e,r),n=>t(n.key)),dI=(o,e)=>o.objectStore(e);var Dg=(o,e)=>IDBKeyRange.upperBound(o,e),Ag=(o,e)=>IDBKeyRange.lowerBound(o,e);var eu="custom",Mg="updates",Eg=500,Fg=(o,e=()=>{},t=()=>{})=>{let[r]=so(o.db,[Mg]);return Tg(r,Ag(o._dbref,!1)).then(n=>{o._destroyed||(e(r),Ze(o.doc,()=>{n.forEach(s=>Mo(o.doc,s))},o,!1),t(r))}).then(()=>Pg(r).then(n=>{o._dbref=n+1})).then(()=>En(r).then(n=>{o._dbsize=n})).then(()=>r)},pI=(o,e=!0)=>Fg(o).then(t=>{(e||o._dbsize>=Eg)&&il(t,An(o.doc)).then(()=>Qf(t,Dg(o._dbref,!0))).then(()=>En(t).then(r=>{o._dbsize=r}))});var Ss=class extends Zn{constructor(e,t){super(),this.doc=t,this.name=e,this._dbref=0,this._dbsize=0,this._destroyed=!1,this.db=null,this.synced=!1,this._db=Sg(e,r=>Ig(r,[["updates",{autoIncrement:!0}],["custom"]])),this.whenSynced=Lo(r=>this.on("synced",()=>r(this))),this._db.then(r=>{this.db=r,Fg(this,a=>il(a,An(t)),()=>{if(this._destroyed)return this;this.synced=!0,this.emit("synced",[this])})}),this._storeTimeout=1e3,this._storeTimeoutId=null,this._storeUpdate=(r,n)=>{if(this.db&&n!==this){let[s]=so(this.db,[Mg]);il(s,r),++this._dbsize>=Eg&&(this._storeTimeoutId!==null&&clearTimeout(this._storeTimeoutId),this._storeTimeoutId=setTimeout(()=>{pI(this,!1),this._storeTimeoutId=null},this._storeTimeout))}},t.on("update",this._storeUpdate),this.destroy=this.destroy.bind(this),t.on("destroy",this.destroy)}destroy(){return this._storeTimeoutId&&clearTimeout(this._storeTimeoutId),this.doc.off("update",this._storeUpdate),this.doc.off("destroy",this.destroy),this._destroyed=!0,this._db.then(e=>{e.close()})}clearData(){return this.destroy().then(()=>{kg(this.name)})}get(e){return this._db.then(t=>{let[r]=so(t,[eu],"readonly");return Lg(r,e)})}set(e,t){return this._db.then(r=>{let[n]=so(r,[eu]);return Cg(n,t,e)})}del(e){return this._db.then(t=>{let[r]=so(t,[eu]);return Qf(r,e)})}};var xr=bn(ua());var Rg=0,ll=1,Og=2,cl=(o,e)=>{Ee(o,Rg);let t=Xh(e);Pt(o,t)},tu=(o,e,t)=>{Ee(o,ll),Pt(o,An(e,t))},mI=(o,e,t)=>tu(e,t,Ft(o)),Ug=(o,e,t)=>{try{Mo(e,Ft(o),t)}catch(r){console.error("Caught error while handling a Yjs update",r)}},$g=(o,e)=>{Ee(o,Og),Pt(o,e)},hI=Ug,Bg=(o,e,t,r)=>{let n=Te(o);switch(n){case Rg:mI(o,e,t);break;case ll:Ug(o,t,r);break;case Og:hI(o,t,r);break;default:throw new Error("Unknown message type")}return n};var xI=0;var Ng=(o,e,t)=>{switch(Te(o)){case xI:t(e,Nr(o))}};var ru=3e4,fl=class extends Zn{constructor(e){super(),this.doc=e,this.clientID=e.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{let t=In();this.getLocalState()!==null&&ru/2<=t-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());let r=[];this.meta.forEach((n,s)=>{s!==this.clientID&&ru<=t-n.lastUpdated&&this.states.has(s)&&r.push(s)}),r.length>0&&ul(this,r,"timeout")},sr(ru/10)),e.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(e){let t=this.clientID,r=this.meta.get(t),n=r===void 0?0:r.clock+1,s=this.states.get(t);e===null?this.states.delete(t):this.states.set(t,e),this.meta.set(t,{clock:n,lastUpdated:In()});let a=[],i=[],l=[],f=[];e===null?f.push(t):s==null?e!=null&&a.push(t):(i.push(t),ds(s,e)||l.push(t)),(a.length>0||l.length>0||f.length>0)&&this.emit("change",[{added:a,updated:l,removed:f},"local"]),this.emit("update",[{added:a,updated:i,removed:f},"local"])}setLocalStateField(e,t){let r=this.getLocalState();r!==null&&this.setLocalState({...r,[e]:t})}getStates(){return this.states}},ul=(o,e,t)=>{let r=[];for(let n=0;n<e.length;n++){let s=e[n];if(o.states.has(s)){if(o.states.delete(s),s===o.clientID){let a=o.meta.get(s);o.meta.set(s,{clock:a.clock+1,lastUpdated:In()})}r.push(s)}}r.length>0&&(o.emit("change",[{added:[],updated:[],removed:r},t]),o.emit("update",[{added:[],updated:[],removed:r},t]))},ks=(o,e,t=o.states)=>{let r=e.length,n=vn();Ee(n,r);for(let s=0;s<r;s++){let a=e[s],i=t.get(a)||null,l=o.meta.get(a).clock;Ee(n,a),Ee(n,l),Io(n,JSON.stringify(i))}return pr(n)};var Hg=(o,e,t)=>{let r=Hr(e),n=In(),s=[],a=[],i=[],l=[],f=Te(r);for(let u=0;u<f;u++){let d=Te(r),m=Te(r),x=JSON.parse(Nr(r)),h=o.meta.get(d),_=o.states.get(d),w=h===void 0?0:h.clock;(w<m||w===m&&x===null&&o.states.has(d))&&(x===null?d===o.clientID&&o.getLocalState()!=null?m++:o.states.delete(d):o.states.set(d,x),o.meta.set(d,{clock:m,lastUpdated:n}),h===void 0&&x!==null?s.push(d):h!==void 0&&x===null?l.push(d):x!==null&&(ds(x,_)||i.push(d),a.push(d)))}(s.length>0||i.length>0||l.length>0)&&o.emit("change",[{added:s,updated:i,removed:l},t]),(s.length>0||a.length>0||l.length>0)&&o.emit("update",[{added:s,updated:a,removed:l},t])};var Ls=()=>new Map,Kg=(o,e,t)=>{let r=o.get(e);return r===void 0&&o.set(e,r=t()),r},Gg=()=>new Set,wI=Array.from,KE=Array.isArray,jg=String.fromCharCode,GE=String.fromCodePoint,jE=jg(65535),_I=o=>o.toLowerCase(),vI=/^\s*/g,SI=o=>o.replace(vI,""),kI=/([A-Z])/g,Vg=(o,e)=>SI(o.replace(kI,t=>`${e}${_I(t)}`)),II=o=>{let e=unescape(encodeURIComponent(o)),t=e.length,r=new Uint8Array(t);for(let n=0;n<t;n++)r[n]=e.codePointAt(n);return r},Ra=typeof TextEncoder!="undefined"?new TextEncoder:null,LI=o=>Ra.encode(o),CI=Ra?LI:II,ou=typeof TextDecoder=="undefined"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});ou&&ou.decode(new Uint8Array).length===1&&(ou=null);var qg=o=>o===void 0?null:o,TI=class{constructor(){this.map=new Map}setItem(o,e){this.map.set(o,e)}getItem(o){return this.map.get(o)}},Yg=new TI,cu=!0;try{typeof localStorage!="undefined"&&(Yg=localStorage,cu=!1)}catch(o){}var Jg=Yg,PI=o=>cu||addEventListener("storage",o),DI=o=>cu||removeEventListener("storage",o),AI=(o,e)=>{let t=[];for(let r in o)t.push(e(o[r],r));return t},MI=(o,e)=>e.includes(o),Ps=typeof process!="undefined"&&process.release&&/node|io\.js/.test(process.release.name),Xg=typeof window!="undefined"&&typeof document!="undefined"&&!Ps,YE=typeof navigator!="undefined"?/Mac/.test(navigator.platform):!1,ao,EI=[],FI=()=>{if(ao===void 0)if(Ps){ao=Ls();let o=process.argv,e=null;for(let t=0;t<o.length;t++){let r=o[t];r[0]==="-"?(e!==null&&ao.set(e,""),e=r):e!==null?(ao.set(e,r),e=null):EI.push(r)}e!==null&&ao.set(e,"")}else typeof location=="object"?(ao=Ls(),(location.search||"?").slice(1).split("&").forEach(o=>{if(o.length!==0){let[e,t]=o.split("=");ao.set(`--${Vg(e,"-")}`,t),ao.set(`-${Vg(e,"-")}`,t)}})):ao=Ls();return ao},su=o=>FI().has(o),au=o=>qg(Ps?process.env[o.toUpperCase()]:Jg.getItem(o)),RI=o=>su("--"+o)||au(o)!==null,JE=RI("production"),Wg=Ps&&MI(process.env.FORCE_COLOR,["true","1","2"]),XE=!su("no-colors")&&(!Ps||process.stdout.isTTY||Wg)&&(!Ps||su("color")||Wg||au("COLORTERM")!==null||(au("TERM")||"").includes("color")),Qg=Math.floor,Zg=(o,e)=>o<e?o:e,OI=(o,e)=>o>e?o:e,QE=Number.isNaN,UI=Math.pow,ex=128,$I=1<<17,BI=1<<18,NI=1<<19,HI=1<<20,VI=1<<21,qI=1<<22,WI=1<<23,zI=1<<24,KI=1<<25,GI=1<<26,jI=1<<27,YI=1<<28,JI=1<<29,XI=1<<30,ZE=1<<31,dl=127,eF=$I-1,tF=BI-1,rF=NI-1,oF=HI-1,nF=VI-1,sF=qI-1,aF=WI-1,iF=zI-1,lF=KI-1,cF=GI-1,fF=jI-1,uF=YI-1,dF=JI-1,pF=XI-1,QI=Number.MAX_SAFE_INTEGER,mF=Number.MIN_SAFE_INTEGER,hF=1<<31,gF=Number.isInteger||(o=>typeof o=="number"&&isFinite(o)&&Qg(o)===o),xF=Number.isNaN,yF=Number.parseInt,ZI=class{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}},Vr=()=>new ZI,fu=o=>{let e=o.cpos;for(let t=0;t<o.bufs.length;t++)e+=o.bufs[t].length;return e},Dr=o=>{let e=new Uint8Array(fu(o)),t=0;for(let r=0;r<o.bufs.length;r++){let n=o.bufs[r];e.set(n,t),t+=n.length}return e.set(ox(o.cbuf.buffer,0,o.cpos),t),e},pl=(o,e)=>{let t=o.cbuf.length;o.cpos===t&&(o.bufs.push(o.cbuf),o.cbuf=new Uint8Array(t*2),o.cpos=0),o.cbuf[o.cpos++]=e},jt=(o,e)=>{for(;e>dl;)pl(o,ex|dl&e),e=Qg(e/128);pl(o,dl&e)},iu=new Uint8Array(3e4),eL=iu.length/3,tL=(o,e)=>{if(e.length<eL){let t=Ra.encodeInto(e,iu).written||0;jt(o,t);for(let r=0;r<t;r++)pl(o,iu[r])}else Cs(o,CI(e))},rL=(o,e)=>{let t=unescape(encodeURIComponent(e)),r=t.length;jt(o,r);for(let n=0;n<r;n++)pl(o,t.codePointAt(n))},bF=Ra&&Ra.encodeInto?tL:rL,oL=(o,e)=>{let t=o.cbuf.length,r=o.cpos,n=Zg(t-r,e.length),s=e.length-n;o.cbuf.set(e.subarray(0,n),r),o.cpos+=n,s>0&&(o.bufs.push(o.cbuf),o.cbuf=new Uint8Array(OI(t*2,s)),o.cbuf.set(e.subarray(n)),o.cpos=s)},Cs=(o,e)=>{jt(o,e.byteLength),oL(o,e)},wF=new DataView(new ArrayBuffer(4)),tx=o=>new Error(o),nL=tx("Unexpected end of array"),sL=tx("Integer out of Range"),aL=class{constructor(o){this.arr=o,this.pos=0}},iL=o=>new aL(o),lL=(o,e)=>{let t=ox(o.arr.buffer,o.pos+o.arr.byteOffset,e);return o.pos+=e,t},cL=o=>lL(o,rx(o)),rx=o=>{let e=0,t=1,r=o.arr.length;for(;o.pos<r;){let n=o.arr[o.pos++];if(e=e+(n&dl)*t,t*=128,n<ex)return e;if(e>QI)throw sL}throw nL},fL=o=>new Uint8Array(o),ox=(o,e,t)=>new Uint8Array(o,e,t),uL=o=>new Uint8Array(o),dL=o=>{let e="";for(let t=0;t<o.byteLength;t++)e+=jg(o[t]);return btoa(e)},pL=o=>Buffer.from(o.buffer,o.byteOffset,o.byteLength).toString("base64"),mL=o=>{let e=atob(o),t=fL(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t},hL=o=>{let e=Buffer.from(o,"base64");return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)},gL=Xg?dL:pL,xL=Xg?mL:hL,nx=new Map,yL=class{constructor(o){this.room=o,this.onmessage=null,this._onChange=e=>e.key===o&&this.onmessage!==null&&this.onmessage({data:xL(e.newValue||"")}),PI(this._onChange)}postMessage(o){Jg.setItem(this.room,gL(uL(o)))}close(){DI(this._onChange)}},bL=typeof BroadcastChannel=="undefined"?yL:BroadcastChannel,uu=o=>Kg(nx,o,()=>{let e=Gg(),t=new bL(o);return t.onmessage=r=>e.forEach(n=>n(r.data,"broadcastchannel")),{bc:t,subs:e}}),wL=(o,e)=>(uu(o).subs.add(e),e),_L=(o,e)=>{let t=uu(o),r=t.subs.delete(e);return r&&t.subs.size===0&&(t.bc.close(),nx.delete(o)),r},Is=(o,e,t=null)=>{let r=uu(o);r.bc.postMessage(e),r.subs.forEach(n=>n(e,t))},lu=Date.now,vL=class{constructor(){this._observers=Ls()}on(o,e){Kg(this._observers,o,Gg).add(e)}once(o,e){let t=(...r)=>{this.off(o,t),e(...r)};this.on(o,t)}off(o,e){let t=this._observers.get(o);t!==void 0&&(t.delete(e),t.size===0&&this._observers.delete(o))}emit(o,e){return wI((this._observers.get(o)||Ls()).values()).forEach(t=>t(...e))}destroy(){this._observers=Ls()}},SL=o=>AI(o,(e,t)=>`${encodeURIComponent(t)}=${encodeURIComponent(e)}`).join("&"),Fn=0,sx=3,Ts=1,kL=2,Oa=[];Oa[Fn]=(o,e,t,r,n)=>{jt(o,Fn);let s=Bg(e,o,t.doc,t);r&&s===ll&&!t.synced&&(t.synced=!0)};Oa[sx]=(o,e,t,r,n)=>{jt(o,Ts),Cs(o,ks(t.awareness,Array.from(t.awareness.getStates().keys())))};Oa[Ts]=(o,e,t,r,n)=>{Hg(t.awareness,cL(e),t)};Oa[kL]=(o,e,t,r,n)=>{Ng(e,t.doc,(s,a)=>IL(t,a))};var zg=3e4,IL=(o,e)=>console.warn(`Permission denied to access ${o.url}.
${e}`),ax=(o,e,t)=>{let r=iL(e),n=Vr(),s=rx(r),a=o.messageHandlers[s];return a?a(n,r,o,t,s):console.error("Unable to compute message"),n},ix=o=>{if(o.shouldConnect&&o.ws===null){let e=new o._WS(o.url);e.binaryType="arraybuffer",o.ws=e,o.wsconnecting=!0,o.wsconnected=!1,o.synced=!1,e.onmessage=t=>{o.wsLastMessageReceived=lu();let r=ax(o,new Uint8Array(t.data),!0);fu(r)>1&&e.send(Dr(r))},e.onerror=t=>{o.emit("connection-error",[t,o])},e.onclose=t=>{o.emit("connection-close",[t,o]),o.ws=null,o.wsconnecting=!1,o.wsconnected?(o.wsconnected=!1,o.synced=!1,ul(o.awareness,Array.from(o.awareness.getStates().keys()).filter(r=>r!==o.doc.clientID),o),o.emit("status",[{status:"disconnected"}])):o.wsUnsuccessfulReconnects++,setTimeout(ix,Zg(UI(2,o.wsUnsuccessfulReconnects)*100,o.maxBackoffTime),o)},e.onopen=()=>{o.wsLastMessageReceived=lu(),o.wsconnecting=!1,o.wsconnected=!0,o.wsUnsuccessfulReconnects=0,o.emit("status",[{status:"connected"}]);let t=Vr();if(jt(t,Fn),cl(t,o.doc),e.send(Dr(t)),o.awareness.getLocalState()!==null){let r=Vr();jt(r,Ts),Cs(r,ks(o.awareness,[o.doc.clientID])),e.send(Dr(r))}},o.emit("status",[{status:"connecting"}])}},nu=(o,e)=>{let t=o.ws;o.wsconnected&&t&&t.readyState===t.OPEN&&t.send(e),o.bcconnected&&Is(o.bcChannel,e,o)},lx=class extends vL{constructor(o,e,t,{connect:r=!0,awareness:n=new fl(t),params:s={},WebSocketPolyfill:a=WebSocket,resyncInterval:i=-1,maxBackoffTime:l=2500,disableBc:f=!1}={}){for(super();o[o.length-1]==="/";)o=o.slice(0,o.length-1);let u=SL(s);this.maxBackoffTime=l,this.bcChannel=o+"/"+e,this.url=o+"/"+e+(u.length===0?"":"?"+u),this.roomname=e,this.doc=t,this._WS=a,this.awareness=n,this.wsconnected=!1,this.wsconnecting=!1,this.bcconnected=!1,this.disableBc=f,this.wsUnsuccessfulReconnects=0,this.messageHandlers=Oa.slice(),this._synced=!1,this.ws=null,this.wsLastMessageReceived=0,this.shouldConnect=r,this._resyncInterval=0,i>0&&(this._resyncInterval=setInterval(()=>{if(this.ws&&this.ws.readyState===WebSocket.OPEN){let d=Vr();jt(d,Fn),cl(d,t),this.ws.send(Dr(d))}},i)),this._bcSubscriber=(d,m)=>{if(m!==this){let x=ax(this,new Uint8Array(d),!1);fu(x)>1&&Is(this.bcChannel,Dr(x),this)}},this._updateHandler=(d,m)=>{if(m!==this){let x=Vr();jt(x,Fn),$g(x,d),nu(this,Dr(x))}},this.doc.on("update",this._updateHandler),this._awarenessUpdateHandler=({added:d,updated:m,removed:x},h)=>{let _=d.concat(m).concat(x),w=Vr();jt(w,Ts),Cs(w,ks(n,_)),nu(this,Dr(w))},this._unloadHandler=()=>{ul(this.awareness,[t.clientID],"window unload")},typeof window!="undefined"?window.addEventListener("unload",this._unloadHandler):typeof process!="undefined"&&process.on("exit",this._unloadHandler),n.on("update",this._awarenessUpdateHandler),this._checkInterval=setInterval(()=>{var d;this.wsconnected&&zg<lu()-this.wsLastMessageReceived&&((d=this.ws)==null||d.close())},zg/10),r&&this.connect()}get synced(){return this._synced}set synced(o){this._synced!==o&&(this._synced=o,this.emit("synced",[o]),this.emit("sync",[o]))}destroy(){this._resyncInterval!==0&&clearInterval(this._resyncInterval),clearInterval(this._checkInterval),this.disconnect(),typeof window!="undefined"?window.removeEventListener("unload",this._unloadHandler):typeof process!="undefined"&&process.off("exit",this._unloadHandler),this.awareness.off("update",this._awarenessUpdateHandler),this.doc.off("update",this._updateHandler),super.destroy()}connectBc(){if(this.disableBc)return;this.bcconnected||(wL(this.bcChannel,this._bcSubscriber),this.bcconnected=!0);let o=Vr();jt(o,Fn),cl(o,this.doc),Is(this.bcChannel,Dr(o),this);let e=Vr();jt(e,Fn),tu(e,this.doc),Is(this.bcChannel,Dr(e),this);let t=Vr();jt(t,sx),Is(this.bcChannel,Dr(t),this);let r=Vr();jt(r,Ts),Cs(r,ks(this.awareness,[this.doc.clientID])),Is(this.bcChannel,Dr(r),this)}disconnectBc(){let o=Vr();jt(o,Ts),Cs(o,ks(this.awareness,[this.doc.clientID],new Map)),nu(this,Dr(o)),this.bcconnected&&(_L(this.bcChannel,this._bcSubscriber),this.bcconnected=!1)}disconnect(){this.shouldConnect=!1,this.disconnectBc(),this.ws!==null&&this.ws.close()}connect(){this.shouldConnect=!0,!this.wsconnected&&this.ws===null&&(ix(this),this.connectBc())}};var Dt=new WeakMap,cx=!1;function hl(o){cx=o}var qr={maxFileSize:1024*1024,maxBackups:5,disableConsole:!1,batchInterval:1e3,maxRetries:3},Yt,Jt,ml=[];function fx(o,e,t,r){Jt=o,Yt=t,r&&(qr={...qr,...r}),e.setInterval(du,qr.batchInterval)}async function du(){if(ml.length===0)return;let o=[...ml];ml.length=0;for(let e=0;e<qr.maxRetries;e++)try{await LL();let t=o.map(ux).join(`
`)+`
`;await Jt.append(Yt,t);return}catch(t){console.error(`Failed to write logs (attempt ${e+1}):`,t),e===qr.maxRetries-1&&console.error("Max retries reached. Discarding log entries.")}}async function LL(){let o=await Jt.stat(Yt);if(o&&o.size>qr.maxFileSize){for(let e=qr.maxBackups;e>0;e--){let t=`${Yt}.${e}`,r=`${Yt}.${e+1}`;await Jt.exists(t)&&(e===qr.maxBackups?await Jt.remove(t):await Jt.rename(t,r))}await Jt.exists(Yt)&&await Jt.rename(Yt,`${Yt}.1`),await Jt.write(Yt,"")}}function ux(o){return`[${o.timestamp}] [${o.level.toUpperCase()}] ${o.message}
    at ${o.callerInfo}`}function CL(o,e){return e?t=>(o.notify(t.name+`
`+t.message),t):t=>(o.notify(t.name+`:
An error has occurred, please reload Obsidian.`),t)}var TL=["token","authorization","email"];function PL(o){if(typeof o=="object"&&o!==null){let e=new WeakSet;try{return JSON.stringify(o,(t,r)=>{var n;if(typeof r=="object"&&r!==null){if(e.has(r))return"[Circular]";e.add(r)}return typeof t=="string"&&TL.some(s=>t.toLowerCase().includes(s.toLowerCase()))?"[REDACTED]":r instanceof Error?{name:r.name,message:r.message,stack:(n=r.stack)==null?void 0:n.split(`
`).map(s=>s.trim()).join(" ")}:r},2)}catch(t){return t instanceof Error?t instanceof RangeError?`[Complex Object: ${Object.prototype.toString.call(o)}]`:`[Unserializable: ${t.message}]`:"[Unknown Error]"}}return String(o)}function Ce(o,e="log"){return(...t)=>{if(cx){let r=new Date().toISOString(),n=new Error().stack,s=n?n.split(`
`)[2].trim():"",a=t.map(PL).join(" "),i={timestamp:r,level:e,message:`${o}: ${a}`,callerInfo:s};qr.disableConsole||console[e](ux(i)),ml.push(i)}}}async function gl(){let o=[];await Jt.exists(Yt)&&o.push(Yt);for(let e=1;e<=qr.maxBackups;e++){let t=`${Yt}.${e}`;await Jt.exists(t)&&o.push(t)}return o}async function dx(){let o=[];if(await Jt.exists(Yt)){let e=await Jt.read(Yt);o.push(e)}for(let e=1;e<=qr.maxBackups;e++){let t=`${Yt}.${e}`;if(await Jt.exists(t)){let r=await Jt.read(t);o.push(r)}}return o.reverse().join(`
`)}var hr=class{constructor(e){let t=e||this.constructor.name;this.debug=Ce(`[${t}]`,"debug"),this.log=Ce(`[${t}]`,"log"),this.warn=Ce(`[${t}]`,"warn"),this.error=Ce(`[${t}]`,"error")}setLoggers(e){this.debug=Ce(`[${e}]`,"debug"),this.log=Ce(`[${e}]`,"log"),this.warn=Ce(`[${e}]`,"warn"),this.error=Ce(`[${e}]`,"error")}},DL=!1;function px(o){return CL(o,DL)}var pu=class{constructor(){this.platform="s3rn";this.product="relay"}},mu=class{constructor(e){this.relayId=e;this.platform="s3rn";this.product="relay"}},Eo=class{constructor(e,t){this.relayId=e;this.folderId=t;this.platform="s3rn";this.product="relay"}},Wr=class{constructor(e,t,r){this.relayId=e;this.folderId=t;this.documentId=r;this.platform="s3rn";this.product="relay"}},on=class{constructor(e){this.folderId=e;this.platform="s3rn";this.product="relay"}},Rn=class{constructor(e,t){this.folderId=e;this.documentId=t;this.platform="s3rn";this.product="relay"}},Xt=class{static validateUUID(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e)}static encode(e){let t=`${e.platform}:${e.product}`;if("relayId"in e){if(!this.validateUUID(e.relayId))throw new Error("Invalid relay UUID");t+=`:relay:${e.relayId}`}if("folderId"in e){if(!this.validateUUID(e.folderId))throw new Error("Invalid folder UUID");t+=`:folder:${e.folderId}`}if("documentId"in e){if(!this.validateUUID(e.documentId))throw new Error("Invalid document UUID");t+=`:doc:${e.documentId}`}return t}static decode(e){let t=e.split(":");if(t.length<3)throw new Error("Invalid s3rn format");let[,r,n,s,a,i,l,f]=t;if(!this.validateUUID(s))throw new Error("Invalid UUID");if(i&&!this.validateUUID(i))throw new Error("Invalid UUID");if(f&&!this.validateUUID(f))throw new Error("Invalid UUID");if(r==="relay"&&n==="relay"&&a==="folder"&&l==="doc")return new Wr(s,i,f);if(r==="relay"&&n==="relay"&&a=="folder")return new Eo(s,i);if(r==="relay"&&n==="folder"&&a==="document")return new Rn(s,i);if(r==="relay"&&n==="folder")return new on(s);if(r==="relay"&&n==="relay")return new mu(s);if(n===void 0)return new pu;throw new Error("Invalid s3rn format for the given product type")}};function AL(o){if(typeof window!="undefined"&&window.btoa)return window.btoa(o);if(typeof Buffer!="undefined")return Buffer.from(o).toString("base64");throw new Error("Unable to encode to Base64")}function mx(o){let e=JSON.stringify(o),t=AL(e);return t=t.replace("+","-").replace("/","_").replace(/=+$/,""),t}var xl={enableUpdateYDocFromDiskBuffer:!1,enableDocumentStatus:!1,enableDebugFileTag:!1,enableNewLinkFormat:!1,enableDeltaLogging:!1,enableHTTPSync:!1,enableSyncMenu:!0,enableDocumentServer:!1,enableDocumentHistory:!1,enableEditorTweens:!1,enableSyncModal:!1,enableDesyncPill:!1,enableAutomaticUpdatesOption:!1};function ML(){return new Proxy({},{get:(o,e)=>e})}var Ar=ML();var Ds=class{constructor(){this.timeouts=[],this.intervals=[]}getTime(){return Date.now()}setInterval(e,t){let r=window.setInterval(e,t);return this.intervals.push(r),r}clearInterval(e){window.clearInterval(e)}setTimeout(e,t){let r=window.setTimeout(()=>{this.timeouts.remove(r),e()},t);return this.timeouts.push(r),r}clearTimeout(e){window.clearTimeout(e)}destroy(){for(let e of this.timeouts)this.clearTimeout(e);this.timeouts=[];for(let e of this.intervals)this.clearInterval(e);this.intervals=[]}debounce(e,t=500){let r;return(...n)=>{r&&clearTimeout(r),r=setTimeout(()=>{e(...n)},t)}}};var Rt=class{constructor(e,t=20){this.timeProvider=e;this.deliveryWindow=t;this.mailboxes=new Map;this.allMailLog=[];this.deliveredMailLog=[];this.isDelivering=!1;this.deliveryInterval=null;this.currentTransactionId=0;this.isInTransaction=!1}static getInstance(){if(this._destroyed)throw new Error("tried to access postie during teardown");return Rt.instance||(Rt.instance=new Rt(new Ds),Dt.set(this.instance,"postie")),Rt.instance}beginTransaction(){this.isInTransaction=!0,this.currentTransactionId++}commitTransaction(){this.isInTransaction=!1,this.isDelivering||this.scheduleDelivery()}send(e,t,r=!1){let n={sender:e,recipient:t,transactionId:this.currentTransactionId,timestamp:Date.now(),recipientOrigin:this.getFunctionOrigin(t)};this.allMailLog.push(n),this.mailboxes.has(t)||this.mailboxes.set(t,new Set),this.mailboxes.get(t).add(e),r?this.deliverImmediate(e,t):!this.isInTransaction&&!this.isDelivering&&this.scheduleDelivery()}deliverImmediate(e,t){t(e),this.deliveredMailLog.push({sender:e,recipient:t,transactionId:this.currentTransactionId,timestamp:Date.now(),recipientOrigin:this.getFunctionOrigin(t)})}scheduleDelivery(){this.isDelivering=!0,this.deliveryInterval=this.timeProvider.setTimeout(()=>{this.deliver(),this.deliveryInterval=null,this.isDelivering=!1,this.mailboxes.size>0&&!this.isInTransaction&&this.scheduleDelivery()},this.deliveryWindow)}deliver(){let e=Ce("[postie]","debug");for(let[t,r]of this.mailboxes){for(let n of r)t(n),e("send",n.constructor.name,t),this.deliveredMailLog.push({sender:n,recipient:t,transactionId:this.currentTransactionId,timestamp:Date.now(),recipientOrigin:this.getFunctionOrigin(t)});r.clear()}}getAllMailLog(){return[...this.allMailLog]}getDeliveredMailLog(){return[...this.deliveredMailLog]}prettyPrintAllMailLog(){Ce("[postie]","warn")("All Mail Log:"),this.prettyPrintMailLog(this.allMailLog)}prettyPrintDeliveredMailLog(){Ce("[postie]","warn")("Delivered Mail Log:"),this.prettyPrintMailLog(this.deliveredMailLog)}prettyPrintMailLog(e){let t=Ce("[postie]","warn");e.forEach((r,n)=>{t(`Mail #${n+1}:`),t(`  Timestamp: ${new Date(r.timestamp).toISOString()}`),t(`  Transaction ID: ${r.transactionId}`),t(`  Sender: ${r.sender.observableName||r.sender.constructor.name}`),t(`  Recipient: ${r.recipient.name||"Anonymous function"}`),t(`  Recipient Origin: ${r.recipientOrigin||"Unknown"}`),t("---")})}getFunctionOrigin(e){if(e.name)return e.name;let t=e.toString(),r=t.match(/^(function|class)?\s*([^\s(]*)/);if(r&&r[2])return r[2];let n=200,s=t.replace(/\s+/g," ").slice(0,n);return s.length===n&&(s+="..."),`AnonymousFunction(${s})`}static destroy(){Rt.instance&&(Rt.instance.mailboxes=null,Rt.instance.allMailLog=[],Rt.instance.deliveredMailLog=[],Rt.instance.timeProvider.destroy(),Rt.instance.timeProvider=null,Rt.instance.isDelivering=!1,Rt.instance.isInTransaction=!1,Rt.instance.currentTransactionId=0,Rt._destroyed=!0,Rt.instance=void 0)}},Mr=Rt;Mr._destroyed=!1;var hu=new Map;function hx(){for(let[,o]of hu)o();hu.clear()}var St=class extends hr{constructor(t){super();this.observableName=t;this.destroyed=!1;hu.set(this,()=>{this._listeners&&this._listeners.size>0&&this.warn(`Missing tear down of ${this._listeners.size} listeners on ${this.observableName}`)}),this._listeners=new Set,this.unsubscribes=[]}notifyListeners(){for(let t of this._listeners)Mr.getInstance().send(this,t)}on(t){return this._listeners.add(t),()=>{this.off(t)}}subscribe(t){return this._listeners.add(t),Mr.getInstance().send(this,t,!0),()=>{this.unsubscribe(t)}}off(t){this._listeners.delete(t)}unsubscribe(t){this._listeners&&this._listeners.delete(t)}destroy(){var t;this.destroyed=!0,this.unsubscribes&&this.unsubscribes.forEach(r=>{r()}),(t=this._listeners)==null||t.clear(),this._listeners=null}};function Ot(){return{...qt.getInstance().flags}}function io(o,e,t=()=>{}){qt.getInstance().flags[o]?e():t()}function gx(o,e,t=()=>{}){o.forEach(r=>{if(qt.getInstance().flags[r]){e();return}}),t()}var qt=class extends St{constructor(){super();this.flags=xl}static getInstance(){return qt.instance||(qt.instance=new qt),qt.instance}setSettings(t){this.settings=t,this.settings.subscribe(r=>{this.flags={...this.flags,...r},this.notifyListeners()})}getFlag(t){return this.flags[t]}setFlag(t,r){this.settings&&this.settings.update(n=>({...n,[t]:r}))}static destroy(){qt.instance=null}};var EL={3:"disconnected",2:"disconnected",1:"connected",0:"connecting"};function xx(o,e,t){let r={token:o.token},n=new lx(o.url,o.docId,e,{connect:!1,params:r,disableBc:!0});return t&&n.awareness.setLocalStateField("user",{name:t.name,color:t.color.color,colorLight:t.color.light}),n}var As=class extends hr{constructor(t,r,n,s){var f;super();this.guid=t;this._s3rn=r;this.tokenStore=n;this.loginManager=s;this._providerSynced=!1;this.PROVIDER_MAX_ERRORS=3;this.listeners=new Map,this.loginManager=s;let a=(f=this.loginManager)==null?void 0:f.user;this.ydoc=new mr,Ot().enableDocumentHistory&&(this.ydoc.gc=!1),a&&new Xi(this.ydoc).setUserMapping(this.ydoc,this.ydoc.clientID,a.id),this.tokenStore=n,this.clientToken=this.tokenStore.getTokenSync(Xt.encode(this.s3rn))||{token:"",url:"",docId:"-",expiryTime:0},this._provider=xx(this.clientToken,this.ydoc,a);let i=this.providerConnectionErrorSubscription(u=>{this.log(`[${this.path}] disconnection event`,u);let d=this._provider.url&&this._provider.shouldConnect&&this._provider.wsUnsuccessfulReconnects<this.PROVIDER_MAX_ERRORS;this.disconnect(),d&&this.connect()});i.on(),this._offConnectionError=i.off;let l=this.providerStateSubscription(u=>{this.notifyListeners()});l.on(),this._offState=l.off}get s3rn(){return this._s3rn}set s3rn(t){this._s3rn=t,this.refreshProvider(this.clientToken)}get debuggerUrl(){return`https://debugger.y-sweet.dev/?payload=${mx(this.clientToken)}`}notifyListeners(){this.debug("[Provider State]",this.path,this.state),this.listeners.forEach(t=>{t(this.state)})}subscribe(t,r){return this.listeners.set(t,r),()=>{this.unsubscribe(t)}}unsubscribe(t){this.listeners.delete(t)}async getProviderToken(){return this.log("get provider token"),this.tokenStore.getToken(Xt.encode(this.s3rn),this.path||"unknown",this.refreshProvider.bind(this))}providerActive(){var t;if(this.clientToken){let r=this._provider.url==this.clientToken.url,n=Date.now()>(((t=this.clientToken)==null?void 0:t.expiryTime)||0);return r&&!n}return!1}refreshProvider(t){var a;this.clientToken=t;let r=new mr,n=xx(t,r),s=n.url;if(this._provider){if(this._provider.url!==s){this._provider.url=s,this._provider.wsUnsuccessfulReconnects=0;let i=this._provider.url.replace(/token=[^&]+/,"token=[REDACTED]");this.log(`Token Refreshed: setting new provider url, ${i}`),(a=this._provider.ws)==null||a.close()}}else throw new Error("missing provider!");n.awareness.destroy(),n.destroy(),r.destroy()}get connected(){return this.state.status==="connected"}connect(){return this.connected?Promise.resolve(!0):this.getProviderToken().then(t=>(this.refreshProvider(t),this._provider.connect(),this.notifyListeners(),!0)).catch(t=>!1)}get state(){var t;return{status:EL[((t=this._provider.ws)==null?void 0:t.readyState)||3],intent:this.intent}}get intent(){return this._provider.shouldConnect?"connected":"disconnected"}get synced(){return this._providerSynced}disconnect(){var t;this._provider.shouldConnect=!1,(t=this._provider.ws)==null||t.close(),this._provider.ws=null,this.tokenStore.removeFromRefreshQueue(this.guid),this.notifyListeners()}withActiveProvider(){return this.providerActive()?new Promise(t=>{t(this)}):this.getProviderToken().then(t=>this)}onceConnected(){return new Promise(t=>{let r=n=>{n.status==="connected"&&t()};this._provider.on("status",r)})}onceProviderSynced(){return this.synced?new Promise(t=>{t()}):new Promise(t=>{this._provider.once("synced",()=>{this._providerSynced=!0,t()})})}_injectIntent(t){return n=>{t({status:n.status,intent:this.intent})}}providerConnectionErrorSubscription(t){return{on:()=>{this._provider.on("connection-error",t)},off:()=>{this._provider.off("connection-error",t)}}}providerStateSubscription(t){return{on:()=>{this._provider.on("status",this._injectIntent(t))},off:()=>{this._provider.off("status",this._injectIntent(t))}}}destroy(){this._offConnectionError&&this._offConnectionError(),this._offState&&this._offState(),this._provider&&(this._provider.disconnect(),this._provider.awareness.destroy(),this._provider._observers.clear(),this._provider.destroy(),window.clearInterval(this._provider.awareness._checkInterval)),this.loginManager=null}};var nn=class{constructor(e,t,r){this.vault=e;this.contents=r;this.parent=null;this.path=t,this.name=t.split("/").pop()||"",this.extension=this.name.includes(".")&&this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.stat={ctime:Date.now(),mtime:Date.now(),size:0}}delete(){return Promise.resolve()}rename(e){return this.path=e,this.name=e.split("/").pop()||"",this.extension=this.name.includes(".")&&this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),Promise.resolve()}getBasePath(){return this.path.substring(0,this.path.lastIndexOf("/"))}},yl=class{constructor(){this.dbName="RelayDiskBuffer";this.storeName="diskBuffers";this.dbPromise=null}async getDB(){return this.dbPromise||(this.dbPromise=this.openDB()),this.dbPromise}async openDB(){return new Promise((e,t)=>{let r=indexedDB.open(this.dbName,1);r.onerror=()=>t(r.error),r.onsuccess=()=>e(r.result),r.onupgradeneeded=n=>{n.target.result.createObjectStore(this.storeName,{keyPath:"guid"})}})}async saveDiskBuffer(e,t){let r=await this.getDB();return new Promise((n,s)=>{try{let l=r.transaction(this.storeName,"readwrite").objectStore(this.storeName).put({guid:e,contents:t});l.onerror=()=>s(l.error),l.onsuccess=()=>n()}catch(a){s(a)}})}async loadDiskBuffer(e){let t=await this.getDB();return new Promise((r,n)=>{try{let i=t.transaction(this.storeName,"readonly").objectStore(this.storeName).get(e);i.onerror=()=>n(i.error),i.onsuccess=()=>r(i.result?i.result.contents:null)}catch(s){n(s)}})}async removeDiskBuffer(e){let t=await this.getDB();return new Promise((r,n)=>{try{let i=t.transaction(this.storeName,"readwrite").objectStore(this.storeName).delete(e);i.onerror=()=>n(i.error),i.onsuccess=()=>r()}catch(s){n(s)}})}};var sn=class{constructor(e,t){this.currentPromise=null;this.promiseFunction=e,this.checkFunction=t}getPromise(){let[e,t]=this.checkFunction(),r=n=>{if(this.currentPromise&&this.resolver){let s=this.resolver;s(n),this.timeoutId&&clearTimeout(this.timeoutId),this.resolver=void 0}return this.currentPromise};if(e){let n=r(t);if(n)return n}return this.currentPromise||(this.currentPromise=new Promise((n,s)=>{this.resolver=n,this.timeoutId=window.setTimeout(()=>{Ce("[Promise]","debug")("Dependency stuck after 3s. Checking.",this.promiseFunction.toString());let[a,i]=this.checkFunction();a&&r(i)},3e3),this.promiseFunction().then(a=>{this.timeoutId&&clearTimeout(this.timeoutId),n(a)},a=>{this.timeoutId&&clearTimeout(this.timeoutId),this.currentPromise=null,s(a)})})),this.currentPromise}destroy(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=void 0),this.currentPromise=null,this.resolver=void 0}},bl=class{constructor(e){this.currentPromise=null;this.promiseFunction=e}getPromise(){return this.currentPromise||(this.currentPromise=new Promise((e,t)=>{this.timeoutId=window.setTimeout(()=>{Ce("[Promise]","error")("SharedPromise stuck after 3s:",this.promiseFunction.toString())},3e3),this.promiseFunction().then(r=>{this.timeoutId&&clearTimeout(this.timeoutId),this.currentPromise=null,e(r)},r=>{this.timeoutId&&clearTimeout(this.timeoutId),this.currentPromise=null,t(r)})})),this.currentPromise}destroy(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=void 0),this.currentPromise=null}};function gu(o,...e){return new Promise((t,r)=>{let n=window.setTimeout(()=>{Ce("[Promise]","error")("Promise stuck after 3s:",...e)},3e3);o.then(s=>{clearTimeout(n),t(s)},s=>{clearTimeout(n),r(s)})})}var FL={md:"text/markdown",txt:"text/plain",json:"application/json",js:"application/javascript",ts:"application/typescript",html:"text/html",css:"text/css",png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",svg:"image/svg+xml",pdf:"application/pdf",canvas:"application/json"};function Ua(o){var t;let e=((t=o.split(".").pop())==null?void 0:t.toLowerCase())||"";return FL[e]||"application/octet-stream"}function Fo(o){return o instanceof wt}var wt=class extends As{constructor(t,r,n,s){let a=s.relayId?new Wr(s.relayId,s.guid,r):new Rn(s.guid,r);super(r,a,s.tokenStore,n);this.whenSyncedPromise=null;this.persistenceSynced=!1;this.userLock=!1;this.unsubscribes=[];this._parent=s,this.path=t,this.name="[CRDT] "+t.split("/").pop()||"",this.setLoggers(this.name),this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.vault=this._parent.vault,this.stat={ctime:Date.now(),mtime:Date.now(),size:0},this._diskBufferStore=this.sharedFolder.diskBufferStore,this.unsubscribes.push(this._parent.subscribe(this.path,i=>{i.intent==="disconnected"&&this.disconnect()})),this.setLoggers(`[SharedDoc](${this.path})`);try{let i=`${this.sharedFolder.appId}-relay-doc-${this.guid}`;this._persistence=new Ss(i,this.ydoc)}catch(i){throw this.warn("Unable to open persistence.",this.guid),console.error(i),i}this.whenSynced().then(()=>{let i=l=>{let f=l.transaction.origin;l.changes.keys.size!==0&&f!=this&&this.updateStats()};this.ytext.observe(i),this.unsubscribes.push(()=>{var l;(l=this.ytext)==null||l.unobserve(i)}),this.updateStats();try{this._persistence.set("path",this.path),this._persistence.set("relay",this.sharedFolder.relayId||""),this._persistence.set("appId",this.sharedFolder.appId),this._persistence.set("s3rn",Xt.encode(this.s3rn))}catch(l){}(async()=>(await this.getServerSynced()||(await this.onceProviderSynced(),await this.markSynced()),this.sharedFolder.markUploaded(this)))()}),io(Ar.enableDeltaLogging,()=>{let i=l=>{var u,d;let f="";f+=`Transaction origin: ${l.transaction.origin} ${(d=(u=l.transaction.origin)==null?void 0:u.constructor)==null?void 0:d.name}
`;for(let m of l.changes.delta)f+=`insert: ${m.insert}

retain: ${m.retain}

delete: ${m.delete}
`;this.debug(f)};this.ytext.observe(i),this.unsubscribes.push(()=>{this.ytext.unobserve(i)})}),this._tfile=null}move(t){this.path=t,this.name=t.split("/").pop()||"",this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.updateStats()}get parent(){var t;return((t=this.tfile)==null?void 0:t.parent)||null}get sharedFolder(){return this._parent}get tfile(){return this._tfile||(this._tfile=this._parent.getTFile(this)),this._tfile}get ytext(){return this.ydoc.getText("contents")}get text(){return this.ytext?this.ytext.toString():""}async diskBuffer(t=!1){if(t||this._diskBuffer===void 0){let r;try{let n=await this._parent.diskBufferStore.loadDiskBuffer(this.guid).catch(s=>null);return n!==null&&n!==""?r=n:r=await this._parent.read(this),this.setDiskBuffer(r.replace(`\r
`,`
`))}catch(n){throw console.error(n),n}}return this._diskBuffer}setDiskBuffer(t){return this._diskBuffer?this._diskBuffer.contents=t:this._diskBuffer=new nn(this._parent.vault,"local disk",t),this._parent.diskBufferStore.saveDiskBuffer(this.guid,t).catch(r=>{}),this._diskBuffer}async clearDiskBuffer(){this._diskBuffer&&(this._diskBuffer.contents="",this._diskBuffer=void 0),await this._parent.diskBufferStore.removeDiskBuffer(this.guid).catch(t=>{})}async checkStale(){await this.whenSynced();let r=(await this.diskBuffer(!0)).contents,n=this.text!==r;return n||this.clearDiskBuffer(),n}async connect(){return this.sharedFolder.s3rn instanceof on?!1:(this.s3rn instanceof Rn&&(this.sharedFolder.relayId?this.s3rn=new Wr(this.sharedFolder.relayId,this.sharedFolder.guid,this.guid):this.s3rn=new Rn(this.sharedFolder.guid,this.guid)),this.sharedFolder.shouldConnect&&this.sharedFolder.connect().then(t=>super.connect()))}get ready(){return this._persistence.synced&&(this.synced||!!this._serverSynced||this._origin==="local")}hasLocalDB(){return!!this._serverSynced||this._persistence._dbsize>3||!!(this._dbsize&&this._dbsize>3)}async awaitingUpdates(){return await this.whenSynced(),await this.getServerSynced(),this._awaitingUpdates?(this._awaitingUpdates=!this.hasLocalDB(),this._awaitingUpdates):!1}async whenReady(){let t=async()=>await this.awaitingUpdates()?(this.log("awaiting updates"),this.connect(),await this.onceConnected(),this.log("connected"),await this.onceProviderSynced(),this.log("synced"),this):this;return this.readyPromise=this.readyPromise||new sn(t,()=>[this.ready,this]),this.readyPromise.getPromise()}whenSynced(){let t=async()=>(await this.sharedFolder.whenSynced(),this._persistence.synced&&!this.persistenceSynced?(await this.count(),this.persistenceSynced=!0,Promise.resolve()):new Promise(r=>{this.persistenceSynced&&r(),this._persistence.once("synced",async()=>{await this.count(),this.persistenceSynced=!0,r()})}));return this.whenSyncedPromise=this.whenSyncedPromise||new sn(t,()=>[this.persistenceSynced,void 0]),this.whenSyncedPromise.getPromise()}async hasKnownPeers(){return await this.whenSynced(),this.hasLocalDB()}get mimetype(){return Ua(this.path)}async markOrigin(t){this._origin=t,await this._persistence.set("origin",t)}async getOrigin(){return this._origin!==void 0?this._origin:(this._origin=await this._persistence.get("origin"),this._origin)}async markSynced(){this._serverSynced=!0,await this._persistence.set("serverSync",1)}async getServerSynced(){return this._serverSynced!==void 0?this._serverSynced:await this._persistence.get("serverSync")===1?(this._serverSynced=!0,this._serverSynced):!1}async count(){if(this._persistence.db===null)throw new Error("database not ready yet");if(this._dbsize)return this._dbsize;if(this._persistence._dbsize>3)return this._dbsize=this._persistence._dbsize,this._dbsize;let[t]=so(this._persistence.db,["updates"],"readonly"),r=await En(t);return this._dbsize=r,this._dbsize}get dbsize(){if(!this._dbsize)throw new Error("dbsize accessed before count");return this._persistence._dbsize===0&&this._dbsize?this._dbsize:this._persistence._dbsize}static checkExtension(t){return t.endsWith(".md")}destroy(){var t,r;this.unsubscribes.forEach(n=>{n()}),super.destroy(),this.ydoc.destroy(),this._diskBuffer&&(this._diskBuffer.contents="",this._diskBuffer=void 0),this._diskBufferStore=null,(t=this.whenSyncedPromise)==null||t.destroy(),this.whenSyncedPromise=null,(r=this.readyPromise)==null||r.destroy(),this.readyPromise=null}async read(){return this.text}async rename(t){this.move(t)}async cleanup(){var t;(t=this._diskBufferStore)==null||t.removeDiskBuffer(this.guid)}updateStats(){this.stat.mtime=Date.now(),this.stat.size=this.text.length}async write(t){this.ytext.delete(0,this.ytext.length),this.ytext.insert(0,t),this.updateStats()}async append(t){this.ytext.insert(this.ytext.length,t),this.updateStats()}};var an=class extends St{constructor(){super();this._set=new Set}add(t){return this._set.add(t),this.notifyListeners(),this}delete(t){let r=this._set.delete(t);return r&&this.notifyListeners(),r}clear(){this._set.clear(),this.notifyListeners()}has(t){return this._set.has(t)}items(){return[...this._set]}get size(){return this._set.size}map(t){return this.items().map(t)}forEach(t){this.items().forEach(t)}find(t){return this.items().find(t)}some(t){for(let r of this._set)if(t(r))return!0;return!1}filter(t){let r=[];for(let n of this._set)t(n)&&r.push(n);return r}};var Ro=class{constructor(e){this.seperator="/";this.namespace=e}fullKey(e){return`${this.namespace}${this.seperator}${e}`}get size(){return Object.keys(localStorage).filter(e=>e.startsWith(this.namespace+this.seperator)).length}clear(){Object.keys(localStorage).filter(e=>e.startsWith(this.namespace+this.seperator)).forEach(e=>localStorage.removeItem(e))}delete(e){let t=this.fullKey(e),r=localStorage.getItem(t)!==null;return localStorage.removeItem(t),r}forEach(e,t){Object.keys(localStorage).filter(r=>r.startsWith(this.namespace+this.seperator)).forEach(r=>{let n=r.split(`${this.namespace}${this.seperator}`)[1],s=this.get(n);e.call(t,s,n,this)})}get(e){let t=this.fullKey(e),r=localStorage.getItem(t);return r?JSON.parse(r):void 0}has(e){let t=this.fullKey(e);return localStorage.getItem(t)!==null}set(e,t){let r=this.fullKey(e);return localStorage.setItem(r,JSON.stringify(t)),this}keys(){return Object.keys(localStorage).filter(t=>t.startsWith(this.namespace+this.seperator)).map(t=>t.split(`${this.namespace}${this.seperator}`)[1]).values()}values(){return Array.from(this.keys()).map(t=>this.get(t)).values()}entries(){return Array.from(this.keys()).map(t=>[t,this.get(t)]).values()}[Symbol.iterator](){return this.entries()}get[Symbol.toStringTag](){return"LocalStorage"}};var xu=require("obsidian");function yu(o){return o instanceof gr}var gr=class extends hr{constructor(t,r,n,s){super();this.path=t;this.guid=r;this.relayManager=n;this._tfolder=null;this.ready=!1;this.createPromise=null;this.connected=!0;this._parent=s,this.name=this.path.split("/").pop()||"",this.vault=this._parent.vault;let a=this.vault.getAbstractFileByPath(this.sharedFolder.getPath(t));a instanceof xu.TFolder?(this._tfolder=a,this.ready=!0):(this.createPromise=this.vault.createFolder(this.sharedFolder.getPath(t)),this.createPromise.then(i=>{this._tfolder=i,this.ready=!0})),this.synctime=0,this.setLoggers(`[SyncFolder](${this.path})`),this.offFolderStatusListener=this._parent.subscribe(this.path,i=>{i.intent==="disconnected"&&this.disconnect()}),(async()=>(this.createPromise&&await this.createPromise,s.markUploaded(this)))(),this.log("created")}static fromTFolder(t,r,n){return console.log("virtualpath for new syncfolder",r.getVirtualPath(n.path)),new gr(r.getVirtualPath(n.path),us(),t,r)}disconnect(){this.connected=!1}move(t){t!==this.path&&(this.log("setting new path",t),this.path=t,this.name=t.split("/").pop()||"",this.setLoggers(`[SharedFolder](${this.path})`))}static checkPath(t){var n;return!((n=t.split("/").pop())==null?void 0:n.includes("."))}get tfolder(){let t=this.vault.getAbstractFileByPath(this.sharedFolder.getPath(this.path));if(t instanceof xu.TFolder)return t;throw new Error("TFolder API used before file existed")}get parent(){var t;return((t=this.tfolder)==null?void 0:t.parent)||null}get sharedFolder(){return this._parent}async connect(){return this.sharedFolder.shouldConnect&&this.sharedFolder.connect().then(t=>(this.connected=!0,this.connected))}async rename(t){this.move(t)}async delete(){return this.vault.delete(this.tfolder)}cleanup(){}destroy(){var t;(t=this.offFolderStatusListener)==null||t.call(this),this.offFolderStatusListener=null,this._parent=null,this.relayManager=null,this._tfolder=null}};var lo=bn(ua());var wl,RL=new Uint8Array(16);function bu(){if(!wl&&(wl=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!wl))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return wl(RL)}var Ut=[];for(let o=0;o<256;++o)Ut.push((o+256).toString(16).slice(1));function yx(o,e=0){return Ut[o[e+0]]+Ut[o[e+1]]+Ut[o[e+2]]+Ut[o[e+3]]+"-"+Ut[o[e+4]]+Ut[o[e+5]]+"-"+Ut[o[e+6]]+Ut[o[e+7]]+"-"+Ut[o[e+8]]+Ut[o[e+9]]+"-"+Ut[o[e+10]]+Ut[o[e+11]]+Ut[o[e+12]]+Ut[o[e+13]]+Ut[o[e+14]]+Ut[o[e+15]]}var OL=typeof crypto!="undefined"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),wu={randomUUID:OL};function UL(o,e,t){if(wu.randomUUID&&!e&&!o)return wu.randomUUID();o=o||{};let r=o.random||(o.rng||bu)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(let n=0;n<16;++n)e[t+n]=r[n];return e}return yx(r)}var Ms=UL;function _u(o){return(o==null?void 0:o.type)==="markdown"}function bx(o){return(o==null?void 0:o.type)==="folder"}function Ba(o){return{version:0,id:o,type:"markdown"}}function _l(o){return{version:0,id:o,type:"folder"}}var vu=class{constructor(e){this.protocols=new Map;e=e||vu.defaults,e.forEach(([t,r])=>this.protocols.set(t,r))}setEnabled(e,t){let r=this.protocols.get(e);r&&(r.enabled=t)}canSync(e,t){var s;if(t){let a=this.protocols.get(t.type);return a?a.enabled&&t.version<=a.maxVersion:!1}if(!((s=e.split("/").pop())==null?void 0:s.includes(".")))return!0;let n=Ua(e);for(let[,a]of this.protocols)if(a.mimetypes.includes(n))return a.enabled;return!1}getTypeForPath(e){let t=Ua(e);for(let[r,n]of this.protocols)if(n.mimetypes.includes(t))return r;return null}},$a=vu;$a.defaults=[["folder",{maxVersion:0,mimetypes:[],enabled:!0}],["markdown",{maxVersion:0,mimetypes:["text/markdown"],enabled:!0}]];var vl=class extends St{constructor(t,r,n){super();this.ydoc=t;this.namespace=r;this.pendingUpload=n;this.legacyIds=this.ydoc.getMap("docs"),this.meta=this.ydoc.getMap("filemeta_v0"),this.overlay=new Map,this.renames=new Map,this.deleteSet=new Set,this.typeRegistry=new $a}assertVPath(t){if(t.startsWith(this.namespace+lo.sep))throw new Error("Expected virtual path"+t)}print(){this.log("files",Array.from(this.meta.entries()).map(([t,r])=>({path:t,...r}))),this.log("pending...",Array.from(this.pendingUpload.entries()).map(([t,r])=>({path:t,guid:r})))}canSync(t){let r=this.getMeta(t);return this.typeRegistry.canSync(t,r)}resolveMove(t){this.log("resolving alias",t),this.renames.delete(t)}resolveAll(){this.renames.clear()}move(t,r){this.log("moving file",t,"to",r),this.assertVPath(t),this.assertVPath(r),this.renames.set(t,r);let n=this.pendingUpload.get(t);n&&(this.pendingUpload.set(r,n),this.pendingUpload.delete(t)),this.deleteSet.has(t)&&(this.deleteSet.add(r),this.deleteSet.delete(t));let s=this.overlay.get(t);s&&(this.overlay.set(r,s),this.overlay.delete(t));let a=this.meta.get(t);bx(a)?this.moveFolder(t,r):a&&(this.set(r,a),this.delete(t))}new(t){this.assertVPath(t);let r=Ms();return this.pendingUpload.set(t,r),r}forEach(t){this.meta.forEach((r,n)=>{this.deleteSet.has(n)||t(r,n)}),this.overlay.forEach((r,n)=>{this.deleteSet.has(n)||t(r,n)})}has(t){return this.renames.has(t)&&(t=this.renames.get(t)),this.deleteSet.has(t)?!1:this.meta.has(t)||this.legacyIds.has(t)||this.overlay.has(t)||this.pendingUpload.has(t)}set(t,r,n=!1){this.assertVPath(t),_u(r)&&this.legacyIds.get(t)!==r.id&&this.legacyIds.set(t,r.id);let s=this.meta.get(t);if(s&&s.id===r.id&&s.mimetype==r.mimetype&&s.type===r.type&&!(r!=null&&r.synctime)&&!(r!=null&&r.hash)){this.log("skipping metadata write",s,r);return}this.warn("metadata write (path, existing, meta)",t,s,r),n?this.ydoc.transact(()=>{this.meta.set(t,r)},this):this.meta.set(t,r)}processFolderOperation(t){let r=new Map,n=new Map;t.changes.keys.forEach((s,a)=>{if(s.action==="delete"){let i=s.oldValue;(i==null?void 0:i.type)==="folder"&&r.set(i.id,a)}else if(s.action==="add"||s.action==="update"){let i=this.meta.get(a);(i==null?void 0:i.type)==="folder"&&n.set(i.id,a)}}),r.forEach((s,a)=>{let i=n.get(a);if(i&&s!==i){this.log(`Detected folder move from ${s} to ${i}`);let l=new Map;this.meta.forEach((f,u)=>{u.startsWith(i+lo.sep)&&l.set(u,f)}),this.renames.set(s,i),this.log("setting alias",s,i),this.log("paths to move",l),l.forEach((f,u)=>{let d=u.slice(i.length),m=s+d;this.renames.set(m,u),this.log("setting alias",m,u)})}})}start(){io(Ar.enableDeltaLogging,()=>{let n=s=>{var i,l;let a="";a+=`Transaction origin: ${s.transaction.origin}${(l=(i=s.transaction.origin)==null?void 0:i.constructor)==null?void 0:l.name}
`,s.changes.keys.forEach((f,u)=>{f.action==="add"&&(a+=`Added ${u}: ${this.get(u)}
`),f.action==="update"&&(a+=`Updated ${u}: ${this.get(u)}
`),f.action==="delete"&&(a+=`Deleted ${u}
`)}),this.debug(a)};this.legacyIds.observe(n),this.meta.observe(n),this.unsubscribes.push(()=>{this.legacyIds.unobserve(n)}),this.unsubscribes.push(()=>{this.meta.unobserve(n)})});let t=async n=>{if(n.changes.keys.size===0){this.log("no changes detected");return}n.transaction.origin!=this&&(this.processFolderOperation(n),this.notifyListeners())},r=async n=>{this.migrateUp(),this.notifyListeners()};this.legacyIds.observe(r),this.meta.observe(t),this.unsubscribes.push(()=>{this.legacyIds.unobserve(r)}),this.unsubscribes.push(()=>{this.meta.unobserve(t)})}get(t){if(this.assertVPath(t),this.renames.has(t)&&(t=this.renames.get(t)),this.deleteSet.has(t))return;let r=this.pendingUpload.get(t);if(r)return r;let n=this.getMeta(t);if(n)return n.id}getMeta(t){if(this.assertVPath(t),this.renames.has(t)&&(t=this.renames.get(t)),this.deleteSet.has(t))return;let r=this.meta.get(t)||this.overlay.get(t),n=this.legacyIds.has(t);if(!r&&this.legacyIds.has(t)){let s=this.legacyIds.get(t),a=Ba(s);return this.overlay.set(t,a),a}if(r){if(_u(r)&&!n){this.deleteSet.add(t);return}return r}}delete(t){return this.assertVPath(t),this.legacyIds.delete(t),this.pendingUpload.delete(t),this.meta.delete(t)}get remoteIds(){let t=new Set;return this.forEach(r=>{t.add(r.id)}),t}commit(){this.overlay.size>0&&this.log("committing overlay",[...this.overlay.keys()]),this.overlay.forEach((t,r)=>{this.set(r,t),t.type==="markdown"&&this.legacyIds.get(r)!==t.id&&this.legacyIds.set(r,t.id)}),this.overlay=new Map,this.deleteSet.size>0&&this.log("committing deleteSet",[...this.deleteSet]),this.deleteSet.forEach(t=>this.delete(t)),this.deleteSet=new Set}detectFolderMoves(){let t=new Map,r=new Set;this.legacyIds.forEach((s,a)=>{let i;if(this.meta.forEach((l,f)=>{l.type==="markdown"&&l.id===s&&f!==a&&(i=f)}),i){let l=(0,lo.dirname)(i),f=(0,lo.dirname)(a);l!==f&&t.set(l,f)}}),Array.from(t.entries()).sort(([s],[a])=>a.length-s.length).forEach(([s,a])=>{r.has(s)||(this.moveFolder(s,a),r.add(s))})}moveFolder(t,r){this.log("moving folder",t,"to",r);let n=new Map;this.meta.forEach((a,i)=>{(i===t||i.startsWith(t+lo.sep))&&n.set(i,a)}),this.overlay.forEach((a,i)=>{(i===t||i.startsWith(t+lo.sep))&&n.set(i,a)});let s=this.meta.get(t);s&&(this.meta.set(r,s),this.meta.delete(t)),n.forEach((a,i)=>{if(i===t)return;let l=i.slice(t.length),f=r+l;this.move(i,f)})}markUploaded(t,r){if(!this.has(t))throw new Error(`unexpected vpath ${t} marked uploaded`);this.pendingUpload.has(t)&&(this.set(t,r),this.pendingUpload.delete(t))}migrateFile(t,r){var i;if(this.assertVPath(r),((i=this.meta.get(r))==null?void 0:i.id)===t)return;let n=new Set,s=r.split(lo.sep),a="";for(let l=0;l<s.length-1;l++)a=s.slice(0,l+1).join(lo.sep),n.add(a);this.meta.has(r)||this.overlay.has(r)||r.endsWith(".md")&&(this.warn(`migrated legacy key on ${r}`),this.overlay.set(r,Ba(t))),n.forEach(l=>{if(l&&!(this.meta.has(l)||this.overlay.has(l))){let f=Ms();console.log("creating folder path",l,f),this.overlay.set(l,_l(f))}})}migrateUp(){this.detectFolderMoves(),this.legacyIds.forEach((t,r)=>{this.migrateFile(t,r)})}destroy(){super.destroy(),this.overlay.clear(),this.deleteSet.clear(),this.renames.clear(),this.legacyIds=null,this.meta=null}};function wx(o,e,t=(r,n)=>r.substring(n.length).replace(/^\/+/,"")){return new Proxy(o,{get(r,n){let s=r[n];return typeof s=="function"?function(...a){return a.length>0&&typeof a[0]=="string"&&(a[0]=t(a[0],e)),s.apply(r,a)}:s}})}var Su=class extends an{constructor(){super(...arguments);this.notifyListeners=(0,pt.debounce)(super.notifyListeners,100)}update(){this.notifyListeners()}add(t,r=!0){let n=this.find(s=>s.guid===t.guid);return n&&n!==t&&(this.error("duplicate guid",n,t),this._set.delete(n)),this._set.add(t),r&&this.notifyListeners(),this}},Sl=class extends As{constructor(t,r,n,s,a,i,l,f,u,d,m,x=!0){var _;let h=m?new Eo(m,r):new on(r);super(r,h,l,s);this.appId=t;this.backgroundSync=u;this._settings=d;this.destroyed=!1;this.readyPromise=null;this.whenSyncedPromise=null;this.persistenceSynced=!1;this.syncFileTreePromise=null;this.syncRequestedDuringSync=!1;this.unsubscribes=[];this.addLocalDocs=()=>{let t=this.getSyncFiles(),r=[],n=this.placeHold(t);t.forEach(s=>{let a=this.getVirtualPath(s.path),i=n.contains(a);if(gr.checkPath(a)){let l=this.getSyncFolder(a,!1);r.push(l)}if(wt.checkExtension(a))if(i){let l=this.uploadDoc(a,!1);r.push(l)}else{let l=this.getDoc(a,!1);r.push(l)}}),r.length>0&&this.fset.update()};this.path=n,this.setLoggers(`[SharedFile](${this.path})`),this.fileManager=i,this.vault=a,this.files=new Map,this.fset=new Su,this.pendingUpload=new Ro(`${t}-system3-relay/folders/${this.guid}/pendingUploads`),this.relayManager=f,this.relayId=m,this.diskBufferStore=new yl,this._shouldConnect=(_=this.settings.connect)!=null?_:!0,this.authoritative=!x,this.unsubscribes.push(this.relayManager.remoteFolders.subscribe(w=>{this.remote=w.find(v=>v.guid==this.guid)})),this.proxy=wx(this,this.path,w=>this.getVirtualPath(w));try{this._persistence=new Ss(this.guid,this.ydoc)}catch(w){throw this.warn("Unable to open persistence.",this.guid),console.error(w),w}s.loggedIn&&this.connect(),this.syncStore=new vl(this.ydoc,this.path,this.pendingUpload),this.syncStore.on(async()=>{await this.syncFileTree(this.syncStore)}),this.whenReady().then(()=>{this.destroyed||(this.addLocalDocs(),this.syncFileTree(this.syncStore))}),this.whenSynced().then(async()=>{this.syncStore.start();try{this._persistence.set("path",this.path),this._persistence.set("relay",this.relayId||""),this._persistence.set("appId",this.appId),this._persistence.set("s3rn",Xt.encode(this.s3rn))}catch(w){}}),(async()=>await this.getServerSynced()||(await this.onceProviderSynced(),await this.markSynced()))(),Dt.set(this,this.path)}get tfolder(){let t=this.vault.getAbstractFileByPath(this.path);if(!(t instanceof pt.TFolder))throw new Error("tfolder is not a folder");return t}isSyncableTFile(t){let r=this.checkPath(t.path);if(t instanceof pt.TFolder&&!gr.checkPath)throw new Error("logical error");let n=this.getVirtualPath(t.path),s=this.syncStore.canSync(n);return r&&s}getSyncFiles(){let t=this.vault.getAbstractFileByPath(this.path);if(!(t instanceof pt.TFolder))throw new Error(`Could not find shared folders on file system at ${this.path}`);let r=[];return pt.Vault.recurseChildren(t,n=>{n!==t&&r.push(n)}),r.filter(n=>this.isSyncableTFile(n))}get shouldConnect(){return this._shouldConnect}set shouldConnect(t){this._settings.update(r=>({...r,connect:t})),this._shouldConnect=t}async netSync(){await this.whenReady(),this.addLocalDocs(),await this.syncFileTree(this.syncStore),this.backgroundSync.enqueueSharedFolderSync(this)}get settings(){return this._settings.get()}async sync(){await this.syncFileTree(this.syncStore)}connect(){return this.s3rn instanceof Eo&&(this.connected||this.shouldConnect)?super.connect():Promise.resolve(!1)}get name(){return this.path.split("/").pop()||""}get location(){return this.path.split("/").slice(0,-1).join("/")}get remote(){var t;try{(t=this._remote)==null||t.relay}catch(r){return}return this._remote}set remote(t){var r;this._remote!==t&&(this._remote=t,this.relayId=(r=t==null?void 0:t.relay)==null?void 0:r.guid,this.s3rn=this.relayId?new Eo(this.relayId,this.guid):new on(this.guid),this._settings.update(n=>({...n,relay:this.relayId})),this.notifyListeners())}get ready(){return this.persistenceSynced&&(this.authoritative||this._serverSynced||this.synced)}async count(){if(this._persistence.db===null)throw new Error("unexpected missing database");if(this._dbsize)return this._dbsize;if(this._persistence._dbsize>3)return this._dbsize=this._persistence._dbsize,this._dbsize;let[t]=so(this._persistence.db,["updates"],"readonly"),r=await En(t);return this._dbsize=r,this._dbsize}async markSynced(){this._serverSynced=!0,await this._persistence.set("serverSync",1)}async getServerSynced(){return this._serverSynced!==void 0?this._serverSynced:await this._persistence.get("serverSync")===1?(this._serverSynced=!0,this._serverSynced):!1}hasLocalDB(){return this._persistence._dbsize>3||!!(this._dbsize&&this._dbsize>3)}async awaitingUpdates(){return await this.whenSynced(),this.authoritative||await this.getServerSynced()?!1:!this.hasLocalDB()}whenReady(){let t=async()=>await this.awaitingUpdates()?(this.connect(),await this.onceConnected(),await this.onceProviderSynced(),this):this;return this.readyPromise=this.readyPromise||new sn(t,()=>[this.ready,this]),this.readyPromise.getPromise()}whenSynced(){let t=async()=>{if(this._persistence.synced){await this.count(),this.persistenceSynced=!0;return}return new Promise(r=>{this._persistence.once("synced",async()=>{await this.count(),this.persistenceSynced=!0,r()})})};return this.whenSyncedPromise=this.whenSyncedPromise||new sn(t,()=>(this._persistence.synced&&this._dbsize&&(this.persistenceSynced=!0),[this.persistenceSynced,void 0])),this.whenSyncedPromise.getPromise()}get intent(){return this.shouldConnect?"connected":"disconnected"}async _handleServerRename(t,r,n,s){if(s==null||s.push(`${n.path} was renamed to ${this.getPath(r)}`),n instanceof pt.TFile){let a=(0,xr.dirname)(r);this.existsSync(a)||(await this.mkdir(a),s==null||s.push(`creating directory ${a}`))}await this.fileManager.renameFile(n,(0,pt.normalizePath)(this.getPath(r))).then(()=>{t.move(r)})}async _handleServerCreate(t,r){let n=(0,xr.dirname)(t);if(this.existsSync(n)||(await this.mkdir(n),r==null||r.push(`creating directory ${n}`)),wt.checkExtension(t))return r==null||r.push(`created local file for remotely added doc ${t}`),await this.downloadDoc(t,!1);if(gr.checkPath(t))return this.getSyncFolder(t,!1);throw new Error("unexpected file")}_assertNamespacing(t){try{this.assertPath(this.path+t)}catch(r){this.error("Deleting doc (somehow moved outside of shared folder)",t),this.syncStore.delete(t);return}}applyRemoteState(t,r,n,s){let a=this.files.get(t);if(!this.syncStore.getMeta(r))return this.warn("unknown sync type",r),{op:"noop",path:r,promise:Promise.resolve()};if(this.existsSync(r))return{op:"noop",path:r,promise:Promise.resolve()};if(n.has(t)&&a){let f=this.getPath(a.path),u=this.vault.getAbstractFileByPath(f);if(u){let d=this._handleServerRename(a,r,u,s);return{op:"rename",path:r,from:f,to:r,promise:d}}}let l=this._handleServerCreate(r,s);return{op:"create",path:r,promise:l}}cleanupExtraLocalFiles(t,r){let n=this.getSyncFiles(),s=[],a=n.filter(f=>f instanceof pt.TFolder),i=n.filter(f=>f instanceof pt.TFile),l=f=>{var w,v;let u=this.isSyncableTFile(f),d=this.checkPath(f.path),m=t.contains(f.path.slice(this.path.length)),x=this.pendingUpload.has(this.getVirtualPath(f.path)),h=this.getVirtualPath(f.path),_=((w=this._provider)==null?void 0:w.synced)&&((v=this._persistence)==null?void 0:v.synced);if(d&&u&&!m&&!x&&_){r.push(`deleted local file ${h} for remotely deleted doc`);let A=this.vault.adapter.trashLocal(f.path);s.push({op:"delete",path:h,promise:A})}};return i.forEach(l),a.forEach(l),s}syncByType(t,r,n,s){t.forEach((a,i)=>{this._assertNamespacing(i),s.contains(a.type)&&(this._assertNamespacing(i),n.push(this.applyRemoteState(a.id,i,t.remoteIds,r)))})}syncFileTree(t){if(this.syncFileTreePromise){this.syncRequestedDuringSync=!0;let n=this.syncFileTreePromise.getPromise();return n.then(()=>{if(this.syncRequestedDuringSync)return this.syncRequestedDuringSync=!1,this.syncFileTree(t)}),n}let r=async()=>{try{let n=[],s=[];this.ydoc.transact(async()=>{this.syncStore.migrateUp(),this.syncByType(t,s,n,["folder"])},this),await Promise.all(n.map(u=>u.promise)),this.ydoc.transact(async()=>{this.syncByType(t,s,n,["markdown"]),this.syncStore.commit()},this);let a=n.filter(u=>u.op==="create"),i=n.filter(u=>u.op==="rename"),l=n.map(u=>u.path);await Promise.all([...a,...i].map(u=>gu(u.promise,u)));let f=this.cleanupExtraLocalFiles(l,s);[...n,...f].every(u=>u.op==="noop")?this.debug("sync: noop"):(this.log("remote paths",l),this.log("operations",[...n,...f])),(i.length>0||a.length>0||f.length>0)&&this.fset.update(),s.length>0&&this.log(`syncFileTree diff:
`+s.join(`
`))}finally{this.syncFileTreePromise=null}};return this.syncFileTreePromise=new bl(r),this.syncFileTreePromise.getPromise()}move(t){this.path=t,this.setLoggers(`[SharedFile](${this.path})`),this._settings.update(r=>({...r,path:t}))}read(t){let r=(0,xr.join)(this.path,t.path);return this.vault.adapter.read((0,pt.normalizePath)(r))}existsSync(t){let r=(0,pt.normalizePath)((0,xr.join)(this.path,t));return this.vault.getAbstractFileByPath(r)!==null}exists(t){let r=(0,xr.join)(this.path,t.path);return this.vault.adapter.exists((0,pt.normalizePath)(r))}flush(t,r){let n=(0,xr.join)(this.path,t.path);return this.log("writing to ",(0,pt.normalizePath)(n)),this.vault.adapter.write((0,pt.normalizePath)(n),r)}getPath(t){return(0,xr.join)(this.path,t)}assertPath(t){if(!this.checkPath(t))throw new Error("Path is not in shared folder: "+t)}mkdir(t){let r=(0,xr.join)(this.path,t);return this.vault.adapter.mkdir((0,pt.normalizePath)(r))}checkPath(t){return t.startsWith(this.path+xr.sep)}getVirtualPath(t){return this.assertPath(t),t.slice(this.path.length)}getTFile(t){let r=this.vault.getAbstractFileByPath(this.getPath(t.path));return r instanceof pt.TFile?r:null}getDoc(t,r=!0){let n=this.syncStore.get(t);if(n!==void 0){let s=this.files.get(n);if(s!==void 0){if(s.move(t),!Fo(s))throw new Error("unexpected ifile type");return s}else return this.log("[getDoc]: creating doc for shared ID"),this.createDoc(t,r)}else{this.warn("[getDoc]: creating new shared ID for existing tfile");let s=this.vault.getAbstractFileByPath(this.getPath(t));if(!(s instanceof pt.TFile))throw new Error("unexpectedly missing tfile or got tfolder");return this.placeHold([s]).length>0?this.uploadDoc(t):this.createDoc(t,r)}}markUploaded(t){if(Fo(t)){let r=Ba(t.guid);this.ydoc.transact(()=>{this.syncStore.markUploaded(t.path,r)},this);return}if(yu(t)){let r=_l(t.guid);this.ydoc.transact(()=>{this.syncStore.markUploaded(t.path,r)},this);return}}getFile(t,r=!0){let n=this.syncStore.get(t);if(n){let s=this.files.get(n);if(s)return s}if(wt.checkExtension(t))return this.getDoc(t);if(gr.checkPath(t))return this.getSyncFolder(t,r);throw new Error("unexpectedly missing file")}placeHold(t){let r=[];return this.ydoc.transact(()=>{t.forEach(n=>{let s=this.getVirtualPath(n.path);this.syncStore.has(s)||(this.syncStore.new(s),r.push(s))})},this),r}viewDoc(t){let r=this.syncStore.get(t);if(!r)return;let n=this.files.get(r);if(!Fo(n))throw new Error("unexpected ifile type");return n}getOrCreateDoc(t,r){let n=this.files.get(t)||new wt(r,t,this.loginManager,this);if(!Fo(n))throw new Error("unexpected ifile type");return n.move(r),n}async downloadDoc(t,r=!0){if(!wt.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error(`called download on item that is not in ids ${t}`);let s=this.getOrCreateDoc(n,t);return s.markOrigin("remote"),gu(this.backgroundSync.enqueueDownload(s),s.path),this.files.set(n,s),this.fset.add(s,r),s}uploadDoc(t,r=!0){if(!wt.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error("missing guid");let s=this.getOrCreateDoc(n,t),a=s.getOrigin(),i=this.awaitingUpdates();return(async()=>{if(!await this.exists(s))throw new Error(`Upload failed, doc does not exist at ${t}`);let[f,u,d]=await Promise.all([this.read(s),a,i]),m=s.ydoc.getText("contents");!d&&u===void 0&&(this.log(`[${s.path}] No Known Peers: Syncing file into ytext.`),this.ydoc.transact(()=>{m.insert(0,f)},this._persistence),s.markOrigin("local"),this.log(`[${s.path}] Uploading file`),await this.backgroundSync.enqueueSync(s),this.markUploaded(s))})(),this.files.set(n,s),this.fset.add(s,r),s}createDoc(t,r=!0){if(!wt.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error("expected guid");let s=this.getOrCreateDoc(n,t);return(async()=>this.whenReady().then(async()=>{var i;let a=await s.getServerSynced();((i=s.tfile)==null?void 0:i.stat.size)===0&&!a?this.backgroundSync.enqueueDownload(s):this.pendingUpload.get(s.path)&&this.backgroundSync.enqueueSync(s)}))(),this.files.set(n,s),this.fset.add(s,r),s}getOrCreateSyncFolder(t,r){let n=this.files.get(t)||new gr(r,t,this.relayManager,this);if(!yu(n))throw new Error("unexpected ifile type");return n.move(r),n}getSyncFolder(t,r){if(this.log("[getSyncFolder]","getting syncfolder"),!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let n=this.syncStore.get(t);if(!n)throw new Error("expected guid");let s=this.getOrCreateSyncFolder(n,t);return this.files.set(n,s),this.fset.add(s,r),s}uploadFile(t,r=!0){if(wt.checkExtension(t))return this.uploadDoc(t,r);if(gr.checkPath(t))return this.getSyncFolder(t,r);throw new Error("unexpectedly unable to upload")}deleteFile(t){let r=this.syncStore.get(t);r&&this.ydoc.transact(()=>{this.syncStore.delete(t);let n=this.files.get(r);n&&(n.cleanup(),this.fset.delete(n)),this.files.delete(r)},this)}renameFile(t,r){let n=t.path,s="",a="";try{s=this.getVirtualPath(n)}catch(i){this.log("Moving out of shared folder")}try{a=this.getVirtualPath(r)}catch(i){this.log("Moving in from outside of shared folder")}if(!(!s&&!a))if(a){let i=this.syncStore.get(a);if(!i)return;let l=this.files.get(i);if(!s)this.ydoc.transact(()=>{this.syncStore.delete(a)},this),l&&(l.cleanup(),l.destroy(),this.fset.delete(l)),this.files.delete(i);else{if(!this.syncStore.get(a))return;let u=[];l instanceof gr&&this.syncStore.forEach((d,m)=>{if(m.startsWith(a+xr.sep)){let x=m.replace(a,s);u.push([d.id,m,x])}}),this.ydoc.transact(()=>{this.syncStore.move(a,s),l&&l.move(s),u.forEach(d=>{let[m,x,h]=d;this.syncStore.move(x,h);let _=this.files.get(m);_&&_.move(h)})},this),this.syncStore.resolveMove(a)}}else{if(this.assertPath(n),!this.syncStore.canSync(s))return;this.placeHold([t]),this.uploadFile(s)}}destroy(){var t,r,n;this.destroyed=!0,this.unsubscribes.forEach(s=>{s()}),this.files.forEach(s=>{s.destroy(),this.files.delete(s.guid)}),this.syncStore.destroy(),super.destroy(),this.ydoc.destroy(),this.fset.clear(),this._settings.destroy(),this._settings=null,this.diskBufferStore=null,this.relayManager=null,this.backgroundSync=null,this.loginManager=null,this.tokenStore=null,this.fileManager=null,this.syncStore=null,(t=this.whenSyncedPromise)==null||t.destroy(),this.whenSyncedPromise=null,(r=this.readyPromise)==null||r.destroy(),this.readyPromise=null,(n=this.syncFileTreePromise)==null||n.destroy(),this.syncFileTreePromise=null}},kl=class extends an{constructor(t,r,n,s){super();this.relayManager=t;this.vault=r;this.settings=s;this.update=(0,pt.debounce)(this.notifyListeners,100);this.folderBuilder=n,this._offRemoteUpdates||(this._offRemoteUpdates=this.relayManager.remoteFolders.subscribe(a=>{let i=!1;this.items().forEach(l=>{let f=a.find(u=>u.guid==l.guid);l.remote!=f&&(i=!0),l.remote=f}),i&&this.update()}))}delete(t){t==null||t.destroy();let r=super.delete(t);return this.settings.update(n=>n.filter(s=>s.guid!==t.guid)),r}lookup(t){let r=this.find(n=>n.checkPath(t));return r||null}destroy(){this.items().forEach(t=>{t.destroy()}),this.clear(),this._offRemoteUpdates&&this._offRemoteUpdates(),this.unsubscribes.forEach(t=>{t()}),this.relayManager=null,this.folderBuilder=null}load(){this._load(this.settings.get())}_load(t){let r=!1;t.forEach(n=>{if(!this.vault.getFolderByPath(n.path)){this.warn(`Invalid settings, ${n.path} does not exist`);return}this._new(n.path,n.guid,n==null?void 0:n.relay),r=!0}),r&&this.notifyListeners()}_new(t,r,n,s){let a=this.find(u=>u.path==t&&u.guid==r);if(a)return a;let i=this.find(u=>u.guid==r);if(i)throw new Error(`This folder is already mounted at ${i.path}.`);if(this.find(u=>u.path==t))throw new Error("Conflict: Tracked folder exists at this location.");let f=this.folderBuilder(t,r,n,s);return this._set.add(f),f}new(t,r,n,s){let a=this._new(t,r,n,s);return this.notifyListeners(),a}};var Nl=require("@codemirror/state"),Ws=require("obsidian");function X(){}function le(o,e){for(let t in e)o[t]=e[t];return o}function _x(o){return!!o&&(typeof o=="object"||typeof o=="function")&&typeof o.then=="function"}function ku(o){return o()}function Ll(){return Object.create(null)}function ke(o){o.forEach(ku)}function ft(o){return typeof o=="function"}function Q(o,e){return o!=o?e==e:o!==e||o&&typeof o=="object"||typeof o=="function"}var Il;function Iu(o,e){return o===e?!0:(Il||(Il=document.createElement("a")),Il.href=e,o===Il.href)}function vx(o){return Object.keys(o).length===0}function Qt(o,...e){if(o==null){for(let r of e)r(void 0);return X}let t=o.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function me(o,e,t){o.$$.on_destroy.push(Qt(e,t))}function he(o,e,t,r){if(o){let n=Sx(o,e,t,r);return o[0](n)}}function Sx(o,e,t,r){return o[1]&&r?le(t.ctx.slice(),o[1](r(e))):t.ctx}function ge(o,e,t,r){if(o[2]&&r){let n=o[2](r(t));if(e.dirty===void 0)return n;if(typeof n=="object"){let s=[],a=Math.max(e.dirty.length,n.length);for(let i=0;i<a;i+=1)s[i]=e.dirty[i]|n[i];return s}return e.dirty|n}return e.dirty}function xe(o,e,t,r,n,s){if(n){let a=Sx(e,t,r,s);o.p(a,n)}}function ye(o){if(o.ctx.length>32){let e=[],t=o.ctx.length/32;for(let r=0;r<t;r++)e[r]=-1;return e}return-1}function ve(o){let e={};for(let t in o)t[0]!=="$"&&(e[t]=o[t]);return e}function Lu(o,e){let t={};e=new Set(e);for(let r in o)!e.has(r)&&r[0]!=="$"&&(t[r]=o[r]);return t}function Es(o){return o==null?"":o}function kx(o,e,t){return o.set(t),e}function Ix(o){return o&&ft(o.destroy)?o.destroy:X}var On=typeof window!="undefined"?window:typeof globalThis!="undefined"?globalThis:global;var Fs=class{constructor(e){dt(this,"_listeners","WeakMap"in On?new WeakMap:void 0);dt(this,"_observer");dt(this,"options");this.options=e}observe(e,t){return this._listeners.set(e,t),this._getObserver().observe(e,this.options),()=>{this._listeners.delete(e),this._observer.unobserve(e)}}_getObserver(){var e;return(e=this._observer)!=null?e:this._observer=new ResizeObserver(t=>{var r;for(let n of t)Fs.entries.set(n.target,n),(r=this._listeners.get(n.target))==null||r(n)})}};Fs.entries="WeakMap"in On?new WeakMap:void 0;var Lx=!1;function Cx(){Lx=!0}function Tx(){Lx=!1}function k(o,e){o.appendChild(e)}function Pe(o,e,t){let r=Px(o);if(!r.getElementById(e)){let n=P("style");n.id=e,n.textContent=t,HL(r,n)}}function Px(o){if(!o)return document;let e=o.getRootNode?o.getRootNode():o.ownerDocument;return e&&e.host?e:o.ownerDocument}function HL(o,e){return k(o.head||o,e),e.sheet}function T(o,e,t){o.insertBefore(e,t||null)}function C(o){o.parentNode&&o.parentNode.removeChild(o)}function it(o,e){for(let t=0;t<o.length;t+=1)o[t]&&o[t].d(e)}function P(o){return document.createElement(o)}function zr(o){return document.createElementNS("http://www.w3.org/2000/svg",o)}function K(o){return document.createTextNode(o)}function B(){return K(" ")}function Le(){return K("")}function re(o,e,t,r){return o.addEventListener(e,t,r),()=>o.removeEventListener(e,t,r)}function Dx(o){return function(e){return e.stopPropagation(),o.call(this,e)}}function b(o,e,t){t==null?o.removeAttribute(e):o.getAttribute(e)!==t&&o.setAttribute(e,t)}function Na(o,e){for(let t in e)b(o,t,e[t])}function Ax(o){return Array.from(o.childNodes)}function se(o,e){e=""+e,o.data!==e&&(o.data=e)}function Zt(o,e){o.value=e==null?"":e}function ue(o,e,t,r){t==null?o.style.removeProperty(e):o.style.setProperty(e,t,r?"important":"")}function ze(o,e,t){o.classList.toggle(e,!!t)}function Cl(o,e,{bubbles:t=!1,cancelable:r=!1}={}){return new CustomEvent(o,{detail:e,bubbles:t,cancelable:r})}var Rs=class{constructor(e=!1){dt(this,"is_svg",!1);dt(this,"e");dt(this,"n");dt(this,"t");dt(this,"a");this.is_svg=e,this.e=this.n=null}c(e){this.h(e)}m(e,t,r=null){this.e||(this.is_svg?this.e=zr(t.nodeName):this.e=P(t.nodeType===11?"TEMPLATE":t.nodeName),this.t=t.tagName!=="TEMPLATE"?t:t.content,this.c(e)),this.i(r)}h(e){this.e.innerHTML=e,this.n=Array.from(this.e.nodeName==="TEMPLATE"?this.e.content.childNodes:this.e.childNodes)}i(e){for(let t=0;t<this.n.length;t+=1)T(this.t,this.n[t],e)}p(e){this.d(),this.h(e),this.i(this.a)}d(){this.n.forEach(C)}};function Mx(o){let e={};return o.childNodes.forEach(t=>{e[t.slot||"default"]=!0}),e}function Os(o,e){return new o(e)}var ln;function yr(o){ln=o}function Ha(){if(!ln)throw new Error("Function called outside component initialization");return ln}function er(o){Ha().$$.on_mount.push(o)}function Cu(o){Ha().$$.on_destroy.push(o)}function $t(){let o=Ha();return(e,t,{cancelable:r=!1}={})=>{let n=o.$$.callbacks[e];if(n){let s=Cl(e,t,{cancelable:r});return n.slice().forEach(a=>{a.call(o,s)}),!s.defaultPrevented}return!0}}function Kr(o,e){let t=o.$$.callbacks[e.type];t&&t.slice().forEach(r=>r.call(this,e))}var Un=[];var Er=[],$s=[],Ex=[],GL=Promise.resolve(),Pu=!1;function Fx(){Pu||(Pu=!0,GL.then(qa))}function Va(o){$s.push(o)}var Tu=new Set,Us=0;function qa(){if(Us!==0)return;let o=ln;do{try{for(;Us<Un.length;){let e=Un[Us];Us++,yr(e),jL(e.$$)}}catch(e){throw Un.length=0,Us=0,e}for(yr(null),Un.length=0,Us=0;Er.length;)Er.pop()();for(let e=0;e<$s.length;e+=1){let t=$s[e];Tu.has(t)||(Tu.add(t),t())}$s.length=0}while(Un.length);for(;Ex.length;)Ex.pop()();Pu=!1,Tu.clear(),yr(o)}function jL(o){if(o.fragment!==null){o.update(),ke(o.before_update);let e=o.dirty;o.dirty=[-1],o.fragment&&o.fragment.p(o.ctx,e),o.after_update.forEach(Va)}}function Rx(o){let e=[],t=[];$s.forEach(r=>o.indexOf(r)===-1?e.push(r):t.push(r)),t.forEach(r=>r()),$s=e}var Tl=new Set,$n;function be(){$n={r:0,c:[],p:$n}}function we(){$n.r||ke($n.c),$n=$n.p}function L(o,e){o&&o.i&&(Tl.delete(o),o.i(e))}function D(o,e,t,r){if(o&&o.o){if(Tl.has(o))return;Tl.add(o),$n.c.push(()=>{Tl.delete(o),r&&(t&&o.d(1),r())}),o.o(e)}else r&&r()}function Bs(o,e){let t=e.token={};function r(n,s,a,i){if(e.token!==t)return;e.resolved=i;let l=e.ctx;a!==void 0&&(l=l.slice(),l[a]=i);let f=n&&(e.current=n)(l),u=!1;e.block&&(e.blocks?e.blocks.forEach((d,m)=>{m!==s&&d&&(be(),D(d,1,1,()=>{e.blocks[m]===d&&(e.blocks[m]=null)}),we())}):e.block.d(1),f.c(),L(f,1),f.m(e.mount(),e.anchor),u=!0),e.block=f,e.blocks&&(e.blocks[s]=f),u&&qa()}if(_x(o)){let n=Ha();if(o.then(s=>{yr(n),r(e.then,1,e.value,s),yr(null)},s=>{if(yr(n),r(e.catch,2,e.error,s),yr(null),!e.hasCatch)throw s}),e.current!==e.pending)return r(e.pending,0),!0}else{if(e.current!==e.then)return r(e.then,1,e.value,o),!0;e.resolved=o}}function Pl(o,e,t){let r=e.slice(),{resolved:n}=o;o.current===o.then&&(r[o.value]=n),o.current===o.catch&&(r[o.error]=n),o.block.p(r,t)}function Fe(o){return(o==null?void 0:o.length)!==void 0?o:Array.from(o)}function Ox(o,e){D(o,1,1,()=>{e.delete(o.key)})}function Ux(o,e,t,r,n,s,a,i,l,f,u,d){let m=o.length,x=s.length,h=m,_={};for(;h--;)_[o[h].key]=h;let w=[],v=new Map,A=new Map,U=[];for(h=x;h--;){let E=d(n,s,h),M=t(E),R=a.get(M);R?r&&U.push(()=>R.p(E,e)):(R=f(M,E),R.c()),v.set(M,w[h]=R),M in _&&A.set(M,Math.abs(h-_[M]))}let I=new Set,F=new Set;function $(E){L(E,1),E.m(i,u),a.set(E.key,E),u=E.first,x--}for(;m&&x;){let E=w[x-1],M=o[m-1],R=E.key,q=M.key;E===M?(u=E.first,m--,x--):v.has(q)?!a.has(R)||I.has(R)?$(E):F.has(q)?m--:A.get(R)>A.get(q)?(F.add(R),$(E)):(I.add(q),m--):(l(M,a),m--)}for(;m--;){let E=o[m];v.has(E.key)||l(E,a)}for(;x;)$(w[x-1]);return ke(U),w}function Oe(o,e){let t={},r={},n={$$scope:1},s=o.length;for(;s--;){let a=o[s],i=e[s];if(i){for(let l in a)l in i||(r[l]=1);for(let l in i)n[l]||(t[l]=i[l],n[l]=1);o[s]=i}else for(let l in a)n[l]=1}for(let a in r)a in t||(t[a]=void 0);return t}function Ve(o){return typeof o=="object"&&o!==null?o:{}}var YL=["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"],JL=new Set([...YL]);function V(o){o&&o.c()}function N(o,e,t){let{fragment:r,after_update:n}=o.$$;r&&r.m(e,t),Va(()=>{let s=o.$$.on_mount.map(ku).filter(ft);o.$$.on_destroy?o.$$.on_destroy.push(...s):ke(s),o.$$.on_mount=[]}),n.forEach(Va)}function H(o,e){let t=o.$$;t.fragment!==null&&(Rx(t.after_update),ke(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function QL(o,e){o.$$.dirty[0]===-1&&(Un.push(o),Fx(),o.$$.dirty.fill(0)),o.$$.dirty[e/31|0]|=1<<e%31}function ee(o,e,t,r,n,s,a=null,i=[-1]){let l=ln;yr(o);let f=o.$$={fragment:null,ctx:[],props:s,update:X,not_equal:n,bound:Ll(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:Ll(),dirty:i,skip_bound:!1,root:e.target||l.$$.root};a&&a(f.root);let u=!1;if(f.ctx=t?t(o,e.props||{},(d,m,...x)=>{let h=x.length?x[0]:m;return f.ctx&&n(f.ctx[d],f.ctx[d]=h)&&(!f.skip_bound&&f.bound[d]&&f.bound[d](h),u&&QL(o,d)),m}):[],f.update(),u=!0,ke(f.before_update),f.fragment=r?r(f.ctx):!1,e.target){if(e.hydrate){Cx();let d=Ax(e.target);f.fragment&&f.fragment.l(d),d.forEach(C)}else f.fragment&&f.fragment.c();e.intro&&L(o.$$.fragment),N(o,e.target,e.anchor),Tx(),qa()}yr(l)}var ZL;typeof HTMLElement=="function"&&(ZL=class extends HTMLElement{constructor(e,t,r){super();dt(this,"$$ctor");dt(this,"$$s");dt(this,"$$c");dt(this,"$$cn",!1);dt(this,"$$d",{});dt(this,"$$r",!1);dt(this,"$$p_d",{});dt(this,"$$l",{});dt(this,"$$l_u",new Map);this.$$ctor=e,this.$$s=t,r&&this.attachShadow({mode:"open"})}addEventListener(e,t,r){if(this.$$l[e]=this.$$l[e]||[],this.$$l[e].push(t),this.$$c){let n=this.$$c.$on(e,t);this.$$l_u.set(t,n)}super.addEventListener(e,t,r)}removeEventListener(e,t,r){if(super.removeEventListener(e,t,r),this.$$c){let n=this.$$l_u.get(t);n&&(n(),this.$$l_u.delete(t))}}async connectedCallback(){if(this.$$cn=!0,!this.$$c){let e=function(s){return()=>{let a;return{c:function(){a=P("slot"),s!=="default"&&b(a,"name",s)},m:function(f,u){T(f,a,u)},d:function(f){f&&C(a)}}}};if(await Promise.resolve(),!this.$$cn||this.$$c)return;let t={},r=Mx(this);for(let s of this.$$s)s in r&&(t[s]=[e(s)]);for(let s of this.attributes){let a=this.$$g_p(s.name);a in this.$$d||(this.$$d[a]=Du(a,s.value,this.$$p_d,"toProp"))}for(let s in this.$$p_d)!(s in this.$$d)&&this[s]!==void 0&&(this.$$d[s]=this[s],delete this[s]);this.$$c=new this.$$ctor({target:this.shadowRoot||this,props:{...this.$$d,$$slots:t,$$scope:{ctx:[]}}});let n=()=>{this.$$r=!0;for(let s in this.$$p_d)if(this.$$d[s]=this.$$c.$$.ctx[this.$$c.$$.props[s]],this.$$p_d[s].reflect){let a=Du(s,this.$$d[s],this.$$p_d,"toAttribute");a==null?this.removeAttribute(this.$$p_d[s].attribute||s):this.setAttribute(this.$$p_d[s].attribute||s,a)}this.$$r=!1};this.$$c.$$.after_update.push(n),n();for(let s in this.$$l)for(let a of this.$$l[s]){let i=this.$$c.$on(s,a);this.$$l_u.set(a,i)}this.$$l={}}}attributeChangedCallback(e,t,r){var n;this.$$r||(e=this.$$g_p(e),this.$$d[e]=Du(e,r,this.$$p_d,"toProp"),(n=this.$$c)==null||n.$set({[e]:this.$$d[e]}))}disconnectedCallback(){this.$$cn=!1,Promise.resolve().then(()=>{!this.$$cn&&this.$$c&&(this.$$c.$destroy(),this.$$c=void 0)})}$$g_p(e){return Object.keys(this.$$p_d).find(t=>this.$$p_d[t].attribute===e||!this.$$p_d[t].attribute&&t.toLowerCase()===e)||e}});function Du(o,e,t,r){var s;let n=(s=t[o])==null?void 0:s.type;if(e=n==="Boolean"&&typeof e!="boolean"?e!=null:e,!r||!t[o])return e;if(r==="toAttribute")switch(n){case"Object":case"Array":return e==null?null:JSON.stringify(e);case"Boolean":return e?"":null;case"Number":return e==null?null:e;default:return e}else switch(n){case"Object":case"Array":return e&&JSON.parse(e);case"Boolean":return e;case"Number":return e!=null?+e:e;default:return e}}var Z=class{constructor(){dt(this,"$$");dt(this,"$$set")}$destroy(){H(this,1),this.$destroy=X}$on(e,t){if(!ft(t))return X;let r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(t),()=>{let n=r.indexOf(t);n!==-1&&r.splice(n,1)}}$set(e){this.$$set&&!vx(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}};var $x="4";typeof window!="undefined"&&(window.__svelte||(window.__svelte={v:new Set})).v.add($x);var eC={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"},Au=eC;function Bx(o,e,t){let r=o.slice();return r[11]=e[t][0],r[12]=e[t][1],r}function Mu(o){let e,t=[o[12]],r={};for(let n=0;n<t.length;n+=1)r=le(r,t[n]);return{c(){e=zr(o[11]),Na(e,r)},m(n,s){T(n,e,s)},p(n,s){Na(e,r=Oe(t,[s&32&&n[12]]))},d(n){n&&C(e)}}}function Nx(o){let e=o[11],t,r=o[11]&&Mu(o);return{c(){r&&r.c(),t=Le()},m(n,s){r&&r.m(n,s),T(n,t,s)},p(n,s){n[11]?e?Q(e,n[11])?(r.d(1),r=Mu(n),e=n[11],r.c(),r.m(t.parentNode,t)):r.p(n,s):(r=Mu(n),e=n[11],r.c(),r.m(t.parentNode,t)):e&&(r.d(1),r=null,e=n[11])},d(n){n&&C(t),r&&r.d(n)}}}function tC(o){let e,t,r,n,s,a=Fe(o[5]),i=[];for(let m=0;m<a.length;m+=1)i[m]=Nx(Bx(o,a,m));let l=o[10].default,f=he(l,o,o[9],null),u=[Au,o[7],{width:o[2]},{height:o[2]},{stroke:o[1]},{"stroke-width":r=o[4]?Number(o[3])*24/Number(o[2]):o[3]},{class:n=o[6]("lucide-icon","lucide",o[0]?`lucide-${o[0]}`:"",o[8].class)}],d={};for(let m=0;m<u.length;m+=1)d=le(d,u[m]);return{c(){e=zr("svg");for(let m=0;m<i.length;m+=1)i[m].c();t=Le(),f&&f.c(),Na(e,d)},m(m,x){T(m,e,x);for(let h=0;h<i.length;h+=1)i[h]&&i[h].m(e,null);k(e,t),f&&f.m(e,null),s=!0},p(m,[x]){if(x&32){a=Fe(m[5]);let h;for(h=0;h<a.length;h+=1){let _=Bx(m,a,h);i[h]?i[h].p(_,x):(i[h]=Nx(_),i[h].c(),i[h].m(e,t))}for(;h<i.length;h+=1)i[h].d(1);i.length=a.length}f&&f.p&&(!s||x&512)&&xe(f,l,m,m[9],s?ge(l,m[9],x,null):ye(m[9]),null),Na(e,d=Oe(u,[Au,x&128&&m[7],(!s||x&4)&&{width:m[2]},(!s||x&4)&&{height:m[2]},(!s||x&2)&&{stroke:m[1]},(!s||x&28&&r!==(r=m[4]?Number(m[3])*24/Number(m[2]):m[3]))&&{"stroke-width":r},(!s||x&257&&n!==(n=m[6]("lucide-icon","lucide",m[0]?`lucide-${m[0]}`:"",m[8].class)))&&{class:n}]))},i(m){s||(L(f,m),s=!0)},o(m){D(f,m),s=!1},d(m){m&&C(e),it(i,m),f&&f.d(m)}}}function rC(o,e,t){let r=["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode","mergeClasses"],n=Lu(e,r),{$$slots:s={},$$scope:a}=e,{name:i=void 0}=e,{color:l="currentColor"}=e,{size:f=24}=e,{strokeWidth:u=2}=e,{absoluteStrokeWidth:d=!1}=e,{iconNode:m}=e,x=(...h)=>h.filter((_,w,v)=>Boolean(_)&&v.indexOf(_)===w).join(" ");return o.$$set=h=>{t(8,e=le(le({},e),ve(h))),t(7,n=Lu(e,r)),"name"in h&&t(0,i=h.name),"color"in h&&t(1,l=h.color),"size"in h&&t(2,f=h.size),"strokeWidth"in h&&t(3,u=h.strokeWidth),"absoluteStrokeWidth"in h&&t(4,d=h.absoluteStrokeWidth),"iconNode"in h&&t(5,m=h.iconNode),"$$scope"in h&&t(9,a=h.$$scope)},e=ve(e),[i,l,f,u,d,m,x,n,e,a,s]}var Eu=class extends Z{constructor(e){super(),ee(this,e,rC,tC,Q,{name:0,color:1,size:2,strokeWidth:3,absoluteStrokeWidth:4,iconNode:5,mergeClasses:6})}get mergeClasses(){return this.$$.ctx[6]}},qe=Eu;function oC(o){let e,t=o[2].default,r=he(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&xe(r,t,n,n[3],e?ge(t,n[3],s,null):ye(n[3]),null)},i(n){e||(L(r,n),e=!0)},o(n){D(r,n),e=!1},d(n){r&&r.d(n)}}}function nC(o){let e,t,r=[{name:"arrow-right-left"},o[1],{iconNode:o[0]}],n={$$slots:{default:[oC]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=le(n,r[s]);return e=new qe({props:n}),{c(){V(e.$$.fragment)},m(s,a){N(e,s,a),t=!0},p(s,[a]){let i=a&3?Oe(r,[r[0],a&2&&Ve(s[1]),a&1&&{iconNode:s[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:s}),e.$set(i)},i(s){t||(L(e.$$.fragment,s),t=!0)},o(s){D(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function sC(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"m16 3 4 4-4 4"}],["path",{d:"M20 7H4"}],["path",{d:"m8 21-4-4 4-4"}],["path",{d:"M4 17h16"}]];return o.$$set=a=>{t(1,e=le(le({},e),ve(a))),"$$scope"in a&&t(3,n=a.$$scope)},e=ve(e),[s,e,r,n]}var Fu=class extends Z{constructor(e){super(),ee(this,e,sC,nC,Q,{})}},Ru=Fu;function aC(o){let e,t=o[2].default,r=he(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&xe(r,t,n,n[3],e?ge(t,n[3],s,null):ye(n[3]),null)},i(n){e||(L(r,n),e=!0)},o(n){D(r,n),e=!1},d(n){r&&r.d(n)}}}function iC(o){let e,t,r=[{name:"arrow-up-down"},o[1],{iconNode:o[0]}],n={$$slots:{default:[aC]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=le(n,r[s]);return e=new qe({props:n}),{c(){V(e.$$.fragment)},m(s,a){N(e,s,a),t=!0},p(s,[a]){let i=a&3?Oe(r,[r[0],a&2&&Ve(s[1]),a&1&&{iconNode:s[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:s}),e.$set(i)},i(s){t||(L(e.$$.fragment,s),t=!0)},o(s){D(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function lC(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"m21 16-4 4-4-4"}],["path",{d:"M17 20V4"}],["path",{d:"m3 8 4-4 4 4"}],["path",{d:"M7 4v16"}]];return o.$$set=a=>{t(1,e=le(le({},e),ve(a))),"$$scope"in a&&t(3,n=a.$$scope)},e=ve(e),[s,e,r,n]}var Ou=class extends Z{constructor(e){super(),ee(this,e,lC,iC,Q,{})}},Uu=Ou;function cC(o){let e,t=o[2].default,r=he(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&xe(r,t,n,n[3],e?ge(t,n[3],s,null):ye(n[3]),null)},i(n){e||(L(r,n),e=!0)},o(n){D(r,n),e=!1},d(n){r&&r.d(n)}}}function fC(o){let e,t,r=[{name:"chevron-left"},o[1],{iconNode:o[0]}],n={$$slots:{default:[cC]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=le(n,r[s]);return e=new qe({props:n}),{c(){V(e.$$.fragment)},m(s,a){N(e,s,a),t=!0},p(s,[a]){let i=a&3?Oe(r,[r[0],a&2&&Ve(s[1]),a&1&&{iconNode:s[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:s}),e.$set(i)},i(s){t||(L(e.$$.fragment,s),t=!0)},o(s){D(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function uC(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"m15 18-6-6 6-6"}]];return o.$$set=a=>{t(1,e=le(le({},e),ve(a))),"$$scope"in a&&t(3,n=a.$$scope)},e=ve(e),[s,e,r,n]}var $u=class extends Z{constructor(e){super(),ee(this,e,uC,fC,Q,{})}},Bu=$u;function dC(o){let e,t=o[2].default,r=he(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&xe(r,t,n,n[3],e?ge(t,n[3],s,null):ye(n[3]),null)},i(n){e||(L(r,n),e=!0)},o(n){D(r,n),e=!1},d(n){r&&r.d(n)}}}function pC(o){let e,t,r=[{name:"chevron-right"},o[1],{iconNode:o[0]}],n={$$slots:{default:[dC]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=le(n,r[s]);return e=new qe({props:n}),{c(){V(e.$$.fragment)},m(s,a){N(e,s,a),t=!0},p(s,[a]){let i=a&3?Oe(r,[r[0],a&2&&Ve(s[1]),a&1&&{iconNode:s[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:s}),e.$set(i)},i(s){t||(L(e.$$.fragment,s),t=!0)},o(s){D(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function mC(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"m9 18 6-6-6-6"}]];return o.$$set=a=>{t(1,e=le(le({},e),ve(a))),"$$scope"in a&&t(3,n=a.$$scope)},e=ve(e),[s,e,r,n]}var Nu=class extends Z{constructor(e){super(),ee(this,e,mC,pC,Q,{})}},Hu=Nu;function hC(o){let e,t=o[2].default,r=he(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&xe(r,t,n,n[3],e?ge(t,n[3],s,null):ye(n[3]),null)},i(n){e||(L(r,n),e=!0)},o(n){D(r,n),e=!1},d(n){r&&r.d(n)}}}function gC(o){let e,t,r=[{name:"circle-check-big"},o[1],{iconNode:o[0]}],n={$$slots:{default:[hC]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=le(n,r[s]);return e=new qe({props:n}),{c(){V(e.$$.fragment)},m(s,a){N(e,s,a),t=!0},p(s,[a]){let i=a&3?Oe(r,[r[0],a&2&&Ve(s[1]),a&1&&{iconNode:s[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:s}),e.$set(i)},i(s){t||(L(e.$$.fragment,s),t=!0)},o(s){D(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function xC(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}],["path",{d:"m9 11 3 3L22 4"}]];return o.$$set=a=>{t(1,e=le(le({},e),ve(a))),"$$scope"in a&&t(3,n=a.$$scope)},e=ve(e),[s,e,r,n]}var Vu=class extends Z{constructor(e){super(),ee(this,e,xC,gC,Q,{})}},qu=Vu;function yC(o){let e,t=o[2].default,r=he(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&xe(r,t,n,n[3],e?ge(t,n[3],s,null):ye(n[3]),null)},i(n){e||(L(r,n),e=!0)},o(n){D(r,n),e=!1},d(n){r&&r.d(n)}}}function bC(o){let e,t,r=[{name:"circle-help"},o[1],{iconNode:o[0]}],n={$$slots:{default:[yC]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=le(n,r[s]);return e=new qe({props:n}),{c(){V(e.$$.fragment)},m(s,a){N(e,s,a),t=!0},p(s,[a]){let i=a&3?Oe(r,[r[0],a&2&&Ve(s[1]),a&1&&{iconNode:s[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:s}),e.$set(i)},i(s){t||(L(e.$$.fragment,s),t=!0)},o(s){D(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function wC(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}],["path",{d:"M12 17h.01"}]];return o.$$set=a=>{t(1,e=le(le({},e),ve(a))),"$$scope"in a&&t(3,n=a.$$scope)},e=ve(e),[s,e,r,n]}var Wu=class extends Z{constructor(e){super(),ee(this,e,wC,bC,Q,{})}},Wa=Wu;function _C(o){let e,t=o[2].default,r=he(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&xe(r,t,n,n[3],e?ge(t,n[3],s,null):ye(n[3]),null)},i(n){e||(L(r,n),e=!0)},o(n){D(r,n),e=!1},d(n){r&&r.d(n)}}}function vC(o){let e,t,r=[{name:"clock"},o[1],{iconNode:o[0]}],n={$$slots:{default:[_C]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=le(n,r[s]);return e=new qe({props:n}),{c(){V(e.$$.fragment)},m(s,a){N(e,s,a),t=!0},p(s,[a]){let i=a&3?Oe(r,[r[0],a&2&&Ve(s[1]),a&1&&{iconNode:s[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:s}),e.$set(i)},i(s){t||(L(e.$$.fragment,s),t=!0)},o(s){D(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function SC(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["circle",{cx:"12",cy:"12",r:"10"}],["polyline",{points:"12 6 12 12 16 14"}]];return o.$$set=a=>{t(1,e=le(le({},e),ve(a))),"$$scope"in a&&t(3,n=a.$$scope)},e=ve(e),[s,e,r,n]}var zu=class extends Z{constructor(e){super(),ee(this,e,SC,vC,Q,{})}},za=zu;function kC(o){let e,t=o[2].default,r=he(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&xe(r,t,n,n[3],e?ge(t,n[3],s,null):ye(n[3]),null)},i(n){e||(L(r,n),e=!0)},o(n){D(r,n),e=!1},d(n){r&&r.d(n)}}}function IC(o){let e,t,r=[{name:"download"},o[1],{iconNode:o[0]}],n={$$slots:{default:[kC]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=le(n,r[s]);return e=new qe({props:n}),{c(){V(e.$$.fragment)},m(s,a){N(e,s,a),t=!0},p(s,[a]){let i=a&3?Oe(r,[r[0],a&2&&Ve(s[1]),a&1&&{iconNode:s[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:s}),e.$set(i)},i(s){t||(L(e.$$.fragment,s),t=!0)},o(s){D(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function LC(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}],["polyline",{points:"7 10 12 15 17 10"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3"}]];return o.$$set=a=>{t(1,e=le(le({},e),ve(a))),"$$scope"in a&&t(3,n=a.$$scope)},e=ve(e),[s,e,r,n]}var Ku=class extends Z{constructor(e){super(),ee(this,e,LC,IC,Q,{})}},Gu=Ku;function CC(o){let e,t=o[2].default,r=he(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&xe(r,t,n,n[3],e?ge(t,n[3],s,null):ye(n[3]),null)},i(n){e||(L(r,n),e=!0)},o(n){D(r,n),e=!1},d(n){r&&r.d(n)}}}function TC(o){let e,t,r=[{name:"folder"},o[1],{iconNode:o[0]}],n={$$slots:{default:[CC]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=le(n,r[s]);return e=new qe({props:n}),{c(){V(e.$$.fragment)},m(s,a){N(e,s,a),t=!0},p(s,[a]){let i=a&3?Oe(r,[r[0],a&2&&Ve(s[1]),a&1&&{iconNode:s[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:s}),e.$set(i)},i(s){t||(L(e.$$.fragment,s),t=!0)},o(s){D(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function PC(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"}]];return o.$$set=a=>{t(1,e=le(le({},e),ve(a))),"$$scope"in a&&t(3,n=a.$$scope)},e=ve(e),[s,e,r,n]}var ju=class extends Z{constructor(e){super(),ee(this,e,PC,TC,Q,{})}},Yu=ju;function DC(o){let e,t=o[2].default,r=he(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&xe(r,t,n,n[3],e?ge(t,n[3],s,null):ye(n[3]),null)},i(n){e||(L(r,n),e=!0)},o(n){D(r,n),e=!1},d(n){r&&r.d(n)}}}function AC(o){let e,t,r=[{name:"info"},o[1],{iconNode:o[0]}],n={$$slots:{default:[DC]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=le(n,r[s]);return e=new qe({props:n}),{c(){V(e.$$.fragment)},m(s,a){N(e,s,a),t=!0},p(s,[a]){let i=a&3?Oe(r,[r[0],a&2&&Ve(s[1]),a&1&&{iconNode:s[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:s}),e.$set(i)},i(s){t||(L(e.$$.fragment,s),t=!0)},o(s){D(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function MC(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M12 16v-4"}],["path",{d:"M12 8h.01"}]];return o.$$set=a=>{t(1,e=le(le({},e),ve(a))),"$$scope"in a&&t(3,n=a.$$scope)},e=ve(e),[s,e,r,n]}var Ju=class extends Z{constructor(e){super(),ee(this,e,MC,AC,Q,{})}},Xu=Ju;function EC(o){let e,t=o[2].default,r=he(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&xe(r,t,n,n[3],e?ge(t,n[3],s,null):ye(n[3]),null)},i(n){e||(L(r,n),e=!0)},o(n){D(r,n),e=!1},d(n){r&&r.d(n)}}}function FC(o){let e,t,r=[{name:"layers"},o[1],{iconNode:o[0]}],n={$$slots:{default:[EC]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=le(n,r[s]);return e=new qe({props:n}),{c(){V(e.$$.fragment)},m(s,a){N(e,s,a),t=!0},p(s,[a]){let i=a&3?Oe(r,[r[0],a&2&&Ve(s[1]),a&1&&{iconNode:s[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:s}),e.$set(i)},i(s){t||(L(e.$$.fragment,s),t=!0)},o(s){D(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function RC(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65"}]];return o.$$set=a=>{t(1,e=le(le({},e),ve(a))),"$$scope"in a&&t(3,n=a.$$scope)},e=ve(e),[s,e,r,n]}var Qu=class extends Z{constructor(e){super(),ee(this,e,RC,FC,Q,{})}},Oo=Qu;function OC(o){let e,t=o[2].default,r=he(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&xe(r,t,n,n[3],e?ge(t,n[3],s,null):ye(n[3]),null)},i(n){e||(L(r,n),e=!0)},o(n){D(r,n),e=!1},d(n){r&&r.d(n)}}}function UC(o){let e,t,r=[{name:"message-square-heart"},o[1],{iconNode:o[0]}],n={$$slots:{default:[OC]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=le(n,r[s]);return e=new qe({props:n}),{c(){V(e.$$.fragment)},m(s,a){N(e,s,a),t=!0},p(s,[a]){let i=a&3?Oe(r,[r[0],a&2&&Ve(s[1]),a&1&&{iconNode:s[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:s}),e.$set(i)},i(s){t||(L(e.$$.fragment,s),t=!0)},o(s){D(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function $C(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"}],["path",{d:"M14.8 7.5a1.84 1.84 0 0 0-2.6 0l-.2.3-.3-.3a1.84 1.84 0 1 0-2.4 2.8L12 13l2.7-2.7c.9-.9.8-2.1.1-2.8"}]];return o.$$set=a=>{t(1,e=le(le({},e),ve(a))),"$$scope"in a&&t(3,n=a.$$scope)},e=ve(e),[s,e,r,n]}var Zu=class extends Z{constructor(e){super(),ee(this,e,$C,UC,Q,{})}},ed=Zu;function BC(o){let e,t=o[2].default,r=he(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&xe(r,t,n,n[3],e?ge(t,n[3],s,null):ye(n[3]),null)},i(n){e||(L(r,n),e=!0)},o(n){D(r,n),e=!1},d(n){r&&r.d(n)}}}function NC(o){let e,t,r=[{name:"pause"},o[1],{iconNode:o[0]}],n={$$slots:{default:[BC]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=le(n,r[s]);return e=new qe({props:n}),{c(){V(e.$$.fragment)},m(s,a){N(e,s,a),t=!0},p(s,[a]){let i=a&3?Oe(r,[r[0],a&2&&Ve(s[1]),a&1&&{iconNode:s[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:s}),e.$set(i)},i(s){t||(L(e.$$.fragment,s),t=!0)},o(s){D(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function HC(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1"}]];return o.$$set=a=>{t(1,e=le(le({},e),ve(a))),"$$scope"in a&&t(3,n=a.$$scope)},e=ve(e),[s,e,r,n]}var td=class extends Z{constructor(e){super(),ee(this,e,HC,NC,Q,{})}},rd=td;function VC(o){let e,t=o[2].default,r=he(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&xe(r,t,n,n[3],e?ge(t,n[3],s,null):ye(n[3]),null)},i(n){e||(L(r,n),e=!0)},o(n){D(r,n),e=!1},d(n){r&&r.d(n)}}}function qC(o){let e,t,r=[{name:"play"},o[1],{iconNode:o[0]}],n={$$slots:{default:[VC]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=le(n,r[s]);return e=new qe({props:n}),{c(){V(e.$$.fragment)},m(s,a){N(e,s,a),t=!0},p(s,[a]){let i=a&3?Oe(r,[r[0],a&2&&Ve(s[1]),a&1&&{iconNode:s[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:s}),e.$set(i)},i(s){t||(L(e.$$.fragment,s),t=!0)},o(s){D(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function WC(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["polygon",{points:"6 3 20 12 6 21 6 3"}]];return o.$$set=a=>{t(1,e=le(le({},e),ve(a))),"$$scope"in a&&t(3,n=a.$$scope)},e=ve(e),[s,e,r,n]}var od=class extends Z{constructor(e){super(),ee(this,e,WC,qC,Q,{})}},nd=od;function zC(o){let e,t=o[2].default,r=he(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&xe(r,t,n,n[3],e?ge(t,n[3],s,null):ye(n[3]),null)},i(n){e||(L(r,n),e=!0)},o(n){D(r,n),e=!1},d(n){r&&r.d(n)}}}function KC(o){let e,t,r=[{name:"refresh-cw"},o[1],{iconNode:o[0]}],n={$$slots:{default:[zC]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=le(n,r[s]);return e=new qe({props:n}),{c(){V(e.$$.fragment)},m(s,a){N(e,s,a),t=!0},p(s,[a]){let i=a&3?Oe(r,[r[0],a&2&&Ve(s[1]),a&1&&{iconNode:s[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:s}),e.$set(i)},i(s){t||(L(e.$$.fragment,s),t=!0)},o(s){D(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function GC(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"}],["path",{d:"M21 3v5h-5"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"}],["path",{d:"M8 16H3v5"}]];return o.$$set=a=>{t(1,e=le(le({},e),ve(a))),"$$scope"in a&&t(3,n=a.$$scope)},e=ve(e),[s,e,r,n]}var sd=class extends Z{constructor(e){super(),ee(this,e,GC,KC,Q,{})}},ad=sd;function jC(o){let e,t=o[2].default,r=he(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&xe(r,t,n,n[3],e?ge(t,n[3],s,null):ye(n[3]),null)},i(n){e||(L(r,n),e=!0)},o(n){D(r,n),e=!1},d(n){r&&r.d(n)}}}function YC(o){let e,t,r=[{name:"satellite"},o[1],{iconNode:o[0]}],n={$$slots:{default:[jC]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=le(n,r[s]);return e=new qe({props:n}),{c(){V(e.$$.fragment)},m(s,a){N(e,s,a),t=!0},p(s,[a]){let i=a&3?Oe(r,[r[0],a&2&&Ve(s[1]),a&1&&{iconNode:s[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:s}),e.$set(i)},i(s){t||(L(e.$$.fragment,s),t=!0)},o(s){D(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function JC(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M13 7 9 3 5 7l4 4"}],["path",{d:"m17 11 4 4-4 4-4-4"}],["path",{d:"m8 12 4 4 6-6-4-4Z"}],["path",{d:"m16 8 3-3"}],["path",{d:"M9 21a6 6 0 0 0-6-6"}]];return o.$$set=a=>{t(1,e=le(le({},e),ve(a))),"$$scope"in a&&t(3,n=a.$$scope)},e=ve(e),[s,e,r,n]}var id=class extends Z{constructor(e){super(),ee(this,e,JC,YC,Q,{})}},Bn=id;function XC(o){let e,t=o[2].default,r=he(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&xe(r,t,n,n[3],e?ge(t,n[3],s,null):ye(n[3]),null)},i(n){e||(L(r,n),e=!0)},o(n){D(r,n),e=!1},d(n){r&&r.d(n)}}}function QC(o){let e,t,r=[{name:"settings"},o[1],{iconNode:o[0]}],n={$$slots:{default:[XC]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=le(n,r[s]);return e=new qe({props:n}),{c(){V(e.$$.fragment)},m(s,a){N(e,s,a),t=!0},p(s,[a]){let i=a&3?Oe(r,[r[0],a&2&&Ve(s[1]),a&1&&{iconNode:s[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:s}),e.$set(i)},i(s){t||(L(e.$$.fragment,s),t=!0)},o(s){D(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function ZC(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"}],["circle",{cx:"12",cy:"12",r:"3"}]];return o.$$set=a=>{t(1,e=le(le({},e),ve(a))),"$$scope"in a&&t(3,n=a.$$scope)},e=ve(e),[s,e,r,n]}var ld=class extends Z{constructor(e){super(),ee(this,e,ZC,QC,Q,{})}},cd=ld;function e2(o){let e,t=o[2].default,r=he(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&xe(r,t,n,n[3],e?ge(t,n[3],s,null):ye(n[3]),null)},i(n){e||(L(r,n),e=!0)},o(n){D(r,n),e=!1},d(n){r&&r.d(n)}}}function t2(o){let e,t,r=[{name:"triangle-alert"},o[1],{iconNode:o[0]}],n={$$slots:{default:[e2]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=le(n,r[s]);return e=new qe({props:n}),{c(){V(e.$$.fragment)},m(s,a){N(e,s,a),t=!0},p(s,[a]){let i=a&3?Oe(r,[r[0],a&2&&Ve(s[1]),a&1&&{iconNode:s[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:s}),e.$set(i)},i(s){t||(L(e.$$.fragment,s),t=!0)},o(s){D(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function r2(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3"}],["path",{d:"M12 9v4"}],["path",{d:"M12 17h.01"}]];return o.$$set=a=>{t(1,e=le(le({},e),ve(a))),"$$scope"in a&&t(3,n=a.$$scope)},e=ve(e),[s,e,r,n]}var fd=class extends Z{constructor(e){super(),ee(this,e,r2,t2,Q,{})}},Ka=fd;function o2(o){let e,t=o[2].default,r=he(t,o,o[3],null);return{c(){r&&r.c()},m(n,s){r&&r.m(n,s),e=!0},p(n,s){r&&r.p&&(!e||s&8)&&xe(r,t,n,n[3],e?ge(t,n[3],s,null):ye(n[3]),null)},i(n){e||(L(r,n),e=!0)},o(n){D(r,n),e=!1},d(n){r&&r.d(n)}}}function n2(o){let e,t,r=[{name:"upload"},o[1],{iconNode:o[0]}],n={$$slots:{default:[o2]},$$scope:{ctx:o}};for(let s=0;s<r.length;s+=1)n=le(n,r[s]);return e=new qe({props:n}),{c(){V(e.$$.fragment)},m(s,a){N(e,s,a),t=!0},p(s,[a]){let i=a&3?Oe(r,[r[0],a&2&&Ve(s[1]),a&1&&{iconNode:s[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:s}),e.$set(i)},i(s){t||(L(e.$$.fragment,s),t=!0)},o(s){D(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function s2(o,e,t){let{$$slots:r={},$$scope:n}=e,s=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}],["polyline",{points:"17 8 12 3 7 8"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15"}]];return o.$$set=a=>{t(1,e=le(le({},e),ve(a))),"$$scope"in a&&t(3,n=a.$$scope)},e=ve(e),[s,e,r,n]}var ud=class extends Z{constructor(e){super(),ee(this,e,s2,n2,Q,{})}},dd=ud;function a2(o){Pe(o,"svelte-1gxdage","button.notebook.svelte-1gxdage{color:var(--color-base-30);background-color:transparent}button.notebook-synced.svelte-1gxdage{color:var(--color-accent)}button.system3-connected.svelte-1gxdage{color:var(--color-accent)}button.system3-disconnected.svelte-1gxdage{color:var(--color-base-40)}")}function i2(o){let e,t,r,n,s,a;return t=new Oo({props:{class:"svg-icon inline-icon"}}),{c(){var i;e=P("button"),V(t.$$.fragment),b(e,"class",r="clickable-icon view-action system3-view-action "+(o[0].tracking?"notebook-synced":"notebook")+" svelte-1gxdage"),b(e,"aria-label",n=o[0].tracking?"Tracking changes: local file and update log are in sync":"Not tracking changes: local file and update log are not in sync"),b(e,"tabindex","0"),b(e,"data-filename",s=(i=o[0].view.file)==null?void 0:i.name)},m(i,l){T(i,e,l),N(t,e,null),a=!0},p(i,l){var f;(!a||l&1&&r!==(r="clickable-icon view-action system3-view-action "+(i[0].tracking?"notebook-synced":"notebook")+" svelte-1gxdage"))&&b(e,"class",r),(!a||l&1&&n!==(n=i[0].tracking?"Tracking changes: local file and update log are in sync":"Not tracking changes: local file and update log are not in sync"))&&b(e,"aria-label",n),(!a||l&1&&s!==(s=(f=i[0].view.file)==null?void 0:f.name))&&b(e,"data-filename",s)},i(i){a||(L(t.$$.fragment,i),a=!0)},o(i){D(t.$$.fragment,i),a=!1},d(i){i&&C(e),H(t)}}}function l2(o){let e,t,r,n,s,a,i,l,f,u,d,m,x;return t=new Oo({props:{class:"svg-icon inline-icon"}}),l=new Bn({props:{class:"svg-icon inline-icon"}}),{c(){var h;e=P("button"),V(t.$$.fragment),a=B(),i=P("button"),V(l.$$.fragment),b(e,"class",r="clickable-icon view-action system3-view-action "+(o[0].tracking?"notebook-synced":"notebook")+" svelte-1gxdage"),b(e,"aria-label",n=o[0].tracking?"Tracking changes: local file and update log are in sync":"Not tracking changes: local file and update log are not in sync"),b(e,"tabindex","0"),b(e,"data-filename",s=(h=o[0].view.file)==null?void 0:h.name),b(i,"class",f="system3-"+o[1].status+" clickable-icon view-action system3-view-action svelte-1gxdage"),b(i,"aria-label",u=`${o[2].relay.name} (${o[1].status})`),b(i,"tabindex","0")},m(h,_){T(h,e,_),N(t,e,null),T(h,a,_),T(h,i,_),N(l,i,null),d=!0,m||(x=[re(i,"click",o[3]),re(i,"keypress",o[4])],m=!0)},p(h,_){var w;(!d||_&1&&r!==(r="clickable-icon view-action system3-view-action "+(h[0].tracking?"notebook-synced":"notebook")+" svelte-1gxdage"))&&b(e,"class",r),(!d||_&1&&n!==(n=h[0].tracking?"Tracking changes: local file and update log are in sync":"Not tracking changes: local file and update log are not in sync"))&&b(e,"aria-label",n),(!d||_&1&&s!==(s=(w=h[0].view.file)==null?void 0:w.name))&&b(e,"data-filename",s),(!d||_&2&&f!==(f="system3-"+h[1].status+" clickable-icon view-action system3-view-action svelte-1gxdage"))&&b(i,"class",f),(!d||_&6&&u!==(u=`${h[2].relay.name} (${h[1].status})`))&&b(i,"aria-label",u)},i(h){d||(L(t.$$.fragment,h),L(l.$$.fragment,h),d=!0)},o(h){D(t.$$.fragment,h),D(l.$$.fragment,h),d=!1},d(h){h&&(C(e),C(a),C(i)),H(t),H(l),m=!1,ke(x)}}}function c2(o){let e,t,r,n,s=[l2,i2],a=[];function i(l,f){return l[2]?0:1}return e=i(o,-1),t=a[e]=s[e](o),{c(){t.c(),r=Le()},m(l,f){a[e].m(l,f),T(l,r,f),n=!0},p(l,[f]){let u=e;e=i(l,f),e===u?a[e].p(l,f):(be(),D(a[u],1,1,()=>{a[u]=null}),we(),t=a[e],t?t.p(l,f):(t=a[e]=s[e](l),t.c()),L(t,1),t.m(r.parentNode,r))},i(l){n||(L(t),n=!0)},o(l){D(t),n=!1},d(l){l&&C(r),a[e].d(l)}}}function f2(o,e,t){let{view:r}=e,{state:n}=e,{remote:s}=e,a={connected:"connected: click to go offline",connecting:"connecting...",disconnected:"disconnected: click to go online",unknown:"unknown status"},i=()=>{r.toggleConnection()},l=f=>{f.key==="Enter"&&i()};return o.$$set=f=>{"view"in f&&t(0,r=f.view),"state"in f&&t(1,n=f.state),"remote"in f&&t(2,s=f.remote)},[r,n,s,i,l]}var pd=class extends Z{constructor(e){super(),ee(this,e,f2,c2,Q,{view:0,state:1,remote:2},a2)}},Hx=pd;var Ns=class{constructor(e,t,r){this.view=e,this.text=t,this.onClick=r,this.display()}display(){let e=this.view.containerEl,t=this.view.containerEl.querySelector(".view-content");if(!e)return;let r=e.querySelector(".system3-banner-box");r||(r=document.createElement("div"),r.classList.add("system3-banner-box"),e.insertBefore(r,t));let n=e.querySelector(".system3-banner");if(!n){n=document.createElement("div"),n.classList.add("system3-banner");let s=n.createSpan();s.setText(this.text),n.appendChild(s),r.appendChild(n);let a=async()=>{await this.onClick()&&this.destroy()};n.addEventListener("click",a)}return!0}destroy(){let e=this.view.containerEl;if(!e)return;let t=e.querySelector(".system3-banner-box");return t&&t.replaceChildren(),!0}};var Dl=require("@codemirror/state"),Vx=require("@codemirror/view");function Ga(o,e){let t=Object.keys(e).map(r=>u2(o,r,e[r]));return t.length===1?t[0]:function(){t.forEach(r=>r())}}function u2(o,e,t){let r=o[e],n=o.hasOwnProperty(e),s=n?r:function(){return Object.getPrototypeOf(o)[e].apply(this,arguments)},a=t(s);return r&&Object.setPrototypeOf(a,r),Object.setPrototypeOf(i,a),o[e]=i,l;function i(...f){return a===s&&o[e]===i&&l(),a.apply(this,f)}function l(){o[e]===i&&(n?o[e]=s:delete o[e]),a!==s&&(a=s,Object.setPrototypeOf(i,r||Function))}}var qx=bn(md());var d2=25,W4=Dl.Facet.define({combine(o){return o[o.length-1]}}),hd=Dl.Annotation.define(),gd=class{constructor(e){this.initialSet=!1;this.destroyed=!1;this.keyFrameCounter=0;this.debug=(...e)=>{};this.log=(...e)=>{};this.warn=(...e)=>{};var r,n,s,a;if(this.editor=e,this.connectionManager=this.editor.state.field(cn),this.view=(r=this.connectionManager)==null?void 0:r.findView(e),!this.view||(this.log=Ce(`[LiveCMPluginValue][${(n=this.view.view.file)==null?void 0:n.path}]`,"log"),this.warn=Ce(`[LiveCMPluginValue][${(s=this.view.view.file)==null?void 0:s.path}]`,"warn"),this.debug=Ce(`[LiveCMPluginValue][${(a=this.view.view.file)==null?void 0:a.path}]`,"debug"),this.debug("created"),!this.view.document))return;let t=this;this.uninstallMonkeyPatch=Ga(this.view.view,{setViewData(i){return function(l,f){return f&&(Uo(t.view)&&t.view.document.text===l&&(t.view.tracking=!0),t.resync()),i.call(this,l,f)}}}),this.view.document.connected?this.resync():this.view.document.onceConnected().then(()=>{this.resync()}),this._observer=async(i,l)=>{if(!Uo(this.view)){this.debug("Recived yjs event against a non-live view");return}if(this.destroyed){this.debug("Recived yjs event but editor was destroyed");return}if(l.origin!==this){let f=i.delta,u=[],d=0;for(let m=0;m<f.length;m++){let x=f[m];x.insert!=null?u.push({from:d,to:d,insert:x.insert}):x.delete!=null?(u.push({from:d,to:d+x.delete,insert:""}),d+=x.delete):x.retain!=null&&(d+=x.retain)}!this.view.tracking||Ot().enableEditorTweens&&this.keyFrameCounter>d2?(this.keyFrameCounter=0,u=await this.getKeyFrame(!0),this.debug("dispatch (full)")):(this.keyFrameCounter+=1,this.debug(`dispatch (incremental + ${this.keyFrameCounter})`)),Uo(this.view)&&(e.dispatch({changes:u,annotations:[hd.of(this.editor)]}),this.view.tracking=!0)}},this.observer=(i,l)=>{var f;try{(f=this._observer)==null||f.call(this,i,l)}catch(u){u instanceof RangeError&&Uo(this.view)&&(this.view.tracking=!1)}},this._ytext=this.view.document.ytext,this._ytext.observe(this.observer)}incrementalBufferChange(e){let t=this.editor.state.doc.toString(),r=new qx.default,n=r.diff_main(t,e);r.diff_cleanupSemantic(n);let s=[],a=0;for(let[i,l]of n)switch(i){case 0:a+=l.length;break;case 1:s.push({from:a,to:a,insert:l}),a+=l.length;break;case-1:s.push({from:a,to:a+l.length,insert:""});break}return s}getBufferChange(e,t=!1){return t?this.incrementalBufferChange(e):[{from:0,to:this.editor.state.doc.length,insert:e}]}async resync(){if(Uo(this.view)&&!this.view.tracking&&!this.destroyed){await this.view.document.whenSynced();let e=await this.getKeyFrame();Uo(this.view)&&!this.view.tracking&&!this.destroyed&&this.editor.dispatch({changes:e,annotations:[hd.of(this.editor)]})}}async getKeyFrame(e=!1){return!Uo(this.view)||this.destroyed?[]:this.view.document.text===this.view.view.getViewData()?(this.view.tracking=!0,[]):(this.warn(`|${this.view.document.text}|
|${this.view.view.getViewData()}|`),this.warn("ytext and editor buffer need syncing"),!this.view.document.hasLocalDB()&&this.view.document.text===""?(this.warn("local db missing, not setting buffer"),[]):(this.view.tracking||this.view.checkStale(),Uo(this.view)&&!this.destroyed?[this.getBufferChange(this.view.document.text,e)]:[]))}update(e){var n,s,a,i;if(!e.docChanged||e.transactions.length>0&&e.transactions[0].annotation(hd)===this.editor)return;let t=e.view;this.view=(n=this.connectionManager)==null?void 0:n.findView(t);let r=(a=(s=this.view)==null?void 0:s.document)==null?void 0:a.ytext;r&&((i=r.doc)==null||i.transact(()=>{let l=0;e.changes.iterChanges((f,u,d,m,x)=>{let h=x.sliceString(0,x.length,`
`);f!==u&&r.delete(f+l,u-f),h.length>0&&r.insert(f+l,h),l+=h.length-(u-f)})},this))}destroy(){var e;this.destroyed=!0,this.observer&&((e=this._ytext)==null||e.unobserve(this.observer)),this.uninstallMonkeyPatch&&(this.uninstallMonkeyPatch(),this.uninstallMonkeyPatch=void 0),this.connectionManager=null,this.view=void 0,this._ytext=void 0,this.editor=null}},Wx=Vx.ViewPlugin.fromClass(gd);var Al=require("@codemirror/state"),lr=require("@codemirror/view");var zx=lr.EditorView.baseTheme({".cm-ySelection":{},".cm-yLineSelection":{padding:0,margin:"0px 2px 0px 4px"},".cm-ySelectionCaret":{position:"relative",borderLeft:"1px solid black",borderRight:"1px solid black",marginLeft:"-1px",marginRight:"-1px",boxSizing:"border-box",display:"inline"},".cm-ySelectionCaretDot":{borderRadius:"50%",position:"absolute",width:".4em",height:".4em",top:"-.2em",left:"-.2em",backgroundColor:"inherit",transition:"transform .3s ease-in-out",boxSizing:"border-box"},".cm-ySelectionCaret:hover > .cm-ySelectionCaretDot":{transformOrigin:"bottom center",transform:"scale(0)"},".cm-ySelectionInfo":{position:"absolute",top:"-1.05em",left:"-1px",fontSize:".75em",fontFamily:"serif",fontStyle:"normal",fontWeight:"normal",lineHeight:"normal",userSelect:"none",color:"white",paddingLeft:"2px",paddingRight:"2px",zIndex:101,transition:"opacity .3s ease-in-out",backgroundColor:"inherit",opacity:0,transitionDelay:"0s",whiteSpace:"nowrap"},".cm-ySelectionCaret:hover > .cm-ySelectionInfo":{opacity:1,transitionDelay:"0s"}}),p2=Al.Annotation.define(),xd=class extends lr.WidgetType{constructor(t,r){super();this.color=t,this.name=r}toDOM(t){return wa("span",[Gt("class","cm-ySelectionCaret"),Gt("style",`background-color: ${this.color}; border-color: ${this.color}`)],[ps("\u2060"),wa("div",[Gt("class","cm-ySelectionCaretDot")]),ps("\u2060"),wa("div",[Gt("class","cm-ySelectionInfo")],[ps(this.name)]),ps("\u2060")])}eq(t){return t.color===this.color}compare(t){return t.color===this.color}updateDOM(){return!1}get estimatedHeight(){return-1}ignoreEvent(){return!0}},yd=class{constructor(e){var r,n;this.editor=e,this.decorations=Al.RangeSet.of([]),this.connectionManager=this.editor.state.field(cn);let t=(r=this.connectionManager)==null?void 0:r.findView(e);if(t&&t instanceof fn){this.view=t;let s=(n=this.view.document)==null?void 0:n._provider;this._listener=({added:a,updated:i,removed:l},f,u)=>{a.concat(i).concat(l).findIndex(m=>{var x;return m!==((x=this._awareness)==null?void 0:x.doc.clientID)})>=0&&e.dispatch({annotations:[p2.of([])]})},s&&(this._awareness=s.awareness,this._awareness.on("change",this._listener))}}destroy(){var e;this._listener&&((e=this._awareness)==null||e.off("change",this._listener),this._listener=void 0),this.connectionManager=null,this.view=null,this.editor=null}update(e){var f,u,d,m;let t=e.view;this.view=(f=this.connectionManager)==null?void 0:f.findView(t);let r=(d=(u=this.view)==null?void 0:u.document)==null?void 0:d.ytext;if(!(this.view&&r&&r.doc))return;let n=(m=this.view.document)==null?void 0:m._provider;if(!n)return;this._awareness=n.awareness;let s=this._awareness,a=r.doc,i=[],l=this._awareness.getLocalState();if(l!=null){let x=e.view.hasFocus&&e.view.dom.ownerDocument.hasFocus(),h=x?e.state.selection.main:null,_=l.cursor==null?null:Wf(l.cursor.anchor),w=l.cursor==null?null:Wf(l.cursor.head);if(h!=null){let v=zf(r,h.anchor),A=zf(r,h.head);(l.cursor==null||!Gf(_,v)||!Gf(w,A))&&s.setLocalStateField("cursor",{anchor:v,head:A})}else l.cursor!=null&&x&&s.setLocalStateField("cursor",null)}s.getStates().forEach((x,h)=>{if(h===s.doc.clientID)return;let _=x.cursor;if(_==null||_.anchor==null||_.head==null)return;let w=Kf(_.anchor,a),v=Kf(_.head,a);if(w==null||v==null||w.type!==r||v.type!==r)return;if(w.index>e.state.doc.length||v.index>e.state.doc.length){Ce("[RemoteSelections]","warn")(`cursor positions (${w.index}, ${v.index}) out of range of document length: ${e.state.doc.length}`),this.decorations=lr.Decoration.none;return}let{color:A="#30bced",name:U="Anonymous"}=x.user||{},I=x.user&&x.user.colorLight||A+"33",F=ts(w.index,v.index),$=$r(w.index,v.index),E=e.view.state.doc.lineAt(F),M=e.view.state.doc.lineAt($);if(E.number===M.number)i.push({from:F,to:$,value:lr.Decoration.mark({attributes:{style:`background-color: ${I}`},class:"cm-ySelection"})});else{i.push({from:F,to:E.from+E.length,value:lr.Decoration.mark({attributes:{style:`background-color: ${I}`},class:"cm-ySelection"})}),i.push({from:M.from,to:$,value:lr.Decoration.mark({attributes:{style:`background-color: ${I}`},class:"cm-ySelection"})});for(let R=E.number+1;R<M.number;R++){let q=e.view.state.doc.line(R).from;i.push({from:q,to:q,value:lr.Decoration.line({attributes:{style:`background-color: ${I}`,class:"cm-yLineSelection"}})})}}i.push({from:v.index,to:v.index,value:lr.Decoration.widget({side:v.index-w.index>0?-1:1,block:!1,widget:new xd(A,U)})})}),this.decorations=lr.Decoration.set(i,!0)}},Kx=lr.ViewPlugin.fromClass(yd,{decorations:o=>o.decorations});var Ml=require("@codemirror/state"),$o=require("@codemirror/view"),Gx=require("@codemirror/view");var o$=Ml.Annotation.define(),wd=class extends Gx.WidgetType{toDOM(){let e=document.createElement("span");return e.style.display="inline-flex",e.addClass("invalid-link"),e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-file-warning"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg>',e.title="This link points outside the shared folder and may not be accessible to other users.",e}},bd=Ml.StateEffect.define(),_d=class{constructor(e){this.log=e=>{};var t;if(this.editor=e,this.connectionManager=this.editor.state.field(cn),this.decorations=$o.Decoration.none,this.decorationAnchors=[],this.metadata=new Map,this.cb=(r,n)=>{this.updateFromMetadata(n),this.editor.dispatch({effects:bd.of(null)})},!this.connectionManager){Ce("[InvalidLinkPluginValue]","warn")("ConnectionManager not found in InvalidLinkPlugin");return}this.app=this.connectionManager.app,this.view=this.connectionManager.findView(e),this.view&&(this.log=Ce(`[InvalidLinkPluginValue][${(t=this.view.view.file)==null?void 0:t.path}]`,"debug"),this.log("created"),this.view.document&&this.view.document.whenSynced().then(()=>{var r,n;if(this.connectionManager&&this.app&&((n=(r=this.view)==null?void 0:r.document)!=null&&n.tfile)){this.connectionManager.onMeta(this.view.document.tfile,this.cb);let s=this.app.metadataCache.getFileCache(this.view.document.tfile);s&&(this.updateFromMetadata(s),this.editor.dispatch({effects:bd.of(null)}))}else this.log("unable to subscribe to metadata updates")}))}findInternalLinks(e){let t=[];return e.state.facet($o.EditorView.decorations).forEach(n=>{(typeof n=="function"?n(e):n).between(0,e.state.doc.length,(a,i,l)=>{var d;(((d=l.spec)==null?void 0:d.class)||"").contains("cm-formatting-link-end")&&t.push({from:a,to:i})})}),t}updateFromMetadata(e){var r,n,s,a;if(this.connectionManager&&(this.view=this.connectionManager.findView(this.editor)),!this.view||!this.view.document||!this.app||!((n=(r=this.view)==null?void 0:r.document)!=null&&n.sharedFolder)||!((a=(s=this.view)==null?void 0:s.document)!=null&&a.tfile))return;let t=new Map;for(let i of(e==null?void 0:e.links)||[]){let l=this.app.metadataCache.getFirstLinkpathDest(i.link,this.view.document.path);l&&!this.view.document.sharedFolder.checkPath(l.path)&&t.set(i.position.start.offset,{from:i.position.start.offset,to:i.position.end.offset,link:i.link,original:i.original})}for(let i of(e==null?void 0:e.embeds)||[]){let l=this.app.metadataCache.getFirstLinkpathDest(i.link,this.view.document.path);l&&!this.view.document.sharedFolder.checkPath(l.path)&&t.set(i.position.start.offset,{from:i.position.start.offset,to:i.position.end.offset,link:i.link,original:i.original})}this.metadata=t}updateMetadataPositions(e){for(let[t,r]of this.metadata)try{this.metadata.set(t,{from:e.changes.mapPos(r.from),to:e.changes.mapPos(r.to),link:r.link,original:r.original})}catch(n){this.metadata.delete(t)}}updateFromEditor(e){var s,a,i,l;if(this.connectionManager&&(this.view=this.connectionManager.findView(this.editor)),!this.view||!this.view.document||!this.app||!((a=(s=this.view)==null?void 0:s.document)!=null&&a.sharedFolder)||!((l=(i=this.view)==null?void 0:i.document)!=null&&l.tfile))return;let t=[],r=new Map(this.metadata),n=this.findInternalLinks(this.editor);for(let f of n){let u=null;for(let[x,h]of r)if(f.from<=h.to&&f.to>=h.from){u=h,r.delete(x);break}if(!u)continue;let d=this.app.metadataCache.getFirstLinkpathDest(u.link,this.view.document.path);d&&!this.view.document.sharedFolder.checkPath(d.path)&&t.push(f.from)}t.filter(f=>f<=e.state.doc.length),this.decorationAnchors=t}updateDecorations(){this.decorationAnchors.sort();let e=this.decorationAnchors.map(t=>$o.Decoration.widget({widget:new wd,side:1}).range(t));e.length>0?this.decorations=$o.Decoration.set(e,!0):this.decorations=$o.Decoration.none}update(e){let t=!1;return e.transactions.forEach(r=>{r.effects.some(n=>n.is(bd))&&(t=!0)}),(e.docChanged||e.viewportChanged||t)&&(t||this.updateMetadataPositions(e),this.updateFromEditor(e),this.updateDecorations()),this.decorations}destroy(){var e,t;this.connectionManager&&((t=(e=this.view)==null?void 0:e.document)!=null&&t.tfile)&&this.connectionManager.offMeta(this.view.document.tfile),this.connectionManager=null,this.view=void 0,this.metadata.clear(),this.metadata=null,this.editor=null}},jx=$o.ViewPlugin.fromClass(_d,{decorations:o=>o.decorations});function Bo(){}Bo.prototype={diff:function(e,t){var r,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=n.callback;typeof n=="function"&&(s=n,n={}),this.options=n;var a=this;function i(I){return s?(setTimeout(function(){s(void 0,I)},0),!0):I}e=this.castInput(e),t=this.castInput(t),e=this.removeEmpty(this.tokenize(e)),t=this.removeEmpty(this.tokenize(t));var l=t.length,f=e.length,u=1,d=l+f;n.maxEditLength&&(d=Math.min(d,n.maxEditLength));var m=(r=n.timeout)!==null&&r!==void 0?r:1/0,x=Date.now()+m,h=[{oldPos:-1,lastComponent:void 0}],_=this.extractCommon(h[0],t,e,0);if(h[0].oldPos+1>=f&&_+1>=l)return i([{value:this.join(t),count:t.length}]);var w=-1/0,v=1/0;function A(){for(var I=Math.max(w,-u);I<=Math.min(v,u);I+=2){var F=void 0,$=h[I-1],E=h[I+1];$&&(h[I-1]=void 0);var M=!1;if(E){var R=E.oldPos-I;M=E&&0<=R&&R<l}var q=$&&$.oldPos+1<f;if(!M&&!q){h[I]=void 0;continue}if(!q||M&&$.oldPos+1<E.oldPos?F=a.addToPath(E,!0,void 0,0):F=a.addToPath($,void 0,!0,1),_=a.extractCommon(F,t,e,I),F.oldPos+1>=f&&_+1>=l)return i(m2(a,F.lastComponent,t,e,a.useLongestToken));h[I]=F,F.oldPos+1>=f&&(v=Math.min(v,I-1)),_+1>=l&&(w=Math.max(w,I+1))}u++}if(s)(function I(){setTimeout(function(){if(u>d||Date.now()>x)return s();A()||I()},0)})();else for(;u<=d&&Date.now()<=x;){var U=A();if(U)return U}},addToPath:function(e,t,r,n){var s=e.lastComponent;return s&&s.added===t&&s.removed===r?{oldPos:e.oldPos+n,lastComponent:{count:s.count+1,added:t,removed:r,previousComponent:s.previousComponent}}:{oldPos:e.oldPos+n,lastComponent:{count:1,added:t,removed:r,previousComponent:s}}},extractCommon:function(e,t,r,n){for(var s=t.length,a=r.length,i=e.oldPos,l=i-n,f=0;l+1<s&&i+1<a&&this.equals(t[l+1],r[i+1]);)l++,i++,f++;return f&&(e.lastComponent={count:f,previousComponent:e.lastComponent}),e.oldPos=i,l},equals:function(e,t){return this.options.comparator?this.options.comparator(e,t):e===t||this.options.ignoreCase&&e.toLowerCase()===t.toLowerCase()},removeEmpty:function(e){for(var t=[],r=0;r<e.length;r++)e[r]&&t.push(e[r]);return t},castInput:function(e){return e},tokenize:function(e){return e.split("")},join:function(e){return e.join("")}};function m2(o,e,t,r,n){for(var s=[],a;e;)s.push(e),a=e.previousComponent,delete e.previousComponent,e=a;s.reverse();for(var i=0,l=s.length,f=0,u=0;i<l;i++){var d=s[i];if(d.removed){if(d.value=o.join(r.slice(u,u+d.count)),u+=d.count,i&&s[i-1].added){var x=s[i-1];s[i-1]=s[i],s[i]=x}}else{if(!d.added&&n){var m=t.slice(f,f+d.count);m=m.map(function(_,w){var v=r[u+w];return v.length>_.length?v:_}),d.value=o.join(m)}else d.value=o.join(t.slice(f,f+d.count));f+=d.count,d.added||(u+=d.count)}}var h=s[l-1];return l>1&&typeof h.value=="string"&&(h.added||h.removed)&&o.equals("",h.value)&&(s[l-2].value+=h.value,s.pop()),s}var s$=new Bo;function h2(o,e){if(typeof o=="function")e.callback=o;else if(o)for(var t in o)o.hasOwnProperty(t)&&(e[t]=o[t]);return e}var Yx=/^[A-Za-z\xC0-\u02C6\u02C8-\u02D7\u02DE-\u02FF\u1E00-\u1EFF]+$/,Jx=/\S/,Ld=new Bo;Ld.equals=function(o,e){return this.options.ignoreCase&&(o=o.toLowerCase(),e=e.toLowerCase()),o===e||this.options.ignoreWhitespace&&!Jx.test(o)&&!Jx.test(e)};Ld.tokenize=function(o){for(var e=o.split(/([^\S\r\n]+|[()[\]{}'"\r\n]|\b)/),t=0;t<e.length-1;t++)!e[t+1]&&e[t+2]&&Yx.test(e[t])&&Yx.test(e[t+2])&&(e[t]+=e[t+2],e.splice(t+1,2),t--);return e};function Xx(o,e,t){return t=h2(t,{ignoreWhitespace:!0}),Ld.diff(o,e,t)}var Cd=new Bo;Cd.tokenize=function(o){this.options.stripTrailingCr&&(o=o.replace(/\r\n/g,`
`));var e=[],t=o.split(/(\n|\r\n)/);t[t.length-1]||t.pop();for(var r=0;r<t.length;r++){var n=t[r];r%2&&!this.options.newlineIsToken?e[e.length-1]+=n:(this.options.ignoreWhitespace&&(n=n.trim()),e.push(n))}return e};function g2(o,e,t){return Cd.diff(o,e,t)}var x2=new Bo;x2.tokenize=function(o){return o.split(/(\S.+?[.!?])(?=\s+|$)/)};var y2=new Bo;y2.tokenize=function(o){return o.split(/([{}:;,]|\s+)/)};function El(o){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?El=function(e){return typeof e}:El=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},El(o)}function vd(o){return b2(o)||w2(o)||_2(o)||v2()}function b2(o){if(Array.isArray(o))return Sd(o)}function w2(o){if(typeof Symbol!="undefined"&&Symbol.iterator in Object(o))return Array.from(o)}function _2(o,e){if(o){if(typeof o=="string")return Sd(o,e);var t=Object.prototype.toString.call(o).slice(8,-1);if(t==="Object"&&o.constructor&&(t=o.constructor.name),t==="Map"||t==="Set")return Array.from(o);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Sd(o,e)}}function Sd(o,e){(e==null||e>o.length)&&(e=o.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=o[t];return r}function v2(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var S2=Object.prototype.toString,ja=new Bo;ja.useLongestToken=!0;ja.tokenize=Cd.tokenize;ja.castInput=function(o){var e=this.options,t=e.undefinedReplacement,r=e.stringifyReplacer,n=r===void 0?function(s,a){return typeof a=="undefined"?t:a}:r;return typeof o=="string"?o:JSON.stringify(kd(o,null,null,n),n,"  ")};ja.equals=function(o,e){return Bo.prototype.equals.call(ja,o.replace(/,([\r\n])/g,"$1"),e.replace(/,([\r\n])/g,"$1"))};function kd(o,e,t,r,n){e=e||[],t=t||[],r&&(o=r(n,o));var s;for(s=0;s<e.length;s+=1)if(e[s]===o)return t[s];var a;if(S2.call(o)==="[object Array]"){for(e.push(o),a=new Array(o.length),t.push(a),s=0;s<o.length;s+=1)a[s]=kd(o[s],e,t,r,n);return e.pop(),t.pop(),a}if(o&&o.toJSON&&(o=o.toJSON()),El(o)==="object"&&o!==null){e.push(o),a={},t.push(a);var i=[],l;for(l in o)o.hasOwnProperty(l)&&i.push(l);for(i.sort(),s=0;s<i.length;s+=1)l=i[s],a[l]=kd(o[l],e,t,r,l);e.pop(),t.pop()}else a=o;return a}var Id=new Bo;Id.tokenize=function(o){return o.slice()};Id.join=Id.removeEmpty=function(o){return o};function Qx(o,e,t,r,n,s,a){a||(a={}),typeof a.context=="undefined"&&(a.context=4);var i=g2(t,r,a);if(!i)return;i.push({value:"",lines:[]});function l(v){return v.map(function(A){return" "+A})}for(var f=[],u=0,d=0,m=[],x=1,h=1,_=function(A){var U=i[A],I=U.lines||U.value.replace(/\n$/,"").split(`
`);if(U.lines=I,U.added||U.removed){var F;if(!u){var $=i[A-1];u=x,d=h,$&&(m=a.context>0?l($.lines.slice(-a.context)):[],u-=m.length,d-=m.length)}(F=m).push.apply(F,vd(I.map(function(W){return(U.added?"+":"-")+W}))),U.added?h+=I.length:x+=I.length}else{if(u)if(I.length<=a.context*2&&A<i.length-2){var E;(E=m).push.apply(E,vd(l(I)))}else{var M,R=Math.min(I.length,a.context);(M=m).push.apply(M,vd(l(I.slice(0,R))));var q={oldStart:u,oldLines:x-u+R,newStart:d,newLines:h-d+R,lines:m};if(A>=i.length-2&&I.length<=a.context){var J=/\n$/.test(t),G=/\n$/.test(r),z=I.length==0&&m.length>q.oldLines;!J&&z&&t.length>0&&m.splice(q.oldLines,0,"\\ No newline at end of file"),(!J&&!z||!G)&&m.push("\\ No newline at end of file")}f.push(q),u=0,d=0,m=[]}x+=I.length,h+=I.length}},w=0;w<i.length;w++)_(w);return{oldFileName:o,newFileName:e,oldHeader:n,newHeader:s,hunks:f}}var ty=require("obsidian");var Fl=class{constructor(e){this.file1Start=e.file1Start,this.file2Start=e.file2Start,this.file1Lines=e.file1Lines,this.file2Lines=e.file2Lines}};var Rl=class{constructor(e){this.file1Name=e.file1Name,this.file2Name=e.file2Name,this.differences=e.differences}static fromParsedDiff(e){let t=[];return e.hunks.forEach(r=>{let n=0,s=0;for(let a=0;a<r.lines.length;a+=1){let i=r.lines[a];if(i.startsWith("+")||i.startsWith("-")){let l=a,f=l;for(;f<r.lines.length-1&&(r.lines[f+1].startsWith("+")||r.lines[f+1].startsWith("-"));)f+=1;let u=r.lines.slice(l,f+1).filter(m=>m.startsWith("-")).map(m=>m.slice(1)),d=r.lines.slice(l,f+1).filter(m=>m.startsWith("+")).map(m=>m.slice(1));t.push(new Fl({file1Start:r.oldStart+l-s-1,file2Start:r.newStart+l-n-1,file1Lines:u,file2Lines:d})),n+=u.length,s+=d.length,a+=f-l}}}),new this({file1Name:e.oldFileName,file2Name:e.newFileName,differences:t})}};function Td(o){let e=o.fullText.split(`
`);return e.splice(o.position,0,o.newLine),e.join(`
`)}function Ya(o){let e=o.fullText.split(`
`);return o.newLine===""?e.splice(o.position,o.linesToReplace):e.splice(o.position,o.linesToReplace,o.newLine),e.join(`
`)}function Ja(o){let e=o.fullText.split(`
`);return e.splice(o.position,o.count),e.join(`
`)}function Vs(o){return o!==""?o:"\u200E"}var cr=class{constructor(e){this.text=e.text,this.onClick=e.onClick}build(e){e.createEl("a",{text:this.text,cls:"no-decoration text-xxs file-diff__action-line"}).onClickEvent(this.onClick)}};var co=class{static build(e){e.createEl("span",{text:"|",cls:"text-xxs file-diff__action-line"})}};var Dd=require("obsidian");var Zx=bn(md());var br=class extends St{constructor(t){super();this.observableName=t;this._map=new Map,this._derivedMaps=new WeakMap}set(t,r){return this._map.set(t,r),this.notifyListeners(),this}delete(t){let r=this._map.delete(t);return r&&this.notifyListeners(),r}clear(){this._map.clear(),this.notifyListeners()}has(t){return this._map.has(t)}get(t){return this._map.get(t)}keys(){return[...this._map.keys()]}values(){return[...this._map.values()]}entries(){return[...this._map.entries()]}get size(){return this._map.size}forEach(t){this._map.forEach(t)}find(t){for(let[r,n]of this._map)if(t(n,r))return n}some(t){for(let[r,n]of this._map)if(t(n,r))return!0;return!1}filter(t){let r=this._derivedMaps.get(t);if(r)return r;let n=new Pd(this,t);return this._derivedMaps.set(t,n),n}},Pd=class extends br{constructor(t,r){super();this.parentMap=t;this.predicate=r;this.sub(),this.observableName=t.observableName+"(filter: "+r.toString()+")"}sub(){this.unsub||(this.unsub=this.parentMap.subscribe(()=>{let t=new Map;this.parentMap.forEach((r,n)=>{this.predicate(r,n)&&t.set(n,r)}),this._map=t,this.notifyListeners()}))}subscribe(t){return this.sub(),super.subscribe(t),()=>{this.unsubscribe(t)}}unsubscribe(t){super.unsubscribe(t),this._listeners.size===0&&this.unsub&&(this.unsub(),this.unsub=void 0)}destroy(){this.unsub&&this.unsub()}};function Xa(o,e){let t=o.path.split("/"),r=e.path.split("/");if(t.length===2&&r.length>2)return 1;if(r.length===2&&t.length>2)return-1;let n=Math.min(t.length,r.length);for(let s=0;s<n;s++)if(t[s]!==r[s]){if(s===t.length-1){let a=t[s].match(/\d+/g),i=r[s].match(/\d+/g);if(a&&i){let l=parseInt(a[0]),f=parseInt(i[0]);if(l!==f)return l-f}}return t[s].localeCompare(r[s])}return t.length-r.length}function ey(o,e){let t=o.getText("contents"),r=t.toString(),n=new Zx.diff_match_patch,s=n.diff_main(r,e);n.diff_cleanupSemantic(s);let a=0,i=Ce("[updateYDocFromDiskBuffer]","debug");i("Updating YDoc:"),i("Current content length:",r.length),i("Disk buffer length:",e.length),s.length!=0&&(o.transact(()=>{for(let[l,f]of s)switch(l){case 1:i(`Inserting "${f}" at position ${a}`),t.insert(a,f),a+=f.length;break;case 0:i(`Keeping "${f}" (length: ${f.length})`),a+=f.length;break;case-1:i(`Deleting "${f}" at position ${a}`),t.delete(a,f.length);break}}),i("Update complete. New content length:",t.toString().length))}var Ol=class extends hr{constructor(t,r,n,s=3){super();this.loginManager=t;this.timeProvider=r;this.sharedFolders=n;this.concurrency=s;this.activeSync=new an;this.activeDownloads=new an;this.syncGroups=new br;this.syncQueue=[];this.downloadQueue=[];this.isProcessingSync=!1;this.isProcessingDownloads=!1;this.isPaused=!0;this.inProgressSyncs=new Set;this.inProgressDownloads=new Set;this.syncCompletionCallbacks=new Map;this.downloadCompletionCallbacks=new Map;this.loggedItems=new Map;this.subscriptions=[];this.start=this.resume;Dt.set(this,"BackgroundSync"),this.timeProvider.setInterval(()=>{this.processSyncQueue(),this.processDownloadQueue()},1e3)}get pendingSyncs(){return this.syncQueue}get pendingDownloads(){return this.downloadQueue}getOverallProgress(){let t=0,r=0,n=0,s=0,a=0,i=0;this.syncGroups.forEach(d=>{t+=d.total,r+=d.completed,n+=d.syncs,s+=d.completedSyncs,a+=d.downloads,i+=d.completedDownloads});let l=t>0?r/t*100:0,f=n>0?s/n*100:0,u=a>0?i/a*100:0;return{totalPercent:Math.round(l),syncPercent:Math.round(f),downloadPercent:Math.round(u),totalItems:t,completedItems:r,syncItems:n,completedSyncs:s,downloadItems:a,completedDownloads:i}}getGroupProgress(t){let r=this.syncGroups.get(t);if(!r)return null;let n=r.total>0?r.completed/r.total*100:0,s=r.syncs>0?r.completedSyncs/r.syncs*100:0,a=r.downloads>0?r.completedDownloads/r.downloads*100:0;return{percent:Math.round(n),syncPercent:Math.round(s),downloadPercent:Math.round(a),sharedFolder:t,status:r.status}}getAllGroupsProgress(){let t=[];return this.syncGroups.forEach((r,n)=>{let s=this.getGroupProgress(n);s&&t.push(s)}),t}async processSyncQueue(){if(this.isPaused||this.isProcessingSync)return;this.isProcessingSync=!0;let t=this.syncQueue.filter(r=>r.sharedFolder.connected);for(;t.length>0&&this.activeSync.size<this.concurrency;){let r=t.shift();if(!r)break;this.syncQueue=this.syncQueue.filter(n=>n.guid!==r.guid),r.status="running",this.activeSync.add(r);try{let n=r.doc;await this.syncDocument(n),r.status="completed";let s=this.syncCompletionCallbacks.get(r.guid);s&&(s.resolve(),this.syncCompletionCallbacks.delete(r.guid));let a=this.syncGroups.get(r.sharedFolder);a&&(this.debug(`[Sync Progress] Before: completed=${a.completed}, total=${a.total}, syncs=${a.syncs}, completedSyncs=${a.completedSyncs}`),a.completedSyncs++,a.completed++,this.debug(`[Sync Progress] After: completed=${a.completed}, total=${a.total}, syncs=${a.syncs}, completedSyncs=${a.completedSyncs}`),a.completed===a.total&&(a.status="completed",this.debug("[Sync Progress] Group completed!")),this.syncGroups.set(r.sharedFolder,a))}catch(n){r.status="failed";let s=this.syncCompletionCallbacks.get(r.guid);s&&(s.reject(n instanceof Error?n:new Error(String(n))),this.syncCompletionCallbacks.delete(r.guid));let a=this.syncGroups.get(r.sharedFolder);a&&(this.error("[Sync Failed]",n),a.status="failed",this.syncGroups.set(r.sharedFolder,a))}finally{this.activeSync.delete(r),this.inProgressSyncs.delete(r.guid)}}this.isProcessingSync=!1,this.syncQueue.length>0&&!this.isPaused&&this.syncQueue.some(n=>n.sharedFolder.connected)&&this.processSyncQueue()}async processDownloadQueue(){if(this.isPaused||this.isProcessingDownloads)return;this.isProcessingDownloads=!0;let t=this.downloadQueue.filter(r=>r.sharedFolder.connected);for(;t.length>0&&this.activeDownloads.size<this.concurrency;){let r=t.shift();if(!r)break;this.downloadQueue=this.downloadQueue.filter(n=>n.guid!==r.guid),r.status="running",this.activeDownloads.add(r);try{await this.getDocument(r.doc),r.status="completed";let n=this.downloadCompletionCallbacks.get(r.guid);n&&(n.resolve(),this.downloadCompletionCallbacks.delete(r.guid));let s=this.syncGroups.get(r.sharedFolder);s&&(s.completedDownloads++,s.completed++,s.completed===s.total&&(s.status="completed"),this.syncGroups.set(r.sharedFolder,s))}catch(n){r.status="failed";let s=this.downloadCompletionCallbacks.get(r.guid);s&&(s.reject(n instanceof Error?n:new Error(String(n))),this.downloadCompletionCallbacks.delete(r.guid));let a=this.syncGroups.get(r.sharedFolder);a&&(a.status="failed",this.syncGroups.set(r.sharedFolder,a)),this.error("[processDownloadQueue]",n)}finally{this.activeDownloads.delete(r),this.inProgressDownloads.delete(r.guid)}}this.isProcessingDownloads=!1,this.downloadQueue.length>0&&!this.isPaused&&this.downloadQueue.some(n=>n.sharedFolder.connected)&&this.processDownloadQueue()}async enqueueSync(t){if(this.inProgressSyncs.has(t.guid)){this.debug(`[enqueueSync] Item ${t.guid} already in progress, skipping`);let i=this.syncCompletionCallbacks.get(t.guid);return i?new Promise((l,f)=>{i.resolve=l,i.reject=f}):(this.processSyncQueue(),Promise.resolve())}let r=t.sharedFolder,n={guid:t.guid,path:r.getPath(t.path),doc:t,status:"pending",sharedFolder:r},s=this.syncGroups.get(r);s?(s.total++,s.syncs++):s={sharedFolder:r,total:1,completed:0,status:"pending",downloads:0,syncs:1,completedDownloads:0,completedSyncs:0},this.syncGroups.set(r,s),this.inProgressSyncs.add(t.guid);let a=new Promise((i,l)=>{this.syncCompletionCallbacks.set(t.guid,{resolve:i,reject:l})});return this.syncQueue.push(n),this.syncQueue.sort(Xa),this.processSyncQueue(),a}enqueueDownload(t){if(this.inProgressDownloads.has(t.guid)){this.debug(`[enqueueDownload] Item ${t.guid} already in progress, skipping`);let i=this.downloadCompletionCallbacks.get(t.guid);return i?(this.processDownloadQueue(),new Promise((l,f)=>{i.resolve=l,i.reject=f})):(this.processDownloadQueue(),Promise.resolve())}let r=t.sharedFolder,n=this.syncGroups.get(r);n||(n={sharedFolder:r,total:0,completed:0,status:"pending",downloads:0,syncs:0,completedDownloads:0,completedSyncs:0}),n.downloads++,n.total++,this.syncGroups.set(r,n);let s={guid:t.guid,path:r.getPath(t.path),doc:t,status:"pending",sharedFolder:r};this.inProgressDownloads.add(t.guid);let a=new Promise((i,l)=>{this.downloadCompletionCallbacks.set(t.guid,{resolve:i,reject:l})});return this.downloadQueue.push(s),this.downloadQueue.sort(Xa),this.processDownloadQueue(),a}enqueueSharedFolderSync(t){let r=[...t.files.values()].filter(Fo),n={sharedFolder:t,total:r.length,completed:0,status:"pending",downloads:0,syncs:r.length,completedDownloads:0,completedSyncs:0};this.syncGroups.set(t,n);let s=[...r].sort(Xa);for(let a of s)this.enqueueDocumentForGroupSync(a);n.status="running",this.syncGroups.set(t,n)}async enqueueDocumentForGroupSync(t){if(this.inProgressSyncs.has(t.guid)){this.debug(`[enqueueDocumentForGroupSync] Item ${t.guid} already in progress, skipping`);let a=this.syncCompletionCallbacks.get(t.guid);return a?(this.processSyncQueue(),new Promise((i,l)=>{a.resolve=i,a.reject=l})):Promise.resolve()}let r=t.sharedFolder,n={guid:t.guid,path:r.getPath(t.path),doc:t,status:"pending",sharedFolder:r};this.inProgressSyncs.add(t.guid);let s=new Promise((a,i)=>{this.syncCompletionCallbacks.set(t.guid,{resolve:a,reject:i})});return this.syncQueue.push(n),this.syncQueue.sort(Xa),this.processSyncQueue(),s}getAuthHeader(t){var r;return{Authorization:Ot().enableDocumentServer?`Bearer ${t.token}`:`Bearer ${(r=this.loginManager.user)==null?void 0:r.token}`}}getBaseUrl(t,r){var i;let n=new URL(t.url);n.protocol="https:";let s=n.pathname.split("/");s.pop(),s.push(t.docId),n.pathname=s.join("/");let a=((i=t.baseUrl)==null?void 0:i.replace(/\/$/,""))||n.toString();return Ot().enableDocumentServer?a:`https://api.system3.md/relay/${r.relayId}/doc/${r.documentId}`}async downloadItem(t){let r=t.s3rn;if(this.log("[downloadItem]",t.path,`${Xt.encode(r)}`),!(r instanceof Wr))throw new Error("Unable to decode S3RN");let n=await t.getProviderToken(),s=this.getAuthHeader(n),a=this.getBaseUrl(n,r),i=`${a}/as-update`,l=await(0,Dd.requestUrl)({url:i,method:"GET",headers:s});return l.status===200?this.debug("[downloadItem]",r.documentId,l.status):this.error("[downloadItem]",r.documentId,a,l.status,l.text),l}async syncDocumentWebsocket(t){let r=t.text,n="";try{n=await t.sharedFolder.read(t)}catch(l){}if(!(r===n)&&n)return this.log("file is not tracking local disk. resolve merge conflicts before syncing."),!1;let a=t.onceProviderSynced(),i=t.intent;return t.connect(),i==="disconnected"&&!t.userLock&&await a,i==="disconnected"&&!t.userLock&&(t.disconnect(),t.sharedFolder.tokenStore.removeFromRefreshQueue(Xt.encode(t.s3rn))),!0}async uploadItem(t){let r=t.s3rn;if(this.log("[uploadItem]",`${Xt.encode(r)}`),!(r instanceof Wr))throw new Error("Unable to decode S3RN");if(!this.loginManager.loggedIn)throw new Error("Not logged in");let n=await t.getProviderToken(),s={"Content-Type":"application/octet-stream",...this.getAuthHeader(n)},a=An(t.ydoc),l=`${this.getBaseUrl(n,r)}/update`,f=await(0,Dd.requestUrl)({url:l,method:"POST",headers:s,body:a.buffer,throw:!1});return f.status===200?this.debug("[uploadItem]",r.documentId,f.status,f.text):this.error("[uploadItem]",r.documentId,l,f.status,f.text),f}async getDocument(t,r=3,n=3e3){try{let s=t.text,a="";try{a=await t.sharedFolder.read(t)}catch(_){}let i=s===a,l=a!=="",u=(await this.downloadItem(t)).arrayBuffer,d=new Uint8Array(u),m=new mr;Mo(m,d);let x=m.getMap("users");if(m.getText("contents").toString()===""){if(x.size===0){this.log("[getDocument] Server contains uninitialized document. Waiting for peer to upload.",x.size,r,n),r>0&&this.timeProvider.setTimeout(()=>{this.getDocument(t,r-1,n*2)},n);return}if(t.text){this.log("[getDocument] local crdt has contents, but remote is empty"),this.enqueueSync(t);return}}if(this.log("[getDocument] applying content from server"),Mo(t.ydoc,d),l&&!i){this.log("Skipping flush - file requires merge conflict resolution.");return}t.sharedFolder.syncStore.has(t.path)&&(t.sharedFolder.flush(t,t.text),this.log("[getDocument] flushed"))}catch(s){throw this.error(s),s}}async syncItem(t){let r=t.text,n="";try{n=await t.sharedFolder.read(t)}catch(m){}if(!(r===n))return this.log("file is not tracking local disk. resolve merge conflicts before syncing."),!1;let a=await this.downloadItem(t);if(a.status!==200)return this.log("server returned an error."),!1;let i=a.arrayBuffer,l=new Uint8Array(i),f=new mr;Mo(f,l);let u=f.getText("contents").toString();return f.getMap("users").size>0&&u===r||(Mo(t.ydoc,l),t.sharedFolder.flush(t,t.text),this.uploadItem(t)),!0}async syncDocument(t){var r;try{Ot().enableHTTPSync&&((r=t.sharedFolder.remote)!=null&&r.relay.provider)?await this.syncItem(t):(this.debug("fallback to websocket sync"),await this.syncDocumentWebsocket(t))}catch(n){console.error(n);return}}subscribeToSync(t){return this.activeSync.subscribe(t)}subscribeToDownloads(t){return this.activeDownloads.subscribe(t)}subscribeToSyncGroups(t){return this.syncGroups.subscribe(t)}subscribeToProgress(t){let r=()=>{t(this.getOverallProgress())},n=this.activeSync.subscribe(()=>r()),s=this.activeDownloads.subscribe(()=>r()),a=this.syncGroups.subscribe(()=>r());return()=>{n(),s(),a()}}subscribeToGroupProgress(t,r){return this.syncGroups.subscribe(()=>{r(this.getGroupProgress(t))})}pause(){this.isPaused=!0}resume(){this.debug("starting"),this.isPaused=!1,this.processSyncQueue(),this.processDownloadQueue()}getQueueStatus(){return{syncsQueued:this.syncQueue.length,syncsActive:this.activeSync.size,downloadsQueued:this.downloadQueue.length,downloadsActive:this.activeDownloads.size,isPaused:this.isPaused}}destroy(){for(let[t,r]of this.syncCompletionCallbacks)r.reject(new Error("BackgroundSync destroyed")),this.syncCompletionCallbacks.delete(t);for(let[t,r]of this.downloadCompletionCallbacks)r.reject(new Error("BackgroundSync destroyed")),this.downloadCompletionCallbacks.delete(t);this.activeSync.destroy(),this.activeDownloads.destroy(),this.syncGroups.destroy(),this.syncQueue=[],this.downloadQueue=[],this.inProgressSyncs.clear(),this.inProgressDownloads.clear(),this.loggedItems.clear(),this.loginManager=null,this.timeProvider=null,this.subscriptions.forEach(t=>t())}};var Ul=class{constructor(e,t){this.app=e;this.difference=t.difference,this.file1=t.file1,this.file2=t.file2,this.file1Content=t.file1Content,this.file2Content=t.file2Content,this.triggerRebuild=t.triggerRebuild}async modify(e,t){if(e instanceof wt){ey(e.ydoc,t);return}else if(e instanceof nn){e.contents=t;return}await this.app.vault.modify(e,t)}build(e){let t=e.createDiv({cls:"flex flex-row gap-1 py-0-5"}),r=this.difference.file1Lines.length>0,n=this.difference.file2Lines.length>0;n&&r?(new cr({text:"Accept Top (Editor)",onClick:s=>this.acceptTopClick(s,this.difference)}).build(t),co.build(t),new cr({text:"Accept Bottom (Local Disk)",onClick:s=>this.acceptBottomClick(s,this.difference)}).build(t),co.build(t),new cr({text:"Accept All",onClick:s=>this.acceptAllClick(s,this.difference)}).build(t),co.build(t),new cr({text:"Accept None",onClick:s=>this.acceptNoneClick(s,this.difference)}).build(t)):r?(new cr({text:"Keep in Editor",onClick:s=>this.insertFile1Difference(s,this.difference)}).build(t),co.build(t),new cr({text:"Discard in Editor",onClick:s=>this.discardFile1Difference(s,this.difference)}).build(t)):n&&(new cr({text:"Accept from Local Disk",onClick:s=>this.insertFile2Difference(s,this.difference)}).build(t),co.build(t),new cr({text:"Discard on Disk",onClick:s=>this.discardFile2Difference(s,this.difference)}).build(t))}async acceptTopClick(e,t){e.preventDefault();let r=t.file1Lines.join(`
`),n=Ya({fullText:this.file2Content,newLine:r,position:t.file2Start,linesToReplace:t.file2Lines.length});await this.modify(this.file2,n),this.triggerRebuild()}async acceptBottomClick(e,t){e.preventDefault();let r=t.file2Lines.join(`
`),n=Ya({fullText:this.file1Content,newLine:r,position:t.file1Start,linesToReplace:t.file1Lines.length});await this.modify(this.file1,n),this.triggerRebuild()}async acceptAllClick(e,t){e.preventDefault();let r=[...t.file1Lines,...t.file2Lines].join(`
`),n=Ya({fullText:this.file1Content,newLine:r,position:t.file1Start,linesToReplace:t.file1Lines.length});await this.modify(this.file1,n);let s=Ya({fullText:this.file2Content,newLine:r,position:t.file2Start,linesToReplace:t.file2Lines.length});await this.modify(this.file2,s),this.triggerRebuild()}async acceptNoneClick(e,t){e.preventDefault();let r=Ja({fullText:this.file1Content,position:t.file1Start,count:t.file1Lines.length});await this.modify(this.file1,r);let n=Ja({fullText:this.file2Content,position:t.file2Start,count:t.file2Lines.length});await this.modify(this.file2,n),this.triggerRebuild()}async insertFile1Difference(e,t){e.preventDefault();let r=t.file1Lines.join(`
`),n=Td({fullText:this.file2Content,newLine:r,position:t.file2Start});await this.modify(this.file2,n),this.triggerRebuild()}async insertFile2Difference(e,t){e.preventDefault();let r=t.file2Lines.join(`
`),n=Td({fullText:this.file1Content,newLine:r,position:t.file1Start});await this.modify(this.file1,n),this.triggerRebuild()}async discardFile1Difference(e,t){e.preventDefault();let r=Ja({fullText:this.file1Content,position:t.file1Start,count:t.file1Lines.length});await this.modify(this.file1,r),this.triggerRebuild()}async discardFile2Difference(e,t){e.preventDefault();let r=Ja({fullText:this.file2Content,position:t.file2Start,count:t.file2Lines.length});await this.modify(this.file2,r),this.triggerRebuild()}};var qs="system3-differences-view";async function ry(o,e){o.detachLeavesOfType(qs);let t=o.getLeaf(!0);t.setViewState({type:qs,active:!0,state:e}),o.revealLeaf(t)}var $l=class extends ty.ItemView{constructor(t){super(t);this.file1Lines=[];this.file2Lines=[]}async getContent(t){return t instanceof wt?t.text:t instanceof nn?t.contents:await this.app.vault.cachedRead(t)}getViewType(){return qs}getDisplayText(){var t,r;return(t=this.state)!=null&&t.file1&&((r=this.state)!=null&&r.file2)?`File Diff: ${this.state.file1.name} and ${this.state.file2.name}`:"File Diff"}async setState(t,r){super.setState(t,r),this.state=t,await this.updateState(),this.build()}async onunload(){var t,r;(r=(t=this.state)==null?void 0:t.onResolve)==null||r.call(t)}async updateState(){var r,n;if(((r=this.state)==null?void 0:r.file1)==null||((n=this.state)==null?void 0:n.file2)==null)return;this.file1Content=await this.getContent(this.state.file1),this.file2Content=await this.getContent(this.state.file2),this.file1Lines=this.file1Content.concat(`
`).split(`
`).map(s=>s.trimEnd()),this.file2Lines=this.file2Content.concat(`
`).split(`
`).map(s=>s.trimEnd());let t=Qx(this.state.file1.path,this.state.file2.path,this.file1Lines.join(`
`),this.file2Lines.join(`
`));this.fileDifferences=Rl.fromParsedDiff(t),this.fileDifferences.differences.length===0&&this.leaf.detach()}build(){this.contentEl.empty();let t=this.contentEl.createDiv({cls:"file-diff__container"});this.buildHeader(t),this.buildLines(t),this.scrollToFirstDifference()}update(){let t=this.contentEl.scrollTop;this.contentEl.empty();let r=this.contentEl.createDiv({cls:"file-diff__container"});this.buildHeader(r),this.buildLines(r),this.contentEl.scrollTop=t}buildHeader(t){let r=t.createDiv({cls:"flex flex-row gap-1 py-0-5"});new cr({text:"Keep Editor Contents",onClick:async n=>{n.preventDefault(),await this.acceptAllFromLeft()}}).build(r),co.build(r),new cr({text:"Accept All from Local Disk",onClick:async n=>{n.preventDefault(),await this.acceptAllFromRight()}}).build(r)}async acceptAllFromLeft(){!this.state||!this.fileDifferences||(await this.app.vault.modify(this.state.file2,this.file1Content||""),this.leaf.detach())}async acceptAllFromRight(){!this.state||!this.fileDifferences||(await this.app.vault.modify(this.state.file1,this.file2Content||""),this.leaf.detach())}buildLines(t){var a,i,l;let r=0,n=0,s=Math.max(((a=this.file1Lines)==null?void 0:a.length)||0,((i=this.file2Lines)==null?void 0:i.length)||0);for(;r<=s||n<=s;){let f=(l=this.fileDifferences)==null?void 0:l.differences.find(u=>u.file1Start===r&&u.file2Start===n);if(f!=null){let u=t.createDiv({cls:"difference"});this.buildDifferenceVisualizer(u,f),r+=f.file1Lines.length,n+=f.file2Lines.length}else{let u=r<=n?this.file1Lines[r]:this.file2Lines[n];t.createDiv({text:Vs(u),cls:"file-diff__line"}),r+=1,n+=1}}}buildDifferenceVisualizer(t,r){var n;(n=this.state)!=null&&n.showMergeOption&&new Ul(this.app,{difference:r,file1:this.state.file1,file2:this.state.file2,file1Content:this.file1Content||"",file2Content:this.file2Content||"",triggerRebuild:async()=>{await this.updateState(),this.update()}}).build(t);for(let s=0;s<r.file1Lines.length;s+=1){let a=r.file1Lines[s],i=r.file2Lines[s],l=t.createDiv({cls:"file-diff__line file-diff__top-line__bg"}),f=this.buildDiffLine(a,i,"file-diff_top-line__character");(s<r.file1Lines.length-1||r.file2Lines.length!==0)&&l.classList.add("file-diff__no-bottom-border"),s!==0&&l.classList.add("file-diff__no-top-border"),l.appendChild(f)}for(let s=0;s<r.file2Lines.length;s+=1){let a=r.file1Lines[s],i=r.file2Lines[s],l=t.createDiv({cls:"file-diff__line file-diff__bottom-line__bg"}),f=this.buildDiffLine(i,a,"file-diff_bottom-line__character");(s==0&&r.file1Lines.length>0||s>0)&&l.classList.add("file-diff__no-top-border"),s<r.file2Lines.length-1&&l.classList.add("file-diff__no-bottom-border"),l.appendChild(f)}}buildDiffLine(t,r,n){let s=document.createElement("div");if(t!=null&&t.length===0)s.textContent=Vs(t);else if(t!=null&&r!=null){let a=Xx(r,t);for(let i of a){if(i.removed)continue;let l=document.createElement("span");l.textContent=Vs(i.value),i.added&&l.classList.add(n),s.appendChild(l)}}else if(t!=null&&r==null){let a=document.createElement("span");a.textContent=Vs(t),a.classList.add(n),s.appendChild(a)}else s.textContent=Vs(t);return s}scrollToFirstDifference(){var n;if(((n=this.fileDifferences)==null?void 0:n.differences.length)===0)return;let t=this.contentEl.getElementsByClassName("file-diff__container")[0].getBoundingClientRect(),r=this.contentEl.getElementsByClassName("difference")[0].getBoundingClientRect();this.contentEl.scrollTo({top:r.top-t.top-100,behavior:"smooth"})}};var L2=3;function Ad(o,e){o.iterateAllLeaves(t=>{t.view instanceof Ws.MarkdownView&&e(t.view)})}function C2(o,e){var t,r,n,s;if(o.length!==e.length)return!1;for(let a=0;a<o.length;a++)if(((t=o[a].view.file)==null?void 0:t.path)!==((r=e[a].view.file)==null?void 0:r.path)||((n=o[a].document)==null?void 0:n.path)!==((s=e[a].document)==null?void 0:s.path))return!1;return!0}var Md=class{constructor(e,t,r){this.document=null;this.canConnect=!1;this._parent=e,this.view=t,this.login=r}attach(){return this.banner=new Ns(this.view,"Login to enable Live edits",async()=>await this.login()),Promise.resolve(this)}release(){var e;(e=this.banner)==null||e.destroy()}destroy(){this.release(),this.banner=void 0,this.view=null}};function Uo(o){return o instanceof fn&&o.document!==void 0&&o.document.text!==void 0}var fn=class{constructor(e,t,r,n=!0,s=!0){this._parent=e,this.view=t,this.document=r,this._tracking=!1,this.shouldConnect=n,this.canConnect=s,e.networkStatus.online||this.offlineBanner()}toggleConnection(){this.shouldConnect=!this.shouldConnect,this.shouldConnect?this.document.connect().then(e=>{e||(this.shouldConnect=!1)}):this.document.disconnect()}get tracking(){return this._tracking}set tracking(e){let t=this._tracking;this._tracking=e,this._tracking!==t&&this.attach()}get ytext(){return this.document.ytext}mergeBanner(){return this._banner=new Ns(this.view,"Merge conflict -- click to resolve",async()=>{let e=await this.document.diskBuffer();return await this.document.checkStale()&&this._parent.openDiffView({file1:this.document,file2:e,showMergeOption:!0,onResolve:async()=>{this.document.clearDiskBuffer()}}),!0}),()=>{}}offlineBanner(){if(this.shouldConnect){let e=new Ns(this.view,"You're offline -- click to reconnect",async()=>(this._parent.networkStatus.checkStatus(),this.connect(),this._parent.networkStatus.online));this._parent.networkStatus.onceOnline(()=>{this.connect(),e.destroy()})}return()=>{}}setConnectionDot(){let e=this.view.containerEl.querySelector(".view-actions");e&&e.firstChild&&(this._viewActions||(this.clearViewActions(),this.offConnectionStatusSubscription&&this.offConnectionStatusSubscription(),this._viewActions=new Hx({target:e,anchor:e.firstChild,props:{view:this,state:this.document.state,remote:this.document.sharedFolder.remote}}),this.offConnectionStatusSubscription=this.document.subscribe(e,t=>{var r;(r=this._viewActions)==null||r.$set({view:this,state:t,remote:this.document.sharedFolder.remote})})),this._viewActions.$set({view:this,state:this.document.state,remote:this.document.sharedFolder.remote}))}clearViewActions(){let e=this.view.containerEl.querySelector(".view-actions");if(e&&e.firstChild){let t=this.view.containerEl.querySelectorAll(".system3-view-action");t.length>0&&t.forEach(r=>{r.remove()})}}async checkStale(){var t,r;let e=await this.document.checkStale();return e&&((t=this.document._diskBuffer)!=null&&t.contents)?this.mergeBanner():((r=this._banner)==null||r.destroy(),this._banner=void 0),e}attach(){return this.document.userLock=!0,this.setConnectionDot(),new Promise(e=>this.document.whenReady().then(t=>{this._parent.networkStatus.online&&this.document.sharedFolder.shouldConnect&&this.shouldConnect&&this.canConnect?this.connect():this.document.disconnect(),e(this)}).catch(()=>{this.offlineBanner()}))}connect(){this.document.connect()}release(){var e,t;(e=this._viewActions)==null||e.$destroy(),this._viewActions=void 0,(t=this._banner)==null||t.destroy(),this._banner=void 0,this.offConnectionStatusSubscription&&(this.offConnectionStatusSubscription(),this.offConnectionStatusSubscription=void 0),this.document.disconnect(),this.document.userLock=!1}destroy(){this.release(),this.clearViewActions(),this.view.leaf.rebuildView(),this._parent=null,this.view=null,this.document=null}},Bl=class{constructor(e,t,r,n){this.app=e;this.destroyed=!1;this.offListeners=[];this.folderListeners=new Map;this.workspace=e.workspace,this.sharedFolders=t,this.views=[],this.extensions=[],this._activePromise=null,this.loginManager=r,this.networkStatus=n,this.refreshQueue=[],this._compartment=new Nl.Compartment,this.log=Ce("[LiveViews]","log"),this.warn=Ce("[LiveViews]","warn"),this.metadataListeners=new Map;let s=(l,f,u)=>{let d=this.metadataListeners.get(l);d==null||d(f,u)},a=this.app.metadataCache.on("changed",s);this.offListeners.push(()=>{this.app.metadataCache.offref(a)}),this.offListeners.push(this.loginManager.on(()=>{this.refresh("[LoginManager]")}));let i=l=>(l.ready||(async()=>l.whenReady().then(()=>{this.refresh("[Shared Folder Ready]")}).catch(f=>{this.views.forEach(u=>{var d;((d=u.document)==null?void 0:d.sharedFolder)===l&&u.offlineBanner()})}))(),l.fset.on(()=>{this.refresh("[Docset]")}));this.offListeners.push(this.sharedFolders.subscribe(()=>{this.refresh("[Shared Folders]"),this.folderListeners.forEach((l,f)=>{this.sharedFolders.has(f)||(l(),this.folderListeners.delete(f))}),this.sharedFolders.forEach(l=>{this.folderListeners.has(l)||this.folderListeners.set(l,i(l))})})),Dt.set(this,"LiveViewManager")}reconfigure(e){e.dispatch({effects:this._compartment.reconfigure([cn.init(()=>this)])})}onMeta(e,t){this.metadataListeners.set(e,t)}offMeta(e){this.metadataListeners.delete(e)}openDiffView(e){ry(this.workspace,e)}goOffline(){this.log("[System 3][Relay][Live Views] going offline"),this.views.forEach(e=>{var t;return(t=e.document)==null?void 0:t.disconnect()}),this.refresh("[NetworkStatus]")}goOnline(){this.log("[System 3][Relay][Live Views] going online"),this.refresh("[NetworkStatus]"),this.sharedFolders.items().forEach(e=>{e.connect()}),this.viewsAttachedWithConnectionPool(this.views)}docIsOpen(e){return this.views.some(t=>t.document===e)}releaseViews(e){e.forEach(t=>{t.release()})}findFolders(){let e=new Set;return Ad(this.workspace,t=>{var s;let r=(s=t.file)==null?void 0:s.path;if(!r)return;let n=this.sharedFolders.lookup(r);n&&e.add(n)}),e.size==0?[]:[...e]}async foldersReady(){let e=new Set;if(Ad(this.workspace,r=>{var a;let n=(a=r.file)==null?void 0:a.path;if(!n)return;let s=this.sharedFolders.lookup(n);s&&e.add(s)}),e.size===0)return[];let t=[...e].map(r=>r.whenReady());return Promise.all(t)}async getViews(){let e=[];return Ad(this.workspace,async t=>{var s;let r=(s=t.file)==null?void 0:s.path;if(!r)return;let n=this.sharedFolders.lookup(r);if(n)if(this.loginManager.loggedIn)if(n.ready){let a=n.proxy.getDoc(r),i=new fn(this,t,a);e.push(i)}else this.log(`Folder not ready, skipping views. folder=${n.path}`);else{let a=new Md(this,t,()=>this.loginManager.openLoginPage());e.push(a)}}),e}findView(e){return this.views.find(t=>t.view.editor.cm===e)}async viewsReady(e){return await Promise.all(e.filter(t=>t instanceof fn).map(async t=>t.document.whenReady().then(r=>t)))}async viewsAttachedWithConnectionPool(e,t=L2){let r=this.workspace.getActiveViewOfType(Ws.MarkdownView),n=0,s=e.sort((i,l)=>l.view.leaf.activeTime-i.view.leaf.activeTime),a=new Set;for(let i of s)i instanceof fn&&(i.view===r||a.has(i.document)?(i.canConnect=!0,a.add(i.document)):n<t?(i.canConnect=!0,a.add(i.document),n++):i.canConnect=!1);return n>t&&this.warn(`[System 3][Relay][Live Views] connection pool (max ${t}): rejected connections for ${n-t} views`),this.viewsAttached(e)}async viewsAttached(e){return await Promise.all(e.map(async t=>t.attach()))}deduplicate(e){let t=[],r=[];return this.views.forEach(n=>{let s=e.find(a=>{if(n.document==a.document&&n.view==a.view)return!0});s?(r.push(n),e.remove(s)):t.push(n)}),e.forEach(n=>{r.push(n)}),[r,t]}async _refreshViews(e,t){let r=`[LiveViews][${e}]`,n=Ce(r,"debug"),s=(d,m)=>{n(d,m.map(x=>{var h;return{type:x.constructor.name,file:(h=x.document)==null?void 0:h.path,canConnect:x.canConnect}}))};if(n("Refresh"),this.destroyed)return!1;await this.foldersReady();let a=[];try{a=await this.getViews()}catch(d){return this.warn("[System 3][Relay][Live Views] error getting views",d),!1}let i=this.findFolders();if(i.length===0&&a.length===0)return this.extensions.length!==0&&(n("Unexpected plugins loaded."),this.wipe()),s("Releasing Views",this.views),this.releaseViews(this.views),this.views=[],!0;this.loginManager.loggedIn&&this.networkStatus.online?i.forEach(d=>{d.connect()}):this.sharedFolders.forEach(d=>{d.disconnect()});let[l,f]=this.deduplicate(a);if(s("Releasing Views",f),this.releaseViews(f),f.length===0&&C2(l,this.views)){let d=await this.viewsAttachedWithConnectionPool(this.views);s("Attached Views",d)}else{let d=await this.viewsReady(l);s("Ready Views",d);let m=await this.viewsAttachedWithConnectionPool(d);s("Attached Views",m),this.views=l}n("loading plugins"),this.load();let u=Ws.moment.utc();return n(`refresh completed in ${u.diff(t)}ms`,r),!0}async refresh(e){if(this.destroyed)return!1;let t=Ce(e,"warn"),r=Ws.moment.utc();if(this.refreshQueue.push(()=>this._refreshViews(e,r)),this._activePromise!==null)return!1;for(;this.refreshQueue.length>0;){if(this.destroyed)return!1;this.refreshQueue.length>2&&t("refreshQueue size:",this.refreshQueue.length);let n=this.refreshQueue.pop();this.refreshQueue.length=0,this._activePromise=n().finally(()=>{this._activePromise=null}),await this._activePromise}return!0}wipe(){this.extensions.length=0,this.workspace.updateOptions()}load(){this.wipe(),this.views.length>0&&(this.extensions.push([this._compartment.of(cn.init(()=>this)),Wx,zx,Kx,jx]),this.workspace.updateOptions())}destroy(){this.destroyed=!0,this.releaseViews(this.views),this.offListeners.forEach(e=>e()),this.offListeners.length=0,this.metadataListeners.clear(),this.metadataListeners=null,this.folderListeners.forEach(e=>e()),this.folderListeners.clear(),this.folderListeners=null,this.views.forEach(e=>e.destroy()),this.views=[],this.wipe(),this.sharedFolders=null,this.refreshQueue=null,this.networkStatus=null,this._activePromise=null,this.loginManager=null,this.app=null,this.workspace=null}},cn=Nl.StateField.define({create(o){},update(o,e){return o}});var zs=require("obsidian");function T2(o){Pe(o,"svelte-1siabfk",".system3-folder-icons.svelte-1siabfk{display:inline-flex;align-items:center;vertical-align:middle;border-radius:var(--radius-m);transition:width 0.3s ease;margin-right:0.6em;padding-left:0.2em;padding-right:0.2em;background-color:var(--color-base-05);position:relative}.system3-icon.svelte-1siabfk{margin-right:0.2em;margin-left:0.2em;width:1em;display:flex;transition:display 0.3s ease}span.system3-connected.svelte-1siabfk{color:var(--color-accent)}span.system3-disconnected.svelte-1siabfk{color:var(--color-base-40)}span.notebook.svelte-1siabfk{color:var(--color-accent)}span.hidden.svelte-1siabfk{display:none}.system3-progress-text.svelte-1siabfk{margin-right:0.4em;font-size:0.8em;color:var(--color-accent);opacity:1;transition:opacity 0.3s ease}.system3-progress-text.completed.svelte-1siabfk{animation:svelte-1siabfk-fadeOutDelay 0.3s ease forwards}.system3-progress-text.failed.svelte-1siabfk{color:var(--color-red)}@keyframes svelte-1siabfk-fadeOutDelay{0%,50%{opacity:1}100%{opacity:0;display:none}}")}function oy(o){let e,t,r,n;return{c(){e=P("span"),t=K(o[3]),r=K("%"),b(e,"class",n="system3-progress-text system3-"+o[4]+" svelte-1siabfk"),ue(e,"opacity","1")},m(s,a){T(s,e,a),k(e,t),k(e,r)},p(s,a){a&8&&se(t,s[3]),a&16&&n!==(n="system3-progress-text system3-"+s[4]+" svelte-1siabfk")&&b(e,"class",n)},d(s){s&&C(e)}}}function P2(o){let e,t,r;return t=new Oo({props:{class:"inline-icon",style:"width: 0.8em"}}),{c(){e=P("span"),V(t.$$.fragment),b(e,"class","notebook system3-icon svelte-1siabfk"),b(e,"aria-label","Tracking Changes")},m(n,s){T(n,e,s),N(t,e,null),r=!0},p:X,i(n){r||(L(t.$$.fragment,n),r=!0)},o(n){D(t.$$.fragment,n),r=!1},d(n){n&&C(e),H(t)}}}function D2(o){let e,t,r,n,s,a,i,l;return t=new Oo({props:{class:"inline-icon",style:"width: 0.8em"}}),s=new Bn({props:{class:"inline-icon"}}),{c(){var f;e=P("span"),V(t.$$.fragment),r=B(),n=P("span"),V(s.$$.fragment),b(e,"class","notebook system3-icon hidden svelte-1siabfk"),b(e,"aria-label","Tracking Changes"),b(n,"class",a="satellite system3-icon system3-"+o[0]+" svelte-1siabfk"),b(n,"aria-label",i=`${((f=o[2])==null?void 0:f.relay.name)||"Relay Server"} (${o[0]})`)},m(f,u){T(f,e,u),N(t,e,null),T(f,r,u),T(f,n,u),N(s,n,null),l=!0},p(f,u){var d;(!l||u&1&&a!==(a="satellite system3-icon system3-"+f[0]+" svelte-1siabfk"))&&b(n,"class",a),(!l||u&5&&i!==(i=`${((d=f[2])==null?void 0:d.relay.name)||"Relay Server"} (${f[0]})`))&&b(n,"aria-label",i)},i(f){l||(L(t.$$.fragment,f),L(s.$$.fragment,f),l=!0)},o(f){D(t.$$.fragment,f),D(s.$$.fragment,f),l=!1},d(f){f&&(C(e),C(r),C(n)),H(t),H(s)}}}function A2(o){let e,t,r,n,s,a=o[5]&&oy(o),i=[D2,P2],l=[];function f(u,d){return u[1]?0:1}return r=f(o,-1),n=l[r]=i[r](o),{c(){e=P("div"),a&&a.c(),t=B(),n.c(),b(e,"class","system3-folder-icons svelte-1siabfk")},m(u,d){T(u,e,d),a&&a.m(e,null),k(e,t),l[r].m(e,null),s=!0},p(u,[d]){u[5]?a?a.p(u,d):(a=oy(u),a.c(),a.m(e,t)):a&&(a.d(1),a=null);let m=r;r=f(u,d),r===m?l[r].p(u,d):(be(),D(l[m],1,1,()=>{l[m]=null}),we(),n=l[r],n?n.p(u,d):(n=l[r]=i[r](u),n.c()),L(n,1),n.m(e,null))},i(u){s||(L(n),s=!0)},o(u){D(n),s=!1},d(u){u&&C(e),a&&a.d(),l[r].d()}}}function M2(o,e,t){let r,{status:n="disconnected"}=e,{relayId:s}=e,{remote:a}=e,{progress:i=0}=e,{syncStatus:l="pending"}=e;return o.$$set=f=>{"status"in f&&t(0,n=f.status),"relayId"in f&&t(1,s=f.relayId),"remote"in f&&t(2,a=f.remote),"progress"in f&&t(3,i=f.progress),"syncStatus"in f&&t(4,l=f.syncStatus)},o.$$.update=()=>{if(o.$$.dirty&24){e:t(5,r=(l!=="completed"||i<100)&&i>0)}},[n,s,a,i,l,r]}var Ed=class extends Z{constructor(e){super(),ee(this,e,M2,A2,Q,{status:0,relayId:1,remote:2,progress:3,syncStatus:4},T2)}},ny=Ed;function E2(o){Pe(o,"svelte-1swndfj",".system3-filepill.svelte-1swndfj{text-wrap:nowrap}")}function F2(o){let e,t,r;return{c(){e=P("div"),t=P("span"),r=K(o[0]),b(e,"class","nav-file-tag system3-filepill svelte-1swndfj"),b(e,"aria-label",o[1])},m(n,s){T(n,e,s),k(e,t),k(t,r)},p(n,[s]){s&1&&se(r,n[0]),s&2&&b(e,"aria-label",n[1])},i:X,o:X,d(n){n&&C(e)}}}function R2(o,e,t){let{text:r}=e,{label:n}=e;return o.$$set=s=>{"text"in s&&t(0,r=s.text),"label"in s&&t(1,n=s.label)},[r,n]}var Fd=class extends Z{constructor(e){super(),ee(this,e,R2,F2,Q,{text:0,label:1},E2)}},Qa=Fd;var Rd=class{constructor(e,t){this.el=e,this.mutationObserver=new MutationObserver((r,n)=>{for(let s of r)s.type==="childList"&&e.nextSibling&&(t(e),n.disconnect())}),this.mutationObserver.observe(e.parentElement,{childList:!0,subtree:!0})}destroy(){var e;(e=this.mutationObserver)==null||e.disconnect(),this.mutationObserver=null}},No=class{visitFolder(e,t,r,n){return null}visitFile(e,t,r,n){return null}},Od=class{constructor(e,t){this.el=e,this.sharedFolder=t,this.siblingWatcher=new Rd(this.el,r=>{this.add()}),this.add()}add(){var e;(e=this.el.nextSibling)==null||e.addClass("system3-live")}remove(){var e;(e=this.el.nextSibling)==null||e.removeClass("system3-live")}destroy(){this.siblingWatcher.destroy(),this.remove()}},Ud=class extends No{visitFolder(e,t,r,n){return n&&n.path===e.path?r||new Od(t.selfEl,n):(r&&r.destroy(),null)}},$d=class{constructor(e,t){this.sharedFolder=t;let r=e.querySelectorAll(".system3-folder-icons");r.length>1&&(r==null||r.forEach(s=>{s.remove()})),this.el=e,this.el.addClass("system3-pill"),this.pill=new ny({target:this.el,props:{status:this.sharedFolder.state.status,relayId:this.sharedFolder.relayId,remote:this.sharedFolder.remote,progress:0,syncStatus:"pending"}});let n=[];n.push(this.sharedFolder.subscribe(this.el,s=>{this.pill.$set({status:s.status,relayId:this.sharedFolder.relayId,remote:this.sharedFolder.remote})})),n.push(this.sharedFolder.backgroundSync.subscribeToGroupProgress(this.sharedFolder,s=>{s&&this.pill.$set({progress:s.percent,syncStatus:s.status})})),this.unsubscribe=()=>n.forEach(s=>s())}destroy(){this.pill.$destroy(),this.unsubscribe(),this.el.removeClass("system3-pill")}},Bd=class extends No{visitFolder(e,t,r,n){return n&&n.path===e.path?r||new $d(t.selfEl,n):(r&&r.destroy(),null)}},Nd=class{constructor(e,t,r,n){this.el=e;this.path=t;this.activeSync=r;this.activeDownloads=n;this.unsubscribers=[];this.titleEl=e.querySelector(".nav-file-title")||e,this.unsubscribers.push(this.activeSync.subscribe(()=>this.checkStatus()),this.activeDownloads.subscribe(()=>this.checkStatus())),this.checkStatus()}checkStatus(){let e=this.activeSync.some(r=>r.path===this.path),t=this.activeDownloads.some(r=>r.path===this.path);e?this.titleEl.addClass("system3-syncing"):this.titleEl.removeClass("system3-syncing"),t?this.titleEl.addClass("system3-downloading"):this.titleEl.removeClass("system3-downloading")}destroy(){this.titleEl.removeClass("system3-uploading"),this.titleEl.removeClass("system3-downloading"),this.unsubscribers.forEach(e=>e())}},Hd=class extends No{constructor(t,r){super();this.activeSync=t;this.activeDownloads=r}visitFile(t,r,n,s){return s&&s.ready&&s.checkPath(t.path)&&wt.checkExtension(t.path)?n||new Nd(r.el,t.path,this.activeSync,this.activeDownloads):(n&&n.destroy(),null)}},Vd=class{constructor(e,t){this.el=e;this.file=t;if(this.el.querySelectorAll(".system3-filepill").forEach(r=>{r.remove()}),t instanceof wt){this.pill=new Qa({target:this.el,props:{text:`${t.guid.slice(0,3)} ${t.dbsize}`}});let r=()=>{this.pill.$set({text:`${t.guid.slice(0,3)} ${t.dbsize}`})};t.whenReady().then(()=>{t.ydoc.on("update",r),r()}),this.unsubscribe=()=>{t.ydoc.off("update",r)}}else this.pill=new Qa({target:this.el,props:{text:`${t.guid.slice(0,4)}`}})}destroy(){var e;this.pill.$destroy(),(e=this.unsubscribe)==null||e.call(this),this.el.querySelectorAll(".system3-filepill").forEach(t=>{t.remove()})}},qd=class extends No{visitFile(e,t,r,n){if(n&&n.ready){if(!Ot().enableDebugFileTag)return null;let s=n.proxy.viewDoc(e.path);return!Fo(s)&&!s||!s.ready?null:r||new Vd(t.selfEl,s)}return r&&r.destroy(),null}},Wd=class{constructor(e){this.el=e;this.el.querySelectorAll(".system3-filepill").forEach(t=>{t.remove()}),this.pill=new Qa({target:this.el,props:{text:"NOT SYNCED",label:"Syncing this file type is disabled"}})}destroy(){this.pill.$destroy(),this.el.querySelectorAll(".system3-filepill").forEach(e=>{e.remove()})}},zd=class extends No{visitFile(e,t,r,n){return n&&!n.isSyncableTFile(e)?r||new Wd(t.selfEl):(r&&r.destroy(),null)}},Kd=class{constructor(e,t,r){this.el=e,this.document=t,this.document.subscribe(e,n=>{this.docStatus(n)}),this.docStatus(this.document.state)}docStatus(e){(e==null?void 0:e.status)==="connected"?(this.el.removeClass("system3-connecting"),this.el.addClass("system3-connected"),this.el.addClass("system3-live")):(e==null?void 0:e.status)==="connecting"?(this.el.removeClass("system3-connected"),this.el.addClass("system3-connecting"),this.el.addClass("system3-live")):(e==null?void 0:e.status)==="disconnected"?(this.el.addClass("system3-live"),this.el.removeClass("system3-connected"),this.el.removeClass("system3-connecting")):(this.el.removeClass("system3-connected"),this.el.removeClass("system3-connecting"),this.el.removeClass("system3-live"))}destroy(){var e;(e=this.document)==null||e.unsubscribe(this.el),this.docStatus()}},Gd=class extends No{visitFile(e,t,r,n){if(n)try{let s=n.getVirtualPath(e.path),a=n.syncStore.get(s);if(!a)return null;let i=n.files.get(a);return!(i instanceof wt)||!i?null:r||new Kd(t.el,i,e)}catch(s){return null}return r&&r.destroy(),null}},jd=class{constructor(e){this.el=e;this.el.querySelectorAll(".system3-filepill").forEach(t=>{t.remove()}),this.pill=new Qa({target:this.el,props:{text:"DESYNC",label:"File content does not match document content"}})}destroy(){this.pill.$destroy(),this.el.querySelectorAll(".system3-filepill").forEach(e=>{e.remove()})}},Yd=class extends No{visitFile(e,t,r,n){if(n&&wt.checkExtension(e.path)){let s=n.proxy.viewDoc(e.path);if(!s||!s.ready)return null;if(e.stat.size!==s.stat.size)return r||new jd(t.selfEl)}return r&&r.destroy(),null}},Hl=class{constructor(e,t,r){this.fileExplorer=e,this.sharedFolders=t,this.visitors=r,this.storage=new Map;for(let n of this.visitors)this.storage.set(n,new Map)}_getFileExplorerItem(e){try{return this.fileExplorer.view.fileItems[e]}catch(t){return null}}getFileExplorerItem(e,t){return typeof t=="string"?this._getFileExplorerItem(t):this._getFileExplorerItem(t.path)}walk(e,t){if(this.fileExplorer.view.getViewType()!=="file-explorer")return;let r=this.sharedFolders.find(s=>s.path===e.path)||t,n=this.getFileExplorerItem(this.fileExplorer,e);n&&this.storage.forEach((s,a)=>{let i=s.get(n),l=a.visitFolder(e,n,i,r);i&&!l?s.delete(n):l&&s.set(n,l)}),e.children.forEach(s=>{if(s instanceof zs.TFolder)this.walk(s,r);else if(s instanceof zs.TFile){let a=this.getFileExplorerItem(this.fileExplorer,s);if(!a)return;this.storage.forEach((i,l)=>{let f=i.get(a),u=l.visitFile(s,a,f,r);f&&!u?i.delete(a):u&&i.set(a,u)})}})}destroy(){this.storage.forEach(e=>{e.forEach(t=>{t.destroy()})})}},Vl=class{constructor(e,t,r,n){this.layoutReady=!1;this.queueSubscriptions=[];this.vault=e,this.workspace=t,this.sharedFolders=r,this.backgroundSync=n,this.treeState=new Map,this.workspace.onLayoutReady(()=>{this.layoutReady=!0,this.refresh()}),this.queueSubscriptions.push(n.activeSync.subscribe(()=>this.quickRefresh()),n.activeDownloads.subscribe(()=>this.quickRefresh()),n.syncGroups.subscribe(()=>this.quickRefresh())),this.offDocumentListeners=new Map,this.offFolderListener=this.sharedFolders.subscribe(()=>{this.sharedFolders.forEach(s=>{gx([Ar.enableDocumentStatus,Ar.enableDebugFileTag],()=>{this.offDocumentListeners.get(s)||this.offDocumentListeners.set(s,s.fset.on(()=>{this.refresh()}))}),s.whenReady().then(()=>{this.refresh()})}),this.refresh()}),this.offLayoutChange=(()=>{let s=this.workspace.on("layout-change",()=>this.quickRefresh());return()=>{this.workspace.offref(s)}})()}makeVisitors(){let e=[];return e.push(new Ud),e.push(new Bd),io(Ar.enableDocumentStatus,()=>{e.push(new Gd),e.push(new Hd(this.backgroundSync.activeSync,this.backgroundSync.activeDownloads))}),io(Ar.enableDebugFileTag,()=>{e.push(new qd)}),io(Ar.enableDesyncPill,()=>{e.push(new Yd)}),e.push(new zd),e}getFileExplorers(){let e=[];return this.workspace.iterateAllLeaves(t=>{t.view.getViewType()==="file-explorer"&&(e.includes(t)||e.push(t))}),e}quickRefresh(){if(!this.layoutReady)return;let e=this.getFileExplorers(),t=this.sharedFolders.map(r=>r.path);for(let r of e){let n=this.treeState.get(r)||new Hl(r,this.sharedFolders,this.makeVisitors());this.treeState.set(r,n);for(let s of t){let a=this.vault.getAbstractFileByPath(s);a instanceof zs.TFolder&&n.walk(a)}}}refresh(){if(!this.layoutReady)return;let e=this.getFileExplorers();for(let t of e){let r=this.treeState.get(t)||new Hl(t,this.sharedFolders,this.makeVisitors());this.treeState.set(t,r);let n=this.vault.getAbstractFileByPath("/");n instanceof zs.TFolder&&r.walk(n)}}destroy(){var e;(e=this.offFolderListener)==null||e.call(this),this.offDocumentListeners.forEach(t=>t()),this.offDocumentListeners.clear(),this.treeState.forEach(t=>{t.destroy()}),this.treeState.clear(),this.offLayoutChange(),this.queueSubscriptions.forEach(t=>t()),this.queueSubscriptions=[],this.vault=null,this.workspace=null,this.sharedFolders=null,this.backgroundSync=null,this.offFolderListener=null}};var gb=require("obsidian");function Ge(o,e,t,r){function n(s){return s instanceof t?s:new t(function(a){a(s)})}return new(t||(t=Promise))(function(s,a){function i(u){try{f(r.next(u))}catch(d){a(d)}}function l(u){try{f(r.throw(u))}catch(d){a(d)}}function f(u){u.done?s(u.value):n(u.value).then(i,l)}f((r=r.apply(o,e||[])).next())})}var un=require("obsidian");function O2(o){let e,t,r;return{c(){e=zr("svg"),t=zr("g"),r=zr("path"),b(r,"d","M216.856339,16.5966031 C200.285002,8.84328665 182.566144,3.2084988 164.041564,0 C161.766523,4.11318106 159.108624,9.64549908 157.276099,14.0464379 C137.583995,11.0849896 118.072967,11.0849896 98.7430163,14.0464379 C96.9108417,9.64549908 94.1925838,4.11318106 91.8971895,0 C73.3526068,3.2084988 55.6133949,8.86399117 39.0420583,16.6376612 C5.61752293,67.146514 -3.4433191,116.400813 1.08711069,164.955721 C23.2560196,181.510915 44.7403634,191.567697 65.8621325,198.148576 C71.0772151,190.971126 75.7283628,183.341335 79.7352139,175.300261 C72.104019,172.400575 64.7949724,168.822202 57.8887866,164.667963 C59.7209612,163.310589 61.5131304,161.891452 63.2445898,160.431257 C105.36741,180.133187 151.134928,180.133187 192.754523,160.431257 C194.506336,161.891452 196.298154,163.310589 198.110326,164.667963 C191.183787,168.842556 183.854737,172.420929 176.223542,175.320965 C180.230393,183.341335 184.861538,190.991831 190.096624,198.16893 C211.238746,191.588051 232.743023,181.531619 254.911949,164.955721 C260.227747,108.668201 245.831087,59.8662432 216.856339,16.5966031 Z M85.4738752,135.09489 C72.8290281,135.09489 62.4592217,123.290155 62.4592217,108.914901 C62.4592217,94.5396472 72.607595,82.7145587 85.4738752,82.7145587 C98.3405064,82.7145587 108.709962,94.5189427 108.488529,108.914901 C108.508531,123.290155 98.3405064,135.09489 85.4738752,135.09489 Z M170.525237,135.09489 C157.88039,135.09489 147.510584,123.290155 147.510584,108.914901 C147.510584,94.5396472 157.658606,82.7145587 170.525237,82.7145587 C183.391518,82.7145587 193.761324,94.5189427 193.539891,108.914901 C193.539891,123.290155 183.391518,135.09489 170.525237,135.09489 Z"),b(r,"fill","#5865F2"),b(r,"fill-rule","nonzero"),b(e,"width",o[0]),b(e,"height",o[0]),b(e,"viewBox","0 -28.5 256 256"),b(e,"version","1.1"),b(e,"xmlns","http://www.w3.org/2000/svg"),b(e,"xmlns:xlink","http://www.w3.org/1999/xlink"),b(e,"preserveAspectRatio","xMidYMid")},m(n,s){T(n,e,s),k(e,t),k(t,r)},p(n,[s]){s&1&&b(e,"width",n[0]),s&1&&b(e,"height",n[0])},i:X,o:X,d(n){n&&C(e)}}}function U2(o,e,t){let{size:r="1em"}=e;return o.$$set=n=>{"size"in n&&t(0,r=n.size)},[r]}var Jd=class extends Z{constructor(e){super(),ee(this,e,U2,O2,Q,{size:0})}},ql=Jd;function $2(o){Pe(o,"svelte-4t8k3t",`.menu-container.svelte-4t8k3t{display:inline-block;position:relative}.menu-button.svelte-4t8k3t{box-shadow:none;padding:8px;border:none;background:transparent;color:var(--text-muted)}.menu-button.svelte-4t8k3t:hover{color:var(--icon-color-hover)}.menu-button.svelte-4t8k3t:focus{color:var(--icon-color-focus)}.menu-dropdown.svelte-4t8k3t{position:absolute;right:0;margin-top:8px;width:224px;background:var(--color-base-10);border-radius:6px;box-shadow:0 4px 6px -1px rgba(0, 0, 0, 0.1),
			0 2px 4px -1px rgba(0, 0, 0, 0.06);border:1px solid rgba(0, 0, 0, 0.1)}.arrow.svelte-4t8k3t{position:absolute;top:-5px;right:12px;width:10px;height:10px;background:var(--color-base-10);border-left:1px solid rgba(0, 0, 0, 0.1);border-top:1px solid rgba(0, 0, 0, 0.1);transform:rotate(45deg)}.menu-content.svelte-4t8k3t{display:flex;flex-direction:column;gap:8px;padding:8px}.menu-item.svelte-4t8k3t{display:flex;width:100%;align-items:center;gap:12px;padding:8px;border-radius:4px;text-decoration:none;color:var(--text-muted);transition:background-color 0.2s;font-size:14px}.menu-item.svelte-4t8k3t:hover{background-color:var(--background-modifier-hover)}.menu-item.svelte-4t8k3t:focus{background-color:var(--background-modifier-hover)}`)}function sy(o){let e,t,r,n,s,a,i,l,f,u,d,m,x;return i=new ql({props:{size:20}}),{c(){e=P("div"),t=P("div"),r=B(),n=P("div"),s=P("span"),a=P("a"),V(i.$$.fragment),l=B(),f=P("span"),f.textContent="Join the community",b(t,"class","arrow svelte-4t8k3t"),b(a,"href","https://discord.system3.md"),b(a,"target","_blank"),b(a,"rel","noopener noreferrer"),b(a,"class","menu-item svelte-4t8k3t"),ue(s,"text-align","center"),ue(s,"display","flex"),b(n,"class","menu-content svelte-4t8k3t"),b(e,"class","menu-dropdown svelte-4t8k3t")},m(h,_){T(h,e,_),k(e,t),k(e,r),k(e,n),k(n,s),k(s,a),N(i,a,null),k(a,l),k(a,f),d=!0,m||(x=Ix(u=o[1].call(null,e)),m=!0)},i(h){d||(L(i.$$.fragment,h),d=!0)},o(h){D(i.$$.fragment,h),d=!1},d(h){h&&C(e),H(i),m=!1,x()}}}function B2(o){let e,t,r,n,s,a,i;r=new ed({props:{size:"20px"}});let l=o[0]&&sy(o);return{c(){e=P("div"),t=P("button"),V(r.$$.fragment),n=B(),l&&l.c(),b(t,"class","menu-button svelte-4t8k3t"),b(e,"class","menu-container svelte-4t8k3t")},m(f,u){T(f,e,u),k(e,t),N(r,t,null),k(e,n),l&&l.m(e,null),s=!0,a||(i=re(t,"click",Dx(o[2])),a=!0)},p(f,[u]){f[0]?l?u&1&&L(l,1):(l=sy(f),l.c(),L(l,1),l.m(e,null)):l&&(be(),D(l,1,1,()=>{l=null}),we())},i(f){s||(L(r.$$.fragment,f),L(l),s=!0)},o(f){D(r.$$.fragment,f),D(l),s=!1},d(f){f&&C(e),H(r),l&&l.d(),a=!1,i()}}}function N2(o,e,t){let r=!1;function n(a){let i=l=>{let f=document.querySelector(".menu-button");!a.contains(l.target)&&l.target!==f&&!(f!=null&&f.contains(l.target))&&t(0,r=!1)};return setTimeout(()=>{document.addEventListener("click",i)},0),{destroy(){document.removeEventListener("click",i)}}}function s(a){a.stopPropagation(),t(0,r=!r)}return[r,n,s]}var Xd=class extends Z{constructor(e){super(),ee(this,e,N2,B2,Q,{},$2)}},ay=Xd;function H2(o){Pe(o,"svelte-ycfe1d",".relay-text.svelte-ycfe1d{fill:var(--text-normal)}")}function V2(o){let e,t;return{c(){e=zr("svg"),t=zr("path"),b(t,"d","m112.88679 65.94517c-1.8219-.6498-2.8316-1.9996-2.8205-3.7707.019-2.9692 4.2679-9.1564 8.5532-12.4538.8896-.6846 3.2865-2.0796 5.3264-3.1002l3.7089-1.8555 1.1034-2.1157c.6069-1.1636 1.0788-2.1403 1.0487-2.1704-.03-.03-.7517.2969-1.6037.7266-1.7893.9026-3.4923 1.0179-5.6348.3816-1.2664-.376-2.6971-1.5724-3.0511-2.5512-.1036-.2865-.2262-.2926-.6259-.031-1.6133 1.0551-3.9805 2.2931-5.3124 2.7783-3.2045 1.1672-7.1579.5507-8.5509-1.3335l-.5903-.7983-1.2238.7491c-3.1246 1.9126-7.5052 2.5576-9.6905 1.4268-1.3209-.6835-2.1336-1.8529-2.3663-3.405-.099-.6587-.2706-1.1976-.3819-1.1976-.1112 0-.4909.3082-.8437.685-1.1393 1.2168-4.3891 3.211-6.2437 3.8314-4.3168 1.4441-8.0424.1949-8.8532-2.9684-.1823-.7114-.3977-1.2593-.4786-1.2177-8.2088 4.2188-13.1666 5.5617-17.3451 4.6983-7.2318-1.4943-8.5363-7.633-3.2721-15.3969 3.43-5.0586 8.1226-8.1393 12.5368-8.2303 4.2661-.088 6.1851 2.8612 4.6067 7.0798-1.4639 3.9129-6.6553 7.7738-11.3995 8.4781l-1.2322.183-.173.9219c-.2449 1.3054.055 2.3726.8414 2.9909 1.4773 1.162 5.3481.4499 9.169-1.6869 4.0877-2.286 9.2494-6.7459 10.2254-8.8353 2.1729-4.6512 10.3391-19.4528 12.6199-22.8741 1.9649-2.9472 2.9544-3.913 4.6877-4.575 2.2454-.8575 3.8556.1204 3.8556 2.3418 0 1.0627-.8749 2.8756-5.2398 10.8581-4.5459 8.3134-10.5554 20.346-10.9601 21.9446-.372 1.4696-.093 1.8547 1.0954 1.5137 3.1691-.9088 8.5727-5.615 10.728-9.3431 3.192-5.5215 7.5241-8.5901 12.516-8.8657 1.3396-.074 2.6532.01 3.3914.2166 1.585.4437 3.5318 2.2009 3.7762 3.4083.1003.4954.3584.9822.5736 1.0817 1.6112.7453 1.9862 1.0047 2.0682 1.4307.051.2665-.9529 2.6236-2.2318 5.238-1.8799 3.8432-2.328 4.9899-2.3404 5.9886l-.015 1.2352.9261.077c1.132.094 3.2883-1.1349 5.6894-3.243 2.3304-2.0459 3.4794-3.659 6.2257-8.7403 1.3371-2.4739 2.6529-4.8096 2.924-5.1906.7068-.9931 1.8337-1.3742 3.6712-1.2413 1.7839.1291 2.6563.7039 2.6563 1.7502 0 .3631-1.6536 3.8273-3.6747 7.698-3.6147 6.9231-4.2241 8.2285-3.8408 8.2285.3864 0 2.6593-1.4351 4.2082-2.6571 2.9724-2.3449 4.1289-3.8334 6.7129-8.64 3.2167-5.9836 4.0513-6.6961 7.4599-6.3685 1.5037.1444 2.3637.7781 2.3637 1.7416 0 .6971-3.7642 8.1283-7.3844 14.5783-1.1774 2.0975-2.1406 3.9288-2.1406 4.0695 0 1.0032 6.4569-2.0079 10.373-4.8373 1.75083-1.265 2.80833-1.8553 3.32363-1.8553.8396 0 1.9138.8456 1.9138 1.5065 0 1.6136-6.83683 5.3607-15.31743 8.3952l-3.0144 1.0785-3.1147 4.959c-6.6125 10.5277-11.2414 15.4863-16.0267 17.1682-1.6492.5797-2.5036.6042-3.8855.1114zm3.4676-4.0874c2.3533-1.2035 5.0029-4.3759 7.0335-8.4211 1.4729-2.9341 1.2858-3.2801-1.0497-1.9405-2.6054 1.4944-6.0792 5.1835-7.6115 8.0833-1.3391 2.5343-.6792 3.458 1.6277 2.2783zm-13.7433-25.7067c2.0798-1.3888 2.707-2.2251 5.1929-6.9235 1.1337-2.1427 2.4702-4.3736 2.9701-4.9576.4999-.5839.8343-1.1823.7432-1.3297-.3028-.49-1.5733-.2724-2.9201.5001-3.9 2.237-10.6318 12.1845-9.2087 13.6076.4489.4489 1.7491.087 3.2226-.8969zm-39.6413-6.7383c1.4951-.7532 3.4914-2.3885 4.373-3.5822.8778-1.1886.8303-2.7169-.089-2.8472-.9504-.1348-2.84 1.147-4.3353 2.9408-1.4368 1.7237-2.8652 3.8321-2.8652 4.2293 0 .3431 1.5421-.048 2.916-.7407zm-15.7519 34.9397c-7.7618-1.6901-14.6809-7.6649-17.3519-14.9834-1.0082-2.7626-2.5946-8.8926-3.6898-14.2584-.7621-3.7334-1.4567-5.8195-2.0623-6.1938-.1258-.078-.173.4384-.1049 1.147l.1238 1.2883-2.6916 5.648c-3.9954 8.3841-5.3958 10.566-7.4555 11.6168-1.4222.7256-3.7417.6896-5.2712-.082-1.0729-.541-1.1779-.6797-1.1514-1.5213.017-.5465.8143-2.6067 1.945-5.0271 3.1568-6.7568 12.4018-25.1754 13.3068-26.5105 1.1089-1.6358 2.3136-2.186 4.3772-1.9989 1.8988.1722 3.7575 1.0556 3.7575 1.7858 0 .685-.9801 3.23-2.4839 6.4499-.6712 1.437-1.2203 2.6574-1.2203 2.712 0 .2508 2.423.059 3.8048-.3005 2.1083-.5492 3.5885-1.4764 5.2895-3.3138 2.9831-3.2221 3.5133-7.5609 1.1835-9.6842-3.8351-3.4952-12.7275-2.9971-21.5226 1.2055-6.4797 3.0962-10.7971 8.141-11.8606 13.8587-.5183 2.7868-1.354 3.618-2.8384 2.8236-2.234-1.1956-1.5337-5.997 1.651-11.3196 5.1483-8.6044 15.656-14.9768 26.6996-16.192 9.3582-1.0298 17.2345 3.5198 17.8697 10.322.3469 3.7147-1.5827 8.0493-5.1855 11.6487-2.6104 2.6078-4.969 3.9861-7.9877 4.6679l-1.94.4381.8512.2875c1.5709.5307 1.8619 1.0923 3.1019 5.988 2.5245 9.9665 4.9471 14.9264 9.4592 19.3659 6.055 5.9576 14.0611 6.1192 19.4354.3922.7131-.7598 2.2084-2.7055 3.323-4.3238 1.1145-1.6182 2.2218-3.0172 2.4606-3.1088 2.1176-.8126 2.9615 1.5236 1.6137 4.4675-2.2327 4.877-6.6161 9.1629-11.4944 11.2387-4.1481 1.7652-9.8251 2.3621-13.9414 1.4657z"),b(e,"class","relay-text svelte-ycfe1d"),b(e,"width",o[0]),b(e,"height",o[1]),b(e,"viewBox","0 0 154.24573 66.293579"),b(e,"xmlns","http://www.w3.org/2000/svg")},m(r,n){T(r,e,n),k(e,t)},p:X,i:X,o:X,d(r){r&&C(e)}}}function q2(o,e,t){let{size:r=64}=e,n=r,s=r/2;return o.$$set=a=>{"size"in a&&t(2,r=a.size)},[n,s,r]}var Qd=class extends Z{constructor(e){super(),ee(this,e,q2,V2,Q,{size:2},H2)}},Wl=Qd;function W2(o){Pe(o,"svelte-120r7kg",".subtitle.svelte-120r7kg{color:var(--text-muted);font-size:1.25rem;margin:0}.description.svelte-120r7kg{color:var(--text-muted);font-size:1rem;max-width:480px;margin:0}")}function z2(o){let e,t,r,n,s,a;return e=new Wl({props:{size:140}}),{c(){V(e.$$.fragment),t=B(),r=P("p"),r.textContent="Real-time collaboration in Obsidian",n=B(),s=P("p"),s.textContent=`Share folders with your team, edit together in real time, and keep your
	knowledge library exactly how you want it.`,b(r,"class","subtitle svelte-120r7kg"),b(s,"class","description svelte-120r7kg")},m(i,l){N(e,i,l),T(i,t,l),T(i,r,l),T(i,n,l),T(i,s,l),a=!0},p:X,i(i){a||(L(e.$$.fragment,i),a=!0)},o(i){D(e.$$.fragment,i),a=!1},d(i){i&&(C(t),C(r),C(n),C(s)),H(e,i)}}}var Zd=class extends Z{constructor(e){super(),ee(this,e,null,z2,Q,{},W2)}},iy=Zd;var zl=require("obsidian");function K2(o){Pe(o,"svelte-1kvxms3",`.help-section.svelte-1kvxms3{width:100%;padding:0 2rem;margin-bottom:2rem}.footer.svelte-1kvxms3{padding:0 2rem;margin-bottom:2rem;text-align:center}.help-container.svelte-1kvxms3{position:relative;max-width:640px;margin:0 auto}.why-google.svelte-1kvxms3:hover{background-color:transparent !important;box-shadow:none;color:var(--text-modifier-hover)}.why-google.svelte-1kvxms3{outline:0;color:var(--text-muted);font-size:0.875rem;margin:0;background-color:transparent !important;box-shadow:none;text-decoration-line:var(--link-decoration);padding:0;border:none;cursor:pointer;width:100%;text-align:left}.why-google.svelte-1kvxms3:hover{color:var(--text-normal)}.help-content.svelte-1kvxms3{margin-top:8px;padding:12px 16px;background:var(--color-base-05);border-radius:4px;font-size:0.9em;color:var(--text-muted);box-shadow:inset 0 1px 3px rgba(0, 0, 0, 0.1);text-align:left}.popover.svelte-1kvxms3{position:absolute;z-index:50;width:256px;padding-left:1em;padding-right:1em;font-size:0.875rem;background-color:var(--background-primary);border:1px solid var(--background-modifier-border);border-radius:4px;box-shadow:var(--shadow-s);top:calc(100% + 8px);text-align:left;left:50%;transform:translateX(-50%);opacity:0;visibility:hidden;transition:opacity 0.3s ease,
			visibility 0.3s ease;transition-delay:0.1s}.popover.visible.svelte-1kvxms3{opacity:1;visibility:visible}.popover.svelte-1kvxms3:not(.visible){transition-delay:0s}.arrow.svelte-1kvxms3{position:absolute;width:8px;height:8px;background-color:var(--background-primary);border-top:1px solid var(--background-modifier-border);border-left:1px solid var(--background-modifier-border);transform:rotate(45deg);top:-5px;right:40px}.discord-link.svelte-1kvxms3{display:inline-flex;align-items:center;justify-content:center;gap:0.5rem;color:var(--text-muted);font-size:0.875rem;margin:0}`)}function G2(o){let e,t,r,n;return{c(){e=P("div"),t=P("div"),r=B(),n=P("p"),n.textContent=`${cy}`,b(t,"class","arrow svelte-1kvxms3"),b(e,"class","popover svelte-1kvxms3"),ze(e,"visible",o[0])},m(s,a){T(s,e,a),k(e,t),k(e,r),k(e,n),o[9](e)},p(s,a){a&1&&ze(e,"visible",s[0])},d(s){s&&C(e),o[9](null)}}}function j2(o){let e,t=o[0]&&ly(o);return{c(){t&&t.c(),e=Le()},m(r,n){t&&t.m(r,n),T(r,e,n)},p(r,n){r[0]?t?t.p(r,n):(t=ly(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&C(e),t&&t.d(r)}}}function ly(o){let e,t;return{c(){e=P("div"),t=P("p"),t.textContent=`${cy}`,b(e,"class","help-content svelte-1kvxms3")},m(r,n){T(r,e,n),k(e,t)},p:X,d(r){r&&C(e)}}}function Y2(o){let e,t,r,n,s,a,i,l,f,u,d,m;function x(w,v){return w[1]?j2:G2}let h=x(o,-1),_=h(o);return l=new ql({}),{c(){e=P("div"),t=P("div"),r=P("button"),r.textContent="Why sign in with Google?",n=B(),_.c(),s=B(),a=P("div"),i=P("a"),V(l.$$.fragment),f=K(`
		Join the project on Discord`),b(r,"class","why-google svelte-1kvxms3"),ze(r,"mobile",o[1]),b(t,"class","help-container svelte-1kvxms3"),b(e,"class","help-section svelte-1kvxms3"),b(i,"href","https://discord.system3.md"),b(i,"class","discord-link svelte-1kvxms3"),b(a,"class","footer svelte-1kvxms3")},m(w,v){T(w,e,v),k(e,t),k(t,r),o[8](r),k(t,n),_.m(t,null),T(w,s,v),T(w,a,v),k(a,i),N(l,i,null),k(i,f),u=!0,d||(m=[re(r,"mouseenter",o[4]),re(r,"mouseleave",o[5]),re(r,"click",o[6])],d=!0)},p(w,[v]){(!u||v&2)&&ze(r,"mobile",w[1]),h===(h=x(w,v))&&_?_.p(w,v):(_.d(1),_=h(w),_&&(_.c(),_.m(t,null)))},i(w){u||(L(l.$$.fragment,w),u=!0)},o(w){D(l.$$.fragment,w),u=!1},d(w){w&&(C(e),C(s),C(a)),o[8](null),_.d(),H(l),d=!1,ke(m)}}}var cy="We require sign-in because your vault needs to communicate securely with Relay servers for syncing. An identity provider like Google helps to prevent spam accounts. We may add more sign-in options based on user feedback \u2014 let us know in Discord.";function J2(o,e,t){var r;let n=!1,s=!1,a,i;function l(){s||t(0,n=!0)}function f(){s||t(0,n=!1)}function u(){s&&t(0,n=!n)}function d(x){Er[x?"unshift":"push"](()=>{a=x,t(2,a)})}function m(x){Er[x?"unshift":"push"](()=>{i=x,t(3,i)})}return o.$$.update=()=>{if(o.$$.dirty&128){e:t(1,s=t(7,r=zl.Platform===null||zl.Platform===void 0?void 0:zl.Platform.isMobile)!==null&&r!==void 0?r:!1)}},[n,s,a,i,l,f,u,r,d,m]}var ep=class extends Z{constructor(e){super(),ee(this,e,J2,Y2,Q,{},K2)}},fy=ep;var uy=[{color:"#30bced",light:"#30bced33"},{color:"#6eeb83",light:"#6eeb8333"},{color:"#ffbc42",light:"#ffbc4233"},{color:"#ecd444",light:"#ecd44433"},{color:"#ee6352",light:"#ee635233"},{color:"#9ac2c9",light:"#9ac2c933"},{color:"#8acb88",light:"#8acb8833"},{color:"#1be7ff",light:"#1be7ff33"}],Kl=class{constructor(e,t,r,n,s){this.id=e;this.name=t;this.email=r;this.picture=n;this.token=s;this.color=uy[ga()%uy.length]}};function X2(o){Pe(o,"svelte-1ym1y1w",".avatar.svelte-1ym1y1w{position:relative;border-radius:50%;overflow:hidden;display:flex;align-items:center;justify-content:center;background-color:var(--color-base-30)}.initial.svelte-1ym1y1w{color:var(--text-on-accent)}img.svelte-1ym1y1w{width:100%;height:100%;object-fit:cover}")}function Q2(o){let e,t;return{c(){e=P("span"),t=K(o[5]),b(e,"class","initial svelte-1ym1y1w"),ue(e,"font-size",o[4])},m(r,n){T(r,e,n),k(e,t)},p(r,n){n&32&&se(t,r[5]),n&16&&ue(e,"font-size",r[4])},d(r){r&&C(e)}}}function Z2(o){let e,t,r,n;return{c(){e=P("img"),Iu(e.src,t=o[0].picture)||b(e,"src",t),b(e,"alt",o[1]),b(e,"class","svelte-1ym1y1w")},m(s,a){T(s,e,a),r||(n=re(e,"error",o[6]),r=!0)},p(s,a){a&1&&!Iu(e.src,t=s[0].picture)&&b(e,"src",t),a&2&&b(e,"alt",s[1])},d(s){s&&C(e),r=!1,n()}}}function eT(o){let e;function t(s,a){return!s[3]&&s[0].picture?Z2:Q2}let r=t(o,-1),n=r(o);return{c(){e=P("div"),n.c(),b(e,"class","avatar svelte-1ym1y1w"),ue(e,"width",o[2]),ue(e,"height",o[2])},m(s,a){T(s,e,a),n.m(e,null)},p(s,[a]){r===(r=t(s,a))&&n?n.p(s,a):(n.d(1),n=r(s),n&&(n.c(),n.m(e,null))),a&4&&ue(e,"width",s[2]),a&4&&ue(e,"height",s[2])},i:X,o:X,d(s){s&&C(e),n.d()}}}function tT(o){var e;return((e=o.match(/[a-z]+$/i))===null||e===void 0?void 0:e[0])||"px"}function rT(o,e,t){let r,n,s,{user:a}=e,{alt:i="Profile picture"}=e,{size:l="40px"}=e,f=!1;function u(){t(3,f=!0)}return o.$$set=d=>{"user"in d&&t(0,a=d.user),"alt"in d&&t(1,i=d.alt),"size"in d&&t(2,l=d.size)},o.$$.update=()=>{if(o.$$.dirty&1){e:t(5,r=a.name?a.name.charAt(0).toUpperCase():"?")}if(o.$$.dirty&4){e:t(7,n=tT(l))}if(o.$$.dirty&132){e:t(4,s=`${parseFloat(l)/2}${n}`)}},[a,i,l,f,s,r,u,n]}var tp=class extends Z{constructor(e){super(),ee(this,e,rT,eT,Q,{user:0,alt:1,size:2},X2)}},dy=tp;function oT(o){let e,t,r,n,s,a=(o[0].name||"")+"",i,l,f,u,d=(o[0].email||"")+"",m,x,h,_;t=new dy({props:{size:"2.5em",user:o[0]}});let w=o[2].default,v=he(w,o,o[1],null);return{c(){e=P("div"),V(t.$$.fragment),r=B(),n=P("div"),s=P("div"),i=K(a),l=B(),f=P("br"),u=B(),m=K(d),x=B(),h=P("div"),v&&v.c(),b(s,"class","setting-item-description"),b(n,"class","setting-item-info"),ue(n,"display","grid"),b(h,"class","setting-item-control"),b(e,"class","setting-item")},m(A,U){T(A,e,U),N(t,e,null),k(e,r),k(e,n),k(n,s),k(s,i),k(s,l),k(s,f),k(s,u),k(s,m),k(e,x),k(e,h),v&&v.m(h,null),_=!0},p(A,[U]){let I={};U&1&&(I.user=A[0]),t.$set(I),(!_||U&1)&&a!==(a=(A[0].name||"")+"")&&se(i,a),(!_||U&1)&&d!==(d=(A[0].email||"")+"")&&se(m,d),v&&v.p&&(!_||U&2)&&xe(v,w,A,A[1],_?ge(w,A[1],U,null):ye(A[1]),null)},i(A){_||(L(t.$$.fragment,A),L(v,A),_=!0)},o(A){D(t.$$.fragment,A),D(v,A),_=!1},d(A){A&&C(e),H(t),v&&v.d(A)}}}function nT(o,e,t){let{$$slots:r={},$$scope:n}=e,{user:s}=e;return o.$$set=a=>{"user"in a&&t(0,s=a.user),"$$scope"in a&&t(1,n=a.$$scope)},[s,n,r]}var rp=class extends Z{constructor(e){super(),ee(this,e,nT,oT,Q,{user:0})}},py=rp;var Gl=require("obsidian");function sT(o){Pe(o,"svelte-5zjjwa",".help-container.svelte-5zjjwa{position:relative;display:inline-block}button.svelte-5zjjwa{display:flex;align-items:center;justify-content:center;width:24px;height:24px;padding:2px;margin:0;background:transparent;border:none;color:var(--text-muted);box-shadow:none;border-radius:50%}button.svelte-5zjjwa:hover{box-shadow:none;color:var(--icon-color-hover);opacity:var(--icon-opacity-hover);background-color:transparent;border-radius:0}button.svelte-5zjjwa:focus{outline:none;box-shadow:none;color:var(--icon-color-focus)}.popover.svelte-5zjjwa{position:absolute;z-index:50;width:256px;padding:8px;font-size:0.875rem;background-color:var(--background-primary);border:1px solid var(--background-modifier-border);border-radius:4px;box-shadow:var(--shadow-s);top:32px;transition-delay:0.1s}.popover.left.svelte-5zjjwa{right:100%;margin-right:8px}.popover.right.svelte-5zjjwa{left:0}.arrow.svelte-5zjjwa{position:absolute;width:8px;height:8px;background-color:var(--background-primary);border-top:1px solid var(--background-modifier-border);border-left:1px solid var(--background-modifier-border);transform:rotate(45deg);top:-5px}.arrow.left.svelte-5zjjwa{right:8px}.arrow.right.svelte-5zjjwa{left:8px}p.svelte-5zjjwa{margin:0;color:var(--text-normal)}")}function my(o){let e,t,r,n,s;return{c(){e=P("div"),t=P("div"),r=B(),n=P("p"),s=K(o[0]),b(t,"class","arrow svelte-5zjjwa"),ze(t,"left",o[4]==="left"),ze(t,"right",o[4]==="right"),b(n,"class","svelte-5zjjwa"),b(e,"class","popover svelte-5zjjwa"),ze(e,"left",o[4]==="left"),ze(e,"right",o[4]==="right")},m(a,i){T(a,e,i),k(e,t),k(e,r),k(e,n),k(n,s),o[9](e)},p(a,i){i&16&&ze(t,"left",a[4]==="left"),i&16&&ze(t,"right",a[4]==="right"),i&1&&se(s,a[0]),i&16&&ze(e,"left",a[4]==="left"),i&16&&ze(e,"right",a[4]==="right")},d(a){a&&C(e),o[9](null)}}}function aT(o){let e,t,r,n,s,a,i;r=new Wa({props:{size:16}});let l=o[1]&&my(o);return{c(){e=P("div"),t=P("button"),V(r.$$.fragment),n=B(),l&&l.c(),b(t,"type","button"),b(t,"class","svelte-5zjjwa"),b(e,"class","help-container svelte-5zjjwa")},m(f,u){T(f,e,u),k(e,t),N(r,t,null),o[8](t),k(e,n),l&&l.m(e,null),s=!0,a||(i=[re(t,"mouseenter",o[5]),re(t,"mouseleave",o[6]),re(t,"click",o[7])],a=!0)},p(f,[u]){f[1]?l?l.p(f,u):(l=my(f),l.c(),l.m(e,null)):l&&(l.d(1),l=null)},i(f){s||(L(r.$$.fragment,f),s=!0)},o(f){D(r.$$.fragment,f),s=!1},d(f){f&&C(e),H(r),o[8](null),l&&l.d(),a=!1,ke(i)}}}function iT(o,e,t){let{helpText:r}=e,n=!1,s="right",a,i;function l(){t(1,n=!0)}function f(){t(1,n=!1)}function u(){t(1,n=!n)}function d(x){Er[x?"unshift":"push"](()=>{a=x,t(2,a)})}function m(x){Er[x?"unshift":"push"](()=>{i=x,t(3,i)})}return o.$$set=x=>{"helpText"in x&&t(0,r=x.helpText)},o.$$.update=()=>{if(o.$$.dirty&14){e:if(n&&a&&i){let x=a.getBoundingClientRect(),h=i.getBoundingClientRect(),_=window.innerWidth;t(4,s=x.right+h.width>_-20?"left":"right")}}},[r,n,a,i,s,l,f,u,d,m]}var op=class extends Z{constructor(e){super(),ee(this,e,iT,aT,Q,{helpText:0},sT)}},hy=op;function lT(o){Pe(o,"svelte-1v3t6m3",".setting-item-name.svelte-1v3t6m3{display:flex;align-items:center;gap:8px}.help-button.svelte-1v3t6m3{display:flex;align-items:center;justify-content:center;width:24px;height:24px;padding:2px !important;margin:0;background:transparent;border:none;color:var(--text-muted);border-radius:50%;-webkit-tap-highlight-color:transparent}@media(hover: hover){.help-button.svelte-1v3t6m3:hover{box-shadow:none;color:var(--text-normal);background:transparent;border-radius:0}}.help-button.svelte-1v3t6m3:active{color:var(--text-normal)}.help-content.svelte-1v3t6m3{margin-top:8px;padding:12px 16px;background:var(--color-base-05);border-radius:4px;font-size:0.9em;color:var(--text-muted);box-shadow:inset 0 1px 3px rgba(0, 0, 0, 0.1)}p.svelte-1v3t6m3{margin:0}")}var cT=o=>({}),gy=o=>({}),fT=o=>({}),xy=o=>({}),uT=o=>({}),yy=o=>({});function dT(o){let e;return{c(){e=K(o[0])},m(t,r){T(t,e,r)},p(t,r){r&1&&se(e,t[0])},d(t){t&&C(e)}}}function by(o){let e,t,r,n,s=[mT,pT],a=[];function i(l,f){return l[3]?0:1}return e=i(o,-1),t=a[e]=s[e](o),{c(){t.c(),r=Le()},m(l,f){a[e].m(l,f),T(l,r,f),n=!0},p(l,f){let u=e;e=i(l,f),e===u?a[e].p(l,f):(be(),D(a[u],1,1,()=>{a[u]=null}),we(),t=a[e],t?t.p(l,f):(t=a[e]=s[e](l),t.c()),L(t,1),t.m(r.parentNode,r))},i(l){n||(L(t),n=!0)},o(l){D(t),n=!1},d(l){l&&C(r),a[e].d(l)}}}function pT(o){let e,t;return e=new hy({props:{helpText:o[1]}}),{c(){V(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},p(r,n){let s={};n&2&&(s.helpText=r[1]),e.$set(s)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function mT(o){let e,t,r,n,s;return t=new Wa({props:{size:16}}),{c(){e=P("button"),V(t.$$.fragment),b(e,"class","help-button svelte-1v3t6m3"),b(e,"aria-expanded",o[2])},m(a,i){T(a,e,i),N(t,e,null),r=!0,n||(s=re(e,"click",o[4]),n=!0)},p(a,i){(!r||i&4)&&b(e,"aria-expanded",a[2])},i(a){r||(L(t.$$.fragment,a),r=!0)},o(a){D(t.$$.fragment,a),r=!1},d(a){a&&C(e),H(t),n=!1,s()}}}function hT(o){let e,t,r=o[7].description,n=he(r,o,o[6],gy);return{c(){e=P("div"),n&&n.c(),b(e,"class","setting-item-description")},m(s,a){T(s,e,a),n&&n.m(e,null),t=!0},p(s,a){n&&n.p&&(!t||a&64)&&xe(n,r,s,s[6],t?ge(r,s[6],a,cT):ye(s[6]),gy)},i(s){t||(L(n,s),t=!0)},o(s){D(n,s),t=!1},d(s){s&&C(e),n&&n.d(s)}}}function wy(o){let e,t,r;return{c(){e=P("div"),t=P("p"),r=K(o[1]),b(t,"class","svelte-1v3t6m3"),b(e,"class","help-content svelte-1v3t6m3"),ze(e,"expanded",o[2])},m(n,s){T(n,e,s),k(e,t),k(t,r)},p(n,s){s&2&&se(r,n[1]),s&4&&ze(e,"expanded",n[2])},d(n){n&&C(e)}}}function gT(o){let e,t,r,n,s,a,i,l,f,u=o[7].name,d=he(u,o,o[6],yy),m=d||dT(o),x=o[1]&&by(o),h=o[7].description,_=he(h,o,o[6],xy),w=_||hT(o),v=o[1]&&o[2]&&o[3]&&wy(o),A=o[7].default,U=he(A,o,o[6],null);return{c(){e=P("div"),t=P("div"),r=P("div"),m&&m.c(),n=B(),x&&x.c(),s=B(),w&&w.c(),a=B(),v&&v.c(),i=B(),l=P("div"),U&&U.c(),b(r,"class","setting-item-name svelte-1v3t6m3"),b(t,"class","setting-item-info"),b(l,"class","setting-item-control"),b(e,"class","setting-item setting-item-heading")},m(I,F){T(I,e,F),k(e,t),k(t,r),m&&m.m(r,null),k(r,n),x&&x.m(r,null),k(t,s),w&&w.m(t,null),k(t,a),v&&v.m(t,null),k(e,i),k(e,l),U&&U.m(l,null),f=!0},p(I,[F]){d?d.p&&(!f||F&64)&&xe(d,u,I,I[6],f?ge(u,I[6],F,uT):ye(I[6]),yy):m&&m.p&&(!f||F&1)&&m.p(I,f?F:-1),I[1]?x?(x.p(I,F),F&2&&L(x,1)):(x=by(I),x.c(),L(x,1),x.m(r,null)):x&&(be(),D(x,1,1,()=>{x=null}),we()),_?_.p&&(!f||F&64)&&xe(_,h,I,I[6],f?ge(h,I[6],F,fT):ye(I[6]),xy):w&&w.p&&(!f||F&64)&&w.p(I,f?F:-1),I[1]&&I[2]&&I[3]?v?v.p(I,F):(v=wy(I),v.c(),v.m(t,null)):v&&(v.d(1),v=null),U&&U.p&&(!f||F&64)&&xe(U,A,I,I[6],f?ge(A,I[6],F,null):ye(I[6]),null)},i(I){f||(L(m,I),L(x),L(w,I),L(U,I),f=!0)},o(I){D(m,I),D(x),D(w,I),D(U,I),f=!1},d(I){I&&C(e),m&&m.d(I),x&&x.d(),w&&w.d(I),v&&v.d(),U&&U.d(I)}}}function xT(o,e,t){let{$$slots:r={},$$scope:n}=e;var s;let{name:a=""}=e,{helpText:i=void 0}=e,l=!1,f=!1;function u(){f&&t(2,l=!l)}return o.$$set=d=>{"name"in d&&t(0,a=d.name),"helpText"in d&&t(1,i=d.helpText),"$$scope"in d&&t(6,n=d.$$scope)},o.$$.update=()=>{if(o.$$.dirty&32){e:t(3,f=t(5,s=Gl.Platform===null||Gl.Platform===void 0?void 0:Gl.Platform.isMobile)!==null&&s!==void 0?s:!1)}},[a,i,l,f,u,s,n,r]}var np=class extends Z{constructor(e){super(),ee(this,e,xT,gT,Q,{name:0,helpText:1},lT)}},Je=np;var Ks=[];function yT(o,e){return{subscribe:_e(o,e).subscribe}}function _e(o,e=X){let t,r=new Set;function n(i){if(Q(o,i)&&(o=i,t)){let l=!Ks.length;for(let f of r)f[1](),Ks.push(f,o);if(l){for(let f=0;f<Ks.length;f+=2)Ks[f][0](Ks[f+1]);Ks.length=0}}}function s(i){n(i(o))}function a(i,l=X){let f=[i,l];return r.add(f),r.size===1&&(t=e(n,s)||X),i(o),()=>{r.delete(f),r.size===0&&t&&(t(),t=null)}}return{set:n,update:s,subscribe:a}}function fo(o,e,t){let r=!Array.isArray(o),n=r?[o]:o;if(!n.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");let s=e.length<2;return yT(t,(a,i)=>{let l=!1,f=[],u=0,d=X,m=()=>{if(u)return;d();let h=e(r?f[0]:f,a,i);s?a(h):d=ft(h)?h:X},x=n.map((h,_)=>Qt(h,w=>{f[_]=w,u&=~(1<<_),l&&m()},()=>{u|=1<<_}));return l=!0,m(),function(){ke(x),d(),l=!1}})}var Cy=require("obsidian"),Ty=require("obsidian");if(globalThis.Response===void 0||globalThis.Headers===void 0)try{if(console.warn("[Relay] Polyfilling Fetch API (Electron Bug: https://github.com/electron/electron/pull/42419)"),globalThis.blinkfetch){globalThis.fetch=globalThis.blinkFetch;let o=["fetch","Response","FormData","Request","Headers"];for(let e of o)globalThis[e]=globalThis[`blink${e}`]}}catch(o){console.error(o)}globalThis.EventSource===void 0&&(Ty.Platform.isMobile?console.warn("[Relay] Polyfilling EventSource API required, but unable to polyfill on Mobile"):(console.warn("[Relay] Polyfilling EventSource API"),globalThis.EventSource=Ly()));var wr=async(o,e)=>{let t=o instanceof URL?o.toString():o,r=(e==null?void 0:e.method)||"GET",n=Object.assign({},e==null?void 0:e.headers,{"Relay-Version":"0.4.9"}),s={url:t,method:r,body:e==null?void 0:e.body,headers:n,throw:!1},a;if(a=await(0,Cy.requestUrl)(s),!a.arrayBuffer.byteLength)return new Response(null,{status:a.status,statusText:a.status.toString(),headers:new Headers(a.headers)});let i=new Response(a.arrayBuffer,{status:a.status,statusText:a.status.toString(),headers:new Headers(a.headers)});Object.defineProperty(i,"json",{value:async()=>JSON.parse(a.text)});let f=a.status>=500?"error":a.status>=400?"warn":"debug",u=a.text,d;try{d=JSON.parse(u)}catch(m){}if(Ce("[CustomFetch]",f)(a.status.toString(),r,t,d||u),a.status>=500)throw new Error(u);return i};function AT(o){Pe(o,"svelte-xcpzqp",`.continue.svelte-xcpzqp{font-weight:600;font-size:larger;margin-top:0;margin-bottom:0px}.link.svelte-xcpzqp{color:var(--text-muted)}.link.svelte-xcpzqp:hover{color:var(--text-normal)}.not-working.svelte-xcpzqp{margin-top:0px;margin-bottom:0px;color:var(--text-faint);font-size:0.75em}.link-button.svelte-xcpzqp{box-shadow:none;background:none;border:none;padding:0;font:inherit;text-decoration:underline}button.link-button.svelte-xcpzqp:hover{box-shadow:none;color:var(--text-normal)}button.link.link-button.svelte-xcpzqp{height:auto;padding:0;color:var(--text-faint)}.welcome.svelte-xcpzqp{display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:7rem 2rem 1rem 2rem;max-width:640px;margin:0 auto;gap:2rem}.google-sign-in-button.svelte-xcpzqp{height:unset;padding:12px 16px 12px 42px !important;border:none;border-radius:3px;box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 1px 1px rgba(0, 0, 0, 0.25);color:var(--text-color);font-size:14px;font-weight:500;font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu,
			Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;background-image:url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48cGF0aCBkPSJNMTcuNiA5LjJsLS4xLTEuOEg5djMuNGg0LjhDMTMuNiAxMiAxMyAxMyAxMiAxMy42djIuMmgzYTguOCA4LjggMCAwIDAgMi42LTYuNnoiIGZpbGw9IiM0Mjg1RjQiIGZpbGwtcnVsZT0ibm9uemVybyIvPjxwYXRoIGQ9Ik05IDE4YzIuNCAwIDQuNS0uOCA2LTIuMmwtMy0yLjJhNS40IDUuNCAwIDAgMS04LTIuOUgxVjEzYTkgOSAwIDAgMCA4IDV6IiBmaWxsPSIjMzRBODUzIiBmaWxsLXJ1bGU9Im5vbnplcm8iLz48cGF0aCBkPSJNNCAxMC43YTUuNCA1LjQgMCAwIDEgMC0zLjRWNUgxYTkgOSAwIDAgMCAwIDhsMy0yLjN6IiBmaWxsPSIjRkJCQzA1IiBmaWxsLXJ1bGU9Im5vbnplcm8iLz48cGF0aCBkPSJNOSAzLjZjMS4zIDAgMi41LjQgMy40IDEuM0wxNSAyLjNBOSA5IDAgMCAwIDEgNWwzIDIuNGE1LjQgNS40IDAgMCAxIDUtMy43eiIgZmlsbD0iI0VBNDMzNSIgZmlsbC1ydWxlPSJub256ZXJvIi8+PHBhdGggZD0iTTAgMGgxOHYxOEgweiIvPjwvZz48L3N2Zz4=);background-color:var(--background-secondary);background-repeat:no-repeat;background-position:12px 11px}.google-sign-in-button.svelte-xcpzqp:hover{box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 2px 4px rgba(0, 0, 0, 0.25)}.google-sign-in-button.svelte-xcpzqp:disabled{cursor:unset;filter:grayscale(100%);box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 1px 1px rgba(0, 0, 0, 0.25)}`)}function MT(o){let e,t,r,n,s,a,i;t=new iy({});function l(h,_){return h[3]?RT:FT}let f=l(o,[-1,-1]),u=f(o);function d(h,_){if(h[5])return UT;if(h[4])return OT}let m=d(o,[-1,-1]),x=m&&m(o);return a=new fy({}),{c(){e=P("div"),V(t.$$.fragment),r=B(),u.c(),n=B(),x&&x.c(),s=B(),V(a.$$.fragment),b(e,"class","welcome svelte-xcpzqp")},m(h,_){T(h,e,_),N(t,e,null),k(e,r),u.m(e,null),k(e,n),x&&x.m(e,null),T(h,s,_),N(a,h,_),i=!0},p(h,_){f===(f=l(h,_))&&u?u.p(h,_):(u.d(1),u=f(h),u&&(u.c(),u.m(e,n))),m===(m=d(h,_))&&x?x.p(h,_):(x&&x.d(1),x=m&&m(h),x&&(x.c(),x.m(e,null)))},i(h){i||(L(t.$$.fragment,h),L(a.$$.fragment,h),i=!0)},o(h){D(t.$$.fragment,h),D(a.$$.fragment,h),i=!1},d(h){h&&(C(e),C(s)),H(t),u.d(),x&&x.d(),H(a,h)}}}function ET(o){let e,t,r,n,s,a,i;e=new Je({props:{$$slots:{name:[BT],default:[$T]},$$scope:{ctx:o}}}),r=new Je({props:{name:"Account"}}),s=new py({props:{user:o[2].user,$$slots:{default:[NT]},$$scope:{ctx:o}}});let l=o[18].default,f=he(l,o,o[25],null);return{c(){V(e.$$.fragment),t=B(),V(r.$$.fragment),n=B(),V(s.$$.fragment),a=B(),f&&f.c()},m(u,d){N(e,u,d),T(u,t,d),N(r,u,d),T(u,n,d),N(s,u,d),T(u,a,d),f&&f.m(u,d),i=!0},p(u,d){let m={};d[0]&33554432&&(m.$$scope={dirty:d,ctx:u}),e.$set(m);let x={};d[0]&4&&(x.user=u[2].user),d[0]&33554432&&(x.$$scope={dirty:d,ctx:u}),s.$set(x),f&&f.p&&(!i||d[0]&33554432)&&xe(f,l,u,u[25],i?ge(l,u[25],d,null):ye(u[25]),null)},i(u){i||(L(e.$$.fragment,u),L(r.$$.fragment,u),L(s.$$.fragment,u),L(f,u),i=!0)},o(u){D(e.$$.fragment,u),D(r.$$.fragment,u),D(s.$$.fragment,u),D(f,u),i=!1},d(u){u&&(C(t),C(n),C(a)),H(e,u),H(r,u),H(s,u),f&&f.d(u)}}}function FT(o){let e,t,r,n,s;return{c(){e=P("a"),t=P("button"),r=K("Sign in with Google"),b(t,"class","google-sign-in-button svelte-xcpzqp"),t.disabled=o[4],b(e,"href",o[1]),b(e,"target","_blank")},m(a,i){T(a,e,i),k(e,t),k(t,r),n||(s=re(t,"click",o[21]),n=!0)},p(a,i){i[0]&16&&(t.disabled=a[4]),i[0]&2&&b(e,"href",a[1])},d(a){a&&C(e),n=!1,s()}}}function RT(o){let e,t,r,n;return{c(){e=P("button"),t=K("Sign in with Google"),b(e,"class","google-sign-in-button svelte-xcpzqp"),e.disabled=o[4]},m(s,a){T(s,e,a),k(e,t),r||(n=re(e,"click",(0,un.debounce)(o[20])),r=!0)},p(s,a){a[0]&16&&(e.disabled=s[4])},d(s){s&&C(e),r=!1,n()}}}function OT(o){let e,t,r,n,s,a,i,l;return{c(){e=P("div"),t=P("p"),t.textContent="Continue in your browser...",r=B(),n=P("p"),s=K(`Not working?
					`),a=P("button"),a.textContent="(try again)",b(t,"class","continue svelte-xcpzqp"),b(a,"class","link link-button svelte-xcpzqp"),b(n,"class","not-working svelte-xcpzqp")},m(f,u){T(f,e,u),k(e,t),k(e,r),k(e,n),k(n,s),k(n,a),i||(l=re(a,"click",o[24]),i=!0)},p:X,d(f){f&&C(e),i=!1,l()}}}function UT(o){let e,t,r,n,s,a,i,l,f,u,d,m=o[6]&&Py(o);return{c(){e=P("p"),t=K(o[5]),r=K("."),n=P("br"),s=B(),m&&m.c(),a=B(),i=P("p"),l=K(`Not working?
				`),f=P("button"),f.textContent="(try again)",b(f,"class","link link-button svelte-xcpzqp"),b(i,"class","not-working svelte-xcpzqp")},m(x,h){T(x,e,h),k(e,t),k(e,r),k(e,n),k(e,s),m&&m.m(e,null),T(x,a,h),T(x,i,h),k(i,l),k(i,f),u||(d=re(f,"click",o[23]),u=!0)},p(x,h){h[0]&32&&se(t,x[5]),x[6]?m?m.p(x,h):(m=Py(x),m.c(),m.m(e,null)):m&&(m.d(1),m=null)},d(x){x&&(C(e),C(a),C(i)),m&&m.d(),u=!1,d()}}}function Py(o){let e,t,r,n;return{c(){e=K("Already logged in? "),t=P("button"),t.textContent="(click here)",b(t,"class","link link-button svelte-xcpzqp")},m(s,a){T(s,e,a),T(s,t,a),r||(n=re(t,"click",(0,un.debounce)(o[22])),r=!0)},p:X,d(s){s&&(C(e),C(t)),r=!1,n()}}}function $T(o){let e,t;return e=new ay({}),{c(){V(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function BT(o){let e,t;return e=new Wl({props:{slot:"name"}}),{c(){V(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},p:X,i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function NT(o){let e,t,r;return{c(){e=P("button"),e.textContent="Logout"},m(n,s){T(n,e,s),t||(r=re(e,"click",(0,un.debounce)(o[19])),t=!0)},p:X,d(n){n&&C(e),t=!1,r()}}}function HT(o){let e,t,r,n,s=[ET,MT],a=[];function i(l,f){return l[2].hasUser&&l[2].user?0:1}return e=i(o,[-1,-1]),t=a[e]=s[e](o),{c(){t.c(),r=Le()},m(l,f){a[e].m(l,f),T(l,r,f),n=!0},p(l,f){let u=e;e=i(l,f),e===u?a[e].p(l,f):(be(),D(a[u],1,1,()=>{a[u]=null}),we(),t=a[e],t?t.p(l,f):(t=a[e]=s[e](l),t.c()),L(t,1),t.m(r.parentNode,r))},i(l){n||(L(t),n=!0)},o(l){D(t),n=!1},d(l){l&&C(r),a[e].d(l)}}}function VT(o,e,t){let r,n,s,a=X,i=()=>(a(),a=Qt(_,ce=>t(2,s=ce)),_),l,f,u,d;o.$$.on_destroy.push(()=>a());let{$$slots:m={},$$scope:x}=e,{plugin:h}=e,_,w=_e(!un.Platform.isIosApp);me(o,w,ce=>t(3,l=ce));let v=_e(!1);me(o,v,ce=>t(4,f=ce)),i(_=h.loginManager);let A=_e(!1);me(o,A,ce=>t(6,d=ce));let U=_e(!1),I=_e(!0);me(o,I,ce=>t(28,r=ce));let F=_e("please wait...");me(o,F,ce=>t(1,n=ce));let $,E,M=_e("");me(o,M,ce=>t(5,u=ce));function R(){return Ge(this,void 0,void 0,function*(){h.loginManager.logout(),U.set(!1),A.set(!1)})}function q(){return Ge(this,void 0,void 0,function*(){try{yield h.loginManager.login()}catch(ce){w.set(!1),U.set(!1),n&&n!=="please wait..."&&(window.open(n,"_blank"),W())}})}let J=_e(h.loginManager.pb);function G(){J.set(h.loginManager.pb)}function z(){try{let ce=r?wr:fetch;$=void 0,F.set("please wait..."),_.initiateManualOAuth2CodeFlow(ce).then(([te,$e,Lt])=>{$=$e,E=Lt,F.set(te)}).catch(te=>{let $e=te.message;throw $e=$e,M.set($e),U.set(!1),te})}catch(ce){M.set(ce.message)}}er(()=>{U.set(!1),z()});function W(){return Ge(this,void 0,void 0,function*(){if(!(!$||!E))return yield h.loginManager.poll($,E).then(ce=>{U.set(!0),v.set(!1),M.set("")}).catch(ce=>{A.set(!0),v.set(!1),U.set(!1),M.set(ce.message)})})}function oe(ce){let te=ce.target;te.focus(),te.select(),navigator.clipboard.writeText(te.value).then(()=>new un.Notice("Invite link copied")).catch($e=>{}),W()}let Ie=()=>{R()},De=async()=>{v.set(!0),await q()},Me=()=>{v.set(!0),W()},Ye=()=>{W()},Re=()=>{v.set(!1),w.set(!1),M.set(""),z()},de=()=>{v.set(!1),w.set(!1)};return o.$$set=ce=>{"plugin"in ce&&t(17,h=ce.plugin),"$$scope"in ce&&t(25,x=ce.$$scope)},[_,n,s,l,f,u,d,w,v,A,I,F,M,R,q,z,W,h,m,Ie,De,Me,Ye,Re,de,x]}var sp=class extends Z{constructor(e){super(),ee(this,e,VT,HT,Q,{plugin:17},AT,[-1,-1])}},Dy=sp;function Ay(o,e,t){let r=o.slice();return r[5]=e[t],r}var qT=o=>({}),My=o=>({}),WT=o=>({}),Ey=o=>({});function zT(o){let e;return{c(){e=K(o[0])},m(t,r){T(t,e,r)},p(t,r){r&1&&se(e,t[0])},d(t){t&&C(e)}}}function KT(o){let e,t=Fe(o[1]),r=[];for(let n=0;n<t.length;n+=1)r[n]=Fy(Ay(o,t,n));return{c(){for(let n=0;n<r.length;n+=1)r[n].c();e=Le()},m(n,s){for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(n,s);T(n,e,s)},p(n,s){if(s&2){t=Fe(n[1]);let a;for(a=0;a<t.length;a+=1){let i=Ay(n,t,a);r[a]?r[a].p(i,s):(r[a]=Fy(i),r[a].c(),r[a].m(e.parentNode,e))}for(;a<r.length;a+=1)r[a].d(1);r.length=t.length}},d(n){n&&C(e),it(r,n)}}}function Fy(o){let e;return{c(){e=P("div"),e.textContent=`${o[5]} `},m(t,r){T(t,e,r)},p:X,d(t){t&&C(e)}}}function GT(o){let e,t=o[1].length>0&&KT(o);return{c(){t&&t.c(),e=Le()},m(r,n){t&&t.m(r,n),T(r,e,n)},p(r,n){r[1].length>0&&t.p(r,n)},d(r){r&&C(e),t&&t.d(r)}}}function jT(o){let e,t,r,n,s,a,i,l,f=o[4].name,u=he(f,o,o[3],Ey),d=u||zT(o),m=o[4].description,x=he(m,o,o[3],My),h=x||GT(o),_=o[4].default,w=he(_,o,o[3],null);return{c(){e=P("div"),t=P("div"),r=P("div"),d&&d.c(),n=B(),s=P("div"),h&&h.c(),a=B(),i=P("div"),w&&w.c(),b(r,"class","setting-item-name"),ue(r,"display","grid"),ue(r,"align-items","center"),b(s,"class","setting-item-description"),b(t,"class","setting-item-info"),ue(t,"display","grid"),b(i,"class","setting-item-control"),b(e,"class","setting-item")},m(v,A){T(v,e,A),k(e,t),k(t,r),d&&d.m(r,null),k(t,n),k(t,s),h&&h.m(s,null),k(e,a),k(e,i),w&&w.m(i,null),l=!0},p(v,[A]){u?u.p&&(!l||A&8)&&xe(u,f,v,v[3],l?ge(f,v[3],A,WT):ye(v[3]),Ey):d&&d.p&&(!l||A&1)&&d.p(v,l?A:-1),x&&x.p&&(!l||A&8)&&xe(x,m,v,v[3],l?ge(m,v[3],A,qT):ye(v[3]),My),w&&w.p&&(!l||A&8)&&xe(w,_,v,v[3],l?ge(_,v[3],A,null):ye(v[3]),null)},i(v){l||(L(d,v),L(h,v),L(w,v),l=!0)},o(v){D(d,v),D(h,v),D(w,v),l=!1},d(v){v&&C(e),d&&d.d(v),h&&h.d(v),w&&w.d(v)}}}function YT(o,e,t){let{$$slots:r={},$$scope:n}=e,{name:s=""}=e,{description:a}=e,i=a!==void 0?a.split(`
`):[];return o.$$set=l=>{"name"in l&&t(0,s=l.name),"description"in l&&t(2,a=l.description),"$$scope"in l&&t(3,n=l.$$scope)},[s,i,a,n,r]}var ap=class extends Z{constructor(e){super(),ee(this,e,YT,jT,Q,{name:0,description:2})}},He=ap;function JT(o){Pe(o,"svelte-tyruzk",".setting-item-control.svelte-tyruzk{width:unset !important;margin-top:unset !important}.setting-item.svelte-tyruzk{flex-direction:unset !important;align-items:flex-start}.setting-item-info.svelte-tyruzk{min-width:0;margin-top:auto;margin-bottom:auto}.setting-item-name.svelte-tyruzk{min-width:0}.truncate.svelte-tyruzk *{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}")}var XT=o=>({}),Ry=o=>({}),QT=o=>({}),Oy=o=>({});function ZT(o){let e;return{c(){e=K(o[0])},m(t,r){T(t,e,r)},p(t,r){r&1&&se(e,t[0])},d(t){t&&C(e)}}}function eP(o){let e,t,r,n,s,a,i,l=o[2].name,f=he(l,o,o[1],Oy),u=f||ZT(o),d=o[2].description,m=he(d,o,o[1],Ry),x=o[2].default,h=he(x,o,o[1],null);return{c(){e=P("div"),t=P("div"),r=P("div"),u&&u.c(),n=B(),m&&m.c(),s=B(),a=P("div"),h&&h.c(),b(r,"class","setting-item-name truncate svelte-tyruzk"),b(t,"class","setting-item-info svelte-tyruzk"),b(a,"class","setting-item-control svelte-tyruzk"),b(e,"class","setting-item svelte-tyruzk")},m(_,w){T(_,e,w),k(e,t),k(t,r),u&&u.m(r,null),k(e,n),m&&m.m(e,null),k(e,s),k(e,a),h&&h.m(a,null),i=!0},p(_,[w]){f?f.p&&(!i||w&2)&&xe(f,l,_,_[1],i?ge(l,_[1],w,QT):ye(_[1]),Oy):u&&u.p&&(!i||w&1)&&u.p(_,i?w:-1),m&&m.p&&(!i||w&2)&&xe(m,d,_,_[1],i?ge(d,_[1],w,XT):ye(_[1]),Ry),h&&h.p&&(!i||w&2)&&xe(h,x,_,_[1],i?ge(x,_[1],w,null):ye(_[1]),null)},i(_){i||(L(u,_),L(m,_),L(h,_),i=!0)},o(_){D(u,_),D(m,_),D(h,_),i=!1},d(_){_&&C(e),u&&u.d(_),m&&m.d(_),h&&h.d(_)}}}function tP(o,e,t){let{$$slots:r={},$$scope:n}=e,{name:s=""}=e;return o.$$set=a=>{"name"in a&&t(0,s=a.name),"$$scope"in a&&t(1,n=a.$$scope)},[s,n,r]}var ip=class extends Z{constructor(e){super(),ee(this,e,tP,eP,Q,{name:0},JT)}},fr=ip;function rP(o){Pe(o,"svelte-y529x8",".extra-setting-button.svelte-y529x8:focus{outline:none;box-shadow:none;color:var(--icon-color-focus)}.extra-setting-button.svelte-y529x8:hover{box-shadow:none;opacity:var(--icon-opacity-hover);color:var(--icon-color-hover);background-color:var(--background-modifier-hover)}")}function oP(o){let e,t,r,n,s;return t=new cd({props:{class:"svg-icon lucide-settings",props:{class:"svg-icon lucide-settings"}}}),{c(){e=P("div"),V(t.$$.fragment),b(e,"class","clickable-icon extra-setting-button svelte-y529x8"),b(e,"aria-label","Options"),b(e,"role","button"),b(e,"tabindex","0")},m(a,i){T(a,e,i),N(t,e,null),r=!0,n||(s=[re(e,"click",o[0]),re(e,"keydown",o[0])],n=!0)},p:X,i(a){r||(L(t.$$.fragment,a),r=!0)},o(a){D(t.$$.fragment,a),r=!1},d(a){a&&C(e),H(t),n=!1,ke(s)}}}function nP(o){let e=$t();function t(r){(r instanceof MouseEvent||r instanceof KeyboardEvent&&(r.key==="Enter"||r.key===" "))&&e("settings")}return[t]}var lp=class extends Z{constructor(e){super(),ee(this,e,nP,oP,Q,{},rP)}},Nn=lp;function sP(o){let e,t,r,n,s,a;t=new Bn({props:{class:"svg-icon",style:"margin-right: .2em; flex-shrink: 0;"}});let i=o[3].default,l=he(i,o,o[2],null);return{c(){e=P("span"),V(t.$$.fragment),r=B(),l&&l.c(),b(e,"role","button"),b(e,"tabindex","0"),ue(e,"display","flex"),ue(e,"align-items","center"),ue(e,"width","100%")},m(f,u){T(f,e,u),N(t,e,null),k(e,r),l&&l.m(e,null),n=!0,s||(a=[re(e,"keypress",o[0]),re(e,"click",o[0])],s=!0)},p(f,[u]){l&&l.p&&(!n||u&4)&&xe(l,i,f,f[2],n?ge(i,f[2],u,null):ye(f[2]),null)},i(f){n||(L(t.$$.fragment,f),L(l,f),n=!0)},o(f){D(t.$$.fragment,f),D(l,f),n=!1},d(f){f&&C(e),H(t),l&&l.d(f),s=!1,ke(a)}}}function aP(o,e,t){let{$$slots:r={},$$scope:n}=e,{relay:s=void 0}=e,a=$t();function i(){s&&a("manageRelay",{relay:s})}return o.$$set=l=>{"relay"in l&&t(1,s=l.relay),"$$scope"in l&&t(2,n=l.$$scope)},[i,s,n,r]}var cp=class extends Z{constructor(e){super(),ee(this,e,aP,sP,Q,{relay:1})}},dn=cp;function iP(o){let e,t,r,n,s,a;t=new Yu({props:{class:"svg-icon",style:"margin-right: .2em; flex-shrink: 0"}});let i=o[3].default,l=he(i,o,o[2],null);return{c(){e=P("span"),V(t.$$.fragment),r=B(),l&&l.c(),b(e,"role","button"),b(e,"tabindex","0"),ue(e,"display","inline-flex"),ue(e,"align-items","center"),ue(e,"width","100%")},m(f,u){T(f,e,u),N(t,e,null),k(e,r),l&&l.m(e,null),n=!0,s||(a=[re(e,"keypress",o[0]),re(e,"click",o[0])],s=!0)},p(f,[u]){l&&l.p&&(!n||u&4)&&xe(l,i,f,f[2],n?ge(i,f[2],u,null):ye(f[2]),null)},i(f){n||(L(t.$$.fragment,f),L(l,f),n=!0)},o(f){D(t.$$.fragment,f),D(l,f),n=!1},d(f){f&&C(e),H(t),l&&l.d(f),s=!1,ke(a)}}}function lP(o,e,t){let{$$slots:r={},$$scope:n}=e,{folder:s=void 0}=e,a=$t();function i(){var l;s&&a("manageSharedFolder",{folder:s,relay:(l=s.remote)===null||l===void 0?void 0:l.relay})}return o.$$set=l=>{"folder"in l&&t(1,s=l.folder),"$$scope"in l&&t(2,n=l.$$scope)},[i,s,n,r]}var fp=class extends Z{constructor(e){super(),ee(this,e,lP,iP,Q,{folder:1})}},uo=fp;function cP(o){let e,t=o[0].name+"",r;return{c(){e=P("span"),r=K(t),ue(e,"overflow","hidden"),ue(e,"text-overflow","ellipsis"),ue(e,"white-space","nowrap")},m(n,s){T(n,e,s),k(e,r)},p(n,s){s&1&&t!==(t=n[0].name+"")&&se(r,t)},d(n){n&&C(e)}}}function Uy(o){let e,t,r,n,s;return t=new Ru({props:{size:16,class:"svg-icon"}}),n=new dn({props:{relay:o[1],$$slots:{default:[fP]},$$scope:{ctx:o}}}),n.$on("manageRelay",o[3]),{c(){e=P("span"),V(t.$$.fragment),r=B(),V(n.$$.fragment),ue(e,"width","16px"),ue(e,"flex-shrink","0"),ue(e,"display","flex"),ue(e,"justify-content","center")},m(a,i){T(a,e,i),N(t,e,null),T(a,r,i),N(n,a,i),s=!0},p(a,i){let l={};i&2&&(l.relay=a[1]),i&17&&(l.$$scope={dirty:i,ctx:a}),n.$set(l)},i(a){s||(L(t.$$.fragment,a),L(n.$$.fragment,a),s=!0)},o(a){D(t.$$.fragment,a),D(n.$$.fragment,a),s=!1},d(a){a&&(C(e),C(r)),H(t),H(n,a)}}}function fP(o){let e,t=o[0].remote.relay.name+"",r;return{c(){e=P("span"),r=K(t),ue(e,"flex","1"),ue(e,"min-width","0"),ue(e,"text-overflow","ellipsis"),ue(e,"white-space","nowrap")},m(n,s){T(n,e,s),k(e,r)},p(n,s){s&1&&t!==(t=n[0].remote.relay.name+"")&&se(r,t)},d(n){n&&C(e)}}}function uP(o){let e,t,r,n,s;r=new uo({props:{folder:o[0],$$slots:{default:[cP]},$$scope:{ctx:o}}}),r.$on("manageSharedFolder",o[2]);let a=o[0].remote&&Uy(o);return{c(){e=P("span"),t=P("span"),V(r.$$.fragment),n=B(),a&&a.c(),ue(t,"display","inline-flex"),ue(t,"align-items","center"),ue(t,"width","200px"),ue(t,"min-width","200px"),ue(t,"flex-shrink","0"),ue(e,"display","inline-flex"),ue(e,"align-items","center"),ue(e,"width","100%"),ue(e,"gap","8px")},m(i,l){T(i,e,l),k(e,t),N(r,t,null),k(e,n),a&&a.m(e,null),s=!0},p(i,[l]){let f={};l&1&&(f.folder=i[0]),l&17&&(f.$$scope={dirty:l,ctx:i}),r.$set(f),i[0].remote?a?(a.p(i,l),l&1&&L(a,1)):(a=Uy(i),a.c(),L(a,1),a.m(e,null)):a&&(be(),D(a,1,1,()=>{a=null}),we())},i(i){s||(L(r.$$.fragment,i),L(a),s=!0)},o(i){D(r.$$.fragment,i),D(a),s=!1},d(i){i&&C(e),H(r),a&&a.d()}}}function dP(o,e,t){let{folder:r}=e,{relay:n}=e;function s(i){Kr.call(this,o,i)}function a(i){Kr.call(this,o,i)}return o.$$set=i=>{"folder"in i&&t(0,r=i.folder),"relay"in i&&t(1,n=i.relay)},[r,n,s,a]}var up=class extends Z{constructor(e){super(),ee(this,e,dP,uP,Q,{folder:0,relay:1})}},$y=up;var Gs=require("obsidian");function pP(o){Pe(o,"svelte-yg42fv","input.system3-input-invalid.svelte-yg42fv{border:1px solid var(--color-red) !important}span.faint.svelte-yg42fv{color:var(--text-faint)}")}function By(o,e,t){let r=o.slice();return r[21]=e[t],r}function Ny(o,e,t){let r=o.slice();return r[24]=e[t],r}function mP(o){let e,t,r,n,s,a;return{c(){e=P("input"),r=B(),n=P("button"),n.textContent="Join",b(e,"type","text"),b(e,"placeholder","Enter share key"),b(e,"class",t=Es(o[2]?"system3-input-invalid":"")+" svelte-yg42fv"),b(n,"class","mod-cta")},m(i,l){T(i,e,l),Zt(e,o[1]),T(i,r,l),T(i,n,l),s||(a=[re(e,"input",o[12]),re(e,"input",o[8]),re(n,"click",function(){ft((0,Gs.debounce)(o[13]))&&(0,Gs.debounce)(o[13]).apply(this,arguments)})],s=!0)},p(i,l){o=i,l&4&&t!==(t=Es(o[2]?"system3-input-invalid":"")+" svelte-yg42fv")&&b(e,"class",t),l&2&&e.value!==o[1]&&Zt(e,o[1])},d(i){i&&(C(e),C(r),C(n)),s=!1,ke(a)}}}function hP(o){let e;return{c(){e=P("span"),e.textContent="Relay Servers",b(e,"slot","name"),ue(e,"display","inline-flex"),ue(e,"align-items","center")},m(t,r){T(t,e,r)},p:X,d(t){t&&C(e)}}}function gP(o){let e,t;function r(){return o[15](o[24])}return e=new Nn({}),e.$on("settings",r),{c(){V(e.$$.fragment)},m(n,s){N(e,n,s),t=!0},p(n,s){o=n},i(n){t||(L(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){H(e,n)}}}function xP(o){let e;return{c(){e=P("span"),e.textContent="(Untitled Relay Server)",b(e,"class","faint svelte-yg42fv")},m(t,r){T(t,e,r)},p:X,d(t){t&&C(e)}}}function yP(o){let e=o[24].name+"",t;return{c(){t=K(e)},m(r,n){T(r,t,n)},p(r,n){n&8&&e!==(e=r[24].name+"")&&se(t,e)},d(r){r&&C(t)}}}function bP(o){let e;function t(s,a){return s[24].name?yP:xP}let r=t(o,-1),n=r(o);return{c(){n.c(),e=Le()},m(s,a){n.m(s,a),T(s,e,a)},p(s,a){r===(r=t(s,a))&&n?n.p(s,a):(n.d(1),n=r(s),n&&(n.c(),n.m(e.parentNode,e)))},d(s){s&&C(e),n.d(s)}}}function wP(o){let e,t;return e=new dn({props:{slot:"name",relay:o[24],t:"name",$$slots:{default:[bP]},$$scope:{ctx:o}}}),e.$on("manageRelay",o[14]),{c(){V(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},p(r,n){let s={};n&8&&(s.relay=r[24]),n&134217736&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function Hy(o){let e,t;return e=new fr({props:{$$slots:{name:[wP],default:[gP]},$$scope:{ctx:o}}}),{c(){V(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},p(r,n){let s={};n&134217736&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function _P(o){let e,t,r;return{c(){e=P("button"),e.textContent="Create",b(e,"class","mod-cta")},m(n,s){T(n,e,s),t||(r=re(e,"click",(0,Gs.debounce)(o[16])),t=!0)},p:X,d(n){n&&C(e),t=!1,r()}}}function Vy(o){let e,t;return e=new He({props:{description:"Go to a Relay Server's settings page above to share existing folders, or add Shared Folders to your vault."}}),{c(){V(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function vP(o){let e,t,r;function n(){return o[19](o[21])}return e=new Nn({}),e.$on("settings",function(){ft((0,Gs.debounce)(n))&&(0,Gs.debounce)(n).apply(this,arguments)}),{c(){V(e.$$.fragment),t=B()},m(s,a){N(e,s,a),T(s,t,a),r=!0},p(s,a){o=s},i(s){r||(L(e.$$.fragment,s),r=!0)},o(s){D(e.$$.fragment,s),r=!1},d(s){s&&C(t),H(e,s)}}}function SP(o){var r;let e,t;return e=new $y({props:{folder:o[21],relay:(r=o[21].remote)==null?void 0:r.relay,slot:"name"}}),e.$on("manageRelay",o[17]),e.$on("manageSharedFolder",o[18]),{c(){V(e.$$.fragment)},m(n,s){N(e,n,s),t=!0},p(n,s){var i;let a={};s&16&&(a.folder=n[21]),s&16&&(a.relay=(i=n[21].remote)==null?void 0:i.relay),e.$set(a)},i(n){t||(L(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){H(e,n)}}}function qy(o){let e,t;return e=new fr({props:{$$slots:{name:[SP],default:[vP]},$$scope:{ctx:o}}}),{c(){V(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},p(r,n){let s={};n&134217752&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function kP(o){let e,t,r,n,s,a,i,l,f,u,d,m=o[4].items().length===0,x,h,_;e=new Je({props:{name:"Join a Relay Server"}}),r=new He({props:{name:"Share key",description:"Enter the code that was shared with you.",$$slots:{default:[mP]},$$scope:{ctx:o}}}),s=new Je({props:{helpText:"A Relay Server coordinates real-time updates between collaborators. You can add collaborators and share folders on the Relay Server's settings page.",$$slots:{name:[hP]},$$scope:{ctx:o}}});let w=Fe(o[3].values().sort(Wy)),v=[];for(let E=0;E<w.length;E+=1)v[E]=Hy(Ny(o,w,E));let A=E=>D(v[E],1,1,()=>{v[E]=null});l=new He({props:{name:"",description:"",$$slots:{default:[_P]},$$scope:{ctx:o}}}),u=new Je({props:{name:"Shared Folders",helpText:"Shared Folders enhance local folders by tracking edits. You can see what Relay Server a Shared Folder is connected to below."}});let U=m&&Vy(o),I=Fe(o[4].items()),F=[];for(let E=0;E<I.length;E+=1)F[E]=qy(By(o,I,E));let $=E=>D(F[E],1,1,()=>{F[E]=null});return{c(){V(e.$$.fragment),t=B(),V(r.$$.fragment),n=B(),V(s.$$.fragment),a=B();for(let E=0;E<v.length;E+=1)v[E].c();i=B(),V(l.$$.fragment),f=B(),V(u.$$.fragment),d=B(),U&&U.c(),x=B();for(let E=0;E<F.length;E+=1)F[E].c();h=Le()},m(E,M){N(e,E,M),T(E,t,M),N(r,E,M),T(E,n,M),N(s,E,M),T(E,a,M);for(let R=0;R<v.length;R+=1)v[R]&&v[R].m(E,M);T(E,i,M),N(l,E,M),T(E,f,M),N(u,E,M),T(E,d,M),U&&U.m(E,M),T(E,x,M);for(let R=0;R<F.length;R+=1)F[R]&&F[R].m(E,M);T(E,h,M),_=!0},p(E,[M]){let R={};M&134217734&&(R.$$scope={dirty:M,ctx:E}),r.$set(R);let q={};if(M&134217728&&(q.$$scope={dirty:M,ctx:E}),s.$set(q),M&72){w=Fe(E[3].values().sort(Wy));let G;for(G=0;G<w.length;G+=1){let z=Ny(E,w,G);v[G]?(v[G].p(z,M),L(v[G],1)):(v[G]=Hy(z),v[G].c(),L(v[G],1),v[G].m(i.parentNode,i))}for(be(),G=w.length;G<v.length;G+=1)A(G);we()}let J={};if(M&134217728&&(J.$$scope={dirty:M,ctx:E}),l.$set(J),M&16&&(m=E[4].items().length===0),m?U?M&16&&L(U,1):(U=Vy(E),U.c(),L(U,1),U.m(x.parentNode,x)):U&&(be(),D(U,1,1,()=>{U=null}),we()),M&152){I=Fe(E[4].items());let G;for(G=0;G<I.length;G+=1){let z=By(E,I,G);F[G]?(F[G].p(z,M),L(F[G],1)):(F[G]=qy(z),F[G].c(),L(F[G],1),F[G].m(h.parentNode,h))}for(be(),G=I.length;G<F.length;G+=1)$(G);we()}},i(E){if(!_){L(e.$$.fragment,E),L(r.$$.fragment,E),L(s.$$.fragment,E);for(let M=0;M<w.length;M+=1)L(v[M]);L(l.$$.fragment,E),L(u.$$.fragment,E),L(U);for(let M=0;M<I.length;M+=1)L(F[M]);_=!0}},o(E){D(e.$$.fragment,E),D(r.$$.fragment,E),D(s.$$.fragment,E),v=v.filter(Boolean);for(let M=0;M<v.length;M+=1)D(v[M]);D(l.$$.fragment,E),D(u.$$.fragment,E),D(U),F=F.filter(Boolean);for(let M=0;M<F.length;M+=1)D(F[M]);_=!1},d(E){E&&(C(t),C(n),C(a),C(i),C(f),C(d),C(x),C(h)),H(e,E),H(r,E),H(s,E),it(v,E),H(l,E),H(u,E),U&&U.d(E),it(F,E)}}}function Wy(o,e){return o.owner&&!e.owner?-1:e.owner&&!o.owner||o.name>e.name?1:-1}function IP(o,e,t){let r,n=X,s=()=>(n(),n=Qt(l,q=>t(3,r=q)),l),a;o.$$.on_destroy.push(()=>n());let{plugin:i}=e,{relays:l}=e;s();let f=i.sharedFolders;me(o,f,q=>t(4,a=q));let u="",d=!1,m=$t();function x(q){q&&m("manageRelay",{relay:q})}function h(q,J){q&&m("manageSharedFolder",{folder:q,relay:J})}function _(){t(2,d=!1)}function w(q){return Ge(this,void 0,void 0,function*(){try{let J=yield i.relayManager.acceptInvitation(q);m("joinRelay",{relay:J})}catch(J){t(2,d=!0)}})}function v(){m("createRelay")}function A(){u=this.value,t(1,u)}let U=()=>w(u);function I(q){Kr.call(this,o,q)}let F=q=>{x(q)},$=()=>v();function E(q){Kr.call(this,o,q)}function M(q){Kr.call(this,o,q)}let R=q=>{let J=r.values().find(G=>{var z;return((z=q.remote)==null?void 0:z.relay.guid)===G.guid});h(q,J)};return o.$$set=q=>{"plugin"in q&&t(11,i=q.plugin),"relays"in q&&s(t(0,l=q.relays))},[l,u,d,r,a,f,x,h,_,w,v,i,A,U,I,F,$,E,M,R]}var dp=class extends Z{constructor(e){super(),ee(this,e,IP,kP,Q,{plugin:11,relays:0},pP)}},po=dp;var mt=require("obsidian");var cb=bn(ua());function LP(o){let e,t,r,n,s,a,i,l,f;n=new Hu({props:{size:16}});let u=o[3].default,d=he(u,o,o[4],null);return{c(){e=P("span"),t=K(o[1]),r=B(),V(n.$$.fragment),s=B(),a=P("span"),d&&d.c(),b(e,"tabindex","0"),b(e,"role","button"),ue(a,"flex","1"),ue(a,"min-width","0"),ue(a,"text-overflow","ellipsis"),ue(a,"white-space","nowrap"),ue(a,"overflow","hidden")},m(m,x){T(m,e,x),k(e,t),T(m,r,x),N(n,m,x),T(m,s,x),T(m,a,x),d&&d.m(a,null),i=!0,l||(f=[re(e,"click",o[2]),re(e,"keypress",o[2])],l=!0)},p(m,x){(!i||x&2)&&se(t,m[1]),d&&d.p&&(!i||x&16)&&xe(d,u,m,m[4],i?ge(u,m[4],x,null):ye(m[4]),null)},i(m){i||(L(n.$$.fragment,m),L(d,m),i=!0)},o(m){D(n.$$.fragment,m),D(d,m),i=!1},d(m){m&&(C(e),C(r),C(s),C(a)),H(n,m),d&&d.d(m),l=!1,ke(f)}}}function CP(o){let e,t,r;var n=o[0];function s(a,i){return{props:{$$slots:{default:[LP]},$$scope:{ctx:a}}}}return n&&(t=Os(n,s(o))),{c(){e=P("h4"),t&&V(t.$$.fragment)},m(a,i){T(a,e,i),t&&N(t,e,null),r=!0},p(a,[i]){if(i&1&&n!==(n=a[0])){if(t){be();let l=t;D(l.$$.fragment,1,0,()=>{H(l,1)}),we()}n?(t=Os(n,s(a,i)),V(t.$$.fragment),L(t.$$.fragment,1),N(t,e,null)):t=null}else if(n){let l={};i&18&&(l.$$scope={dirty:i,ctx:a}),t.$set(l)}},i(a){r||(t&&L(t.$$.fragment,a),r=!0)},o(a){t&&D(t.$$.fragment,a),r=!1},d(a){a&&C(e),t&&H(t)}}}function TP(o,e,t){let{$$slots:r={},$$scope:n}=e,{category:s}=e,{categoryText:a}=e,i=$t();function l(){i("goBack")}return o.$$set=f=>{"category"in f&&t(0,s=f.category),"categoryText"in f&&t(1,a=f.categoryText),"$$scope"in f&&t(4,n=f.$$scope)},[s,a,l,r,n]}var pp=class extends Z{constructor(e){super(),ee(this,e,TP,CP,Q,{category:0,categoryText:1})}},jl=pp;var Jl=require("obsidian");function PP(o){let e,t,r=o[0].shared&&zy(o);return{c(){e=P("div"),r&&r.c(),b(e,"class","suggestion-icon")},m(n,s){T(n,e,s),r&&r.m(e,null),t=!0},p(n,s){n[0].shared?r?s&1&&L(r,1):(r=zy(n),r.c(),L(r,1),r.m(e,null)):r&&(be(),D(r,1,1,()=>{r=null}),we())},i(n){t||(L(r),t=!0)},o(n){D(r),t=!1},d(n){n&&C(e),r&&r.d()}}}function DP(o){let e;return{c(){e=P("span"),e.textContent="Enter to create",b(e,"class","suggestion-action")},m(t,r){T(t,e,r)},p:X,i:X,o:X,d(t){t&&C(e)}}}function zy(o){let e,t;return e=new Oo({props:{class:"svg-icon"}}),{c(){V(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function AP(o){let e,t,r=o[0].folder+"",n,s,a,i,l,f,u=[DP,PP],d=[];function m(x,h){return x[0].exists?1:0}return i=m(o,-1),l=d[i]=u[i](o),{c(){e=P("div"),t=P("div"),n=K(r),s=B(),a=P("div"),l.c(),b(t,"class","suggestion-title"),b(e,"class","suggestion-content"),b(a,"class","suggestion-aux")},m(x,h){T(x,e,h),k(e,t),k(t,n),T(x,s,h),T(x,a,h),d[i].m(a,null),f=!0},p(x,[h]){(!f||h&1)&&r!==(r=x[0].folder+"")&&se(n,r);let _=i;i=m(x,h),i===_?d[i].p(x,h):(be(),D(d[_],1,1,()=>{d[_]=null}),we(),l=d[i],l?l.p(x,h):(l=d[i]=u[i](x),l.c()),L(l,1),l.m(a,null))},i(x){f||(L(l),f=!0)},o(x){D(l),f=!1},d(x){x&&(C(e),C(s),C(a)),d[i].d()}}}function MP(o,e,t){let{suggestion:r}=e;return o.$$set=n=>{"suggestion"in n&&t(0,r=n.suggestion)},[r]}var mp=class extends Z{constructor(e){super(),ee(this,e,MP,AP,Q,{suggestion:0})}},Ky=mp;var Yl=class extends Jl.SuggestModal{constructor(t,r,n){super(t);this.sharedFolders=r;this.onChoose=n;this.components=[];this.sharedPaths=new Set(this.sharedFolders.map(s=>s.path)),this.hasRemotes=new Set(this.sharedFolders.filter(s=>s.remote!==void 0).map(s=>s.path)),this.setInstructions([{command:"\u2191/\u2193",purpose:"Navigate"},{command:"Enter",purpose:"Choose and share folder"},{command:"Esc",purpose:"Cancel"}])}sortFn(t,r){return t.exists&&!r.exists?1:!t.exists&&r.exists||t.shared&&!r.shared?-1:r.shared&&!t.shared?1:t.folder.localeCompare(r.folder)}onClose(){super.onClose(),this.components.forEach(t=>{t.$destroy()})}getSuggestions(t){this.components.forEach(i=>{i.$destroy()});let r=t.toLowerCase(),n=[],s=this.app.vault.getAbstractFileByPath(t)!==null;t.length>0&&!s&&n.push({folder:t,exists:!1,shared:!1});let a=i=>{let l=this.sharedPaths.has(i.path),f=this.hasRemotes.has(i.path);if(i.path.toLowerCase().contains(r)&&i.path.length>1&&!f&&n.push({folder:i.path,exists:!0,shared:l}),!l)for(let u of i.children)u instanceof Jl.TFolder&&a(u)};return a(this.app.vault.getRoot()),n.sort(this.sortFn)}renderSuggestion(t,r){r.addClass("mod-complex");let n=new Ky({target:r,props:{suggestion:t}});this.components.push(n)}onChooseSuggestion(t,r){this.onChoose(t.folder)}};var Qy=require("obsidian");var gp=require("obsidian");var Gy=require("obsidian"),jy=require("obsidian"),Xl=class extends jy.AbstractInputSuggest{constructor(t,r,n){super(t,n);this.app=t;this.sharedFolders=r;this.inputEl=n;this.sharedPaths=new Set(this.sharedFolders.map(s=>s.path))}getSuggestions(t){let r=t.toLowerCase(),n=[],s=a=>{if(!this.sharedPaths.has(a.path)){a.path.toLowerCase().contains(r)&&n.push(a.path);for(let l of a.children)l instanceof Gy.TFolder&&s(l)}};return s(this.app.vault.getRoot()),n}renderSuggestion(t,r){r.setText(t)}selectSuggestion(t){this.inputEl.value=t,this.inputEl.trigger("input"),this.close()}};function EP(o){let e,t,r,n;return{c(){e=P("div"),t=P("input"),b(t,"type","text"),b(t,"placeholder","/"),b(e,"class","folder-suggest-container")},m(s,a){T(s,e,a),k(e,t),o[5](t),Zt(t,o[2]),r||(n=[re(t,"input",FP),re(t,"input",o[6])],r=!0)},p(s,[a]){a&4&&t.value!==s[2]&&Zt(t,s[2])},i:X,o:X,d(s){s&&C(e),o[5](null),r=!1,ke(n)}}}function FP(){}function RP(o,e,t){let r,n=X,s=()=>(n(),n=Qt(u,x=>t(2,r=x)),u);o.$$.on_destroy.push(()=>n());let{app:a}=e,i,l,{sharedFolders:f}=e,{selectedFolder:u=_e()}=e;s(),er(()=>{l=new Xl(a,f,i);let x=h=>{s(t(0,u=h.detail.folder.path))};return i.addEventListener("folder-selected",x),()=>{i.removeEventListener("folder-selected",x)}}),Cu(()=>{l&&l.close()});function d(x){Er[x?"unshift":"push"](()=>{i=x,t(1,i)})}function m(){r=this.value,u.set(r)}return o.$$set=x=>{"app"in x&&t(3,a=x.app),"sharedFolders"in x&&t(4,f=x.sharedFolders),"selectedFolder"in x&&s(t(0,u=x.selectedFolder))},[u,i,r,a,f,d,m]}var hp=class extends Z{constructor(e){super(),ee(this,e,RP,EP,Q,{app:3,sharedFolders:4,selectedFolder:0})}},Yy=hp;function OP(o){Pe(o,"svelte-hgd3zf","span.error.svelte-hgd3zf{flex:auto;align-content:center}")}function UP(o){let e,t,r;return{c(){e=P("input"),b(e,"type","text")},m(n,s){T(n,e,s),Zt(e,o[4]),t||(r=re(e,"input",o[8]),t=!0)},p(n,s){s&16&&e.value!==n[4]&&Zt(e,n[4])},d(n){n&&C(e),t=!1,r()}}}function $P(o){let e,t;return e=new Yy({props:{app:o[0],sharedFolders:o[2],selectedFolder:o[7]}}),{c(){V(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},p(r,n){let s={};n&1&&(s.app=r[0]),n&4&&(s.sharedFolders=r[2]),e.$set(s)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function Jy(o){let e,t;return{c(){e=P("span"),t=K(o[5]),b(e,"class","mod-warning error svelte-hgd3zf")},m(r,n){T(r,e,n),k(e,t)},p(r,n){n&32&&se(t,r[5])},d(r){r&&C(e)}}}function BP(o){let e,t,r,n,s,a,i,l,f,u,d,m,x;n=new He({props:{name:"Folder name",description:"Set the name of the folder to be added.",$$slots:{default:[UP]},$$scope:{ctx:o}}}),a=new He({props:{name:"Folder location",description:"Set the location in your vault.",$$slots:{default:[$P]},$$scope:{ctx:o}}});let h=o[5]&&Jy(o);return{c(){e=P("div"),e.textContent="Add to vault",t=B(),r=P("div"),V(n.$$.fragment),s=B(),V(a.$$.fragment),i=B(),l=P("div"),h&&h.c(),f=B(),u=P("button"),u.textContent="Confirm",b(e,"class","modal-title"),b(u,"class","mod-cta"),b(l,"class","modal-button-container"),b(r,"class","modal-content")},m(_,w){T(_,e,w),T(_,t,w),T(_,r,w),N(n,r,null),k(r,s),N(a,r,null),k(r,i),k(r,l),h&&h.m(l,null),k(l,f),k(l,u),d=!0,m||(x=re(u,"click",function(){ft((0,gp.debounce)(o[9]))&&(0,gp.debounce)(o[9]).apply(this,arguments)}),m=!0)},p(_,[w]){o=_;let v={};w&1040&&(v.$$scope={dirty:w,ctx:o}),n.$set(v);let A={};w&1029&&(A.$$scope={dirty:w,ctx:o}),a.$set(A),o[5]?h?h.p(o,w):(h=Jy(o),h.c(),h.m(l,f)):h&&(h.d(1),h=null)},i(_){d||(L(n.$$.fragment,_),L(a.$$.fragment,_),d=!0)},o(_){D(n.$$.fragment,_),D(a.$$.fragment,_),d=!1},d(_){_&&(C(e),C(t),C(r)),H(n),H(a),h&&h.d(),m=!1,x()}}}function NP(o,e,t){let r,{app:n}=e,{remoteFolder:s}=e,{sharedFolders:a}=e,{onConfirm:i}=e,l=s.name,f=_e();me(o,f,x=>t(6,r=x));let u="";function d(){l=this.value,t(4,l)}let m=async()=>{i(s,l,r||"").catch(x=>{t(5,u=x.message)})};return o.$$set=x=>{"app"in x&&t(0,n=x.app),"remoteFolder"in x&&t(1,s=x.remoteFolder),"sharedFolders"in x&&t(2,a=x.sharedFolders),"onConfirm"in x&&t(3,i=x.onConfirm)},[n,s,a,i,l,u,r,f,d,m]}var xp=class extends Z{constructor(e){super(),ee(this,e,NP,BP,Q,{app:0,remoteFolder:1,sharedFolders:2,onConfirm:3},OP)}},Xy=xp;var Ql=class extends Qy.Modal{constructor(t,r,n,s){super(t);this.sharedFolders=r;this.remoteFolder=n;this.onConfirm=s;this.onConfirm=s}onOpen(){let{contentEl:t}=this;this.component=new Xy({target:t,props:{remoteFolder:this.remoteFolder,sharedFolders:this.sharedFolders,onConfirm:async(r,n,s)=>{await this.onConfirm(r,n,s),this.close()},app:this.app}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var bp=bn(Zy());function HP(o){Pe(o,"svelte-xzg7gq",".system3-settings-danger-zone.svelte-xzg7gq{margin-top:6em}input.system3-updating.svelte-xzg7gq{border:1px solid var(--color-accent) !important}input.system3-input-invalid.svelte-xzg7gq{border:1px solid var(--color-red) !important}.faint.svelte-xzg7gq{color:var(--text-faint)}")}function eb(o,e,t){let r=o.slice();return r[50]=e[t],r}function tb(o,e,t){let r=o.slice();return r[53]=e[t],r}function VP(o){let e;return{c(){e=P("span"),e.textContent="(Untitled Relay Server)",b(e,"class","faint svelte-xzg7gq")},m(t,r){T(t,e,r)},p:X,d(t){t&&C(e)}}}function qP(o){let e=o[0].name+"",t;return{c(){t=K(e)},m(r,n){T(r,t,n)},p(r,n){n[0]&1&&e!==(e=r[0].name+"")&&se(t,e)},d(r){r&&C(t)}}}function WP(o){let e;function t(s,a){return s[0].name?qP:VP}let r=t(o,[-1,-1]),n=r(o);return{c(){n.c(),e=Le()},m(s,a){n.m(s,a),T(s,e,a)},p(s,a){r===(r=t(s,a))&&n?n.p(s,a):(n.d(1),n=r(s),n&&(n.c(),n.m(e.parentNode,e)))},d(s){s&&C(e),n.d(s)}}}function rb(o){let e,t;return e=new He({props:{name:"Name",description:"Set the Relay Server's name.",$$slots:{default:[zP]},$$scope:{ctx:o}}}),{c(){V(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},p(r,n){let s={};n[0]&297|n[1]&33554432&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function zP(o){let e,t,r,n;return{c(){e=P("input"),b(e,"type","text"),b(e,"spellcheck","false"),b(e,"placeholder","Example: Shared Notes"),b(e,"class",t=Es((o[8]?"system3-updating":"")+(o[5]?"":" system3-input-invalid"))+" svelte-xzg7gq")},m(s,a){T(s,e,a),Zt(e,o[0].name),o[35](e),r||(n=[re(e,"input",o[34]),re(e,"input",o[26])],r=!0)},p(s,a){a[0]&288&&t!==(t=Es((s[8]?"system3-updating":"")+(s[5]?"":" system3-input-invalid"))+" svelte-xzg7gq")&&b(e,"class",t),a[0]&1&&e.value!==s[0].name&&Zt(e,s[0].name)},d(s){s&&C(e),o[35](null),r=!1,ke(n)}}}function KP(o){let e,t;return e=new fr({props:{$$slots:{name:[JP],default:[jP]},$$scope:{ctx:o}}}),{c(){V(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},p(r,n){let s={};n[0]&512|n[1]&33554432&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function GP(o){let e,t;return e=new fr({props:{$$slots:{name:[ZP],default:[XP]},$$scope:{ctx:o}}}),{c(){V(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},p(r,n){let s={};n[0]&1536|n[1]&33554432&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function jP(o){let e,t,r;function n(){return o[39](o[53])}return{c(){e=P("button"),e.textContent="Add to Vault",b(e,"class","mod-cta"),b(e,"aria-label","Add shared folder to vault")},m(s,a){T(s,e,a),t||(r=re(e,"click",function(){ft((0,mt.debounce)(n))&&(0,mt.debounce)(n).apply(this,arguments)}),t=!0)},p(s,a){o=s},d(s){s&&C(e),t=!1,r()}}}function YP(o){let e=o[53].name+"",t;return{c(){t=K(e)},m(r,n){T(r,t,n)},p(r,n){n[0]&512&&e!==(e=r[53].name+"")&&se(t,e)},d(r){r&&C(t)}}}function JP(o){let e,t;return e=new uo({props:{slot:"name",$$slots:{default:[YP]},$$scope:{ctx:o}}}),{c(){V(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},p(r,n){let s={};n[0]&512|n[1]&33554432&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function XP(o){let e,t;function r(){return o[38](o[53])}return e=new Nn({}),e.$on("settings",function(){ft((0,mt.debounce)(r))&&(0,mt.debounce)(r).apply(this,arguments)}),{c(){V(e.$$.fragment)},m(n,s){N(e,n,s),t=!0},p(n,s){o=n},i(n){t||(L(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){H(e,n)}}}function QP(o){let e=o[53].name+"",t;return{c(){t=K(e)},m(r,n){T(r,t,n)},p(r,n){n[0]&512&&e!==(e=r[53].name+"")&&se(t,e)},d(r){r&&C(t)}}}function ZP(o){let e,t;function r(...n){return o[36](o[53],...n)}return e=new uo({props:{folder:o[10].find(r),slot:"name",$$slots:{default:[QP]},$$scope:{ctx:o}}}),e.$on("manageSharedFolder",o[37]),{c(){V(e.$$.fragment)},m(n,s){N(e,n,s),t=!0},p(n,s){o=n;let a={};s[0]&1536&&(a.folder=o[10].find(r)),s[0]&512|s[1]&33554432&&(a.$$scope={dirty:s,ctx:o}),e.$set(a)},i(n){t||(L(e.$$.fragment,n),t=!0)},o(n){D(e.$$.fragment,n),t=!1},d(n){H(e,n)}}}function ob(o){let e,t,r,n,s;function a(...u){return o[33](o[53],...u)}let i=[GP,KP],l=[];function f(u,d){return d[0]&1536&&(e=null),e==null&&(e=!!u[10].find(a)),e?0:1}return t=f(o,[-1,-1]),r=l[t]=i[t](o),{c(){r.c(),n=Le()},m(u,d){l[t].m(u,d),T(u,n,d),s=!0},p(u,d){o=u;let m=t;t=f(o,d),t===m?l[t].p(o,d):(be(),D(l[m],1,1,()=>{l[m]=null}),we(),r=l[t],r?r.p(o,d):(r=l[t]=i[t](o),r.c()),L(r,1),r.m(n.parentNode,n))},i(u){s||(L(r),s=!0)},o(u){D(r),s=!1},d(u){u&&C(n),l[t].d(u)}}}function eD(o){let e,t,r;return{c(){e=P("button"),e.textContent="Share a folder",b(e,"class","mod-cta"),b(e,"aria-label","Select a folder to share it with this Relay Server")},m(n,s){T(n,e,s),t||(r=re(e,"click",(0,mt.debounce)(o[40])),t=!0)},p:X,d(n){n&&C(e),t=!1,r()}}}function tD(o){let e=o[11].values().length+"",t,r,n=o[7].userLimit+"",s;return{c(){t=K(e),r=K(" / "),s=K(n)},m(a,i){T(a,t,i),T(a,r,i),T(a,s,i)},p(a,i){i[0]&2048&&e!==(e=a[11].values().length+"")&&se(t,e),i[0]&128&&n!==(n=a[7].userLimit+"")&&se(s,n)},d(a){a&&(C(t),C(r),C(s))}}}function nb(o){let e,t,r;function n(){return o[41](o[50])}return{c(){e=P("button"),e.textContent="Kick",b(e,"class","mod-destructive")},m(s,a){T(s,e,a),t||(r=re(e,"click",function(){ft((0,mt.debounce)(n))&&(0,mt.debounce)(n).apply(this,arguments)}),t=!0)},p(s,a){o=s},d(s){s&&C(e),t=!1,r()}}}function rD(o){let e,t=o[50].role==="Member"&&o[7].owner&&nb(o);return{c(){t&&t.c(),e=B()},m(r,n){t&&t.m(r,n),T(r,e,n)},p(r,n){r[50].role==="Member"&&r[7].owner?t?t.p(r,n):(t=nb(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&C(e),t&&t.d(r)}}}function sb(o){let e,t;return e=new He({props:{name:o[50].user.name,description:o[50].role,$$slots:{default:[rD]},$$scope:{ctx:o}}}),{c(){V(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},p(r,n){let s={};n[0]&2048&&(s.name=r[50].user.name),n[0]&2048&&(s.description=r[50].role),n[0]&2176|n[1]&33554432&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function oD(o){let e,t,r;return{c(){e=P("input"),e.value=o[4],b(e,"type","text"),e.readOnly=!0,b(e,"id","system3InviteLink")},m(n,s){T(n,e,s),t||(r=re(e,"click",(0,mt.debounce)(o[30])),t=!0)},p(n,s){s[0]&16&&e.value!==n[4]&&(e.value=n[4])},d(n){n&&C(e),t=!1,r()}}}function nD(o){let e,t,r,n;return e=new Je({props:{name:"Membership"}}),r=new He({props:{name:"Leave Relay Server",description:"Leave the Relay Server. Local data is preserved.",$$slots:{default:[aD]},$$scope:{ctx:o}}}),{c(){V(e.$$.fragment),t=B(),V(r.$$.fragment)},m(s,a){N(e,s,a),T(s,t,a),N(r,s,a),n=!0},p(s,a){let i={};a[1]&33554432&&(i.$$scope={dirty:a,ctx:s}),r.$set(i)},i(s){n||(L(e.$$.fragment,s),L(r.$$.fragment,s),n=!0)},o(s){D(e.$$.fragment,s),D(r.$$.fragment,s),n=!1},d(s){s&&C(t),H(e,s),H(r,s)}}}function sD(o){let e,t,r,n,s,a,i,l=[lD,iD],f=[];function u(d,m){return d[12]?0:1}return e=u(o,[-1,-1]),t=f[e]=l[e](o),n=new Je({props:{name:"Storage"}}),a=new He({props:{name:"Destroy Relay Server",description:"This will destroy the Relay Server (deleting all data on the server). Local data is preserved.",$$slots:{default:[xD]},$$scope:{ctx:o}}}),{c(){t.c(),r=B(),V(n.$$.fragment),s=B(),V(a.$$.fragment)},m(d,m){f[e].m(d,m),T(d,r,m),N(n,d,m),T(d,s,m),N(a,d,m),i=!0},p(d,m){let x=e;e=u(d,m),e===x?f[e].p(d,m):(be(),D(f[x],1,1,()=>{f[x]=null}),we(),t=f[e],t?t.p(d,m):(t=f[e]=l[e](d),t.c()),L(t,1),t.m(r.parentNode,r));let h={};m[0]&64|m[1]&33554432&&(h.$$scope={dirty:m,ctx:d}),a.$set(h)},i(d){i||(L(t),L(n.$$.fragment,d),L(a.$$.fragment,d),i=!0)},o(d){D(t),D(n.$$.fragment,d),D(a.$$.fragment,d),i=!1},d(d){d&&(C(r),C(s)),f[e].d(d),H(n,d),H(a,d)}}}function aD(o){let e,t,r;return{c(){e=P("button"),e.textContent="Leave",b(e,"class","mod-warning")},m(n,s){T(n,e,s),t||(r=re(e,"click",(0,mt.debounce)(o[45])),t=!0)},p:X,d(n){n&&C(e),t=!1,r()}}}function iD(o){let e,t;return e=new He({props:{name:`Plan: ${o[7].plan}`,description:"",$$slots:{description:[fD],default:[cD]},$$scope:{ctx:o}}}),{c(){V(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},p(r,n){let s={};n[0]&128&&(s.name=`Plan: ${r[7].plan}`),n[0]&128|n[1]&33554432&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function lD(o){let e,t,r=!o[6].values()[0].active||o[6].values()[0].cancelAt,n,s;e=new He({props:{name:`Plan: ${o[7].plan}`,description:"",$$slots:{description:[dD],default:[uD]},$$scope:{ctx:o}}});let a=r&&ib(o);return{c(){V(e.$$.fragment),t=B(),a&&a.c(),n=Le()},m(i,l){N(e,i,l),T(i,t,l),a&&a.m(i,l),T(i,n,l),s=!0},p(i,l){let f={};l[0]&128&&(f.name=`Plan: ${i[7].plan}`),l[0]&4288|l[1]&33554432&&(f.$$scope={dirty:l,ctx:i}),e.$set(f),l[0]&64&&(r=!i[6].values()[0].active||i[6].values()[0].cancelAt),r?a?(a.p(i,l),l[0]&64&&L(a,1)):(a=ib(i),a.c(),L(a,1),a.m(n.parentNode,n)):a&&(be(),D(a,1,1,()=>{a=null}),we())},i(i){s||(L(e.$$.fragment,i),L(a),s=!0)},o(i){D(e.$$.fragment,i),D(a),s=!1},d(i){i&&(C(t),C(n)),H(e,i),a&&a.d(i)}}}function cD(o){let e,t,r;return{c(){e=P("button"),e.textContent="Upgrade",b(e,"class","mod-cta")},m(n,s){T(n,e,s),t||(r=re(e,"click",function(){ft((0,mt.debounce)(o[44]))&&(0,mt.debounce)(o[44]).apply(this,arguments)}),t=!0)},p(n,s){o=n},d(n){n&&C(e),t=!1,r()}}}function fD(o){let e,t=(o[7].cta||"Thanks for supporting Relay development <3")+"",r;return{c(){e=P("fragment"),r=K(t),b(e,"slot","description")},m(n,s){T(n,e,s),k(e,r)},p(n,s){s[0]&128&&t!==(t=(n[7].cta||"Thanks for supporting Relay development <3")+"")&&se(r,t)},d(n){n&&C(e)}}}function ab(o){let e,t,r;return{c(){e=P("button"),e.textContent="Cancel",b(e,"class","mod-destructive")},m(n,s){T(n,e,s),t||(r=re(e,"click",function(){ft((0,mt.debounce)(o[43]))&&(0,mt.debounce)(o[43]).apply(this,arguments)}),t=!0)},p(n,s){o=n},d(n){n&&C(e),t=!1,r()}}}function uD(o){let e,t,r=o[6].values()[0].active&&!o[6].values()[0].cancelAt,n,s,a,i=r&&ab(o);return{c(){e=P("button"),e.textContent="Manage",t=B(),i&&i.c(),n=Le()},m(l,f){T(l,e,f),T(l,t,f),i&&i.m(l,f),T(l,n,f),s||(a=re(e,"click",function(){ft((0,mt.debounce)(o[42]))&&(0,mt.debounce)(o[42]).apply(this,arguments)}),s=!0)},p(l,f){o=l,f[0]&64&&(r=o[6].values()[0].active&&!o[6].values()[0].cancelAt),r?i?i.p(o,f):(i=ab(o),i.c(),i.m(n.parentNode,n)):i&&(i.d(1),i=null)},d(l){l&&(C(e),C(t),C(n)),i&&i.d(l),s=!1,a()}}}function dD(o){let e,t=o[7].cta+"",r;return{c(){e=P("fragment"),r=K(t),b(e,"slot","description")},m(n,s){T(n,e,s),k(e,r)},p(n,s){s[0]&128&&t!==(t=n[7].cta+"")&&se(r,t)},d(n){n&&C(e)}}}function ib(o){let e,t;return e=new He({props:{description:"",$$slots:{name:[mD],default:[pD]},$$scope:{ctx:o}}}),{c(){V(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},p(r,n){let s={};n[0]&64|n[1]&33554432&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function pD(o){let e=o[14](o[6].values()[0].cancelAt)+"",t;return{c(){t=K(e)},m(r,n){T(r,t,n)},p(r,n){n[0]&64&&e!==(e=r[14](r[6].values()[0].cancelAt)+"")&&se(t,e)},d(r){r&&C(t)}}}function mD(o){let e;return{c(){e=P("span"),e.textContent="Status: Cancelled",b(e,"slot","name"),b(e,"class","mod-warning")},m(t,r){T(t,e,r)},p:X,d(t){t&&C(e)}}}function hD(o){let e,t,r;return{c(){e=P("button"),e.textContent="Destroy",b(e,"class","mod-warning")},m(n,s){T(n,e,s),t||(r=re(e,"click",(0,mt.debounce)(o[27])),t=!0)},p:X,d(n){n&&C(e),t=!1,r()}}}function gD(o){let e,t;return{c(){e=P("button"),e.textContent="Destroy",e.disabled=t=!0,b(e,"class","mod-warning"),b(e,"aria-label","Cancel subscription to destroy Relay Server.")},m(r,n){T(r,e,n)},p:X,d(r){r&&C(e)}}}function xD(o){let e,t;function r(a,i){return i[0]&64&&(e=null),e==null&&(e=a[6].values().length>0&&!a[6].values()[0].cancelAt),e?gD:hD}let n=r(o,[-1,-1]),s=n(o);return{c(){s.c(),t=Le()},m(a,i){s.m(a,i),T(a,t,i)},p(a,i){n===(n=r(a,i))&&s?s.p(a,i):(s.d(1),s=n(a),s&&(s.c(),s.m(t.parentNode,t)))},d(a){a&&C(t),s.d(a)}}}function yD(o){let e,t,r,n,s,a,i,l,f,u,d,m,x,h,_,w,v,A,U;e=new jl({props:{category:dn,categoryText:"Relay Servers",$$slots:{default:[WP]},$$scope:{ctx:o}}}),e.$on("goBack",o[23]);let I=o[0].owner&&rb(o);n=new Je({props:{name:"Folders on this Relay Server"}});let F=Fe(o[9].values()),$=[];for(let W=0;W<F.length;W+=1)$[W]=ob(tb(o,F,W));let E=W=>D($[W],1,1,()=>{$[W]=null});i=new He({props:{description:"",name:"",$$slots:{default:[eD]},$$scope:{ctx:o}}}),f=new Je({props:{name:"Users",$$slots:{default:[tD]},$$scope:{ctx:o}}});let M=Fe(o[11].values().sort(lb)),R=[];for(let W=0;W<M.length;W+=1)R[W]=sb(eb(o,M,W));let q=W=>D(R[W],1,1,()=>{R[W]=null});m=new Je({props:{name:"Sharing"}}),h=new He({props:{name:"Share Key",description:"Share this key with your collaborators.",$$slots:{default:[oD]},$$scope:{ctx:o}}});let J=[sD,nD],G=[];function z(W,oe){return W[7].owner?0:1}return w=z(o,[-1,-1]),v=G[w]=J[w](o),{c(){V(e.$$.fragment),t=B(),I&&I.c(),r=B(),V(n.$$.fragment),s=B();for(let W=0;W<$.length;W+=1)$[W].c();a=B(),V(i.$$.fragment),l=B(),V(f.$$.fragment),u=B();for(let W=0;W<R.length;W+=1)R[W].c();d=B(),V(m.$$.fragment),x=B(),V(h.$$.fragment),_=B(),v.c(),A=Le()},m(W,oe){N(e,W,oe),T(W,t,oe),I&&I.m(W,oe),T(W,r,oe),N(n,W,oe),T(W,s,oe);for(let Ie=0;Ie<$.length;Ie+=1)$[Ie]&&$[Ie].m(W,oe);T(W,a,oe),N(i,W,oe),T(W,l,oe),N(f,W,oe),T(W,u,oe);for(let Ie=0;Ie<R.length;Ie+=1)R[Ie]&&R[Ie].m(W,oe);T(W,d,oe),N(m,W,oe),T(W,x,oe),N(h,W,oe),T(W,_,oe),G[w].m(W,oe),T(W,A,oe),U=!0},p(W,oe){let Ie={};if(oe[0]&1|oe[1]&33554432&&(Ie.$$scope={dirty:oe,ctx:W}),e.$set(Ie),W[0].owner?I?(I.p(W,oe),oe[0]&1&&L(I,1)):(I=rb(W),I.c(),L(I,1),I.m(r.parentNode,r)):I&&(be(),D(I,1,1,()=>{I=null}),we()),oe[0]&570426880){F=Fe(W[9].values());let de;for(de=0;de<F.length;de+=1){let ce=tb(W,F,de);$[de]?($[de].p(ce,oe),L($[de],1)):($[de]=ob(ce),$[de].c(),L($[de],1),$[de].m(a.parentNode,a))}for(be(),de=F.length;de<$.length;de+=1)E(de);we()}let De={};oe[1]&33554432&&(De.$$scope={dirty:oe,ctx:W}),i.$set(De);let Me={};if(oe[0]&2176|oe[1]&33554432&&(Me.$$scope={dirty:oe,ctx:W}),f.$set(Me),oe[0]&268437632){M=Fe(W[11].values().sort(lb));let de;for(de=0;de<M.length;de+=1){let ce=eb(W,M,de);R[de]?(R[de].p(ce,oe),L(R[de],1)):(R[de]=sb(ce),R[de].c(),L(R[de],1),R[de].m(d.parentNode,d))}for(be(),de=M.length;de<R.length;de+=1)q(de);we()}let Ye={};oe[0]&16|oe[1]&33554432&&(Ye.$$scope={dirty:oe,ctx:W}),h.$set(Ye);let Re=w;w=z(W,oe),w===Re?G[w].p(W,oe):(be(),D(G[Re],1,1,()=>{G[Re]=null}),we(),v=G[w],v?v.p(W,oe):(v=G[w]=J[w](W),v.c()),L(v,1),v.m(A.parentNode,A))},i(W){if(!U){L(e.$$.fragment,W),L(I),L(n.$$.fragment,W);for(let oe=0;oe<F.length;oe+=1)L($[oe]);L(i.$$.fragment,W),L(f.$$.fragment,W);for(let oe=0;oe<M.length;oe+=1)L(R[oe]);L(m.$$.fragment,W),L(h.$$.fragment,W),L(v),U=!0}},o(W){D(e.$$.fragment,W),D(I),D(n.$$.fragment,W),$=$.filter(Boolean);for(let oe=0;oe<$.length;oe+=1)D($[oe]);D(i.$$.fragment,W),D(f.$$.fragment,W),R=R.filter(Boolean);for(let oe=0;oe<R.length;oe+=1)D(R[oe]);D(m.$$.fragment,W),D(h.$$.fragment,W),D(v),U=!1},d(W){W&&(C(t),C(r),C(s),C(a),C(l),C(u),C(d),C(x),C(_),C(A)),H(e,W),I&&I.d(W),H(n,W),it($,W),H(i,W),H(f,W),it(R,W),H(m,W),H(h,W),G[w].d(W)}}}function lb(o,e){return o.role==="Owner"&&e.role!=="Owner"?-1:o.role!=="Owner"&&e.role==="Owner"||o.user.name>e.user.name?1:-1}function bD(o){if(/[\\:*?"<>|]/.test(o))return!1;let t=o.split("/");for(let r of t)if(r===""||r==="."||r==="..")return!1;return!0}function wD(o,e,t){let r,n,s=X,a=()=>(s(),s=Qt($,ne=>t(46,n=ne)),$),i,l,f=X,u=()=>(f(),f=Qt(A,ne=>t(7,l=ne)),A),d,m,x,h=X,_=()=>(h(),h=Qt(F,ne=>t(10,x=ne)),F),w,v;o.$$.on_destroy.push(()=>s()),o.$$.on_destroy.push(()=>f()),o.$$.on_destroy.push(()=>h());let{relay:A}=e;u();let U=A.folders;me(o,U,ne=>t(9,m=ne));let{plugin:I}=e,{sharedFolders:F}=e;_();let{relayRoles:$}=e;a();function E(ne){if(!ne)return"Active";let We=(0,bp.default)(),tt=(0,bp.default)(ne).diff(We,"days");return tt<=0?"Subscription has ended":tt===1?"Active for 1 more day":`Active for ${tt} more days`}let M=l.subscriptions;me(o,M,ne=>t(6,i=ne));let R=fo(i,ne=>{if(ne.values().length===0)return;let We=ne.values()[0];return We.token||I.relayManager.getSubscriptionToken(We).then(nt=>{We.token=nt}),We});me(o,R,ne=>t(12,v=ne));let q=n.filter(ne=>ne.relayId===A.id);me(o,q,ne=>t(11,w=ne));let J=_e(!0);me(o,J,ne=>t(5,r=ne));let G;er(()=>{G&&G.value===""&&G.focus()});let z=$t();function W(ne){return Ge(this,void 0,void 0,function*(){var We;if(!(!((We=I.loginManager)===null||We===void 0)&&We.user))return;let nt={relay:ne.id,quantity:10,user_email:I.loginManager.user.email},tt=btoa(JSON.stringify(nt)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");window.open(I.buildApiUrl(`/subscribe/${tt}`),"_blank")})}function oe(ne){return Ge(this,void 0,void 0,function*(){let We=ne.token,nt=ne.id;window.open(I.buildApiUrl(`/subscriptions/${nt}/manage?token=${We}`),"_blank")})}function Ie(ne){return Ge(this,void 0,void 0,function*(){let We=ne.token,nt=ne.id;window.open(I.buildApiUrl(`/subscriptions/${nt}/cancel?token=${We}`),"_blank")})}function De(){return Ge(this,void 0,void 0,function*(){I.relayManager.leaveRelay(A),z("goBack",{clear:!0})})}function Me(){return Ge(this,void 0,void 0,function*(){z("goBack",{clear:!0})})}let Ye;I.relayManager.getRelayInvitationKey(A).then(ne=>{t(4,Ye=ne)});function Re(ne,We,nt){return Ge(this,void 0,void 0,function*(){let tt=(0,mt.normalizePath)((0,cb.join)(nt,We));I.vault.getFolderByPath(tt)===null&&(yield I.vault.createFolder(tt));let Ae=I.sharedFolders.new(tt,ne.guid,A.guid,!0);return Ae.remote=ne,I.sharedFolders.notifyListeners(),Ae})}let de=_e(!1);me(o,de,ne=>t(8,d=ne));let ce=I.timeProvider.debounce(()=>{I.relayManager.updateRelay(A).then(()=>{de.set(!1)})},500),te=ne=>{new Ql(I.app,F,ne,Re).open()};function $e(){J.set(bD(G.value)),r&&G.value!==""&&(de.set(!0),ce())}function Lt(){I.relayManager.destroyRelay(A),z("goBack",{})}function Mt(ne){I.relayManager.kick(ne)}function Et(ne,We){ne&&z("manageSharedFolder",{folder:ne,relay:We,mount:!1})}function ht(ne){let We=ne.target;We.focus(),We.select(),navigator.clipboard.writeText(We.value).then(()=>new mt.Notice("Invite link copied")).catch(nt=>{})}let gt=new Yl(I.app,F,ne=>Ge(void 0,void 0,void 0,function*(){let We=(0,mt.normalizePath)(ne),nt=F.find(Jr=>Jr.path==ne);if(nt){let Jr=yield I.relayManager.createRemoteFolder(nt,A);nt.remote=Jr,nt.connect(),I.sharedFolders.notifyListeners();return}I.vault.getFolderByPath(We)===null&&(yield I.vault.createFolder(We));let tt=us(),Ae=I.sharedFolders.new((0,mt.normalizePath)(ne),tt,A.guid,!0),Yr=yield I.relayManager.createRemoteFolder(Ae,A);Ae.remote=Yr,I.sharedFolders.notifyListeners()})),ut=(ne,We)=>We.remote===ne;function Wt(){A.name=this.value,u(t(0,A))}function mn(ne){Er[ne?"unshift":"push"](()=>{G=ne,t(3,G)})}let Wn=(ne,We)=>We.remote===ne;function Qs(ne){Kr.call(this,o,ne)}let Zs=ne=>{let We=x.find(nt=>nt.remote===ne);We&&Et(We,ne.relay)},zn=ne=>{te(ne)},ea=()=>{gt.open()},kr=ne=>{Mt(ne)},ot=()=>{oe(v)},Ht=()=>{Ie(v)},ho=()=>{W(l)},hn=()=>{De()};return o.$$set=ne=>{"relay"in ne&&u(t(0,A=ne.relay)),"plugin"in ne&&t(32,I=ne.plugin),"sharedFolders"in ne&&_(t(1,F=ne.sharedFolders)),"relayRoles"in ne&&a(t(2,$=ne.relayRoles))},[A,F,$,G,Ye,r,i,l,d,m,x,w,v,U,E,M,R,q,J,W,oe,Ie,De,Me,de,te,$e,Lt,Mt,Et,ht,gt,I,ut,Wt,mn,Wn,Qs,Zs,zn,ea,kr,ot,Ht,ho,hn]}var wp=class extends Z{constructor(e){super(),ee(this,e,wD,yD,Q,{relay:0,plugin:32,sharedFolders:1,relayRoles:2},HP,[-1,-1])}},Ys=wp;function _D(o){let e,t,r,n,s,a;return r=new Bu({}),{c(){e=P("div"),t=P("div"),V(r.$$.fragment),b(t,"class","clickable-icon"),b(t,"aria-label","Back"),b(t,"tabindex","0"),b(t,"role","button"),b(e,"class","modal-setting-nav-bar")},m(i,l){T(i,e,l),k(e,t),N(r,t,null),n=!0,s||(a=[re(t,"click",o[0]),re(t,"keypress",o[1])],s=!0)},p:X,i(i){n||(L(r.$$.fragment,i),n=!0)},o(i){D(r.$$.fragment,i),n=!1},d(i){i&&C(e),H(r),s=!1,ke(a)}}}function vD(o){let e=$t();function t(){e("goBack",{})}function r(n){n.key==="Escape"&&(e("goBack",{}),n.stopPropagation())}return[t,r]}var _p=class extends Z{constructor(e){super(),ee(this,e,vD,_D,Q,{})}},fb=_p;var Js=require("obsidian");function SD(o){let e=o[1].name+"",t;return{c(){t=K(e)},m(r,n){T(r,t,n)},p(r,n){n&2&&e!==(e=r[1].name+"")&&se(t,e)},d(r){r&&C(t)}}}function kD(o){let e,t,r;return{c(){e=P("button"),e.textContent="Delete local",b(e,"class","mod-warning")},m(n,s){T(n,e,s),t||(r=re(e,"click",(0,Js.debounce)(o[13])),t=!0)},p:X,d(n){n&&C(e),t=!1,r()}}}function ID(o){let e,t,r,n,s,a,i;return{c(){e=P("button"),t=K("Delete metadata"),b(e,"class",r=o[4]?"mod-disabled":"mod-warning"),e.disabled=n=!!o[4],b(e,"aria-label",s=o[4]?"Metadata is required for sharing.":"")},m(l,f){T(l,e,f),k(e,t),a||(i=re(e,"click",(0,Js.debounce)(o[14])),a=!0)},p(l,f){f&16&&r!==(r=l[4]?"mod-disabled":"mod-warning")&&b(e,"class",r),f&16&&n!==(n=!!l[4])&&(e.disabled=n),f&16&&s!==(s=l[4]?"Metadata is required for sharing.":"")&&b(e,"aria-label",s)},d(l){l&&C(e),a=!1,i()}}}function ub(o){var n,s,a,i,l;let e,t,r=(((n=o[4])==null?void 0:n.owner)||((i=(a=(s=o[3])==null?void 0:s.remote)==null?void 0:a.creator)==null?void 0:i.id)===((l=o[0].relayManager.user)==null?void 0:l.id))&&db(o);return{c(){r&&r.c(),e=Le()},m(f,u){r&&r.m(f,u),T(f,e,u),t=!0},p(f,u){var d,m,x,h,_;(d=f[4])!=null&&d.owner||((h=(x=(m=f[3])==null?void 0:m.remote)==null?void 0:x.creator)==null?void 0:h.id)===((_=f[0].relayManager.user)==null?void 0:_.id)?r?(r.p(f,u),u&25&&L(r,1)):(r=db(f),r.c(),L(r,1),r.m(e.parentNode,e)):r&&(be(),D(r,1,1,()=>{r=null}),we())},i(f){t||(L(r),t=!0)},o(f){D(r),t=!1},d(f){f&&C(e),r&&r.d(f)}}}function db(o){let e,t,r,n;return e=new Je({props:{name:"Remote Folder"}}),r=new He({props:{name:"Remove from relay",description:"Deletes the remote folder from the relay. Local files will be preserved.",$$slots:{default:[LD]},$$scope:{ctx:o}}}),{c(){V(e.$$.fragment),t=B(),V(r.$$.fragment)},m(s,a){N(e,s,a),T(s,t,a),N(r,s,a),n=!0},p(s,a){let i={};a&1048576&&(i.$$scope={dirty:a,ctx:s}),r.$set(i)},i(s){n||(L(e.$$.fragment,s),L(r.$$.fragment,s),n=!0)},o(s){D(e.$$.fragment,s),D(r.$$.fragment,s),n=!1},d(s){s&&C(t),H(e,s),H(r,s)}}}function LD(o){let e,t,r;return{c(){e=P("button"),e.textContent="Delete remote",b(e,"class","mod-destructive")},m(n,s){T(n,e,s),t||(r=re(e,"click",(0,Js.debounce)(o[9])),t=!0)},p:X,d(n){n&&C(e),t=!1,r()}}}function CD(o){let e,t;return e=new He({props:{description:"This folder is tracking edits, but is not connected to a Relay Server."}}),{c(){V(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},p:X,i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function TD(o){let e,t;return e=new fr({props:{$$slots:{name:[AD],default:[PD]},$$scope:{ctx:o}}}),{c(){V(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},p(r,n){let s={};n&1048592&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function PD(o){let e,t;return e=new Nn({}),e.$on("settings",function(){ft((0,Js.debounce)(o[16]))&&(0,Js.debounce)(o[16]).apply(this,arguments)}),{c(){V(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},p(r,n){o=r},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function DD(o){let e=o[4].name+"",t;return{c(){t=K(e)},m(r,n){T(r,t,n)},p(r,n){n&16&&e!==(e=r[4].name+"")&&se(t,e)},d(r){r&&C(t)}}}function AD(o){let e,t;return e=new dn({props:{slot:"name",relay:o[4],$$slots:{default:[DD]},$$scope:{ctx:o}}}),e.$on("manageRelay",o[15]),{c(){V(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},p(r,n){let s={};n&16&&(s.relay=r[4]),n&1048592&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function MD(o){let e,t,r,n,s,a,i,l,f,u,d,m,x,h,_;e=new jl({props:{category:uo,categoryText:"Shared Folders",$$slots:{default:[SD]},$$scope:{ctx:o}}}),e.$on("goBack",o[7]),r=new Je({props:{name:"Local folder"}}),s=new He({props:{name:"Delete from vault",description:"Delete the local Shared Folder and all of its contents.",$$slots:{default:[kD]},$$scope:{ctx:o}}}),i=new He({props:{name:"Delete metadata",description:"Deletes edit history and disables change tracking.",$$slots:{default:[ID]},$$scope:{ctx:o}}});let w=o[4]&&ub(o);u=new Je({props:{name:"Relay Server"}});let v=[TD,CD],A=[];function U(I,F){return I[4]?0:1}return m=U(o,-1),x=A[m]=v[m](o),{c(){V(e.$$.fragment),t=B(),V(r.$$.fragment),n=B(),V(s.$$.fragment),a=B(),V(i.$$.fragment),l=B(),w&&w.c(),f=B(),V(u.$$.fragment),d=B(),x.c(),h=Le()},m(I,F){N(e,I,F),T(I,t,F),N(r,I,F),T(I,n,F),N(s,I,F),T(I,a,F),N(i,I,F),T(I,l,F),w&&w.m(I,F),T(I,f,F),N(u,I,F),T(I,d,F),A[m].m(I,F),T(I,h,F),_=!0},p(I,[F]){let $={};F&1048578&&($.$$scope={dirty:F,ctx:I}),e.$set($);let E={};F&1048576&&(E.$$scope={dirty:F,ctx:I}),s.$set(E);let M={};F&1048592&&(M.$$scope={dirty:F,ctx:I}),i.$set(M),I[4]?w?(w.p(I,F),F&16&&L(w,1)):(w=ub(I),w.c(),L(w,1),w.m(f.parentNode,f)):w&&(be(),D(w,1,1,()=>{w=null}),we());let R=m;m=U(I,F),m===R?A[m].p(I,F):(be(),D(A[R],1,1,()=>{A[R]=null}),we(),x=A[m],x?x.p(I,F):(x=A[m]=v[m](I),x.c()),L(x,1),x.m(h.parentNode,h))},i(I){_||(L(e.$$.fragment,I),L(r.$$.fragment,I),L(s.$$.fragment,I),L(i.$$.fragment,I),L(w),L(u.$$.fragment,I),L(x),_=!0)},o(I){D(e.$$.fragment,I),D(r.$$.fragment,I),D(s.$$.fragment,I),D(i.$$.fragment,I),D(w),D(u.$$.fragment,I),D(x),_=!1},d(I){I&&(C(t),C(n),C(a),C(l),C(f),C(d),C(h)),H(e,I),H(r,I),H(s,I),H(i,I),w&&w.d(I),H(u,I),A[m].d(I)}}}function ED(o,e,t){let r,n,s=X,a=()=>(s(),s=Qt(u,R=>t(17,n=R)),u),i;o.$$.on_destroy.push(()=>s());let{plugin:l}=e,{sharedFolder:f}=e,{sharedFolders:u}=e;a();let{relayRoles:d}=e,m=fo(n,R=>R.find(q=>q===f));me(o,m,R=>t(3,r=R));let x=fo([m,d],([R,q])=>{var J;return(J=q.find(G=>{var z;return G.relay===((z=R==null?void 0:R.remote)===null||z===void 0?void 0:z.relay)}))===null||J===void 0?void 0:J.relay});me(o,x,R=>t(4,i=R));let h;er(()=>{!f&&h&&h.value===""&&h.focus()});let _=$t();function w(){return Ge(this,void 0,void 0,function*(){_("goBack",{clear:!0})})}function v(R){R&&_("manageRelay",{relay:R})}function A(){return Ge(this,void 0,void 0,function*(){yield l.relayManager.deleteRemote(f),l.sharedFolders.notifyListeners()})}function U(){return Ge(this,void 0,void 0,function*(){r&&l.sharedFolders.delete(r),_("goBack",{clear:!0})})}function I(){let R=l.vault.getFolderByPath(f.path);R&&l.app.vault.trash(R,!1),_("goBack",{})}let F=()=>{I()},$=()=>{U()};function E(R){Kr.call(this,o,R)}let M=()=>{v(i)};return o.$$set=R=>{"plugin"in R&&t(0,l=R.plugin),"sharedFolder"in R&&t(1,f=R.sharedFolder),"sharedFolders"in R&&a(t(2,u=R.sharedFolders)),"relayRoles"in R&&t(12,d=R.relayRoles)},[l,f,u,r,i,m,x,w,v,A,U,I,d,F,$,E,M]}var vp=class extends Z{constructor(e){super(),ee(this,e,ED,MD,Q,{plugin:0,sharedFolder:1,sharedFolders:2,relayRoles:12})}},Sp=vp;function FD(o){let e=[],t="",r=0;for(;r<o.length;)o[r]==="*"&&r+1<o.length&&o[r+1]==="*"?(t&&(e.push({type:"TEXT",value:t}),t=""),e.push({type:"DOUBLE_STAR"}),r+=2):o[r]==="*"?(t&&(e.push({type:"TEXT",value:t}),t=""),e.push({type:"STAR"}),r++):(t+=o[r],r++);return t&&e.push({type:"TEXT",value:t}),e}function RD(o){let e="",t="NORMAL",r=0;for(;r<o.length;){let n=o[r];switch(t){case"NORMAL":n.type==="TEXT"?e+=n.value:n.type==="STAR"?(t="EMPHASIS",e+="<u>"):n.type==="DOUBLE_STAR"&&(t="BOLD",e+="<strong>");break;case"EMPHASIS":n.type==="TEXT"?e+=n.value:n.type==="STAR"?(t="NORMAL",e+="</u>"):n.type==="DOUBLE_STAR"&&(t="BOLD",e+="</u><strong>");break;case"BOLD":n.type==="TEXT"?e+=n.value:n.type==="STAR"?e+="*":n.type==="DOUBLE_STAR"&&(t="NORMAL",e+="</strong>");break}r++}return t==="EMPHASIS"?e+="</u>":t==="BOLD"&&(e+="</strong>"),e}function kp(o){let e=FD(o);return RD(e)}function OD(o){Pe(o,"svelte-d22j3",".relay-version.svelte-d22j3{user-select:auto;background:var(--color-base-10);color:var(--text-faint);position:absolute;bottom:0;right:0;font-size:xx-small;padding-right:1em;padding-top:0.3em;padding-left:1em;border-top-left-radius:1em}.vertical-tab-content.svelte-d22j3{max-height:var(--modal-max-height);position:relative}.system3-announcement-banner.svelte-d22j3{padding-left:48px !important}.system3-announcement.svelte-d22j3{color:var(--text-on-accent)}")}function UD(o){let e,t,r,n,s=o[0].networkStatus.status&&pb(o);return{c(){e=P("div"),t=P("span"),s&&s.c(),b(t,"class","system3-announcement svelte-d22j3"),ue(t,"color",o[0].networkStatus.status.color?o[0].networkStatus.status.color:"var(--text-on-accent)",1),b(e,"class","modal-setting-nav-bar system3-announcement-banner svelte-d22j3"),b(e,"role","button"),b(e,"tabindex","0"),ue(e,"background-color",o[0].networkStatus.status.backgroundColor?o[0].networkStatus.status.backgroundColor:"var(--color-accent)",1)},m(a,i){T(a,e,i),k(e,t),s&&s.m(t,null),r||(n=[re(e,"click",o[17]),re(e,"keypress",o[18])],r=!0)},p(a,i){a[0].networkStatus.status?s?s.p(a,i):(s=pb(a),s.c(),s.m(t,null)):s&&(s.d(1),s=null),i&1&&ue(t,"color",a[0].networkStatus.status.color?a[0].networkStatus.status.color:"var(--text-on-accent)",1),i&1&&ue(e,"background-color",a[0].networkStatus.status.backgroundColor?a[0].networkStatus.status.backgroundColor:"var(--color-accent)",1)},i:X,o:X,d(a){a&&C(e),s&&s.d(),r=!1,ke(n)}}}function $D(o){let e,t;return e=new fb({}),e.$on("goBack",o[9]),{c(){V(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},p:X,i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function pb(o){let e,t=kp(o[0].networkStatus.status.status)+"",r;return{c(){e=new Rs(!1),r=Le(),e.a=r},m(n,s){e.m(t,n,s),T(n,r,s)},p(n,s){s&1&&t!==(t=kp(n[0].networkStatus.status.status)+"")&&e.p(t)},d(n){n&&(C(r),e.d())}}}function BD(o){let e,t;return e=new Dy({props:{plugin:o[0],$$slots:{default:[VD]},$$scope:{ctx:o}}}),{c(){V(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},p(r,n){let s={};n&1&&(s.plugin=r[0]),n&8388609&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function ND(o){let e,t;return e=new Ys({props:{plugin:o[0],relayRoles:o[3],relay:o[2],sharedFolders:o[5]}}),e.$on("goBack",o[9]),e.$on("close",o[10]),e.$on("manageSharedFolder",o[7]),{c(){V(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},p(r,n){let s={};n&1&&(s.plugin=r[0]),n&4&&(s.relay=r[2]),e.$set(s)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function HD(o){let e,t;return e=new Sp({props:{plugin:o[0],relayRoles:o[3],sharedFolder:o[1],sharedFolders:o[5]}}),e.$on("goBack",o[9]),e.$on("close",o[10]),e.$on("manageRelay",o[6]),{c(){V(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},p(r,n){let s={};n&1&&(s.plugin=r[0]),n&2&&(s.sharedFolder=r[1]),e.$set(s)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function VD(o){let e,t;return e=new po({props:{relays:o[4],plugin:o[0]}}),e.$on("manageRelay",o[6]),e.$on("manageSharedFolder",o[7]),e.$on("createRelay",o[8]),e.$on("joinRelay",o[11]),{c(){V(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},p(r,n){let s={};n&1&&(s.plugin=r[0]),e.$set(s)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function mb(o){let e,t=o[0].version+"",r;return{c(){e=P("span"),r=K(t),b(e,"class","relay-version svelte-d22j3")},m(n,s){T(n,e,s),k(e,r)},p(n,s){s&1&&t!==(t=n[0].version+"")&&se(r,t)},d(n){n&&C(e)}}}function qD(o){let e,t,r,n,s,a,i,l,f,u=[$D,UD],d=[];function m(v,A){return v[2]||v[1]?0:v[0].networkStatus.status?1:-1}~(e=m(o,-1))&&(t=d[e]=u[e](o));let x=[HD,ND,BD],h=[];function _(v,A){return v[1]?0:v[2]?1:2}s=_(o,-1),a=h[s]=x[s](o);let w=o[0].manifest.version!==o[0].version&&mb(o);return{c(){t&&t.c(),r=B(),n=P("div"),a.c(),i=B(),w&&w.c(),l=Le(),b(n,"class","vertical-tab-content svelte-d22j3")},m(v,A){~e&&d[e].m(v,A),T(v,r,A),T(v,n,A),h[s].m(n,null),T(v,i,A),w&&w.m(v,A),T(v,l,A),f=!0},p(v,[A]){let U=e;e=m(v,A),e===U?~e&&d[e].p(v,A):(t&&(be(),D(d[U],1,1,()=>{d[U]=null}),we()),~e?(t=d[e],t?t.p(v,A):(t=d[e]=u[e](v),t.c()),L(t,1),t.m(r.parentNode,r)):t=null);let I=s;s=_(v,A),s===I?h[s].p(v,A):(be(),D(h[I],1,1,()=>{h[I]=null}),we(),a=h[s],a?a.p(v,A):(a=h[s]=x[s](v),a.c()),L(a,1),a.m(n,null)),v[0].manifest.version!==v[0].version?w?w.p(v,A):(w=mb(v),w.c(),w.m(l.parentNode,l)):w&&(w.d(1),w=null)},i(v){f||(L(t),L(a),f=!0)},o(v){D(t),D(a),f=!1},d(v){v&&(C(r),C(n),C(i),C(l)),~e&&d[e].d(v),h[s].d(),w&&w.d(v)}}}function WD(o,e,t){let r,{plugin:n}=e,{path:s=void 0}=e,a=n.app,i=n.relayManager,l=i.relayRoles,f=i.relays;me(o,f,q=>t(16,r=q));let u=n.sharedFolders,d,m=po,x,h=[{component:po}],{close:_}=e;function w(q){if(t(2,x=void 0),t(1,d=void 0),q==="/"){t(15,m=po);return}let J=new URLSearchParams(q.split("?")[1]||""),G=J.get("id");if(q.startsWith("/relays")){G?(t(2,x=i.relays.find(z=>z.guid===G)),t(15,m=Ys)):t(15,m=po);return}if(q.startsWith("/shared-folders")){if(G){t(1,d=u.find(W=>W.guid===G));let z=J.get("relay");z&&t(2,x=i.relays.get(z)),t(15,m=Sp)}return}}function v(q){h.push({currentRelay:x,sharedFolder:d,component:m}),t(2,x=q.detail.relay),t(1,d=void 0),t(15,m=Ys)}function A(q){h.push({currentRelay:x,sharedFolder:d,component:m}),t(1,d=q.detail.folder),t(2,x=q.detail.relay)}function U(q){return Ge(this,void 0,void 0,function*(){h.push({currentRelay:x,sharedFolder:d,component:m}),t(2,x=yield n.relayManager.createRelay("")),t(15,m=Ys)})}function I(q){if(q.detail.clear){h.length=0,t(2,x=void 0),t(1,d=void 0),t(15,m=po);return}let J=h.pop();if(J)for(;J;){if(!J.currentRelay&&!J.sharedFolder)t(2,x=J.currentRelay),t(1,d=J.sharedFolder),t(15,m=J.component);else if(J.sharedFolder&&u.has(J.sharedFolder)){t(2,x=J.currentRelay),t(1,d=J.sharedFolder),t(15,m=J.component);break}else if(J.currentRelay&&i.relays.get(J.currentRelay.id)){t(2,x=J.currentRelay),t(1,d=J.sharedFolder),t(15,m=J.component);break}J=h.pop()}else t(2,x=void 0),t(1,d=void 0),t(15,m=po)}function F(q){h.length=0,_()}function $(q){t(2,x=q.detail.relay),t(15,m=Ys)}function E(){var q;!((q=n.networkStatus.status)===null||q===void 0)&&q.versions&&(n.releaseSettings.get().channel==="stable"?n.installVersion(n.networkStatus.status.versions.stable):n.releaseSettings.get().channel==="beta"&&n.installVersion(n.networkStatus.status.versions.beta))}let M=()=>{var q,J;(q=n.networkStatus.status)!=null&&q.versions?E():(J=n.networkStatus.status)!=null&&J.link&&window.open(n.networkStatus.status.link)},R=()=>{var q,J;(q=n.networkStatus.status)!=null&&q.versions?E():(J=n.networkStatus.status)!=null&&J.link&&window.open(n.networkStatus.status.link)};return o.$$set=q=>{"plugin"in q&&t(0,n=q.plugin),"path"in q&&t(13,s=q.path),"close"in q&&t(14,_=q.close)},o.$$.update=()=>{if(o.$$.dirty&8192){e:s&&w(s)}if(o.$$.dirty&65540){e:x&&!r.has(x.id)&&(t(2,x=void 0),t(15,m=po))}if(o.$$.dirty&2){e:d&&!u.has(d)&&(t(1,d=void 0),t(15,m=po))}if(o.$$.dirty&32774){e:(m||x||d)&&setTimeout(()=>{let q=document.querySelector(".vertical-tab-content");q&&(q.scrollTop=0)},0)}},[n,d,x,l,f,u,v,A,U,I,F,$,E,s,_,m,r,M,R]}var Ip=class extends Z{constructor(e){super(),ee(this,e,WD,qD,Q,{plugin:0,path:13,close:14},OD)}},hb=Ip;var Zl=class extends gb.PluginSettingTab{constructor(t,r){super(t,r);this.plugin=r}display(){let{containerEl:t}=this;this.targetEl=t.parentElement,this.targetEl.empty(),this.plugin.relayManager.update(),this.component=new hb({target:this.targetEl,props:{plugin:this.plugin,close:()=>{this.setting.close()}}})}navigateTo(t){var r;(r=this.component)==null||r.$set({path:t})}hide(){var t;try{(t=this.component)==null||t.$destroy()}catch(r){console.warn(r)}}destroy(){this.hide(),this.plugin=null}};var Sb=require("obsidian");var tr=class extends Error{constructor(e){var t,r,n,s;super("ClientResponseError"),this.url="",this.status=0,this.response={},this.isAbort=!1,this.originalError=null,Object.setPrototypeOf(this,tr.prototype),e!==null&&typeof e=="object"&&(this.url=typeof e.url=="string"?e.url:"",this.status=typeof e.status=="number"?e.status:0,this.isAbort=!!e.isAbort,this.originalError=e.originalError,e.response!==null&&typeof e.response=="object"?this.response=e.response:e.data!==null&&typeof e.data=="object"?this.response=e.data:this.response={}),this.originalError||e instanceof tr||(this.originalError=e),typeof DOMException!="undefined"&&e instanceof DOMException&&(this.isAbort=!0),this.name="ClientResponseError "+this.status,this.message=(t=this.response)==null?void 0:t.message,this.message||(this.isAbort?this.message="The request was autocancelled. You can find more info in https://github.com/pocketbase/js-sdk#auto-cancellation.":(s=(n=(r=this.originalError)==null?void 0:r.cause)==null?void 0:n.message)!=null&&s.includes("ECONNREFUSED ::1")?this.message="Failed to connect to the PocketBase server. Try changing the SDK URL from localhost to 127.0.0.1 (https://github.com/pocketbase/js-sdk/issues/21).":this.message="Something went wrong while processing your request.")}get data(){return this.response}toJSON(){return{...this}}},ec=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function zD(o,e){let t={};if(typeof o!="string")return t;let r=Object.assign({},e||{}).decode||KD,n=0;for(;n<o.length;){let s=o.indexOf("=",n);if(s===-1)break;let a=o.indexOf(";",n);if(a===-1)a=o.length;else if(a<s){n=o.lastIndexOf(";",s-1)+1;continue}let i=o.slice(n,s).trim();if(t[i]===void 0){let l=o.slice(s+1,a).trim();l.charCodeAt(0)===34&&(l=l.slice(1,-1));try{t[i]=r(l)}catch(f){t[i]=l}}n=a+1}return t}function xb(o,e,t){let r=Object.assign({},t||{}),n=r.encode||GD;if(!ec.test(o))throw new TypeError("argument name is invalid");let s=n(e);if(s&&!ec.test(s))throw new TypeError("argument val is invalid");let a=o+"="+s;if(r.maxAge!=null){let i=r.maxAge-0;if(isNaN(i)||!isFinite(i))throw new TypeError("option maxAge is invalid");a+="; Max-Age="+Math.floor(i)}if(r.domain){if(!ec.test(r.domain))throw new TypeError("option domain is invalid");a+="; Domain="+r.domain}if(r.path){if(!ec.test(r.path))throw new TypeError("option path is invalid");a+="; Path="+r.path}if(r.expires){if(!function(l){return Object.prototype.toString.call(l)==="[object Date]"||l instanceof Date}(r.expires)||isNaN(r.expires.valueOf()))throw new TypeError("option expires is invalid");a+="; Expires="+r.expires.toUTCString()}if(r.httpOnly&&(a+="; HttpOnly"),r.secure&&(a+="; Secure"),r.priority)switch(typeof r.priority=="string"?r.priority.toLowerCase():r.priority){case"low":a+="; Priority=Low";break;case"medium":a+="; Priority=Medium";break;case"high":a+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}if(r.sameSite)switch(typeof r.sameSite=="string"?r.sameSite.toLowerCase():r.sameSite){case!0:a+="; SameSite=Strict";break;case"lax":a+="; SameSite=Lax";break;case"strict":a+="; SameSite=Strict";break;case"none":a+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return a}function KD(o){return o.indexOf("%")!==-1?decodeURIComponent(o):o}function GD(o){return encodeURIComponent(o)}var wb;function tc(o){if(o)try{let e=decodeURIComponent(wb(o.split(".")[1]).split("").map(function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(e)||{}}catch(e){}return{}}function _b(o,e=0){let t=tc(o);return!(Object.keys(t).length>0&&(!t.exp||t.exp-e>Date.now()/1e3))}wb=typeof atob=="function"?atob:o=>{let e=String(o).replace(/=+$/,"");if(e.length%4==1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(var t,r,n=0,s=0,a="";r=e.charAt(s++);~r&&(t=n%4?64*t+r:r,n++%4)?a+=String.fromCharCode(255&t>>(-2*n&6)):0)r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(r);return a};var yb="pb_auth",ei=class{constructor(){this.baseToken="",this.baseModel=null,this._onChangeCallbacks=[]}get token(){return this.baseToken}get model(){return this.baseModel}get isValid(){return!_b(this.token)}get isAdmin(){return tc(this.token).type==="admin"}get isAuthRecord(){return tc(this.token).type==="authRecord"}save(e,t){this.baseToken=e||"",this.baseModel=t||null,this.triggerChange()}clear(){this.baseToken="",this.baseModel=null,this.triggerChange()}loadFromCookie(e,t=yb){let r=zD(e||"")[t]||"",n={};try{n=JSON.parse(r),(typeof n===null||typeof n!="object"||Array.isArray(n))&&(n={})}catch(s){}this.save(n.token||"",n.model||null)}exportToCookie(e,t=yb){var l,f;let r={secure:!0,sameSite:!0,httpOnly:!0,path:"/"},n=tc(this.token);r.expires=n!=null&&n.exp?new Date(1e3*n.exp):new Date("1970-01-01"),e=Object.assign({},r,e);let s={token:this.token,model:this.model?JSON.parse(JSON.stringify(this.model)):null},a=xb(t,JSON.stringify(s),e),i=typeof Blob!="undefined"?new Blob([a]).size:a.length;if(s.model&&i>4096){s.model={id:(l=s==null?void 0:s.model)==null?void 0:l.id,email:(f=s==null?void 0:s.model)==null?void 0:f.email};let u=["collectionId","username","verified"];for(let d in this.model)u.includes(d)&&(s.model[d]=this.model[d]);a=xb(t,JSON.stringify(s),e)}return a}onChange(e,t=!1){return this._onChangeCallbacks.push(e),t&&e(this.token,this.model),()=>{for(let r=this._onChangeCallbacks.length-1;r>=0;r--)if(this._onChangeCallbacks[r]==e)return delete this._onChangeCallbacks[r],void this._onChangeCallbacks.splice(r,1)}}triggerChange(){for(let e of this._onChangeCallbacks)e&&e(this.token,this.model)}},Cp=class extends ei{constructor(e="pocketbase_auth"){super(),this.storageFallback={},this.storageKey=e,this._bindStorageEvent()}get token(){return(this._storageGet(this.storageKey)||{}).token||""}get model(){return(this._storageGet(this.storageKey)||{}).model||null}save(e,t){this._storageSet(this.storageKey,{token:e,model:t}),super.save(e,t)}clear(){this._storageRemove(this.storageKey),super.clear()}_storageGet(e){if(typeof window!="undefined"&&(window!=null&&window.localStorage)){let t=window.localStorage.getItem(e)||"";try{return JSON.parse(t)}catch(r){return t}}return this.storageFallback[e]}_storageSet(e,t){if(typeof window!="undefined"&&(window!=null&&window.localStorage)){let r=t;typeof t!="string"&&(r=JSON.stringify(t)),window.localStorage.setItem(e,r)}else this.storageFallback[e]=t}_storageRemove(e){var t;typeof window!="undefined"&&(window!=null&&window.localStorage)&&((t=window.localStorage)==null||t.removeItem(e)),delete this.storageFallback[e]}_bindStorageEvent(){typeof window!="undefined"&&(window!=null&&window.localStorage)&&window.addEventListener&&window.addEventListener("storage",e=>{if(e.key!=this.storageKey)return;let t=this._storageGet(this.storageKey)||{};super.save(t.token||"",t.model||null)})}},Ho=class{constructor(e){this.client=e}},Tp=class extends Ho{async getAll(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/settings",e)}async update(e,t){return t=Object.assign({method:"PATCH",body:e},t),this.client.send("/api/settings",t)}async testS3(e="storage",t){return t=Object.assign({method:"POST",body:{filesystem:e}},t),this.client.send("/api/settings/test/s3",t).then(()=>!0)}async testEmail(e,t,r){return r=Object.assign({method:"POST",body:{email:e,template:t}},r),this.client.send("/api/settings/test/email",r).then(()=>!0)}async generateAppleClientSecret(e,t,r,n,s,a){return a=Object.assign({method:"POST",body:{clientId:e,teamId:t,keyId:r,privateKey:n,duration:s}},a),this.client.send("/api/settings/apple/generate-client-secret",a)}},ti=class extends Ho{decode(e){return e}async getFullList(e,t){if(typeof e=="number")return this._getFullList(e,t);let r=500;return(t=Object.assign({},e,t)).batch&&(r=t.batch,delete t.batch),this._getFullList(r,t)}async getList(e=1,t=30,r){return(r=Object.assign({method:"GET"},r)).query=Object.assign({page:e,perPage:t},r.query),this.client.send(this.baseCrudPath,r).then(n=>{var s;return n.items=((s=n.items)==null?void 0:s.map(a=>this.decode(a)))||[],n})}async getFirstListItem(e,t){return(t=Object.assign({requestKey:"one_by_filter_"+this.baseCrudPath+"_"+e},t)).query=Object.assign({filter:e,skipTotal:1},t.query),this.getList(1,1,t).then(r=>{var n;if(!((n=r==null?void 0:r.items)!=null&&n.length))throw new tr({status:404,response:{code:404,message:"The requested resource wasn't found.",data:{}}});return r.items[0]})}async getOne(e,t){if(!e)throw new tr({url:this.client.buildUrl(this.baseCrudPath+"/"),status:404,response:{code:404,message:"Missing required record id.",data:{}}});return t=Object.assign({method:"GET"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),t).then(r=>this.decode(r))}async create(e,t){return t=Object.assign({method:"POST",body:e},t),this.client.send(this.baseCrudPath,t).then(r=>this.decode(r))}async update(e,t,r){return r=Object.assign({method:"PATCH",body:t},r),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),r).then(n=>this.decode(n))}async delete(e,t){return t=Object.assign({method:"DELETE"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),t).then(()=>!0)}_getFullList(e=500,t){(t=t||{}).query=Object.assign({skipTotal:1},t.query);let r=[],n=async s=>this.getList(s,e||500,t).then(a=>{let i=a.items;return r=r.concat(i),i.length==a.perPage?n(s+1):r});return n(1)}};function _r(o,e,t,r){let n=r!==void 0;return n||t!==void 0?n?(console.warn(o),e.body=Object.assign({},e.body,t),e.query=Object.assign({},e.query,r),e):Object.assign(e,t):e}function Lp(o){var e;(e=o._resetAutoRefresh)==null||e.call(o)}var Pp=class extends ti{get baseCrudPath(){return"/api/admins"}async update(e,t,r){return super.update(e,t,r).then(n=>{var s,a;return((s=this.client.authStore.model)==null?void 0:s.id)===n.id&&((a=this.client.authStore.model)==null?void 0:a.collectionId)===void 0&&this.client.authStore.save(this.client.authStore.token,n),n})}async delete(e,t){return super.delete(e,t).then(r=>{var n,s;return r&&((n=this.client.authStore.model)==null?void 0:n.id)===e&&((s=this.client.authStore.model)==null?void 0:s.collectionId)===void 0&&this.client.authStore.clear(),r})}authResponse(e){let t=this.decode((e==null?void 0:e.admin)||{});return e!=null&&e.token&&(e!=null&&e.admin)&&this.client.authStore.save(e.token,t),Object.assign({},e,{token:(e==null?void 0:e.token)||"",admin:t})}async authWithPassword(e,t,r,n){let s={method:"POST",body:{identity:e,password:t}};s=_r("This form of authWithPassword(email, pass, body?, query?) is deprecated. Consider replacing it with authWithPassword(email, pass, options?).",s,r,n);let a=s.autoRefreshThreshold;delete s.autoRefreshThreshold,s.autoRefresh||Lp(this.client);let i=await this.client.send(this.baseCrudPath+"/auth-with-password",s);return i=this.authResponse(i),a&&function(f,u,d,m){Lp(f);let x=f.beforeSend,h=f.authStore.model,_=f.authStore.onChange((w,v)=>{(!w||(v==null?void 0:v.id)!=(h==null?void 0:h.id)||(v!=null&&v.collectionId||h!=null&&h.collectionId)&&(v==null?void 0:v.collectionId)!=(h==null?void 0:h.collectionId))&&Lp(f)});f._resetAutoRefresh=function(){_(),f.beforeSend=x,delete f._resetAutoRefresh},f.beforeSend=async(w,v)=>{var F;let A=f.authStore.token;if((F=v.query)!=null&&F.autoRefresh)return x?x(w,v):{url:w,sendOptions:v};let U=f.authStore.isValid;if(U&&_b(f.authStore.token,u))try{await d()}catch($){U=!1}U||await m();let I=v.headers||{};for(let $ in I)if($.toLowerCase()=="authorization"&&A==I[$]&&f.authStore.token){I[$]=f.authStore.token;break}return v.headers=I,x?x(w,v):{url:w,sendOptions:v}}}(this.client,a,()=>this.authRefresh({autoRefresh:!0}),()=>this.authWithPassword(e,t,Object.assign({autoRefresh:!0},s))),i}async authRefresh(e,t){let r={method:"POST"};return r=_r("This form of authRefresh(body?, query?) is deprecated. Consider replacing it with authRefresh(options?).",r,e,t),this.client.send(this.baseCrudPath+"/auth-refresh",r).then(this.authResponse.bind(this))}async requestPasswordReset(e,t,r){let n={method:"POST",body:{email:e}};return n=_r("This form of requestPasswordReset(email, body?, query?) is deprecated. Consider replacing it with requestPasswordReset(email, options?).",n,t,r),this.client.send(this.baseCrudPath+"/request-password-reset",n).then(()=>!0)}async confirmPasswordReset(e,t,r,n,s){let a={method:"POST",body:{token:e,password:t,passwordConfirm:r}};return a=_r("This form of confirmPasswordReset(resetToken, password, passwordConfirm, body?, query?) is deprecated. Consider replacing it with confirmPasswordReset(resetToken, password, passwordConfirm, options?).",a,n,s),this.client.send(this.baseCrudPath+"/confirm-password-reset",a).then(()=>!0)}},jD=["requestKey","$cancelKey","$autoCancel","fetch","headers","body","query","params","cache","credentials","headers","integrity","keepalive","method","mode","redirect","referrer","referrerPolicy","signal","window"];function vb(o){if(o){o.query=o.query||{};for(let e in o)jD.includes(e)||(o.query[e]=o[e],delete o[e])}}var rc=class extends Ho{constructor(){super(...arguments),this.clientId="",this.eventSource=null,this.subscriptions={},this.lastSentSubscriptions=[],this.maxConnectTimeout=15e3,this.reconnectAttempts=0,this.maxReconnectAttempts=1/0,this.predefinedReconnectIntervals=[200,300,500,1e3,1200,1500,2e3],this.pendingConnects=[]}get isConnected(){return!!this.eventSource&&!!this.clientId&&!this.pendingConnects.length}async subscribe(e,t,r){var a;if(!e)throw new Error("topic must be set.");let n=e;if(r){vb(r);let i="options="+encodeURIComponent(JSON.stringify({query:r.query,headers:r.headers}));n+=(n.includes("?")?"&":"?")+i}let s=function(i){let l=i,f;try{f=JSON.parse(l==null?void 0:l.data)}catch(u){}t(f||{})};return this.subscriptions[n]||(this.subscriptions[n]=[]),this.subscriptions[n].push(s),this.isConnected?this.subscriptions[n].length===1?await this.submitSubscriptions():(a=this.eventSource)==null||a.addEventListener(n,s):await this.connect(),async()=>this.unsubscribeByTopicAndListener(e,s)}async unsubscribe(e){var r;let t=!1;if(e){let n=this.getSubscriptionsByTopic(e);for(let s in n)if(this.hasSubscriptionListeners(s)){for(let a of this.subscriptions[s])(r=this.eventSource)==null||r.removeEventListener(s,a);delete this.subscriptions[s],t||(t=!0)}}else this.subscriptions={};this.hasSubscriptionListeners()?t&&await this.submitSubscriptions():this.disconnect()}async unsubscribeByPrefix(e){var r;let t=!1;for(let n in this.subscriptions)if((n+"?").startsWith(e)){t=!0;for(let s of this.subscriptions[n])(r=this.eventSource)==null||r.removeEventListener(n,s);delete this.subscriptions[n]}t&&(this.hasSubscriptionListeners()?await this.submitSubscriptions():this.disconnect())}async unsubscribeByTopicAndListener(e,t){var s;let r=!1,n=this.getSubscriptionsByTopic(e);for(let a in n){if(!Array.isArray(this.subscriptions[a])||!this.subscriptions[a].length)continue;let i=!1;for(let l=this.subscriptions[a].length-1;l>=0;l--)this.subscriptions[a][l]===t&&(i=!0,delete this.subscriptions[a][l],this.subscriptions[a].splice(l,1),(s=this.eventSource)==null||s.removeEventListener(a,t));i&&(this.subscriptions[a].length||delete this.subscriptions[a],r||this.hasSubscriptionListeners(a)||(r=!0))}this.hasSubscriptionListeners()?r&&await this.submitSubscriptions():this.disconnect()}hasSubscriptionListeners(e){var t,r;if(this.subscriptions=this.subscriptions||{},e)return!!((t=this.subscriptions[e])!=null&&t.length);for(let n in this.subscriptions)if((r=this.subscriptions[n])!=null&&r.length)return!0;return!1}async submitSubscriptions(){if(this.clientId)return this.addAllSubscriptionListeners(),this.lastSentSubscriptions=this.getNonEmptySubscriptionKeys(),this.client.send("/api/realtime",{method:"POST",body:{clientId:this.clientId,subscriptions:this.lastSentSubscriptions},requestKey:this.getSubscriptionsCancelKey()}).catch(e=>{if(!(e!=null&&e.isAbort))throw e})}getSubscriptionsCancelKey(){return"realtime_"+this.clientId}getSubscriptionsByTopic(e){let t={};e=e.includes("?")?e:e+"?";for(let r in this.subscriptions)(r+"?").startsWith(e)&&(t[r]=this.subscriptions[r]);return t}getNonEmptySubscriptionKeys(){let e=[];for(let t in this.subscriptions)this.subscriptions[t].length&&e.push(t);return e}addAllSubscriptionListeners(){if(this.eventSource){this.removeAllSubscriptionListeners();for(let e in this.subscriptions)for(let t of this.subscriptions[e])this.eventSource.addEventListener(e,t)}}removeAllSubscriptionListeners(){if(this.eventSource)for(let e in this.subscriptions)for(let t of this.subscriptions[e])this.eventSource.removeEventListener(e,t)}async connect(){if(!(this.reconnectAttempts>0))return new Promise((e,t)=>{this.pendingConnects.push({resolve:e,reject:t}),this.pendingConnects.length>1||this.initConnect()})}initConnect(){this.disconnect(!0),clearTimeout(this.connectTimeoutId),this.connectTimeoutId=setTimeout(()=>{this.connectErrorHandler(new Error("EventSource connect took too long."))},this.maxConnectTimeout),this.eventSource=new EventSource(this.client.buildUrl("/api/realtime")),this.eventSource.onerror=e=>{this.connectErrorHandler(new Error("Failed to establish realtime connection."))},this.eventSource.addEventListener("PB_CONNECT",e=>{let t=e;this.clientId=t==null?void 0:t.lastEventId,this.submitSubscriptions().then(async()=>{let r=3;for(;this.hasUnsentSubscriptions()&&r>0;)r--,await this.submitSubscriptions()}).then(()=>{for(let n of this.pendingConnects)n.resolve();this.pendingConnects=[],this.reconnectAttempts=0,clearTimeout(this.reconnectTimeoutId),clearTimeout(this.connectTimeoutId);let r=this.getSubscriptionsByTopic("PB_CONNECT");for(let n in r)for(let s of r[n])s(e)}).catch(r=>{this.clientId="",this.connectErrorHandler(r)})})}hasUnsentSubscriptions(){let e=this.getNonEmptySubscriptionKeys();if(e.length!=this.lastSentSubscriptions.length)return!0;for(let t of e)if(!this.lastSentSubscriptions.includes(t))return!0;return!1}connectErrorHandler(e){if(clearTimeout(this.connectTimeoutId),clearTimeout(this.reconnectTimeoutId),!this.clientId&&!this.reconnectAttempts||this.reconnectAttempts>this.maxReconnectAttempts){for(let r of this.pendingConnects)r.reject(new tr(e));return this.pendingConnects=[],void this.disconnect()}this.disconnect(!0);let t=this.predefinedReconnectIntervals[this.reconnectAttempts]||this.predefinedReconnectIntervals[this.predefinedReconnectIntervals.length-1];this.reconnectAttempts++,this.reconnectTimeoutId=setTimeout(()=>{this.initConnect()},t)}disconnect(e=!1){var t;if(clearTimeout(this.connectTimeoutId),clearTimeout(this.reconnectTimeoutId),this.removeAllSubscriptionListeners(),this.client.cancelRequest(this.getSubscriptionsCancelKey()),(t=this.eventSource)==null||t.close(),this.eventSource=null,this.clientId="",!e){this.reconnectAttempts=0;for(let r of this.pendingConnects)r.resolve();this.pendingConnects=[]}}},Dp=class extends ti{constructor(e,t){super(e),this.collectionIdOrName=t}get baseCrudPath(){return this.baseCollectionPath+"/records"}get baseCollectionPath(){return"/api/collections/"+encodeURIComponent(this.collectionIdOrName)}async subscribe(e,t,r){if(!e)throw new Error("Missing topic.");if(!t)throw new Error("Missing subscription callback.");return this.client.realtime.subscribe(this.collectionIdOrName+"/"+e,t,r)}async unsubscribe(e){return e?this.client.realtime.unsubscribe(this.collectionIdOrName+"/"+e):this.client.realtime.unsubscribeByPrefix(this.collectionIdOrName)}async getFullList(e,t){if(typeof e=="number")return super.getFullList(e,t);let r=Object.assign({},e,t);return super.getFullList(r)}async getList(e=1,t=30,r){return super.getList(e,t,r)}async getFirstListItem(e,t){return super.getFirstListItem(e,t)}async getOne(e,t){return super.getOne(e,t)}async create(e,t){return super.create(e,t)}async update(e,t,r){return super.update(e,t,r).then(n=>{var s,a,i;return((s=this.client.authStore.model)==null?void 0:s.id)!==(n==null?void 0:n.id)||((a=this.client.authStore.model)==null?void 0:a.collectionId)!==this.collectionIdOrName&&((i=this.client.authStore.model)==null?void 0:i.collectionName)!==this.collectionIdOrName||this.client.authStore.save(this.client.authStore.token,n),n})}async delete(e,t){return super.delete(e,t).then(r=>{var n,s,a;return!r||((n=this.client.authStore.model)==null?void 0:n.id)!==e||((s=this.client.authStore.model)==null?void 0:s.collectionId)!==this.collectionIdOrName&&((a=this.client.authStore.model)==null?void 0:a.collectionName)!==this.collectionIdOrName||this.client.authStore.clear(),r})}authResponse(e){let t=this.decode((e==null?void 0:e.record)||{});return this.client.authStore.save(e==null?void 0:e.token,t),Object.assign({},e,{token:(e==null?void 0:e.token)||"",record:t})}async listAuthMethods(e){return e=Object.assign({method:"GET"},e),this.client.send(this.baseCollectionPath+"/auth-methods",e).then(t=>Object.assign({},t,{usernamePassword:!!(t!=null&&t.usernamePassword),emailPassword:!!(t!=null&&t.emailPassword),authProviders:Array.isArray(t==null?void 0:t.authProviders)?t==null?void 0:t.authProviders:[]}))}async authWithPassword(e,t,r,n){let s={method:"POST",body:{identity:e,password:t}};return s=_r("This form of authWithPassword(usernameOrEmail, pass, body?, query?) is deprecated. Consider replacing it with authWithPassword(usernameOrEmail, pass, options?).",s,r,n),this.client.send(this.baseCollectionPath+"/auth-with-password",s).then(a=>this.authResponse(a))}async authWithOAuth2Code(e,t,r,n,s,a,i){let l={method:"POST",body:{provider:e,code:t,codeVerifier:r,redirectUrl:n,createData:s}};return l=_r("This form of authWithOAuth2Code(provider, code, codeVerifier, redirectUrl, createData?, body?, query?) is deprecated. Consider replacing it with authWithOAuth2Code(provider, code, codeVerifier, redirectUrl, createData?, options?).",l,a,i),this.client.send(this.baseCollectionPath+"/auth-with-oauth2",l).then(f=>this.authResponse(f))}async authWithOAuth2(...e){if(e.length>1||typeof(e==null?void 0:e[0])=="string")return console.warn("PocketBase: This form of authWithOAuth2() is deprecated and may get removed in the future. Please replace with authWithOAuth2Code() OR use the authWithOAuth2() realtime form as shown in https://pocketbase.io/docs/authentication/#oauth2-integration."),this.authWithOAuth2Code((e==null?void 0:e[0])||"",(e==null?void 0:e[1])||"",(e==null?void 0:e[2])||"",(e==null?void 0:e[3])||"",(e==null?void 0:e[4])||{},(e==null?void 0:e[5])||{},(e==null?void 0:e[6])||{});let t=(e==null?void 0:e[0])||{},r=(await this.listAuthMethods()).authProviders.find(l=>l.name===t.provider);if(!r)throw new tr(new Error(`Missing or invalid provider "${t.provider}".`));let n=this.client.buildUrl("/api/oauth2-redirect"),s=new rc(this.client),a=null;function i(){a==null||a.close(),s.unsubscribe()}return t.urlCallback||(a=bb(void 0)),new Promise(async(l,f)=>{var u;try{await s.subscribe("@oauth2",async h=>{let _=s.clientId;try{if(!h.state||_!==h.state)throw new Error("State parameters don't match.");let w=Object.assign({},t);delete w.provider,delete w.scopes,delete w.createData,delete w.urlCallback;let v=await this.authWithOAuth2Code(r.name,h.code,r.codeVerifier,n,t.createData,w);l(v)}catch(w){f(new tr(w))}i()});let d={state:s.clientId};(u=t.scopes)!=null&&u.length&&(d.scope=t.scopes.join(" "));let m=this._replaceQueryParams(r.authUrl+n,d);await(t.urlCallback||function(h){a?a.location.href=h:a=bb(h)})(m)}catch(d){i(),f(new tr(d))}})}async authRefresh(e,t){let r={method:"POST"};return r=_r("This form of authRefresh(body?, query?) is deprecated. Consider replacing it with authRefresh(options?).",r,e,t),this.client.send(this.baseCollectionPath+"/auth-refresh",r).then(n=>this.authResponse(n))}async requestPasswordReset(e,t,r){let n={method:"POST",body:{email:e}};return n=_r("This form of requestPasswordReset(email, body?, query?) is deprecated. Consider replacing it with requestPasswordReset(email, options?).",n,t,r),this.client.send(this.baseCollectionPath+"/request-password-reset",n).then(()=>!0)}async confirmPasswordReset(e,t,r,n,s){let a={method:"POST",body:{token:e,password:t,passwordConfirm:r}};return a=_r("This form of confirmPasswordReset(token, password, passwordConfirm, body?, query?) is deprecated. Consider replacing it with confirmPasswordReset(token, password, passwordConfirm, options?).",a,n,s),this.client.send(this.baseCollectionPath+"/confirm-password-reset",a).then(()=>!0)}async requestVerification(e,t,r){let n={method:"POST",body:{email:e}};return n=_r("This form of requestVerification(email, body?, query?) is deprecated. Consider replacing it with requestVerification(email, options?).",n,t,r),this.client.send(this.baseCollectionPath+"/request-verification",n).then(()=>!0)}async confirmVerification(e,t,r){let n={method:"POST",body:{token:e}};return n=_r("This form of confirmVerification(token, body?, query?) is deprecated. Consider replacing it with confirmVerification(token, options?).",n,t,r),this.client.send(this.baseCollectionPath+"/confirm-verification",n).then(()=>!0)}async requestEmailChange(e,t,r){let n={method:"POST",body:{newEmail:e}};return n=_r("This form of requestEmailChange(newEmail, body?, query?) is deprecated. Consider replacing it with requestEmailChange(newEmail, options?).",n,t,r),this.client.send(this.baseCollectionPath+"/request-email-change",n).then(()=>!0)}async confirmEmailChange(e,t,r,n){let s={method:"POST",body:{token:e,password:t}};return s=_r("This form of confirmEmailChange(token, password, body?, query?) is deprecated. Consider replacing it with confirmEmailChange(token, password, options?).",s,r,n),this.client.send(this.baseCollectionPath+"/confirm-email-change",s).then(()=>!0)}async listExternalAuths(e,t){return t=Object.assign({method:"GET"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e)+"/external-auths",t)}async unlinkExternalAuth(e,t,r){return r=Object.assign({method:"DELETE"},r),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e)+"/external-auths/"+encodeURIComponent(t),r).then(()=>!0)}_replaceQueryParams(e,t={}){let r=e,n="";e.indexOf("?")>=0&&(r=e.substring(0,e.indexOf("?")),n=e.substring(e.indexOf("?")+1));let s={},a=n.split("&");for(let i of a){if(i=="")continue;let l=i.split("=");s[decodeURIComponent(l[0].replace(/\+/g," "))]=decodeURIComponent((l[1]||"").replace(/\+/g," "))}for(let i in t)t.hasOwnProperty(i)&&(t[i]==null?delete s[i]:s[i]=t[i]);n="";for(let i in s)s.hasOwnProperty(i)&&(n!=""&&(n+="&"),n+=encodeURIComponent(i.replace(/%20/g,"+"))+"="+encodeURIComponent(s[i].replace(/%20/g,"+")));return n!=""?r+"?"+n:r}};function bb(o){if(typeof window=="undefined"||!(window!=null&&window.open))throw new tr(new Error("Not in a browser context - please pass a custom urlCallback function."));let e=1024,t=768,r=window.innerWidth,n=window.innerHeight;e=e>r?r:e,t=t>n?n:t;let s=r/2-e/2,a=n/2-t/2;return window.open(o,"popup_window","width="+e+",height="+t+",top="+a+",left="+s+",resizable,menubar=no")}var Ap=class extends ti{get baseCrudPath(){return"/api/collections"}async import(e,t=!1,r){return r=Object.assign({method:"PUT",body:{collections:e,deleteMissing:t}},r),this.client.send(this.baseCrudPath+"/import",r).then(()=>!0)}},Mp=class extends Ho{async getList(e=1,t=30,r){return(r=Object.assign({method:"GET"},r)).query=Object.assign({page:e,perPage:t},r.query),this.client.send("/api/logs",r)}async getOne(e,t){if(!e)throw new tr({url:this.client.buildUrl("/api/logs/"),status:404,response:{code:404,message:"Missing required log id.",data:{}}});return t=Object.assign({method:"GET"},t),this.client.send("/api/logs/"+encodeURIComponent(e),t)}async getStats(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/logs/stats",e)}},Ep=class extends Ho{async check(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/health",e)}},Fp=class extends Ho{getUrl(e,t,r={}){if(!t||!(e!=null&&e.id)||!(e!=null&&e.collectionId)&&!(e!=null&&e.collectionName))return"";let n=[];n.push("api"),n.push("files"),n.push(encodeURIComponent(e.collectionId||e.collectionName)),n.push(encodeURIComponent(e.id)),n.push(encodeURIComponent(t));let s=this.client.buildUrl(n.join("/"));if(Object.keys(r).length){r.download===!1&&delete r.download;let a=new URLSearchParams(r);s+=(s.includes("?")?"&":"?")+a}return s}async getToken(e){return e=Object.assign({method:"POST"},e),this.client.send("/api/files/token",e).then(t=>(t==null?void 0:t.token)||"")}},Rp=class extends Ho{async getFullList(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/backups",e)}async create(e,t){return t=Object.assign({method:"POST",body:{name:e}},t),this.client.send("/api/backups",t).then(()=>!0)}async upload(e,t){return t=Object.assign({method:"POST",body:e},t),this.client.send("/api/backups/upload",t).then(()=>!0)}async delete(e,t){return t=Object.assign({method:"DELETE"},t),this.client.send(`/api/backups/${encodeURIComponent(e)}`,t).then(()=>!0)}async restore(e,t){return t=Object.assign({method:"POST"},t),this.client.send(`/api/backups/${encodeURIComponent(e)}/restore`,t).then(()=>!0)}getDownloadUrl(e,t){return this.client.buildUrl(`/api/backups/${encodeURIComponent(t)}?token=${encodeURIComponent(e)}`)}},oc=class{constructor(e="/",t,r="en-US"){this.cancelControllers={},this.recordServices={},this.enableAutoCancellation=!0,this.baseUrl=e,this.lang=r,this.authStore=t||new Cp,this.admins=new Pp(this),this.collections=new Ap(this),this.files=new Fp(this),this.logs=new Mp(this),this.settings=new Tp(this),this.realtime=new rc(this),this.health=new Ep(this),this.backups=new Rp(this)}collection(e){return this.recordServices[e]||(this.recordServices[e]=new Dp(this,e)),this.recordServices[e]}autoCancellation(e){return this.enableAutoCancellation=!!e,this}cancelRequest(e){return this.cancelControllers[e]&&(this.cancelControllers[e].abort(),delete this.cancelControllers[e]),this}cancelAllRequests(){for(let e in this.cancelControllers)this.cancelControllers[e].abort();return this.cancelControllers={},this}filter(e,t){if(!t)return e;for(let r in t){let n=t[r];switch(typeof n){case"boolean":case"number":n=""+n;break;case"string":n="'"+n.replace(/'/g,"\\'")+"'";break;default:n=n===null?"null":n instanceof Date?"'"+n.toISOString().replace("T"," ")+"'":"'"+JSON.stringify(n).replace(/'/g,"\\'")+"'"}e=e.replaceAll("{:"+r+"}",n)}return e}getFileUrl(e,t,r={}){return this.files.getUrl(e,t,r)}buildUrl(e){var r;let t=this.baseUrl;return typeof window=="undefined"||!window.location||t.startsWith("https://")||t.startsWith("http://")||(t=(r=window.location.origin)!=null&&r.endsWith("/")?window.location.origin.substring(0,window.location.origin.length-1):window.location.origin||"",this.baseUrl.startsWith("/")||(t+=window.location.pathname||"/",t+=t.endsWith("/")?"":"/"),t+=this.baseUrl),e&&(t+=t.endsWith("/")?"":"/",t+=e.startsWith("/")?e.substring(1):e),t}async send(e,t){t=this.initSendOptions(e,t);let r=this.buildUrl(e);if(this.beforeSend){let n=Object.assign({},await this.beforeSend(r,t));n.url!==void 0||n.options!==void 0?(r=n.url||r,t=n.options||t):Object.keys(n).length&&(t=n,console!=null&&console.warn&&console.warn("Deprecated format of beforeSend return: please use `return { url, options }`, instead of `return options`."))}if(t.query!==void 0){let n=this.serializeQueryParams(t.query);n&&(r+=(r.includes("?")?"&":"?")+n),delete t.query}return this.getHeader(t.headers,"Content-Type")=="application/json"&&t.body&&typeof t.body!="string"&&(t.body=JSON.stringify(t.body)),(t.fetch||fetch)(r,t).then(async n=>{let s={};try{s=await n.json()}catch(a){}if(this.afterSend&&(s=await this.afterSend(n,s)),n.status>=400)throw new tr({url:n.url,status:n.status,data:s});return s}).catch(n=>{throw new tr(n)})}initSendOptions(e,t){if((t=Object.assign({method:"GET"},t)).body=this.convertToFormDataIfNeeded(t.body),vb(t),t.query=Object.assign({},t.params,t.query),t.requestKey===void 0&&(t.$autoCancel===!1||t.query.$autoCancel===!1?t.requestKey=null:(t.$cancelKey||t.query.$cancelKey)&&(t.requestKey=t.$cancelKey||t.query.$cancelKey)),delete t.$autoCancel,delete t.query.$autoCancel,delete t.$cancelKey,delete t.query.$cancelKey,this.getHeader(t.headers,"Content-Type")!==null||this.isFormData(t.body)||(t.headers=Object.assign({},t.headers,{"Content-Type":"application/json"})),this.getHeader(t.headers,"Accept-Language")===null&&(t.headers=Object.assign({},t.headers,{"Accept-Language":this.lang})),this.authStore.token&&this.getHeader(t.headers,"Authorization")===null&&(t.headers=Object.assign({},t.headers,{Authorization:this.authStore.token})),this.enableAutoCancellation&&t.requestKey!==null){let r=t.requestKey||(t.method||"GET")+e;delete t.requestKey,this.cancelRequest(r);let n=new AbortController;this.cancelControllers[r]=n,t.signal=n.signal}return t}convertToFormDataIfNeeded(e){if(typeof FormData=="undefined"||e===void 0||typeof e!="object"||e===null||this.isFormData(e)||!this.hasBlobField(e))return e;let t=new FormData;for(let r in e){let n=this.normalizeFormDataValue(e[r]),s=Array.isArray(n)?n:[n];if(s.length)for(let a of s)t.append(r,a);else t.append(r,"")}return t}normalizeFormDataValue(e){return e===null||typeof e!="object"||e instanceof Date||this.hasBlobField({data:e})||Array.isArray(e)&&!e.filter(t=>typeof t!="string").length?e:JSON.stringify(e)}hasBlobField(e){for(let t in e){let r=Array.isArray(e[t])?e[t]:[e[t]];for(let n of r)if(typeof Blob!="undefined"&&n instanceof Blob||typeof File!="undefined"&&n instanceof File)return!0}return!1}getHeader(e,t){e=e||{},t=t.toLowerCase();for(let r in e)if(r.toLowerCase()==t)return e[r];return null}isFormData(e){return e&&(e.constructor.name==="FormData"||typeof FormData!="undefined"&&e instanceof FormData)}serializeQueryParams(e){let t=[];for(let r in e){if(e[r]===null)continue;let n=e[r],s=encodeURIComponent(r);if(Array.isArray(n))for(let a of n)t.push(s+"="+encodeURIComponent(a));else n instanceof Date?t.push(s+"="+encodeURIComponent(n.toISOString())):typeof n!==null&&typeof n=="object"?t.push(s+"="+encodeURIComponent(JSON.stringify(n))):t.push(s+"="+encodeURIComponent(n))}return t.join("&")}};var nc=class extends ei{constructor(t="pocketbase_auth"){super();this.storageFallback={};this._storageChangeHandler=t=>{if(t.key!=this.storageKey)return;let r=this._storageGet(this.storageKey)||{};super.save(r.token||"",r.model||null)};this.storageKey=t,this._bindStorageEvent()}get token(){return(this._storageGet(this.storageKey)||{}).token||""}get model(){return(this._storageGet(this.storageKey)||{}).model||null}save(t,r){this._storageSet(this.storageKey,{token:t,model:r}),super.save(t,r)}clear(){this._storageRemove(this.storageKey),super.clear()}destroy(){this._unbindStorageEvent()}_storageGet(t){if(typeof window!="undefined"&&(window!=null&&window.localStorage)){let r=window.localStorage.getItem(t)||"";try{return JSON.parse(r)}catch(n){return r}}return this.storageFallback[t]}_storageSet(t,r){if(typeof window!="undefined"&&(window!=null&&window.localStorage)){let n=r;typeof r!="string"&&(n=JSON.stringify(r)),window.localStorage.setItem(t,n)}else this.storageFallback[t]=r}_storageRemove(t){var r;typeof window!="undefined"&&(window!=null&&window.localStorage)&&((r=window.localStorage)==null||r.removeItem(t)),delete this.storageFallback[t]}_bindStorageEvent(){if(typeof window=="undefined"||!(window!=null&&window.localStorage)||!window.addEventListener)return()=>{};window.addEventListener("storage",this._storageChangeHandler)}_unbindStorageEvent(){if(typeof window=="undefined"||!(window!=null&&window.localStorage)||!window.addEventListener)return()=>{};window.removeEventListener("storage",this._storageChangeHandler)}};var sc=class extends St{constructor(t,r,n,s){var i;super();this.beforeLogin=s;let a=Ce("[Pocketbase]","debug");this.authStore=new nc(`pocketbase_auth_${t}`),this.pb=new oc("https://auth.system3.md",this.authStore),this.pb.beforeSend=(l,f)=>(a(l,f),f.fetch=wr,f.headers=Object.assign({},f.headers,{"Relay-Version":"0.4.9"}),{url:l,options:f}),this.refreshToken(),n.setInterval(()=>this.refreshToken(),864e5),this.openSettings=r,this.pb.authStore.isValid||this.logout(),(i=this.pb.authStore.model)!=null&&i.id&&this.pb.collection("users").getOne(this.pb.authStore.model.id).catch(l=>{l.status===404&&this.logout()}),Dt.set(this,"loginManager")}refreshToken(){this.pb.authStore.isValid&&(this.user=this.makeUser(this.pb.authStore),this.pb.collection("users").authRefresh().then(t=>{let r=t.token,[,n]=r.split("."),s=JSON.parse(atob(n)),a=new Date(s.exp*1e3),i=new Date,l=Math.ceil((a.getTime()-i.getTime())/(1e3*60*60*24));this.log("Token Refreshed"),this.log("JWT Info:",{expiresAt:a.toLocaleString(),expiresIn:`${l} days`,userId:s.id,email:s.email})}))}setup(t){var r,n;return this.pb.authStore.isValid?(this.user=this.makeUser(this.pb.authStore,(r=t==null?void 0:t.meta)==null?void 0:r.rawUser),this.notifyListeners(),t&&this.pb.collection("oauth2_response").create({user:t.record.id,oauth_response:(n=t.meta)==null?void 0:n.rawUser}).then(()=>{this.notifyListeners()}).catch(s=>{this.log(s)}),!0):(this.notifyListeners(),!1)}whoami(){let t={Authorization:`Bearer ${this.pb.authStore.token}`};(0,Sb.requestUrl)({url:"https://api.system3.md/whoami",method:"GET",headers:t}).then(r=>{this.log(r.json)}).catch(r=>{this.log(r)})}get loggedIn(){return this.user!==void 0}get hasUser(){return this.user!==void 0}makeUser(t,r){var n,s,a,i;return new Kl((n=t.model)==null?void 0:n.id,((s=t.model)==null?void 0:s.name)||(r==null?void 0:r.name),(a=t.model)==null?void 0:a.email,((i=t.model)==null?void 0:i.picture)||(r==null?void 0:r.picture),t.token)}logout(){this.pb.cancelAllRequests(),this.pb.authStore.clear(),this.user=void 0,this.notifyListeners()}webviewIntercept(){let t=this.pb.buildUrl("/api/oauth2-redirect"),r="https:\\/\\/accounts\\.google\\.com\\/o\\/oauth2\\/auth";return new RegExp(`^${r}.*?[?&]redirect_uri=${encodeURIComponent(t)}`,"i")}async initiateManualOAuth2CodeFlow(t){this.beforeLogin();let n=(await this.pb.collection("users").listAuthMethods({fetch:t}).catch(a=>{throw a.originalError})).authProviders[0],s=this.pb.buildUrl("/api/oauth2-redirect");return[n.authUrl+s,n,async a=>this.pb.collection("users").authWithOAuth2Code(n.name,a,n.codeVerifier,s,{fetch:t}).then(i=>(this.setup(i),i))]}async poll(t,r){let n=0,s=1e3;return new Promise((a,i)=>{let l=setInterval(()=>{if(n+=1,n>=30)return clearInterval(l),i(new Error(`Auth timeout: Timed out after ${n*s/1e3} seconds`));this.pb.collection("code_exchange").getOne(t.state.slice(0,15)).then(f=>{if(f)return clearInterval(l),a(r(f.code))}).catch(f=>{})},s)})}async login(){this.beforeLogin();let t=await this.pb.collection("users").authWithOAuth2({provider:"google"});return this.setup(t)}async openLoginPage(){return await this.openSettings(),await new Promise((r,n)=>{let s=()=>{this.loggedIn&&(this.off(s),r(!0)),r(!1)};this.on(s)})}destroy(){this.pb.cancelAllRequests(),this.pb.realtime.unsubscribe(),this.pb=null,this.authStore.destroy(),this.authStore=null,this.user=void 0,this.openSettings=null,super.destroy()}};var Bt=crypto;var mo=new TextEncoder,vr=new TextDecoder,vN=2**32;var kb=o=>{let e=o;typeof e=="string"&&(e=mo.encode(e));let t=32768,r=[];for(let n=0;n<e.length;n+=t)r.push(String.fromCharCode.apply(null,e.subarray(n,n+t)));return btoa(r.join(""))},Gr=o=>kb(o).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"),Ib=o=>{let e=atob(o),t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t},Hn=o=>{let e=o;e instanceof Uint8Array&&(e=vr.decode(e)),e=e.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return Ib(e)}catch(t){throw new TypeError("The input to be decoded is not correctly encoded.")}};var Op={};Xc(Op,{JOSEAlgNotAllowed:()=>oi,JOSEError:()=>At,JOSENotSupported:()=>_t,JWEDecryptionFailed:()=>ni,JWEInvalid:()=>Sr,JWKInvalid:()=>ic,JWKSInvalid:()=>lc,JWKSMultipleMatchingKeys:()=>cc,JWKSNoMatchingKey:()=>si,JWKSTimeout:()=>fc,JWSInvalid:()=>Vo,JWSSignatureVerificationFailed:()=>ai,JWTClaimValidationFailed:()=>ri,JWTExpired:()=>ac,JWTInvalid:()=>rr});var At=class extends Error{static get code(){return"ERR_JOSE_GENERIC"}constructor(e){var t;super(e),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,(t=Error.captureStackTrace)==null||t.call(Error,this,this.constructor)}},ri=class extends At{static get code(){return"ERR_JWT_CLAIM_VALIDATION_FAILED"}constructor(e,t="unspecified",r="unspecified"){super(e),this.code="ERR_JWT_CLAIM_VALIDATION_FAILED",this.claim=t,this.reason=r}},ac=class extends At{static get code(){return"ERR_JWT_EXPIRED"}constructor(e,t="unspecified",r="unspecified"){super(e),this.code="ERR_JWT_EXPIRED",this.claim=t,this.reason=r}},oi=class extends At{constructor(){super(...arguments),this.code="ERR_JOSE_ALG_NOT_ALLOWED"}static get code(){return"ERR_JOSE_ALG_NOT_ALLOWED"}},_t=class extends At{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}static get code(){return"ERR_JOSE_NOT_SUPPORTED"}},ni=class extends At{constructor(){super(...arguments),this.code="ERR_JWE_DECRYPTION_FAILED",this.message="decryption operation failed"}static get code(){return"ERR_JWE_DECRYPTION_FAILED"}},Sr=class extends At{constructor(){super(...arguments),this.code="ERR_JWE_INVALID"}static get code(){return"ERR_JWE_INVALID"}},Vo=class extends At{constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}static get code(){return"ERR_JWS_INVALID"}},rr=class extends At{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}static get code(){return"ERR_JWT_INVALID"}},ic=class extends At{constructor(){super(...arguments),this.code="ERR_JWK_INVALID"}static get code(){return"ERR_JWK_INVALID"}},lc=class extends At{constructor(){super(...arguments),this.code="ERR_JWKS_INVALID"}static get code(){return"ERR_JWKS_INVALID"}},si=class extends At{constructor(){super(...arguments),this.code="ERR_JWKS_NO_MATCHING_KEY",this.message="no applicable key found in the JSON Web Key Set"}static get code(){return"ERR_JWKS_NO_MATCHING_KEY"}},cc=class extends At{constructor(){super(...arguments),this.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS",this.message="multiple matching keys found in the JSON Web Key Set"}static get code(){return"ERR_JWKS_MULTIPLE_MATCHING_KEYS"}},fc=class extends At{constructor(){super(...arguments),this.code="ERR_JWKS_TIMEOUT",this.message="request timed out"}static get code(){return"ERR_JWKS_TIMEOUT"}},ai=class extends At{constructor(){super(...arguments),this.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED",this.message="signature verification failed"}static get code(){return"ERR_JWS_SIGNATURE_VERIFICATION_FAILED"}};var uc=Bt.getRandomValues.bind(Bt);function ZD(o){return typeof o=="object"&&o!==null}function or(o){if(!ZD(o)||Object.prototype.toString.call(o)!=="[object Object]")return!1;if(Object.getPrototypeOf(o)===null)return!0;let e=o;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(o)===e}var uA=Symbol();var _A,mc,Ob;(typeof navigator=="undefined"||!((Ob=(mc=navigator.userAgent)==null?void 0:mc.startsWith)!=null&&Ob.call(mc,"Mozilla/5.0 ")))&&(_A="jose/v5.3.0");var Bp={};Xc(Bp,{decode:()=>hc,encode:()=>vA});var vA=Gr,hc=Hn;function Np(o){if(typeof o!="string")throw new rr("JWTs must use Compact JWS serialization, JWT must be a string");let{1:e,length:t}=o.split(".");if(t===5)throw new rr("Only JWTs using Compact JWS serialization can be decoded");if(t!==3)throw new rr("Invalid JWT");if(!e)throw new rr("JWTs must contain a payload");let r;try{r=hc(e)}catch(s){throw new rr("Failed to base64url decode the payload")}let n;try{n=JSON.parse(vr.decode(r))}catch(s){throw new rr("Failed to parse the decoded payload as JSON")}if(!or(n))throw new rr("Invalid JWT Claims Set");return n}var Vn=class extends Error{constructor(e){super(e),this.name="[System3] Relay Error"}};function Ub(o){return o<1e3?`${o}ms`:o<6e4?`${Math.round(o/1e3)}s`:o<36e5?`${Math.round(o/6e4)}m`:`${Math.round(o/36e5)}h`}function SA(o){let e=Np(o.token);if(typeof e=="string")return 0;let t=e==null?void 0:e.exp;return t?t*1e3:0}var gc=class{constructor(e,t=5){this.expiryMargin=5*60*1e3;this.activeConnections=0;this._activePromises=new Map,e.getStorage?this.tokenMap=e.getStorage():this.tokenMap=new Map,this.callbacks=new Map,this.refreshQueue=new Set,this._log=e.log,this.refresh=e.refresh,this.timeProvider=e.getTimeProvider(),e.getJwtExpiry?this.getJwtExpiry=e.getJwtExpiry:this.getJwtExpiry=SA,this.maxConnections=t,this.refreshInterval=null,Dt.set(this,"TokenStore")}onRefresh(e){return new Promise((r,n)=>{let s=i=>{r(i)},a=i=>{this.removeFromRefreshQueue(e),n(i)};this.refresh(e,s,a)})}start(){this.log("starting"),this.report(),this.refreshInterval=this.timeProvider.setInterval(()=>this.checkAndRefreshTokens(),60*1e3),this.checkAndRefreshTokens()}stop(){this.log("stopping"),this.refreshInterval&&(this.timeProvider.clearInterval(this.refreshInterval),this.refreshInterval=null)}_cleanupInvalidTokens(){let e=[];for(let[t,r]of this.tokenMap.entries())this.isTokenValid(r)||e.push(t);for(let t of e)this.tokenMap.delete(t)}checkAndRefreshTokens(){this.log("check and refresh tokens"),this._cleanupInvalidTokens();for(let[e,t]of this.tokenMap.entries())this.callbacks.has(e)&&this.shouldRefresh(t)&&(this.log("adding to refresh queue"),this.addToRefreshQueue(e));this.log(this.report())}dequeue(){if(this.log("getting next item in queue"),this.refreshQueue.size>0){let e=this.refreshQueue.values().next().value;return this.refreshQueue.delete(e),e}return null}addToRefreshQueue(e){if(this.activeConnections<this.maxConnections){this.log(`immediate refresh of ${e}`),this.activeConnections++;let t=n=>{this.onTokenRefreshed(e,n),this.activeConnections--;let s=this.dequeue();s&&this.addToRefreshQueue(s)},r=()=>{this.onRefreshFailure(e),this.activeConnections--;let n=this.dequeue();n&&this.addToRefreshQueue(n)};this.refresh(e,t,r)}else this.log(`enqueued refresh of ${e}`),this.refreshQueue.add(e)}removeFromRefreshQueue(e){return this.log(`removing ${e} from refresh queue`),this.refreshQueue.has(e)?(this.refreshQueue.delete(e),!0):!1}log(e){this._log(e)}onTokenRefreshed(e,t){let r=this.getJwtExpiry(t);if(this.tokenMap.has(e)){let n=this.tokenMap.get(e),s=this.callbacks.get(e);this.log(`new expiry time is ${r}`),this.tokenMap.set(e,{...n,token:t,expiryTime:r}),s(t),this.log(`Token refreshed for ${n.friendlyName} (${e})`)}}onRefreshFailure(e){let t=this.tokenMap.get(e),r=(t==null?void 0:t.attempts)||0+1;r<=3?this.tokenMap.set(e,{...t,attempts:r}):this.tokenMap.delete(e)}isTokenValid(e){return this.timeProvider.getTime()<e.expiryTime}shouldRefresh(e){return this.timeProvider.getTime()+this.expiryMargin>e.expiryTime}getTokenSync(e){var t,r;return(r=(t=this.tokenMap)==null?void 0:t.get(e))==null?void 0:r.token}getTokenFromNetwork(e,t,r){let n=this._activePromises.get(e);if(n)return n;this.tokenMap.set(e,{token:null,friendlyName:t,expiryTime:0,attempts:0}),this.callbacks.set(e,r);let s=this.onRefresh(e).then(a=>(this.onTokenRefreshed(e,a),this._activePromises.delete(e),a)).catch(a=>{throw this.onRefreshFailure(e),this._activePromises.delete(e),a});return this._activePromises.set(e,s),s}async getToken(e,t,r){if(this.log(`getting token ${t}`),this.tokenMap||Promise.reject(new Vn("attempted to get token after TokenStore was destroyed.")),this.tokenMap.has(e)){let n=this.tokenMap.get(e);if(n.token&&this.isTokenValid(n))return this.callbacks.set(e,r),n.friendlyName=t,r(n.token),this.log("token was valid, cache hit!"),this._activePromises.delete(e),Promise.resolve(n.token)}return this.getTokenFromNetwork(e,t,r)}_reportWithFilter(e){let t=[],r=this.timeProvider.getTime(),n=Array.from(this.tokenMap.entries()).sort((s,a)=>s[1].expiryTime-a[1].expiryTime);for(let[s,{friendlyName:a,expiryTime:i,attempts:l}]of n){if(!e(s))continue;let f=i-r,u="";f>0?u=`expires in ${Ub(f-this.expiryMargin)}`:u="expired",t.push(`${s} (${a}): ${l} attempts, (${u})`)}return t}report(){let e=[];return e.push("Token Store Report:"),e.push(`Expiry Margin: ${Ub(this.expiryMargin)}`),e.push("Active Tokens:"),e.push(...this._reportWithFilter(t=>this.callbacks.has(t))),e.push("Stale Tokens:"),e.push(...this._reportWithFilter(t=>!this.callbacks.has(t))),e.push(`Queue size: ${this.refreshQueue.size}`),e.join(`
`)}async waitForQueue(){return new Promise(e=>{setInterval(()=>{if(this.refreshQueue.size==0)return e()},100)})}clearState(){this.refreshQueue.clear();for(let[e,t]of this.tokenMap.entries())this.isTokenValid(t)?this.tokenMap.set(e,{...t,attempts:0}):this.tokenMap.delete(e)}clear(){this.tokenMap.clear(),this.refreshQueue.clear()}destroy(){this.clear(),this.timeProvider.destroy(),this.timeProvider=null,this.refresh=null,this.callbacks.clear(),this.callbacks=null,this._activePromises.clear(),this._activePromises=null,this.tokenMap=null}};function kA(o){return o.expiryTime||0}function IA(o,e){return(...t)=>e(o,...t)}async function LA(o,e,t,r){var f;let n=Ce("[TokenStore][Refresh]","debug"),s=Ce("[TokenStore][Refresh]","error");n(`${e}`);let a=Xt.decode(e),i;if(a instanceof Wr)i=JSON.stringify({docId:a.documentId,relay:a.relayId,folder:a.folderId});else if(a instanceof Eo)i=JSON.stringify({docId:a.folderId,relay:a.relayId,folder:a.folderId});else{r(new Error("No remote to connect to"));return}if(!o.loggedIn){r(Error("Not logged in"));return}let l={Authorization:`Bearer ${(f=o.user)==null?void 0:f.token}`,"Relay-Version":"0.4.9"};try{let u=await wr("https://api.system3.md/token",{method:"POST",headers:l,body:i});if(!u.ok){n(u.status,await u.text()),r(Error(`Received status code ${u.status} from an API.`));return}let d=await u.json();t(d)}catch(u){s(u,i),r(u)}}var xc=class extends gc{constructor(e,t,r,n=5){super({log:Ce("[LiveTokenStore]","debug"),refresh:IA(e,LA),getJwtExpiry:kA,getStorage:function(){return new Ro("TokenStore/"+r)},getTimeProvider:()=>t},n)}};var $b=require("obsidian");var Hp=class{constructor(e,t,r=1e4){this.timeProvider=e;this.onOnline=[];this.onOffline=[];this.online=!0;this._log=Ce("[NetworkStatus]"),this.url=t,this.interval=r,this._onceOnline=new Set}log(e,...t){this._log(e,...t)}start(){this.timer||(this.timer=this.checkStatusRepeatedly())}stop(){this.timer&&clearInterval(this.timer)}checkStatusRepeatedly(){return this.timeProvider.setInterval(this._checkStatus.bind(this),this.interval)}checkStatus(){return this.online?Promise.resolve(!0):new Promise(e=>{this._checkStatus().then(()=>{e(this.online)})})}async _checkStatus(){return(0,$b.requestUrl)({url:this.url,method:"GET",headers:{"Relay-Version":"0.4.9"}}).then(e=>{if(e.status===200){if(e.json&&e.json.status&&(this.status=e.json),!this.online){this.log("back online"),this.online=!0,this.onOnline.forEach(t=>t(this.status)),this._onceOnline.forEach(t=>t(this.status)),this._onceOnline.clear();return}}else if(e.status!==200&&this.online)throw new Error("disconnected")}).catch(e=>{if(e.message.includes("ERR_NETWORK_CHANGED")){this._checkStatus();return}this.online=!1,this.onOffline.forEach(t=>t(this.status))})}onceOnline(e){this._onceOnline.add(e)}addEventListener(e,t){e==="online"?this.onOnline.push(t):e==="offline"&&this.onOffline.push(t)}destroy(){this._onceOnline.clear(),this._onceOnline=null,this.onOnline=null,this.onOffline=null,this.timeProvider=null}},Bb=Hp;function Vp(o){return typeof o.id=="string"}function CA(o){return typeof o.name=="string"}var qp=class{constructor(e){this.collectionName="roles";this.roles=e}items(){return this.roles.values()}clear(){this.roles.clear()}get(e){return this.roles.get(e)}ingest(e){return this.roles.set(e.id,e),e}delete(e){this.roles.delete(e)}};function Nb(o){return typeof o.aggregate_root=="object"}function Hb(o){return typeof o.acl=="object"}var li=class{get aggregate_root(){}get acl(){}},yc=class extends li{constructor(t){super();this.user=t}get id(){return this.user.id}get name(){return this.user.name}update(t){return this.user=t,this}},Wp=class extends li{constructor(t,r,n){super();this.remoteFolder=t;this.relays=r;this.users=n}update(t){return this.remoteFolder=t,this}get id(){return this.remoteFolder.id}get guid(){return this.remoteFolder.guid}get name(){return this.remoteFolder.name}get private(){return this.remoteFolder.private}get creator(){let t=this.users.get(this.remoteFolder.creator);if(!t)throw new Error("invalid remote folder");return t}get relay(){let t=this.relays.get(this.remoteFolder.relay);if(!t)throw new Error("invalid remote folder");return t}get aggregate_root(){return["relays",this.remoteFolder.relay]}get acl(){return["relays",this.remoteFolder.relay]}},zp=class{constructor(e,t,r){this.remoteFolders=e;this.relays=t;this.users=r;this.collectionName="shared_folders"}items(){return this.remoteFolders.values()}clear(){this.remoteFolders.clear()}get(e){return this.remoteFolders.get(e)}ingest(e){let t=this.remoteFolders.get(e.id);if(t)return t.update(e),this.remoteFolders.notifyListeners(),t;let r=new Wp(e,this.relays,this.users);return this.remoteFolders.set(e.id,r),r}delete(e){this.remoteFolders.delete(e)}},Kp=class{constructor(e,t,r,n,s,a,i){this.relays=e;this.roles=t;this.relayRoles=r;this.relayInvitations=n;this.remoteFolders=s;this.subscriptions=a;this.user=i;this.collectionName="relays"}items(){return this.relays.values()}clear(){this.relays.clear()}get(e){return this.relays.get(e)}ingest(e){let t=this.relays.get(e.id);if(t)return t.update(e),this.relays.notifyListeners(),t;let r=new bc(e,this.relayRoles,this.relayInvitations,this.remoteFolders,this.subscriptions,this.user);return this.relays.set(r.id,r),r}delete(e){this.relays.delete(e)}},Gp=class{constructor(e,t,r,n){this.collectionName="relay_roles";this.relayRoles=e,this.relays=t,this.users=r,this.roles=n}items(){return this.relayRoles.values()}clear(){this.relayRoles.clear()}get(e){return this.relayRoles.get(e)}ingest(e){let t=this.relayRoles.get(e.id);if(t)return t.update(e),this.relayRoles.notifyListeners(),t;let r=new Qp(e,this.relays,this.users,this.roles);return this.relayRoles.set(r.id,r),r}delete(e){this.relayRoles.get(e)&&this.relayRoles.delete(e)}},jp=class{constructor(e,t,r){this.collectionName="relay_invitations";this.relayInvitations=e,this.relays=t,this.roles=r}items(){return this.relayInvitations.values()}clear(){this.relayInvitations.clear()}get(e){return this.relayInvitations.get(e)}ingest(e){let t=this.relayInvitations.get(e.id);if(t)return t.update(e),this.relayInvitations.notifyListeners(),t;let r=new Zp(e,this.relays,this.roles);return this.relayInvitations.set(r.id,r),r}delete(e){this.relayInvitations.delete(e)}},Yp=class{constructor(e){this.users=e;this.collectionName="users"}items(){return this.users.values()}clear(){this.users.clear()}get(e){return this.users.get(e)}ingest(e){let t=this.users.get(e.id);if(t)return t.update(e),this.users.notifyListeners(),t;let r=new yc(e);return this.users.set(e.id,r),r}delete(e){this.users.delete(e)}},Jp=class{constructor(e,t,r){this.subscriptions=e;this.relays=t;this.users=r;this.collectionName="subscriptions"}items(){return this.subscriptions.values()}clear(){this.subscriptions.clear()}get(e){return this.subscriptions.get(e)}ingest(e){let t=this.subscriptions.get(e.id);if(t)return t.update(e),this.subscriptions.notifyListeners(),t;let r=new em(e,this.relays,this.users);return this.subscriptions.set(e.id,r),r}delete(e){this.subscriptions.delete(e)}},Xp=class extends hr{constructor(t){super();this.collections=new Map,this.relationships=new Map;for(let r of t)this.collections.set(r.collectionName,r);Dt.set(this,"Store")}getCollection(t){let r=this.collections.get(t);if(!r)throw this.error("No collection found for",t),new Error("No collection found for "+t);return r}clear(){let t=Mr.getInstance();t.beginTransaction(),this.collections.forEach(r=>{r.clear()}),this.collections.clear(),this.relationships.clear(),t.commitTransaction()}destroy(){this.clear(),this.collections=null,this.relationships=null}ingestPage(t){return this.ingestBatch(t==null?void 0:t.items)}ingestBatch(t){if(t)return t.map(r=>this.ingest(r))}ingest(t){let r=Mr.getInstance();r.beginTransaction();let n=this._ingest(t);return r.commitTransaction(),n}_ingest(t){if(!t)return;let r,n=this.collections.get(t.collectionName);if(n?r=n.ingest(t):this.error("No collection found for record",t),Nb(r)){let s=r.aggregate_root;if(s){let a=t.id,i=this.relationships.get(s.join(":"))||new Set;i.add([t.collectionName,a].join(":")),this.relationships.set(s.join(":"),i)}}if(Hb(r)){let s=r.acl;if(s){let a=t.id,i=this.relationships.get(s.join(":"))||new Set;i.add([t.collectionName,a].join(":")),this.relationships.set(s.join(":"),i)}}if(t.expand)for(let[,s]of Object.entries(t.expand))Array.isArray(s)?this.ingestBatch(s):this.ingest(s);return r}delete(t){this.cascade(t.collectionName,t.id)}graphviz(){let t=`digraph G {
`;for(let[r,n]of this.collections)for(let s of n.items()){if(!Vp(s)){this.warn("record has no id",s);continue}let a=r+"_"+s.id;if(CA(s)&&(a=r+"_"+s.name),t+=`  ${r}_${s.id} [label="${a}"];
`,Vp(s)&&Nb(s)&&s.aggregate_root){let[i,l]=s.aggregate_root;t+=`  ${r}_${s.id} -> ${i}_${l};
`}if(Vp(s)&&Hb(s)&&s.acl){let[i,l]=s.acl;t+=`  ${r}_${s.id} -> ${i}_${l} [style=dotted];
`}}return t+="}",t}cascade(t,r){let n=this.collections.get(t),s=this.relationships.get([t,r].join(":")),a=Mr.getInstance();a.beginTransaction(),n&&(this.warn("cascade delete parent",t,r),n.delete(r)),this.relationships.delete([t,r].join(":"));for(let i of s||[]){let[l,f]=i.split(":");this.warn("cascade delete child",l,f),this.getCollection(l)&&this.cascade(l,f)}a.commitTransaction()}},Qp=class extends li{constructor(t,r,n,s){super();this.users=n,this.roles=s,this.relays=r,this.relayRole=t}update(t){return this.relayRole=t,this}get id(){return this.relayRole.id}get userId(){return this.relayRole.user}get user(){let t=this.users.get(this.relayRole.user);if(!t)throw new Error(`Unable to find user: ${this.relayRole.user}`);return t}get role(){var t;return(t=this.roles.get(this.relayRole.role))==null?void 0:t.name}get relayId(){return this.relayRole.relay}get relay(){let t=this.relays.get(this.relayRole.relay);if(!t)throw new Error(`invalid role: unable to find relay ${this.relayRole.relay} on role ${this.relayRole.id}`);return t}get aggregate_root(){return["relays",this.relayRole.relay]}get acl(){return["users",this.relayRole.user]}},Zp=class{constructor(e,t,r){this.relayInvitation=e,this.roles=r,this.relays=t}update(e){return this.relayInvitation=e,this}get key(){return this.relayInvitation.key}get id(){return this.relayInvitation.id}get role(){var e;return(e=this.roles.get(this.relayInvitation.role))==null?void 0:e.name}get relayId(){return this.relayInvitation.relay}get relay(){let e=this.relays.get(this.relayInvitation.relay);if(!e)throw new Error("invalid invitation");return e}get aggregate_root(){return["relays",this.relayInvitation.relay]}},em=class extends St{constructor(t,r,n){super();this.subscription=t;this.relays=r;this.users=n}update(t){return this.subscription=t,this.notifyListeners(),this}get id(){return this.subscription.id}get token(){return this.subscription.token}get active(){return this.subscription.active}get user(){let t=this.users.get(this.subscription.user);if(!t)throw new Error("invalid subscription");return t}get relayId(){return this.subscription.relay}get relay(){let t=this.relays.get(this.subscription.relay);if(!t)throw new Error("invalid subscription");return t}get stripe_cancel_at(){return this.subscription.stripe_cancel_at}get cancelAt(){return this.subscription.stripe_cancel_at!==0?new Date(this.subscription.stripe_cancel_at*1e3):null}get quantity(){return this.subscription.stripe_quantity}get aggregate_root(){return["relays",this.subscription.relay]}get acl(){return["users",this.subscription.user]}},bc=class extends St{constructor(t,r,n,s,a,i){super();this.relay=t;this.relayRoles=r;this.relayInvitations=n;this.remoteFolders=s;this._subscriptions=a;this.user=i}update(t){return this.relay=t,this.notifyListeners(),this}get cta(){return this.relay.cta}get plan(){return this.relay.plan}get id(){return this.relay.id}get guid(){return this.relay.guid}get name(){return this.relay.name}set name(t){this.relay.name=t}get userLimit(){return this.relay.user_limit}get role(){var n;let t=this.relay.creator===this.user.id,r=(n=this.relayRoles.find(s=>s.relayId===this.relay.id&&s.userId===this.user.id))==null?void 0:n.role;return r||(this.warn("couldn't find role",this.relay.id,this.user,t),t?"Owner":"Member")}get owner(){return this.role==="Owner"}get invitation(){return this.relayInvitations.find(t=>t.relay.id===this.relay.id)}get folders(){return this.remoteFolders.filter(t=>t.relay.id===this.id)}get subscriptions(){return this._subscriptions.filter(t=>t.relay.id===this.id)}get acl(){var r;let t=(r=this.relayRoles.find(n=>n.relayId===this.id&&n.userId===this.user.id))==null?void 0:r.id;if(t)return["relay_roles",t]}get provider(){return this.relay.provider}},wc=class extends hr{constructor(t){super();this.loginManager=t;this.destroyed=!1;this.pb=this.loginManager.pb,this.users=new br("users"),this.relays=new br("relays"),this.remoteFolders=new br("remote folders"),this.relayInvitations=new br("relay invitations"),this.relayRoles=new br("relay roles"),this.roles=new br("roles"),this.roles.set("2arnubkcv7jpce8",{name:"Owner",id:"2arnubkcv7jpce8"}),this.roles.set("x6lllh2qsf9lxk6",{name:"Member",id:"x6lllh2qsf9lxk6"}),this.subscriptions=new br("subscriptions"),this._offLoginManager=this.loginManager.on(()=>{this.login()}),this.setUser(),this.user&&(Dt.set(this,"RelayManager"),this.buildGraph(),this.subscribe(),this.update())}buildGraph(){if(!this.user||this.store)return;let t=new qp(this.roles),r=new Yp(this.users),n=new Kp(this.relays,this.roles,this.relayRoles,this.relayInvitations,this.remoteFolders,this.subscriptions,this.user),s=new Gp(this.relayRoles,this.relays,this.users,this.roles),a=new jp(this.relayInvitations,this.relays,this.roles),i=new zp(this.remoteFolders,this.relays,this.users),l=new Jp(this.subscriptions,this.relays,this.users);this.store=new Xp([t,r,n,s,a,i,l])}setUser(){var t;this.authUser=(t=this.pb)==null?void 0:t.authStore.model,this.authUser&&(this.user=new yc(this.authUser),this.users.set(this.user.id,this.user))}login(){this.setUser(),this.buildGraph(),this.subscribe(),this.update()}logout(){var t;(t=this.store)==null||t.clear(),this.user=void 0,this.store=void 0}async getRelayInvitationKey(t){if(!this.pb)return"";let r=this.relayInvitations.find(n=>n.relay.id===t.id);return r!=null&&r.key?r.key:this.pb.collection("relay_invitations").getList(0,200).then(n=>{n.items.forEach(a=>{var i;(i=this.store)==null||i.ingest(a)});let s=this.relayInvitations.find(a=>a.relay.id===t.id);return s?s.key:""})}async getSubscriptionToken(t){if(!this.pb||!this.pb.authStore.isValid)throw new Error("Auth is not valid");let r=`/api/subscription/${t.id}/token`,n=await this.pb.send(r,{method:"POST"});if(n!==200)throw new Error("Token API failed");return n.json().token}async subscribe(){var n;if(!this.pb||!this.pb.authStore.isValid||((n=this.pb.authStore.model)==null?void 0:n.id)===void 0)return;let t=[{name:"relays",expand:["relay_invitations_via_relay","shared_folders_via_relay","shared_folders_via_relay.creator","subscriptions_via_relay","subscriptions_via_relay.relay","creator"]},{name:"relay_invitations",expand:["relay"]},{name:"relay_roles",expand:["user","relay"]},{name:"shared_folders",expand:["relay","creator"]},{name:"subscriptions",expand:["user","relay"]}],r=(s,a)=>{var i,l;this.debug(`[Event]: ${s}`,a.action,a.record),a.action==="delete"?(i=this.store)==null||i.delete(a.record):(l=this.store)==null||l.ingest(a.record)};for(let s of t)this.pb.collection(s.name).subscribe("*",a=>r(s.name,a),{expand:s.expand.join(","),fetch:wr})}collection(t){this.pb}async update(){let t=(n,s={})=>{var a;return!this.pb||!this.pb.authStore.isValid||((a=this.pb.authStore.model)==null?void 0:a.id)===void 0?Promise.resolve([]):(typeof s=="function"&&(s=s(this.pb.authStore.model.id)),this.pb.collection(n).getFullList(s))};[t("users",n=>({filter:`id="${n}"`,expand:"relay_roles_via_user,relay_roles_via_user.relay,relay_roles_via_user.role"})),t("relay_roles",{expand:"user"}),t("relay_invitations"),t("shared_folders",{expand:"relay,creator"}),t("subscriptions",{expand:"relay,user"})].forEach(async n=>{let s=await n;for(let a of s)!this.destroyed&&this.store&&this.store.ingest(a)})}async acceptInvitation(t){var s;if(!this.pb)throw new Error("Failed to accept invitation");let r=await this.pb.send("/api/accept-invitation",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:t})});this.debug("[InviteAccept]",r);let n=(s=this.store)==null?void 0:s.ingest(r);if(!n)throw new Error("Failed to accept invitation");return n}async createRelay(t){var a;let r=Ms(),n=await((a=this.pb)==null?void 0:a.collection("relays").create({guid:r,name:t,path:null}));if(!n)throw new Error("Failed to create Relay");if(!this.user)throw new Error("Not Logged In");let s=new bc(n,this.relayRoles,this.relayInvitations,this.remoteFolders,this.subscriptions,this.user);return this.relays.set(s.id,s),s}async updateRelay(t){var s;if(!this.pb)throw new Error("Failed to update relay");let r=await this.pb.collection("relays").update(t.id,{name:t.name.trim()}),n=(s=this.store)==null?void 0:s.ingest(r);if(!n)throw new Error("Failed to update relay");return n}async deleteRemote(t){var n;t.remote=void 0;let r=this.remoteFolders.find(s=>s.guid===t.guid);return r?(await((n=this.pb)==null?void 0:n.collection("shared_folders").delete(r.id)),t.remote=void 0,!0):!1}async createRemoteFolder(t,r){var a,i;if(!this.pb)throw new Error("Failed to create folder");let n=await this.pb.collection("shared_folders").create({name:t.name,guid:t.guid,relay:r.id,creator:(a=this.user)==null?void 0:a.id,private:!1},{expand:"relay"}),s=(i=this.store)==null?void 0:i.ingest(n);if(!s)throw new Error("Failed to create folder");return s}async destroyRelay(t){var r,n;return(r=this.store)==null||r.cascade("relays",t.id),await((n=this.pb)==null?void 0:n.collection("relays").delete(t.id)),!0}async leaveRelay(t){var n,s;let r=this.relayRoles.find(a=>{var i;return a.userId===((i=this.user)==null?void 0:i.id)&&a.relayId===t.id});r?await((n=this.pb)==null?void 0:n.collection("relay_roles").delete(r.id)):this.warn("No role found to leave relay"),(s=this.store)==null||s.cascade("relay",t.id)}async kick(t){var r;return(r=this.pb)==null?void 0:r.collection("relay_roles").delete(t.id)}destroy(){var t,r;this.destroyed=!0,this._offLoginManager&&this._offLoginManager(),(t=this.pb)==null||t.cancelAllRequests(),this.loginManager=null,this.pb=null,(r=this.store)==null||r.destroy(),this.authUser=null,this.store=null}};var g_=require("obsidian");var Kb=require("obsidian");var Wb=require("obsidian");function TA(o){Pe(o,"svelte-4kkvmr",".feature-flag-toggle-modal.svelte-4kkvmr{padding:1rem}.feature-flag-item.svelte-4kkvmr{display:flex;justify-content:space-between;align-items:center;padding:0.5rem 0;border-top:1px solid var(--background-modifier-border)}.checkbox-container.svelte-4kkvmr{cursor:pointer}")}function Vb(o,e,t){let r=o.slice();return r[8]=e[t][0],r[9]=e[t][1],r}function qb(o){let e,t,r,n=o[8]+"",s,a,i,l,f=o[8]+"",u,d,m,x,h,_,w,v,A,U,I,F;function $(){return o[6](o[8])}function E(){return o[7](o[8])}return{c(){e=P("div"),t=P("div"),r=P("div"),s=K(n),a=B(),i=P("div"),l=K("Toggle "),u=K(f),d=K(" on or off"),m=B(),x=P("div"),h=P("div"),_=P("input"),v=B(),A=P("div"),b(r,"class","setting-item-name"),b(i,"class","setting-item-description"),b(t,"class","setting-item-info"),b(_,"type","checkbox"),b(_,"tabindex","-1"),_.checked=w=o[9],b(A,"class","checkbox-toggle"),b(h,"role","checkbox"),b(h,"aria-checked",U=o[9]),b(h,"tabindex","0"),b(h,"class","checkbox-container svelte-4kkvmr"),ze(h,"is-enabled",o[9]),b(x,"class","setting-item-control"),b(e,"class","feature-flag-item setting-item svelte-4kkvmr")},m(M,R){T(M,e,R),k(e,t),k(t,r),k(r,s),k(t,a),k(t,i),k(i,l),k(i,u),k(i,d),k(e,m),k(e,x),k(x,h),k(h,_),k(h,v),k(h,A),I||(F=[re(h,"keypress",$),re(h,"click",E)],I=!0)},p(M,R){o=M,R&2&&n!==(n=o[8]+"")&&se(s,n),R&2&&f!==(f=o[8]+"")&&se(u,f),R&2&&w!==(w=o[9])&&(_.checked=w),R&2&&U!==(U=o[9])&&b(h,"aria-checked",U),R&2&&ze(h,"is-enabled",o[9])},d(M){M&&C(e),I=!1,ke(F)}}}function PA(o){let e,t,r,n,s,a,i,l,f,u=Fe(Object.entries(o[1])),d=[];for(let m=0;m<u.length;m+=1)d[m]=qb(Vb(o,u,m));return{c(){e=P("div"),t=P("h2"),t.textContent="Feature Flags",r=B();for(let m=0;m<d.length;m+=1)d[m].c();n=B(),s=P("div"),a=P("div"),i=P("button"),i.textContent="Apply",b(i,"aria-label","apply flag settings"),b(i,"tabindex","0"),b(a,"class","setting-item-control"),b(s,"class","setting-item"),b(e,"class","feature-flag-toggle-modal svelte-4kkvmr")},m(m,x){T(m,e,x),k(e,t),k(e,r);for(let h=0;h<d.length;h+=1)d[h]&&d[h].m(e,null);k(e,n),k(e,s),k(s,a),k(a,i),l||(f=[re(i,"click",function(){ft(o[0])&&o[0].apply(this,arguments)}),re(i,"keypress",function(){ft(o[0])&&o[0].apply(this,arguments)})],l=!0)},p(m,[x]){if(o=m,x&26){u=Fe(Object.entries(o[1]));let h;for(h=0;h<u.length;h+=1){let _=Vb(o,u,h);d[h]?d[h].p(_,x):(d[h]=qb(_),d[h].c(),d[h].m(e,n))}for(;h<d.length;h+=1)d[h].d(1);d.length=u.length}},i:X,o:X,d(m){m&&C(e),it(d,m),l=!1,ke(f)}}}function DA(o,e,t){let r,n,{reload:s}=e,a=qt.getInstance();me(o,a,d=>t(5,n=d));function i(d){let m=!r[d];t(1,r[d]=m,r),a.setFlag(d,r[d])}function l(d){return d in r}er(()=>{Object.keys(r).forEach(d=>{let m=document.getElementById(`toggle-${d}`);m&&(0,Wb.setIcon)(m,"check")})});let f=d=>{if(!l(d))throw new Error("Unexpected feature flag!");i(d)},u=d=>{if(!l(d))throw new Error("Unexpected feature flag!");i(d)};return o.$$set=d=>{"reload"in d&&t(0,s=d.reload)},o.$$.update=()=>{if(o.$$.dirty&32){e:t(1,r=Object.assign({},n.flags))}},[s,r,a,i,l,n,f,u]}var tm=class extends Z{constructor(e){super(),ee(this,e,DA,PA,Q,{reload:0},TA)}},zb=tm;var _c=class extends Kb.Modal{constructor(t,r){super(t);this.reload=r}onOpen(){let{contentEl:t}=this;this.component=new zb({target:t,props:{reload:this.reload}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var rw=require("obsidian");var ew=require("obsidian");function Gb(o,e,t){let r=o.slice();return r[13]=e[t],r}function jb(o,e,t){let r=o.slice();return r[16]=e[t],r}function AA(o){let e,t,r;return{c(){e=P("button"),e.textContent="Refresh"},m(n,s){T(n,e,s),t||(r=re(e,"click",(0,ew.debounce)(o[12])),t=!0)},p:X,d(n){n&&C(e),t=!1,r()}}}function MA(o){let e=navigator.userAgent+"",t;return{c(){t=K(e)},m(r,n){T(r,t,n)},p:X,d(r){r&&C(t)}}}function EA(o){let e;return{c(){e=K(o[1])},m(t,r){T(t,e,r)},p(t,r){r&2&&se(e,t[1])},d(t){t&&C(e)}}}function FA(o){let e;return{c(){e=K(o[2])},m(t,r){T(t,e,r)},p(t,r){r&4&&se(e,t[2])},d(t){t&&C(e)}}}function RA(o){let e;return{c(){e=K(o[3])},m(t,r){T(t,e,r)},p(t,r){r&8&&se(e,t[3])},d(t){t&&C(e)}}}function OA(o){let e=o[0].loadTime?`${o[0].loadTime}ms`:"unknown",t;return{c(){t=K(e)},m(r,n){T(r,t,n)},p(r,n){n&1&&e!==(e=r[0].loadTime?`${r[0].loadTime}ms`:"unknown")&&se(t,e)},d(r){r&&C(t)}}}function Yb(o){let e,t=`${o[16]}`,r,n;return{c(){e=P("div"),r=K(t),n=B()},m(s,a){T(s,e,a),k(e,r),k(e,n)},p(s,a){a&16&&t!==(t=`${s[16]}`)&&se(r,t)},d(s){s&&C(e)}}}function UA(o){let e,t=Fe(Object.keys(o[4].cancelControllers)),r=[];for(let n=0;n<t.length;n+=1)r[n]=Yb(jb(o,t,n));return{c(){e=P("div");for(let n=0;n<r.length;n+=1)r[n].c();b(e,"slot","description")},m(n,s){T(n,e,s);for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(e,null)},p(n,s){if(s&16){t=Fe(Object.keys(n[4].cancelControllers));let a;for(a=0;a<t.length;a+=1){let i=jb(n,t,a);r[a]?r[a].p(i,s):(r[a]=Yb(i),r[a].c(),r[a].m(e,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=t.length}},d(n){n&&C(e),it(r,n)}}}function Jb(o){let e,t=`${o[13]}`,r,n;return{c(){e=P("div"),r=K(t),n=B()},m(s,a){T(s,e,a),k(e,r),k(e,n)},p(s,a){a&32&&t!==(t=`${s[13]}`)&&se(r,t)},d(s){s&&C(e)}}}function $A(o){let e,t=Fe(o[5]),r=[];for(let n=0;n<t.length;n+=1)r[n]=Jb(Gb(o,t,n));return{c(){e=P("div");for(let n=0;n<r.length;n+=1)r[n].c();b(e,"slot","description")},m(n,s){T(n,e,s);for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(e,null)},p(n,s){if(s&32){t=Fe(n[5]);let a;for(a=0;a<t.length;a+=1){let i=Gb(n,t,a);r[a]?r[a].p(i,s):(r[a]=Jb(i),r[a].c(),r[a].m(e,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=t.length}},d(n){n&&C(e),it(r,n)}}}function BA(o){let e,t,r,n,s,a,i,l,f,u,d,m,x,h,_,w,v,A,U,I,F,$,E;return n=new Je({props:{name:"Environment",$$slots:{default:[AA]},$$scope:{ctx:o}}}),a=new He({props:{name:"User Agent",description:"",$$slots:{default:[MA]},$$scope:{ctx:o}}}),l=new He({props:{name:"Fetch",description:"",$$slots:{default:[EA]},$$scope:{ctx:o}}}),u=new He({props:{name:"Response",description:"",$$slots:{default:[FA]},$$scope:{ctx:o}}}),m=new He({props:{name:"Blink Fetch",description:"",$$slots:{default:[RA]},$$scope:{ctx:o}}}),h=new He({props:{name:"Startup Time",description:"",$$slots:{default:[OA]},$$scope:{ctx:o}}}),w=new Je({props:{name:"Connections"}}),A=new He({props:{name:"",description:"",$$slots:{description:[UA]},$$scope:{ctx:o}}}),I=new Je({props:{name:"Log Files"}}),$=new He({props:{name:"",description:"",$$slots:{description:[$A]},$$scope:{ctx:o}}}),{c(){e=P("div"),e.textContent="Debug Info",t=B(),r=P("div"),V(n.$$.fragment),s=B(),V(a.$$.fragment),i=B(),V(l.$$.fragment),f=B(),V(u.$$.fragment),d=B(),V(m.$$.fragment),x=B(),V(h.$$.fragment),_=B(),V(w.$$.fragment),v=B(),V(A.$$.fragment),U=B(),V(I.$$.fragment),F=B(),V($.$$.fragment),b(e,"class","modal-title"),b(r,"class","modal-content")},m(M,R){T(M,e,R),T(M,t,R),T(M,r,R),N(n,r,null),k(r,s),N(a,r,null),k(r,i),N(l,r,null),k(r,f),N(u,r,null),k(r,d),N(m,r,null),k(r,x),N(h,r,null),k(r,_),N(w,r,null),k(r,v),N(A,r,null),k(r,U),N(I,r,null),k(r,F),N($,r,null),E=!0},p(M,[R]){let q={};R&524288&&(q.$$scope={dirty:R,ctx:M}),n.$set(q);let J={};R&524288&&(J.$$scope={dirty:R,ctx:M}),a.$set(J);let G={};R&524290&&(G.$$scope={dirty:R,ctx:M}),l.$set(G);let z={};R&524292&&(z.$$scope={dirty:R,ctx:M}),u.$set(z);let W={};R&524296&&(W.$$scope={dirty:R,ctx:M}),m.$set(W);let oe={};R&524289&&(oe.$$scope={dirty:R,ctx:M}),h.$set(oe);let Ie={};R&524304&&(Ie.$$scope={dirty:R,ctx:M}),A.$set(Ie);let De={};R&524320&&(De.$$scope={dirty:R,ctx:M}),$.$set(De)},i(M){E||(L(n.$$.fragment,M),L(a.$$.fragment,M),L(l.$$.fragment,M),L(u.$$.fragment,M),L(m.$$.fragment,M),L(h.$$.fragment,M),L(w.$$.fragment,M),L(A.$$.fragment,M),L(I.$$.fragment,M),L($.$$.fragment,M),E=!0)},o(M){D(n.$$.fragment,M),D(a.$$.fragment,M),D(l.$$.fragment,M),D(u.$$.fragment,M),D(m.$$.fragment,M),D(h.$$.fragment,M),D(w.$$.fragment,M),D(A.$$.fragment,M),D(I.$$.fragment,M),D($.$$.fragment,M),E=!1},d(M){M&&(C(e),C(t),C(r)),H(n),H(a),H(l),H(u),H(m),H(h),H(w),H(A),H(I),H($)}}}function Xb(){try{return Response.toString()}catch(o){return"undefined"}}function Qb(){try{return fetch.toString()}catch(o){return"undefined"}}function Zb(){try{return(globalThis==null?void 0:globalThis.blinkfetch)!==void 0?"Yes":"No"}catch(o){return"No"}}function NA(o,e,t){let r,n,s,a,i,{plugin:l}=e,f=_e(Xb());me(o,f,w=>t(2,n=w));let u=_e(Qb());me(o,u,w=>t(1,r=w));let d=_e(Zb());me(o,d,w=>t(3,s=w));let m=_e(l.loginManager.pb);me(o,m,w=>t(4,a=w));let x=_e([]);me(o,x,w=>t(5,i=w)),gl().then(w=>{x.set(w)});function h(){f.set(Xb()),u.set(Qb()),d.set(Zb()),m.set(l.loginManager.pb)}let _=()=>{h()};return o.$$set=w=>{"plugin"in w&&t(0,l=w.plugin)},[l,r,n,s,a,i,f,u,d,m,x,h,_]}var rm=class extends Z{constructor(e){super(),ee(this,e,NA,BA,Q,{plugin:0})}},tw=rm;var vc=class extends rw.Modal{constructor(t,r){super(t);this.plugin=r}onOpen(){let{contentEl:t}=this;this.component=new tw({target:t,props:{plugin:this.plugin}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var ur=class extends Error{constructor(t,r){super(t);this.path=r;this.name="SettingsError"}};var Sc=class extends St{constructor(t,r){super();this.storage=t;this.defaults=r;this._loaded=!1;this.data={...r}}async load(){let t=await this.storage.loadData();this.data={...this.defaults,...t||{}},this._loaded=!0,this.log("Loaded settings from disk:",this.data)}async save(){if(!this._loaded){this.warn("Attempted to save before loading settings from disk");return}this.warn("Saving settings to disk:",this.data),await this.storage.saveData(this.data)}get(){return this.data}async update(t){if(!this._loaded){this.warn("Attempted to update before loading settings from disk");return}let r=t(this.data),n=await this.storage.loadData();if(JSON.stringify(r)===JSON.stringify(n)){this.debug("updated matches disk, no change");return}this.data=r,await this.save(),this.notifyListeners()}notifyListeners(){for(let t of this._listeners)t(this.data)}},jr=class extends St{constructor(t,r){super();this.settings=t;this.patterns=[];this.validatePath(r),[this.path,this.basePath,this.patterns]=this.processPath(r),this.lastKnown=this.getNestedValue(this.settings.get()),this.setupSubscription()}isWildcardPattern(t){return t.type==="wildcard"}validatePath(t){if(!t)throw new ur("Path cannot be empty");if(t.startsWith("/")||t.endsWith("/"))throw new ur(`Invalid path format: ${t}`)}createPatternRegex(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace("\\*",".*")}setupSubscription(){this.unsub=this.settings.subscribe(()=>{let t=this.getNestedValue(this.settings.get());this.lastKnown===void 0&&t===void 0||JSON.stringify(this.lastKnown)!==JSON.stringify(t)&&(this.lastKnown=t,this.notifyListeners())})}hasArrayPatterns(){return this.patterns.some(t=>t.type==="arrayMatch")}destroy(){this.destroyed||(this.unsub&&(this.unsub(),this.unsub=void 0),this._listeners.clear(),this.destroyed=!0)}get(){if(this.destroyed)throw new ur("Cannot use destroyed settings",this.getPath());let t=this.settings.get();if(!t)return{};let r=this.patterns.find(this.isWildcardPattern);if(r&&this.path.length===1){let s=new RegExp(`^${r.wildcardPattern}$`);return Object.entries(t).filter(([i])=>s.test(i)).reduce((i,[l,f])=>(i[l]=f,i),{})}let n=this.getNestedValue(t);return n===void 0?{}:n}async set(t){if(this.destroyed)throw new ur("Cannot use destroyed settings",this.getPath());if(t===void 0)throw new ur("Cannot set undefined value",this.getPath());try{await this.settings.update(r=>{let n=this.patterns.find(this.isWildcardPattern);if(n){if(this.path.length===1){let l=new RegExp(`^${n.wildcardPattern}$`),f={...r};return Object.entries(t).forEach(([u,d])=>{l.test(u)&&(f[u]=d)}),f}let s={...r},a=s;this.path.forEach(l=>{a[l]=a[l]||{},a=a[l]});let i=new RegExp(`^${n.wildcardPattern}$`);return Object.entries(t).forEach(([l,f])=>{i.test(l)&&(a[l]=f)}),s}return this.setNestedValue(r,t)})}catch(r){let n=r instanceof Error?r.message:"Unknown error";throw new ur(`Failed to set value at path ${this.getPath()}: ${n}`,this.getPath())}}async update(t,r=!1){if(this.destroyed)throw new ur("Cannot use destroyed settings",this.getPath());let n=this.get(),s=t(n);!r&&JSON.stringify(n)===JSON.stringify(s)||await this.set(s)}async flush(){if(this.destroyed)throw new ur("Cannot use destroyed settings",this.getPath());await this.update(t=>t,!0)}processPath(t){let r=t.split("/").filter(i=>i),n=[],s=[],a=[];return r.forEach((i,l)=>{let f=i.match(/^\[(\w+)=(.+)\]$/),u=i.match(/^\((.+?)\)$/);if(f){let[,d,m]=f,x=l>0?s[l-1]:i.split("[")[0];a.push({type:"arrayMatch",key:d,value:m,level:l}),n.push(i),s.push(x)}else if(u){let[,d]=u;a.push({type:"wildcard",wildcardPattern:this.createPatternRegex(d),level:l}),n.push(i),s.push(i)}else n.push(i),s.push(i)}),[n,s,a]}getNestedValue(t){let r=t,n=this.patterns.find(this.isWildcardPattern);if(n&&this.path.length===1){let a=new RegExp(`^${n.wildcardPattern}$`);return Object.entries(r).filter(([l])=>a.test(l)).reduce((l,[f,u])=>(l[f]=u,l),{})}let s=this.patterns[0];if((s==null?void 0:s.type)==="arrayMatch"){let a=this.basePath[0];if(!Array.isArray(r[a]))return;let i=r[a].find(f=>f[s.key]===s.value);if(!i)return;let l=this.basePath.slice(s.level+1);if(l.length>0){let f=i;for(let u of l){if(!f||typeof f!="object")return;f=f[u]}return f}return i}for(let a=0;a<this.basePath.length;a++){if(!r)return;r=r[this.basePath[a]]}return r}setNestedValue(t,r){let n={...t},s=this.patterns.find(l=>l.type==="arrayMatch");if(s){let l=this.basePath[0];n[l]||(n[l]=[]);let f=n[l].findIndex(d=>d[s.key]===s.value),u=this.basePath.slice(s.level+1);if(f>=0)if(u.length>0){let d=n[l][f];for(let x=0;x<u.length-1;x++){let h=u[x];d[h]=d[h]||{},d=d[h]}let m=u[u.length-1];d[m]=r}else n[l][f]={...n[l][f],...r,[s.key]:s.value};else if(u.length>0){let d={[s.key]:s.value},m=d;for(let h=0;h<u.length-1;h++){let _=u[h];m[_]={},m=m[_]}let x=u[u.length-1];m[x]=r,n[l].push(d)}else n[l].push({...r,[s.key]:s.value});return n}let a=n;for(let l=0;l<this.basePath.length-1;l++){let f=this.basePath[l];a[f]=a[f]||{},a=a[f]}let i=this.basePath[this.basePath.length-1];return a[i]=r,n}getParent(){if(this.destroyed)throw new ur("Cannot use destroyed settings",this.getPath());let t=this.path.slice(0,-1).join("/");return new jr(this.settings,t)}getChild(t,r){let n=[...this.path,t].join("/");return r?r(this.settings,n):(this.log("getChild",this.path,t,n,this.patterns),new jr(this.settings,n))}getPath(){return this.path.join("/")}exists(){if(this.destroyed)throw new ur("Cannot use destroyed settings",this.getPath());let t=this.settings.get();return this.getNestedValue(t)!==void 0}async delete(){if(this.destroyed)throw new ur("Cannot use destroyed settings",this.getPath());await this.settings.update(t=>{let r={...t},n=this.patterns.find(l=>l.type==="arrayMatch");if(n){let l=this.basePath[0];return Array.isArray(r[l])&&(r[l]=r[l].filter(f=>f[n.key]!==n.value),r[l].length===0&&delete r[l]),r}let s=r,a=this.basePath.slice(0,-1);for(let l of a){if(!s[l])return r;s=s[l]}let i=this.basePath[this.basePath.length-1];return delete s[i],r})}subscribe(t){if(this.destroyed)throw new ur("Cannot use destroyed settings",this.getPath());return this._listeners.add(t),t(this.get()),()=>{this._listeners.delete(t)}}notifyListeners(){if(this.destroyed)return;let t=this.get();for(let r of this._listeners)r(t)}};var ow=require("obsidian"),kc=class{notify(e){new ow.Notice(e)}},Ic=class{constructor(e){this.vault=e}async append(e,t){return this.vault.adapter.append(e,t)}async stat(e){return this.vault.adapter.stat(e)}async exists(e){return this.vault.adapter.exists(e)}async remove(e){return this.vault.adapter.remove(e)}async rename(e,t){return this.vault.adapter.rename(e,t)}async write(e,t){return this.vault.adapter.write(e,t)}async read(e){return this.vault.adapter.read(e)}};var dw=require("obsidian");var fw=require("obsidian");function HA(o){Pe(o,"svelte-jmqfac",".system3-bug-report.svelte-jmqfac{display:flex;flex-direction:column;height:100%;min-height:30em}.report-container.svelte-jmqfac{display:flex;flex-direction:column;flex:1}.form-content.svelte-jmqfac{flex:1;overflow-y:auto}textarea.svelte-jmqfac{width:100%;height:300px;resize:vertical}.centered-message.svelte-jmqfac{display:flex;flex:1;align-items:center;justify-content:center;padding-bottom:5em}")}function nw(o,e,t){let r=o.slice();return r[21]=e[t],r}function VA(o){let e,t,r,n,s,a,i,l,f,u,d,m,x;r=new He({props:{name:"Description",description:"Please describe what went wrong and what you were trying to do."}}),i=new He({props:{name:"Include Logs",description:"Send logs to the Relay developers to help them debug the issue.",$$slots:{default:[zA]},$$scope:{ctx:o}}});let h=o[4]&&sw(o);return u=new He({props:{name:"",description:"",$$slots:{default:[GA]},$$scope:{ctx:o}}}),{c(){e=P("div"),t=P("div"),V(r.$$.fragment),n=B(),s=P("textarea"),a=B(),V(i.$$.fragment),l=B(),h&&h.c(),f=B(),V(u.$$.fragment),b(s,"placeholder","Describe the issue here..."),b(s,"class","svelte-jmqfac"),b(t,"class","form-content svelte-jmqfac"),b(e,"class","report-container svelte-jmqfac")},m(_,w){T(_,e,w),k(e,t),N(r,t,null),k(t,n),k(t,s),Zt(s,o[3]),k(t,a),N(i,t,null),k(t,l),h&&h.m(t,null),k(e,f),N(u,e,null),d=!0,m||(x=re(s,"input",o[13]),m=!0)},p(_,w){w&8&&Zt(s,_[3]);let v={};w&16777232&&(v.$$scope={dirty:w,ctx:_}),i.$set(v),_[4]?h?(h.p(_,w),w&16&&L(h,1)):(h=sw(_),h.c(),L(h,1),h.m(t,null)):h&&(be(),D(h,1,1,()=>{h=null}),we());let A={};w&16777293&&(A.$$scope={dirty:w,ctx:_}),u.$set(A)},i(_){d||(L(r.$$.fragment,_),L(i.$$.fragment,_),L(h),L(u.$$.fragment,_),d=!0)},o(_){D(r.$$.fragment,_),D(i.$$.fragment,_),D(h),D(u.$$.fragment,_),d=!1},d(_){_&&C(e),H(r),H(i),h&&h.d(),H(u),m=!1,x()}}}function qA(o){let e;return{c(){e=P("div"),e.innerHTML='<div id="spinner" class="d-flex align-items-center"><strong>Sending Bug Report...</strong> <div class="spinner-border ms-auto" role="status" aria-hidden="true"></div></div>',b(e,"class","centered-message svelte-jmqfac")},m(t,r){T(t,e,r)},p:X,i:X,o:X,d(t){t&&C(e)}}}function WA(o){let e,t,r;return t=new He({props:{name:"Thank you!",description:"Your bug report will help us improve Relay."}}),{c(){e=P("div"),V(t.$$.fragment),b(e,"class","centered-message svelte-jmqfac")},m(n,s){T(n,e,s),N(t,e,null),r=!0},p:X,i(n){r||(L(t.$$.fragment,n),r=!0)},o(n){D(t.$$.fragment,n),r=!1},d(n){n&&C(e),H(t)}}}function zA(o){let e,t,r,n,s,a;return{c(){e=P("div"),t=P("input"),r=B(),n=P("div"),b(t,"type","checkbox"),b(t,"tabindex","-1"),t.checked=o[4],b(n,"class","checkbox-toggle"),b(e,"role","checkbox"),b(e,"aria-checked",o[4]),b(e,"tabindex","0"),b(e,"class","checkbox-container"),ze(e,"is-enabled",o[4])},m(i,l){T(i,e,l),k(e,t),k(e,r),k(e,n),s||(a=[re(e,"keypress",YA),re(e,"click",o[14])],s=!0)},p(i,l){l&16&&(t.checked=i[4]),l&16&&b(e,"aria-checked",i[4]),l&16&&ze(e,"is-enabled",i[4])},d(i){i&&C(e),s=!1,ke(a)}}}function sw(o){let e,t;return e=new He({props:{name:"Logs",description:"",$$slots:{description:[KA]},$$scope:{ctx:o}}}),{c(){V(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},p(r,n){let s={};n&16777248&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function aw(o){let e,t=`${o[21]}
`,r,n;return{c(){e=P("div"),r=K(t),n=B()},m(s,a){T(s,e,a),k(e,r),k(e,n)},p(s,a){a&32&&t!==(t=`${s[21]}
`)&&se(r,t)},d(s){s&&C(e)}}}function KA(o){let e,t=Fe(o[5]),r=[];for(let n=0;n<t.length;n+=1)r[n]=aw(nw(o,t,n));return{c(){e=P("div");for(let n=0;n<r.length;n+=1)r[n].c();b(e,"slot","description")},m(n,s){T(n,e,s);for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(e,null)},p(n,s){if(s&32){t=Fe(n[5]);let a;for(a=0;a<t.length;a+=1){let i=nw(n,t,a);r[a]?r[a].p(i,s):(r[a]=aw(i),r[a].c(),r[a].m(e,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=t.length}},d(n){n&&C(e),it(r,n)}}}function GA(o){let e,t,r,n;return{c(){e=P("button"),t=K("Send"),e.disabled=o[2]},m(s,a){T(s,e,a),k(e,t),r||(n=re(e,"click",o[15]),r=!0)},p(s,a){a&4&&(e.disabled=s[2])},d(s){s&&C(e),r=!1,n()}}}function jA(o){let e,t,r,n,s,a,i=[WA,qA,VA],l=[];function f(u,d){return u[1]?0:u[2]&&!u[1]?1:2}return n=f(o,-1),s=l[n]=i[n](o),{c(){e=P("div"),e.textContent="Send Bug Report",t=B(),r=P("div"),s.c(),b(e,"class","modal-title"),b(r,"class","modal-content system3-bug-report svelte-jmqfac")},m(u,d){T(u,e,d),T(u,t,d),T(u,r,d),l[n].m(r,null),a=!0},p(u,[d]){let m=n;n=f(u,d),n===m?l[n].p(u,d):(be(),D(l[m],1,1,()=>{l[m]=null}),we(),s=l[n],s?s.p(u,d):(s=l[n]=i[n](u),s.c()),L(s,1),s.m(r,null))},i(u){a||(L(s),a=!0)},o(u){D(s),a=!1},d(u){u&&(C(e),C(t),C(r)),l[n].d()}}}function iw(){try{return Response.toString()}catch(o){return"undefined"}}function lw(){try{return fetch.toString()}catch(o){return"undefined"}}function cw(){try{return(globalThis==null?void 0:globalThis.blinkfetch)!==void 0?"Yes":"No"}catch(o){return"No"}}var YA=()=>{};function JA(o,e,t){let r,n,s,a,i,l,{plugin:f}=e,u=_e(iw()),d=_e(lw()),m=_e(cw()),x=_e("");me(o,x,M=>t(3,s=M));let h=_e(!1);me(o,h,M=>t(4,a=M));let _=_e(!1),w=_e(!1);me(o,w,M=>t(2,n=M));let v=_e(!1);me(o,v,M=>t(1,r=M));let A=_e(f.loginManager.pb);me(o,A,M=>t(6,l=M));let U=_e([]);me(o,U,M=>t(5,i=M)),gl().then(M=>{U.set(M)});function I(){u.set(iw()),d.set(lw()),m.set(cw()),A.set(f.loginManager.pb)}function F(){s=this.value,x.set(s)}let $=()=>{let M=!a;h.set(M)},E=async()=>{var R;let M=`Bug Report

`;if(M+=JSON.stringify({userAgent:navigator.userAgent,manifest:f.manifest,user:(R=l==null?void 0:l.authStore.model)==null?void 0:R.id,loadTime:f.loadTime,description:s},null,2),M+=`

`,h){let q=await dx();M+=q}(0,fw.requestUrl)({url:"https://bug-reports.system3.dev",method:"PUT",body:M,headers:{"Content-Type":"text/plain"}}).then(()=>{v.set(!0)}),w.set(!0)};return o.$$set=M=>{"plugin"in M&&t(0,f=M.plugin)},[f,r,n,s,a,i,l,x,h,w,v,A,U,F,$,E]}var om=class extends Z{constructor(e){super(),ee(this,e,JA,jA,Q,{plugin:0},HA)}},uw=om;var Lc=class extends dw.Modal{constructor(t,r){super(t);this.plugin=r}onOpen(){let{contentEl:t}=this;this.component=new uw({target:t,props:{plugin:this.plugin}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var _w=require("obsidian");async function pw(o){let{appId:e,filterByAppId:t,onProgress:r}=o,n=await window.indexedDB.databases(),s=n.length,a=[],i=0,l=0,f=0,u=0;for(let d of n)if(d.name){try{let m=await new Promise((x,h)=>{let _=indexedDB.open(d.name);_.onerror=()=>h(_.error),_.onsuccess=w=>x(w.target.result)});try{let x=Array.from(m.objectStoreNames);if(!x.includes("updates")||!x.includes("custom"))continue;let h=m.transaction(["updates","custom"],"readonly"),_=h.objectStore("updates"),w=h.objectStore("custom"),v=await new Promise(U=>{let I=w.get("appId");I.onsuccess=()=>U(I.result||"")});i++;let A=await new Promise((U,I)=>{let F=_.count();F.onsuccess=()=>U(F.result),F.onerror=()=>I(F.error)});if(l+=A,A>0){let U=0;if(await new Promise((I,F)=>{let $=_.openCursor();$.onsuccess=E=>{let M=E.target.result;if(M){let R=M.value instanceof Uint8Array?M.value.byteLength:JSON.stringify(M.value).length;U+=R,M.continue()}else I()},$.onerror=()=>F($.error)}),f+=U,U>1024*1024&&(!t||v===e)){let I=await new Promise(E=>{let M=w.get("path");M.onsuccess=()=>E(M.result||"")}),F=await new Promise(E=>{let M=w.get("relay");M.onsuccess=()=>E(M.result||"")}),$=!d.name.startsWith(`${e}-relay`);a.push({slug:`${d.name}/${_.name}`,path:I,relay:F,appId:v||"unknown",count:A,estimatedSizeMB:Math.round(U/(1024*1024)*100)/100,isLegacy:$})}}}finally{m.close()}}catch(m){console.error(`Error processing database ${d.name}:`,m);continue}u++,r&&r(u/n.length*100)}return{totalStores:i,totalItems:l,totalSizeMB:Math.round(f/(1024*1024)*100)/100,databaseCount:s,largeStores:a.sort((d,m)=>m.estimatedSizeMB-d.estimatedSizeMB)}}async function mw(o){let[e,t]=o.split("/"),r=await new Promise((n,s)=>{let a=indexedDB.open(e);a.onerror=()=>s(a.error),a.onsuccess=()=>n(a.result)});try{let s=r.transaction(t,"readwrite").objectStore(t);await new Promise((a,i)=>{let l=s.clear();l.onsuccess=()=>a(),l.onerror=()=>i(l.error)})}catch(n){console.error(`Error deleting store: ${o}`,n)}finally{r.close()}}var FK=require("obsidian");function XA(o){Pe(o,"svelte-1n3w4sk",".system3-dangerous.svelte-1n3w4sk:enabled{background-color:var(--background-modifier-error)}.system3-indexeddb-analysis.svelte-1n3w4sk{padding:1rem;max-height:500px;overflow-y:auto}.system3-loading-container.svelte-1n3w4sk{display:flex;flex-direction:column;align-items:center;justify-content:center;height:200px;gap:1rem}.system3-loading-spinner.svelte-1n3w4sk{border:4px solid var(--background-modifier-border);border-top:4px solid var(--interactive-accent);border-radius:50%;width:40px;height:40px;animation:svelte-1n3w4sk-spin 1s linear infinite}.system3-progress-bar.svelte-1n3w4sk{width:80%;height:8px;border-radius:4px;background-color:var(--background-secondary);overflow:hidden;margin:0 auto}.system3-progress-fill.svelte-1n3w4sk{height:100%;background-color:var(--color-accent);border-radius:4px;transition:width 0.3s ease;min-width:0%;max-width:100%}.system3-error-message.svelte-1n3w4sk{color:var(--text-error);padding:1rem;background-color:var(--mod-error);border-radius:4px}.system3-actions.svelte-1n3w4sk{display:flex;gap:0.5rem}.system3-summary-stats.svelte-1n3w4sk{display:grid;grid-template-columns:repeat(3, 1fr);gap:1rem;margin-bottom:2rem;padding:1rem;background-color:var(--background-secondary);border-radius:4px}.system3-stat-item.svelte-1n3w4sk{text-align:center}.system3-global-count.svelte-1n3w4sk{grid-column:1 / -1;padding-top:0.5rem;margin-top:0.5rem;border-bottom:1px solid var(--background-modifier-border)}.system3-warning.svelte-1n3w4sk{color:var(--text-warning)}.system3-critical.svelte-1n3w4sk{color:var(--text-error)}.system3-warning-text.svelte-1n3w4sk{font-size:0.8em;margin-top:0.5rem;color:var(--text-warning);line-height:1.4}.system3-warning-text.system3-critical.svelte-1n3w4sk{color:var(--text-error);font-weight:bold}.system3-stat-label.svelte-1n3w4sk{font-size:0.9em;color:var(--text-muted);margin-bottom:0.5rem}.system3-stat-value.svelte-1n3w4sk{font-size:1.2em;font-weight:bold}@keyframes svelte-1n3w4sk-spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}")}function hw(o,e,t){let r=o.slice();return r[18]=e[t][0],r[19]=e[t][1],r}function gw(o,e,t){let r=o.slice();return r[22]=e[t],r}function QA(o){let e,t,r,n,s,a=o[0].databaseCount.toLocaleString()+"",i,l,f,u,d,m,x,h,_=o[0].totalStores+"",w,v,A,U,I,F,$=o[0].totalItems.toLocaleString()+"",E,M,R,q,J,G,z=o[0].totalSizeMB.toFixed(2)+"",W,oe,Ie,De,Me;function Ye(te,$e){if(te[0].databaseCount>45e3)return rM;if(te[0].databaseCount>4e4)return tM}let Re=Ye(o,-1),de=Re&&Re(o),ce=o[0].largeStores.length>0&&xw(o);return{c(){e=P("div"),t=P("div"),r=P("div"),r.textContent="Global Database Limit",n=B(),s=P("div"),i=K(a),l=K(" / 50,000"),f=B(),de&&de.c(),u=B(),d=P("div"),m=P("div"),m.textContent="Relay Databases",x=B(),h=P("div"),w=K(_),v=B(),A=P("div"),U=P("div"),U.textContent="Document Updates",I=B(),F=P("div"),E=K($),M=B(),R=P("div"),q=P("div"),q.textContent="Total Size",J=B(),G=P("div"),W=K(z),oe=K(" MB"),Ie=B(),ce&&ce.c(),De=Le(),b(r,"class","system3-stat-label svelte-1n3w4sk"),b(s,"class","system3-stat-value svelte-1n3w4sk"),ze(s,"system3-warning",o[0].databaseCount>4e4),ze(s,"system3-critical",o[0].databaseCount>45e3),b(t,"class","system3-stat-item system3-global-count svelte-1n3w4sk"),b(m,"class","system3-stat-label svelte-1n3w4sk"),b(h,"class","system3-stat-value svelte-1n3w4sk"),b(d,"class","system3-stat-item svelte-1n3w4sk"),b(U,"class","system3-stat-label svelte-1n3w4sk"),b(F,"class","system3-stat-value svelte-1n3w4sk"),b(A,"class","system3-stat-item svelte-1n3w4sk"),b(q,"class","system3-stat-label svelte-1n3w4sk"),b(G,"class","system3-stat-value svelte-1n3w4sk"),b(R,"class","system3-stat-item svelte-1n3w4sk"),b(e,"class","system3-summary-stats svelte-1n3w4sk")},m(te,$e){T(te,e,$e),k(e,t),k(t,r),k(t,n),k(t,s),k(s,i),k(s,l),k(t,f),de&&de.m(t,null),k(e,u),k(e,d),k(d,m),k(d,x),k(d,h),k(h,w),k(e,v),k(e,A),k(A,U),k(A,I),k(A,F),k(F,E),k(e,M),k(e,R),k(R,q),k(R,J),k(R,G),k(G,W),k(G,oe),T(te,Ie,$e),ce&&ce.m(te,$e),T(te,De,$e),Me=!0},p(te,$e){(!Me||$e&1)&&a!==(a=te[0].databaseCount.toLocaleString()+"")&&se(i,a),(!Me||$e&1)&&ze(s,"system3-warning",te[0].databaseCount>4e4),(!Me||$e&1)&&ze(s,"system3-critical",te[0].databaseCount>45e3),Re!==(Re=Ye(te,$e))&&(de&&de.d(1),de=Re&&Re(te),de&&(de.c(),de.m(t,null))),(!Me||$e&1)&&_!==(_=te[0].totalStores+"")&&se(w,_),(!Me||$e&1)&&$!==($=te[0].totalItems.toLocaleString()+"")&&se(E,$),(!Me||$e&1)&&z!==(z=te[0].totalSizeMB.toFixed(2)+"")&&se(W,z),te[0].largeStores.length>0?ce?(ce.p(te,$e),$e&1&&L(ce,1)):(ce=xw(te),ce.c(),L(ce,1),ce.m(De.parentNode,De)):ce&&(be(),D(ce,1,1,()=>{ce=null}),we())},i(te){Me||(L(ce),Me=!0)},o(te){D(ce),Me=!1},d(te){te&&(C(e),C(Ie),C(De)),de&&de.d(),ce&&ce.d(te)}}}function ZA(o){let e,t;return{c(){e=P("div"),t=K(o[5]),b(e,"class","system3-error-message svelte-1n3w4sk")},m(r,n){T(r,e,n),k(e,t)},p(r,n){n&32&&se(t,r[5])},i:X,o:X,d(r){r&&C(e)}}}function eM(o){let e,t,r,n,s,a,i;return{c(){e=P("div"),t=P("div"),r=B(),n=P("div"),n.textContent="Analyzing Databases...",s=B(),a=P("div"),i=P("div"),b(t,"class","system3-loading-spinner svelte-1n3w4sk"),b(n,"class","loading-text"),b(i,"class","system3-progress-fill svelte-1n3w4sk"),ue(i,"width",o[4]+"%"),b(a,"class","system3-progress-bar svelte-1n3w4sk"),b(e,"class","system3-loading-container svelte-1n3w4sk")},m(l,f){T(l,e,f),k(e,t),k(e,r),k(e,n),k(e,s),k(e,a),k(a,i)},p(l,f){f&16&&ue(i,"width",l[4]+"%")},i:X,o:X,d(l){l&&C(e)}}}function tM(o){let e;return{c(){e=P("div"),e.innerHTML=`Warning: high number of databases.<br/>
						Consider cleaning up unused databases.`,b(e,"class","system3-warning-text svelte-1n3w4sk")},m(t,r){T(t,e,r)},d(t){t&&C(e)}}}function rM(o){let e;return{c(){e=P("div"),e.innerHTML=`Critical: approaching IndexedDB database limit!<br/>
						Your browser may start deleting old databases soon.`,b(e,"class","system3-warning-text system3-critical svelte-1n3w4sk")},m(t,r){T(t,e,r)},d(t){t&&C(e)}}}function xw(o){let e,t,r,n;e=new Je({props:{name:"Large Stores (>1MB)"}});let s=Fe(o[2]),a=[];for(let l=0;l<s.length;l+=1)a[l]=bw(hw(o,s,l));let i=l=>D(a[l],1,1,()=>{a[l]=null});return{c(){V(e.$$.fragment),t=B();for(let l=0;l<a.length;l+=1)a[l].c();r=Le()},m(l,f){N(e,l,f),T(l,t,f);for(let u=0;u<a.length;u+=1)a[u]&&a[u].m(l,f);T(l,r,f),n=!0},p(l,f){if(f&2052){s=Fe(l[2]);let u;for(u=0;u<s.length;u+=1){let d=hw(l,s,u);a[u]?(a[u].p(d,f),L(a[u],1)):(a[u]=bw(d),a[u].c(),L(a[u],1),a[u].m(r.parentNode,r))}for(be(),u=s.length;u<a.length;u+=1)i(u);we()}},i(l){if(!n){L(e.$$.fragment,l);for(let f=0;f<s.length;f+=1)L(a[f]);n=!0}},o(l){D(e.$$.fragment,l),a=a.filter(Boolean);for(let f=0;f<a.length;f+=1)D(a[f]);n=!1},d(l){l&&(C(t),C(r)),H(e,l),it(a,l)}}}function oM(o){let e,t,r,n,s;function a(){return o[17](o[22])}return{c(){e=P("div"),t=P("button"),t.textContent="Delete",r=B(),b(t,"class","mod-warning"),b(t,"title","Delete all data in this store"),b(e,"class","system3-actions svelte-1n3w4sk")},m(i,l){T(i,e,l),k(e,t),T(i,r,l),n||(s=re(t,"click",a),n=!0)},p(i,l){o=i},d(i){i&&(C(e),C(r)),n=!1,s()}}}function yw(o){let e,t;return e=new He({props:{name:o[22].path||o[22].slug,description:"Size: "+o[22].estimatedSizeMB+"MB, Items: "+o[22].count,$$slots:{default:[oM]},$$scope:{ctx:o}}}),{c(){V(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},p(r,n){let s={};n&4&&(s.name=r[22].path||r[22].slug),n&4&&(s.description="Size: "+r[22].estimatedSizeMB+"MB, Items: "+r[22].count),n&33554436&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function bw(o){let e,t,r,n;e=new Je({props:{name:o[18]==="local"?"Tracked Documents":`Relay: ${o[18]}`}});let s=Fe(o[19]),a=[];for(let l=0;l<s.length;l+=1)a[l]=yw(gw(o,s,l));let i=l=>D(a[l],1,1,()=>{a[l]=null});return{c(){V(e.$$.fragment),t=B();for(let l=0;l<a.length;l+=1)a[l].c();r=Le()},m(l,f){N(e,l,f),T(l,t,f);for(let u=0;u<a.length;u+=1)a[u]&&a[u].m(l,f);T(l,r,f),n=!0},p(l,f){let u={};if(f&4&&(u.name=l[18]==="local"?"Tracked Documents":`Relay: ${l[18]}`),e.$set(u),f&2052){s=Fe(l[19]);let d;for(d=0;d<s.length;d+=1){let m=gw(l,s,d);a[d]?(a[d].p(m,f),L(a[d],1)):(a[d]=yw(m),a[d].c(),L(a[d],1),a[d].m(r.parentNode,r))}for(be(),d=s.length;d<a.length;d+=1)i(d);we()}},i(l){if(!n){L(e.$$.fragment,l);for(let f=0;f<s.length;f+=1)L(a[f]);n=!0}},o(l){D(e.$$.fragment,l),a=a.filter(Boolean);for(let f=0;f<a.length;f+=1)D(a[f]);n=!1},d(l){l&&(C(t),C(r)),H(e,l),it(a,l)}}}function nM(o){let e,t,r,n,s,a,i,l,f,u,d,m,x,h,_,w,v,A=[eM,ZA,QA],U=[];function I(F,$){return F[3]?0:F[5]?1:F[0]?2:-1}return~(x=I(o,-1))&&(h=U[x]=A[x](o)),{c(){e=P("div"),e.textContent="Relay database analysis",t=B(),r=P("div"),n=P("div"),s=P("div"),s.innerHTML=`<div class="setting-item-name">Search across vaults</div> <div class="setting-item-description"><div class="mod-warning">Warning: This is a dangerous setting. It allows you to delete relay
					databases from other vaults.</div></div>`,a=B(),i=P("div"),l=P("div"),f=P("input"),u=B(),d=P("div"),m=B(),h&&h.c(),b(e,"class","modal-title"),b(s,"class","setting-item-info"),b(f,"type","checkbox"),b(f,"tabindex","-1"),f.checked=o[1],b(d,"class","checkbox-toggle"),b(l,"role","checkbox"),b(l,"aria-checked",o[1]),b(l,"tabindex","0"),b(l,"class","checkbox-container system3-dangerous svelte-1n3w4sk"),ze(l,"is-enabled",o[1]),b(i,"class","setting-item-control"),b(n,"class","setting-item"),b(r,"class","system3-indexeddb-analysis svelte-1n3w4sk")},m(F,$){T(F,e,$),T(F,t,$),T(F,r,$),k(r,n),k(n,s),k(n,a),k(n,i),k(i,l),k(l,f),k(l,u),k(l,d),k(r,m),~x&&U[x].m(r,null),_=!0,w||(v=[re(l,"keypress",o[15]),re(l,"click",o[16])],w=!0)},p(F,[$]){(!_||$&2)&&(f.checked=F[1]),(!_||$&2)&&b(l,"aria-checked",F[1]),(!_||$&2)&&ze(l,"is-enabled",F[1]);let E=x;x=I(F,$),x===E?~x&&U[x].p(F,$):(h&&(be(),D(U[E],1,1,()=>{U[E]=null}),we()),~x?(h=U[x],h?h.p(F,$):(h=U[x]=A[x](F),h.c()),L(h,1),h.m(r,null)):h=null)},i(F){_||(L(h),_=!0)},o(F){D(h),_=!1},d(F){F&&(C(e),C(t),C(r)),~x&&U[x].d(),w=!1,ke(v)}}}function sM(o,e,t){let r,n,s,a,i,l;var f;let{plugin:u}=e,d=_e(!0);me(o,d,F=>t(3,a=F));let m=_e(0);me(o,m,F=>t(4,i=F));let x=_e(null);me(o,x,F=>t(0,s=F));let h=_e(null);me(o,h,F=>t(5,l=F));let _=!1;function w(){return Ge(this,void 0,void 0,function*(){d.set(!0),h.set(null);try{let F=yield pw({appId:u.appId,filterByAppId:!_,onProgress:$=>m.set($)});x.set(F)}catch(F){h.set(`Analysis failed: ${F.message}`)}finally{d.set(!1)}})}function v(F){return Ge(this,void 0,void 0,function*(){try{yield mw(F),s&&kx(x,s.largeStores=s.largeStores.filter($=>$.slug!==F),s)}catch($){h.set(`Failed to delete ${F}: ${$.message}`)}})}er(()=>{w()});let A=()=>{t(1,_=!_),w()},U=()=>{t(1,_=!_),w()},I=F=>v(F.slug);return o.$$set=F=>{"plugin"in F&&t(12,u=F.plugin)},o.$$.update=()=>{if(o.$$.dirty&8193){e:t(14,r=t(13,f=s==null?void 0:s.largeStores.reduce((F,$)=>{let E=$.relay||"local";return F[E]||(F[E]=[]),F[E].push($),F},{}))!==null&&f!==void 0?f:{})}if(o.$$.dirty&16384){e:t(2,n=Object.entries(r).sort(([F],[$])=>F==="local"?-1:$==="local"?1:F.localeCompare($)))}},[s,_,n,a,i,l,d,m,x,h,w,v,u,f,r,A,U,I]}var nm=class extends Z{constructor(e){super(),ee(this,e,sM,nM,Q,{plugin:12},XA)}},ww=nm;var Cc=class extends _w.Modal{constructor(t,r){super(t);this.plugin=r}onOpen(){let{contentEl:t}=this;this.component=new ww({target:t,props:{plugin:this.plugin}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var Yw=require("obsidian");var{Boolean:Ew}=On;function aM(o){Pe(o,"svelte-18bqwhy",".file-name.svelte-18bqwhy{display:flex;align-items:center;gap:6px;font-size:0.9rem;flex:1;min-width:0}.details-container.svelte-18bqwhy{margin-left:auto;text-align:right;padding-left:8px;padding-right:8px}.details.svelte-18bqwhy{font-size:0.75rem;color:var(--text-muted)}.error-message.svelte-18bqwhy{color:var(--text-error);margin-top:2px;text-align:right}.more-files.svelte-18bqwhy{font-size:0.8rem;color:var(--text-muted);text-align:center}button.mod-warning.svelte-18bqwhy{display:flex;align-items:center;gap:4px;background-color:var(--background-modifier-error);color:var(--text-error)}.mod-primary{color:var(--interactive-accent)}.mod-success{color:var(--interactive-success)}.mod-warning{color:var(--text-warning)}.show-more-link.svelte-18bqwhy{color:var(--text-accent);cursor:pointer;font-size:0.8rem}.show-more-link.svelte-18bqwhy:hover{text-decoration:underline}")}function vw(o,e,t){let r=o.slice();return r[20]=e[t],r}function Sw(o,e,t){let r=o.slice();return r[23]=e[t],r}function iM(o){return{c:X,m:X,p:X,i:X,o:X,d:X}}function lM(o){let e,t,r=Fe(Mw(o[19].documents)),n=[];for(let a=0;a<r.length;a+=1)n[a]=Pw(vw(o,r,a));let s=a=>D(n[a],1,1,()=>{n[a]=null});return{c(){for(let a=0;a<n.length;a+=1)n[a].c();e=Le()},m(a,i){for(let l=0;l<n.length;l+=1)n[l]&&n[l].m(a,i);T(a,e,i),t=!0},p(a,i){if(i&8311){r=Fe(Mw(a[19].documents));let l;for(l=0;l<r.length;l+=1){let f=vw(a,r,l);n[l]?(n[l].p(f,i),L(n[l],1)):(n[l]=Pw(f),n[l].c(),L(n[l],1),n[l].m(e.parentNode,e))}for(be(),l=r.length;l<n.length;l+=1)s(l);we()}},i(a){if(!t){for(let i=0;i<r.length;i+=1)L(n[i]);t=!0}},o(a){n=n.filter(Ew);for(let i=0;i<n.length;i+=1)D(n[i]);t=!1},d(a){a&&C(e),it(n,a)}}}function kw(o){let e,t=Aw(o[23].queueState.timestamp)+"",r;return{c(){e=K("\u2022 "),r=K(t)},m(n,s){T(n,e,s),T(n,r,s)},p(n,s){s&3&&t!==(t=Aw(n[23].queueState.timestamp)+"")&&se(r,t)},d(n){n&&(C(e),C(r))}}}function Iw(o){let e,t=o[23].queueState.error+"",r;return{c(){e=P("div"),r=K(t),b(e,"class","error-message svelte-18bqwhy")},m(n,s){T(n,e,s),k(e,r)},p(n,s){s&3&&t!==(t=n[23].queueState.error+"")&&se(r,t)},d(n){n&&C(e)}}}function Lw(o){let e,t,r,n,s,a;t=new ad({props:{size:14,class:"svg-icon lucide-refresh-cw"}});function i(){return o[10](o[23])}return{c(){e=P("button"),V(t.$$.fragment),r=K(`
							Retry`),b(e,"class","mod-warning svelte-18bqwhy")},m(l,f){T(l,e,f),N(t,e,null),k(e,r),n=!0,s||(a=re(e,"click",i),s=!0)},p(l,f){o=l},i(l){n||(L(t.$$.fragment,l),n=!0)},o(l){D(t.$$.fragment,l),n=!1},d(l){l&&C(e),H(t),s=!1,a()}}}function cM(o){var x,h,_;let e,t,r=o[5](o[23]).text+"",n,s,a,i,l,f,u=((x=o[23].queueState)==null?void 0:x.timestamp)&&kw(o),d=((h=o[23].queueState)==null?void 0:h.error)&&Iw(o),m=((_=o[23].queueState)==null?void 0:_.status)==="failed"&&Lw(o);return{c(){e=P("div"),t=P("span"),n=K(r),s=B(),u&&u.c(),a=B(),d&&d.c(),i=B(),m&&m.c(),l=Le(),b(t,"class","details svelte-18bqwhy"),b(e,"class","details-container svelte-18bqwhy")},m(w,v){T(w,e,v),k(e,t),k(t,n),k(t,s),u&&u.m(t,null),k(t,a),d&&d.m(t,null),T(w,i,v),m&&m.m(w,v),T(w,l,v),f=!0},p(w,v){var A,U,I;(!f||v&3)&&r!==(r=w[5](w[23]).text+"")&&se(n,r),(A=w[23].queueState)!=null&&A.timestamp?u?u.p(w,v):(u=kw(w),u.c(),u.m(t,a)):u&&(u.d(1),u=null),(U=w[23].queueState)!=null&&U.error?d?d.p(w,v):(d=Iw(w),d.c(),d.m(t,null)):d&&(d.d(1),d=null),((I=w[23].queueState)==null?void 0:I.status)==="failed"?m?(m.p(w,v),v&3&&L(m,1)):(m=Lw(w),m.c(),L(m,1),m.m(l.parentNode,l)):m&&(be(),D(m,1,1,()=>{m=null}),we())},i(w){f||(L(m),f=!0)},o(w){D(m),f=!1},d(w){w&&(C(e),C(i),C(l)),u&&u.d(),d&&d.d(),m&&m.d(w)}}}function fM(o){let e,t=o[9].default,r=he(t,o,o[13],null),n=r||cM(o);return{c(){n&&n.c()},m(s,a){n&&n.m(s,a),e=!0},p(s,a){r?r.p&&(!e||a&8192)&&xe(r,t,s,s[13],e?ge(t,s[13],a,null):ye(s[13]),null):n&&n.p&&(!e||a&3)&&n.p(s,e?a:-1)},i(s){e||(L(n,s),e=!0)},o(s){D(n,s),e=!1},d(s){n&&n.d(s)}}}function uM(o){let e,t,r,n,s=o[23].path.split("/").pop()+"",a,i;var l=o[5](o[23]).icon;function f(u,d){return{props:{size:16,class:"svg-icon "+u[5](u[23]).iconClass}}}return l&&(t=Os(l,f(o))),{c(){e=P("span"),t&&V(t.$$.fragment),r=B(),n=P("span"),a=K(s),b(e,"slot","name"),b(e,"class","file-name svelte-18bqwhy")},m(u,d){T(u,e,d),t&&N(t,e,null),k(e,r),k(e,n),k(n,a),i=!0},p(u,d){if(d&3&&l!==(l=u[5](u[23]).icon)){if(t){be();let m=t;D(m.$$.fragment,1,0,()=>{H(m,1)}),we()}l?(t=Os(l,f(u,d)),V(t.$$.fragment),L(t.$$.fragment,1),N(t,e,r)):t=null}else if(l){let m={};d&3&&(m.class="svg-icon "+u[5](u[23]).iconClass),t.$set(m)}(!i||d&3)&&s!==(s=u[23].path.split("/").pop()+"")&&se(a,s)},i(u){i||(t&&L(t.$$.fragment,u),i=!0)},o(u){t&&D(t.$$.fragment,u),i=!1},d(u){u&&C(e),t&&H(t)}}}function Cw(o){let e,t;return e=new fr({props:{$$slots:{name:[uM],default:[fM]},$$scope:{ctx:o}}}),{c(){V(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},p(r,n){let s={};n&8195&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function Tw(o){let e,t;return e=new fr({props:{$$slots:{name:[dM]},$$scope:{ctx:o}}}),{c(){V(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},p(r,n){let s={};n&8195&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function dM(o){let e,t,r=Dw(o[1](o[20]).remainingCount)+"",n,s,a=o[20].title.toLowerCase()+"",i,l,f,u,d,m,x,h;function _(){return o[11](o[20])}function w(...v){return o[12](o[20],...v)}return{c(){var v;e=P("span"),t=K("...and "),n=K(r),s=K(` more
					`),i=K(a),l=B(),f=P("span"),u=K("(show more)"),m=B(),b(f,"class","show-more-link svelte-18bqwhy"),b(f,"role","button"),b(f,"tabindex","0"),b(f,"aria-label",d=`Show ${((v=o[2][o[20].title])==null?void 0:v.incrementCount)||o[2].default.incrementCount} more ${o[20].title.toLowerCase()}`),b(e,"slot","name"),b(e,"class","more-files svelte-18bqwhy")},m(v,A){T(v,e,A),k(e,t),k(e,n),k(e,s),k(e,i),k(e,l),k(e,f),k(f,u),k(e,m),x||(h=[re(f,"click",_),re(f,"keydown",w)],x=!0)},p(v,A){var U;o=v,A&3&&r!==(r=Dw(o[1](o[20]).remainingCount)+"")&&se(n,r),A&1&&a!==(a=o[20].title.toLowerCase()+"")&&se(i,a),A&1&&d!==(d=`Show ${((U=o[2][o[20].title])==null?void 0:U.incrementCount)||o[2].default.incrementCount} more ${o[20].title.toLowerCase()}`)&&b(f,"aria-label",d)},d(v){v&&C(e),x=!1,ke(h)}}}function Pw(o){let e,t,r,n=o[1](o[20]).remainingCount>0,s,a;e=new Je({props:{name:o[20].title}});let i=Fe(o[1](o[20]).visibleDocs),l=[];for(let d=0;d<i.length;d+=1)l[d]=Cw(Sw(o,i,d));let f=d=>D(l[d],1,1,()=>{l[d]=null}),u=n&&Tw(o);return{c(){V(e.$$.fragment),t=B();for(let d=0;d<l.length;d+=1)l[d].c();r=B(),u&&u.c(),s=Le()},m(d,m){N(e,d,m),T(d,t,m);for(let x=0;x<l.length;x+=1)l[x]&&l[x].m(d,m);T(d,r,m),u&&u.m(d,m),T(d,s,m),a=!0},p(d,m){let x={};if(m&1&&(x.name=d[20].title),e.$set(x),m&8291){i=Fe(d[1](d[20]).visibleDocs);let h;for(h=0;h<i.length;h+=1){let _=Sw(d,i,h);l[h]?(l[h].p(_,m),L(l[h],1)):(l[h]=Cw(_),l[h].c(),L(l[h],1),l[h].m(r.parentNode,r))}for(be(),h=i.length;h<l.length;h+=1)f(h);we()}m&3&&(n=d[1](d[20]).remainingCount>0),n?u?(u.p(d,m),m&3&&L(u,1)):(u=Tw(d),u.c(),L(u,1),u.m(s.parentNode,s)):u&&(be(),D(u,1,1,()=>{u=null}),we())},i(d){if(!a){L(e.$$.fragment,d);for(let m=0;m<i.length;m+=1)L(l[m]);L(u),a=!0}},o(d){D(e.$$.fragment,d),l=l.filter(Ew);for(let m=0;m<l.length;m+=1)D(l[m]);D(u),a=!1},d(d){d&&(C(t),C(r),C(s)),H(e,d),it(l,d),u&&u.d(d)}}}function pM(o){let e;return{c(){e=P("div"),e.textContent="Loading...",b(e,"class","loading")},m(t,r){T(t,e,r)},p:X,i:X,o:X,d(t){t&&C(e)}}}function mM(o){let e,t,r,n={ctx:o,current:null,token:null,hasCatch:!1,pending:pM,then:lM,catch:iM,value:19,blocks:[,,,]};return Bs(t=o[0],n),{c(){e=Le(),n.block.c()},m(s,a){T(s,e,a),n.block.m(s,n.anchor=a),n.mount=()=>e.parentNode,n.anchor=e,r=!0},p(s,[a]){o=s,n.ctx=o,a&1&&t!==(t=o[0])&&Bs(t,n)||Pl(n,o,a)},i(s){r||(L(n.block),r=!0)},o(s){for(let a=0;a<3;a+=1){let i=n.blocks[a];D(i)}r=!1},d(s){s&&C(e),n.block.d(s),n.token=null,n=null}}}function Dw(o){return new Intl.NumberFormat().format(o)}function Aw(o){let e=new Date(o),r=new Date().getTime()-e.getTime(),n=Math.floor(r/(1e3*60));if(n<1)return"just now";if(n===1)return"1 minute ago";if(n<60)return`${n} minutes ago`;let s=Math.floor(n/60);if(s===1)return"1 hour ago";if(s<24)return`${s} hours ago`;let a=Math.floor(s/24);return a===1?"yesterday":`${a} days ago`}function Mw(o){let e=o.filter(s=>{var a;return((a=s.queueState)===null||a===void 0?void 0:a.status)==="running"}),t=o.filter(s=>{var a;return((a=s.queueState)===null||a===void 0?void 0:a.status)==="failed"}),r=o.filter(s=>{var a;return((a=s.queueState)===null||a===void 0?void 0:a.status)==="pending"}),n=o.filter(s=>{var a;return((a=s.queueState)===null||a===void 0?void 0:a.status)==="completed"});return[e.length>0&&{title:"Active Files",documents:e},t.length>0&&{title:"Stuck Files",documents:t},r.length>0&&{title:"Queued Files",documents:r},n.length>0&&{title:"Completed Files",documents:n}].filter(Boolean)}function hM(o,e,t){let r,n,s,a,i,{$$slots:l={},$$scope:f}=e,{folder:u}=e,{backgroundSync:d}=e,m={"Active Files":{initialCount:1/0,incrementCount:100},"Stuck Files":{initialCount:1/0,incrementCount:100},"Queued Files":{initialCount:10,incrementCount:100},"Completed Files":{initialCount:5,incrementCount:100},default:{initialCount:1/0,incrementCount:100}},x=_e({}),h=fo(x,$=>E=>{let M=m[E.title]||m.default,R=$[E.title]||M.initialCount,q=E.documents.slice(0,R),J=E.documents.length-R;return{visibleCount:R,visibleDocs:q,remainingCount:J}});me(o,h,$=>t(1,i=$));function _($){let E=m[$]||m.default;x.update(M=>Object.assign(Object.assign({},M),{[$]:(M[$]||E.initialCount)+E.incrementCount}))}function w($){return Ge(this,void 0,void 0,function*(){var E;let M=[],R=Array.from($.docs.values());for(let q of R){let J=yield q.getOrigin(),G=yield q.getServerSynced(),z={guid:q.guid,path:$.getPath(q.path),doc:q,origin:J||"unknown",serverSynced:G},W=Array.from(r).find(De=>De.guid===q.guid),oe=Array.from(n).find(De=>De.guid===q.guid),Ie=s.find(De=>De.guid===q.guid);if(W||oe||Ie){let De=W||oe||Ie;z.queueState={status:De.status,type:"type"in De?De.type:"sync",error:"error"in De?De.error:void 0,timestamp:"timestamp"in De?De.timestamp:Date.now()}}else J==="local"&&!G?z.queueState={status:"pending",type:"sync",timestamp:Date.now()}:G?z.queueState={status:"completed",type:"sync",timestamp:Date.now()}:z.queueState={status:"pending",type:"sync",timestamp:Date.now()};M.push(z)}return{folder:$,documents:M,progress:((E=d.getGroupProgress($))===null||E===void 0?void 0:E.percent)||0}})}function v($){let{origin:E,serverSynced:M,queueState:R}=$,q=(R==null?void 0:R.status)||"completed",J=(R==null?void 0:R.type)||"sync";return E==="remote"&&!M&&q==="running"&&J==="download"?{text:"Downloading",description:"Initial acquisition",icon:Gu,iconClass:"mod-primary"}:E==="remote"&&!M&&q==="pending"&&J==="download"?{text:"Queued for Download",description:"Waiting to download",icon:za,iconClass:""}:E==="remote"&&!M&&q==="failed"&&J==="download"?{text:"Download stuck",description:"Needs retry",icon:Ka,iconClass:"mod-warning"}:E==="local"&&!M&&q==="running"&&J==="sync"?{text:"Uploading",description:"First-time upload",icon:dd,iconClass:"mod-primary"}:E==="local"&&!M&&q==="pending"&&J==="sync"?{text:"Queued for Upload",description:"Waiting to upload",icon:za,iconClass:""}:E==="local"&&!M&&q==="failed"&&J==="sync"?{text:"Upload stuck",description:"Needs retry",icon:Ka,iconClass:"mod-warning"}:M&&q==="running"&&J==="sync"?{text:"Syncing",description:"Collaborative update",icon:Uu,iconClass:"mod-primary"}:M&&q==="pending"&&J==="sync"?{text:"Queued for Sync",description:"Waiting to sync",icon:za,iconClass:""}:M&&q==="failed"&&J==="sync"?{text:"Sync stuck",description:"Needs retry",icon:Ka,iconClass:"mod-warning"}:M&&q==="completed"?{text:"Complete",description:"Fully synchronized",icon:qu,iconClass:"mod-success"}:{text:"Unknown",description:"Status unknown",icon:Xu,iconClass:""}}function A($){return Ge(this,void 0,void 0,function*(){var E,M;let R={id:$.guid,guid:$.guid,path:$.path,timestamp:((E=$.queueState)===null||E===void 0?void 0:E.timestamp)||Date.now(),type:((M=$.queueState)===null||M===void 0?void 0:M.type)||"sync",status:"failed",sharedFolderGuid:$.doc.sharedFolder.guid};yield d.retryLogItem(R)})}let U=$=>A($),I=$=>{_($.title)},F=($,E)=>E.key==="Enter"&&_($.title);return o.$$set=$=>{"folder"in $&&t(7,u=$.folder),"backgroundSync"in $&&t(8,d=$.backgroundSync),"$$scope"in $&&t(13,f=$.$$scope)},o.$$.update=()=>{if(o.$$.dirty&256){e:r=new Set(d.activeSync.items())}if(o.$$.dirty&256){e:n=new Set(d.activeDownloads.items())}if(o.$$.dirty&256){e:s=d.getSyncLog()}if(o.$$.dirty&128){e:t(0,a=w(u))}},[a,i,m,h,_,v,A,u,d,l,U,I,F,f]}var sm=class extends Z{constructor(e){super(),ee(this,e,hM,mM,Q,{folder:7,backgroundSync:8},aM)}},am=sm;var{Map:gM}=On;function xM(o){Pe(o,"svelte-ztgdsf",".folder-header.svelte-ztgdsf{display:flex;align-items:center;cursor:pointer;background:none;border:none;padding:0;width:100%;text-align:left;color:inherit;font:inherit}.arrow.svelte-ztgdsf{margin-right:8px;font-size:0.8em;transition:transform 0.15s ease}.arrow.is-expanded.svelte-ztgdsf{transform:rotate(90deg)}.sync-stats.svelte-ztgdsf{margin-left:8px;display:flex;gap:4px}.tag.svelte-ztgdsf{font-size:0.7em;padding:2px 6px;border-radius:4px;background-color:var(--background-modifier-border);color:var(--text-muted)}.tag.mod-success.svelte-ztgdsf{background-color:var(--interactive-success);color:var(--text-on-accent)}.tag.mod-warning.svelte-ztgdsf{background-color:var(--text-warning);color:var(--text-on-accent)}.progress-container.svelte-ztgdsf{display:flex;align-items:center;margin-top:4px;width:100%}.progress-bar.svelte-ztgdsf{flex:1;height:6px;background-color:var(--background-modifier-border);border-radius:3px;overflow:hidden;margin-right:8px}.progress-value.svelte-ztgdsf{height:100%;background-color:var(--interactive-accent);border-radius:3px}.progress-text.svelte-ztgdsf{font-size:0.75rem;color:var(--text-muted)}")}function Fw(o,e,t){let r=o.slice();r[25]=e[t];let n=r[4].get(r[25].guid);return r[26]=n,r}function Rw(o){let e,t;return e=new Je({props:{name:"Sync Status"}}),{c(){V(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function Ow(o){let e,t;return e=new He({props:{name:o[11]?"Sync in Progress":o[10]?"Queued Files":"Sync Complete",description:`${o[2]} active \u2022 ${o[7]} stuck \u2022 ${o[3]} queued \u2022 ${o[8]} complete`,$$slots:{default:[wM]},$$scope:{ctx:o}}}),{c(){V(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},p(r,n){let s={};n&3072&&(s.name=r[11]?"Sync in Progress":r[10]?"Queued Files":"Sync Complete"),n&396&&(s.description=`${r[2]} active \u2022 ${r[7]} stuck \u2022 ${r[3]} queued \u2022 ${r[8]} complete`),n&536874496&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function Uw(o){let e,t,r,n,s,a,i=[bM,yM],l=[];function f(u,d){return u[9]?0:1}return t=f(o,-1),r=l[t]=i[t](o),{c(){e=P("button"),r.c(),b(e,"class","mod-cta")},m(u,d){T(u,e,d),l[t].m(e,null),n=!0,s||(a=re(e,"click",o[16]),s=!0)},p(u,d){let m=t;t=f(u,d),t!==m&&(be(),D(l[m],1,1,()=>{l[m]=null}),we(),r=l[t],r||(r=l[t]=i[t](u),r.c()),L(r,1),r.m(e,null))},i(u){n||(L(r),n=!0)},o(u){D(r),n=!1},d(u){u&&C(e),l[t].d(),s=!1,a()}}}function yM(o){let e,t,r;return e=new rd({props:{size:16,class:"svg-icon lucide-pause",style:"margin-right: 8px;"}}),{c(){V(e.$$.fragment),t=K(`
						Pause`)},m(n,s){N(e,n,s),T(n,t,s),r=!0},i(n){r||(L(e.$$.fragment,n),r=!0)},o(n){D(e.$$.fragment,n),r=!1},d(n){n&&C(t),H(e,n)}}}function bM(o){let e,t,r;return e=new nd({props:{size:16,class:"svg-icon lucide-play",style:"margin-right: 8px;"}}),{c(){V(e.$$.fragment),t=K(`
						Resume`)},m(n,s){N(e,n,s),T(n,t,s),r=!0},i(n){r||(L(e.$$.fragment,n),r=!0)},o(n){D(e.$$.fragment,n),r=!1},d(n){n&&C(t),H(e,n)}}}function wM(o){let e,t,r=(o[11]||o[10])&&Uw(o);return{c(){r&&r.c(),e=Le()},m(n,s){r&&r.m(n,s),T(n,e,s),t=!0},p(n,s){n[11]||n[10]?r?(r.p(n,s),s&3072&&L(r,1)):(r=Uw(n),r.c(),L(r,1),r.m(e.parentNode,e)):r&&(be(),D(r,1,1,()=>{r=null}),we())},i(n){t||(L(r),t=!0)},o(n){D(r),t=!1},d(n){n&&C(e),r&&r.d(n)}}}function _M(o){let e=[],t=new gM,r,n,s=Fe(o[6]),a=i=>i[25].guid;for(let i=0;i<s.length;i+=1){let l=Fw(o,s,i),f=a(l);t.set(f,e[i]=qw(f,l))}return{c(){for(let i=0;i<e.length;i+=1)e[i].c();r=Le()},m(i,l){for(let f=0;f<e.length;f+=1)e[f]&&e[f].m(i,l);T(i,r,l),n=!0},p(i,l){l&32851&&(s=Fe(i[6]),be(),e=Ux(e,l,a,1,i,s,t,r.parentNode,Ox,qw,r,Fw),we())},i(i){if(!n){for(let l=0;l<s.length;l+=1)L(e[l]);n=!0}},o(i){for(let l=0;l<e.length;l+=1)D(e[l]);n=!1},d(i){i&&C(r);for(let l=0;l<e.length;l+=1)e[l].d(i)}}}function vM(o){let e,t,r,n;return e=new Je({props:{$$slots:{name:[TM],default:[LM]},$$scope:{ctx:o}}}),r=new am({props:{folder:o[5],backgroundSync:o[0]}}),{c(){V(e.$$.fragment),t=B(),V(r.$$.fragment)},m(s,a){N(e,s,a),T(s,t,a),N(r,s,a),n=!0},p(s,a){let i={};a&536875040&&(i.$$scope={dirty:a,ctx:s}),e.$set(i);let l={};a&32&&(l.folder=s[5]),a&1&&(l.backgroundSync=s[0]),r.$set(l)},i(s){n||(L(e.$$.fragment,s),L(r.$$.fragment,s),n=!0)},o(s){D(e.$$.fragment,s),D(r.$$.fragment,s),n=!1},d(s){s&&C(t),H(e,s),H(r,s)}}}function $w(o){let e,t,r,n,s,a=o[26].progress+"",i,l;return{c(){e=P("div"),t=P("div"),r=P("div"),n=B(),s=P("span"),i=K(a),l=K("%"),b(r,"class","progress-value svelte-ztgdsf"),ue(r,"width",o[26].progress+"%"),b(t,"class","progress-bar svelte-ztgdsf"),b(s,"class","progress-text svelte-ztgdsf"),b(e,"class","progress-container svelte-ztgdsf")},m(f,u){T(f,e,u),k(e,t),k(t,r),k(e,n),k(e,s),k(s,i),k(s,l)},p(f,u){u&80&&ue(r,"width",f[26].progress+"%"),u&80&&a!==(a=f[26].progress+"")&&se(i,a)},d(f){f&&C(e)}}}function SM(o){let e,t=o[26]&&(o[26].running>0||o[26].failed>0)&&$w(o);return{c(){t&&t.c(),e=Le()},m(r,n){t&&t.m(r,n),T(r,e,n)},p(r,n){r[26]&&(r[26].running>0||r[26].failed>0)?t?t.p(r,n):(t=$w(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&C(e),t&&t.d(r)}}}function Bw(o){let e,t=o[26].running+"",r,n;return{c(){e=P("span"),r=K(t),n=K(" active"),b(e,"class","tag mod-success svelte-ztgdsf")},m(s,a){T(s,e,a),k(e,r),k(e,n)},p(s,a){a&80&&t!==(t=s[26].running+"")&&se(r,t)},d(s){s&&C(e)}}}function Nw(o){let e,t=o[26].failed+"",r,n;return{c(){e=P("span"),r=K(t),n=K(" stuck"),b(e,"class","tag mod-warning svelte-ztgdsf")},m(s,a){T(s,e,a),k(e,r),k(e,n)},p(s,a){a&80&&t!==(t=s[26].failed+"")&&se(r,t)},d(s){s&&C(e)}}}function Hw(o){let e,t=o[26].pending+"",r,n;return{c(){e=P("span"),r=K(t),n=K(" queued"),b(e,"class","tag svelte-ztgdsf")},m(s,a){T(s,e,a),k(e,r),k(e,n)},p(s,a){a&80&&t!==(t=s[26].pending+"")&&se(r,t)},d(s){s&&C(e)}}}function kM(o){var I,F,$;let e,t,r,n,s,a=o[25].name+"",i,l,f,u,d,m,x,h,_=((I=o[26])==null?void 0:I.running)>0&&Bw(o),w=((F=o[26])==null?void 0:F.failed)>0&&Nw(o),v=(($=o[26])==null?void 0:$.pending)>0&&Hw(o);function A(){return o[22](o[25])}function U(...E){return o[23](o[25],...E)}return{c(){e=P("div"),t=P("span"),r=K("\u25B6"),s=B(),i=K(a),l=B(),f=P("span"),_&&_.c(),u=B(),w&&w.c(),d=B(),v&&v.c(),b(t,"class",n="arrow "+(o[1][o[25].guid]?"is-expanded":"")+" svelte-ztgdsf"),b(f,"class","sync-stats svelte-ztgdsf"),b(e,"class","folder-header svelte-ztgdsf"),b(e,"role","button"),b(e,"tabindex","0"),b(e,"aria-expanded",m=!!o[1][o[25].guid])},m(E,M){T(E,e,M),k(e,t),k(t,r),k(e,s),k(e,i),k(e,l),k(e,f),_&&_.m(f,null),k(f,u),w&&w.m(f,null),k(f,d),v&&v.m(f,null),x||(h=[re(e,"click",A),re(e,"keydown",U)],x=!0)},p(E,M){var R,q,J;o=E,M&66&&n!==(n="arrow "+(o[1][o[25].guid]?"is-expanded":"")+" svelte-ztgdsf")&&b(t,"class",n),M&64&&a!==(a=o[25].name+"")&&se(i,a),((R=o[26])==null?void 0:R.running)>0?_?_.p(o,M):(_=Bw(o),_.c(),_.m(f,u)):_&&(_.d(1),_=null),((q=o[26])==null?void 0:q.failed)>0?w?w.p(o,M):(w=Nw(o),w.c(),w.m(f,d)):w&&(w.d(1),w=null),((J=o[26])==null?void 0:J.pending)>0?v?v.p(o,M):(v=Hw(o),v.c(),v.m(f,null)):v&&(v.d(1),v=null),M&66&&m!==(m=!!o[1][o[25].guid])&&b(e,"aria-expanded",m)},d(E){E&&C(e),_&&_.d(),w&&w.d(),v&&v.d(),x=!1,ke(h)}}}function IM(o){let e,t;return e=new uo({props:{folder:o[25],$$slots:{default:[kM]},$$scope:{ctx:o}}}),{c(){V(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},p(r,n){let s={};n&64&&(s.folder=r[25]),n&536870994&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function Vw(o){let e,t;return e=new am({props:{folder:o[25],backgroundSync:o[0]}}),{c(){V(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},p(r,n){let s={};n&64&&(s.folder=r[25]),n&1&&(s.backgroundSync=r[0]),e.$set(s)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function qw(o,e){let t,r,n,s,a;r=new Je({props:{$$slots:{name:[IM],default:[SM]},$$scope:{ctx:e}}});let i=e[1][e[25].guid]&&Vw(e);return{key:o,first:null,c(){t=Le(),V(r.$$.fragment),n=B(),i&&i.c(),s=Le(),this.first=t},m(l,f){T(l,t,f),N(r,l,f),T(l,n,f),i&&i.m(l,f),T(l,s,f),a=!0},p(l,f){e=l;let u={};f&536870994&&(u.$$scope={dirty:f,ctx:e}),r.$set(u),e[1][e[25].guid]?i?(i.p(e,f),f&66&&L(i,1)):(i=Vw(e),i.c(),L(i,1),i.m(s.parentNode,s)):i&&(be(),D(i,1,1,()=>{i=null}),we())},i(l){a||(L(r.$$.fragment,l),L(i),a=!0)},o(l){D(r.$$.fragment,l),D(i),a=!1},d(l){l&&(C(t),C(n),C(s)),H(r,l),i&&i.d(l)}}}function Ww(o){let e,t,r,n,s,a=o[12].progress+"",i,l;return{c(){e=P("div"),t=P("div"),r=P("div"),n=B(),s=P("span"),i=K(a),l=K("%"),b(r,"class","progress-value svelte-ztgdsf"),ue(r,"width",o[12].progress+"%"),b(t,"class","progress-bar svelte-ztgdsf"),b(s,"class","progress-text svelte-ztgdsf"),b(e,"class","progress-container svelte-ztgdsf")},m(f,u){T(f,e,u),k(e,t),k(t,r),k(e,n),k(e,s),k(s,i),k(s,l)},p(f,u){u&4096&&ue(r,"width",f[12].progress+"%"),u&4096&&a!==(a=f[12].progress+"")&&se(i,a)},d(f){f&&C(e)}}}function LM(o){let e,t=(o[12].running>0||o[12].failed>0)&&Ww(o);return{c(){t&&t.c(),e=Le()},m(r,n){t&&t.m(r,n),T(r,e,n)},p(r,n){r[12].running>0||r[12].failed>0?t?t.p(r,n):(t=Ww(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&C(e),t&&t.d(r)}}}function zw(o){let e,t=o[12].running+"",r,n;return{c(){e=P("span"),r=K(t),n=K(" active"),b(e,"class","tag mod-success svelte-ztgdsf")},m(s,a){T(s,e,a),k(e,r),k(e,n)},p(s,a){a&4096&&t!==(t=s[12].running+"")&&se(r,t)},d(s){s&&C(e)}}}function Kw(o){let e,t=o[12].failed+"",r,n;return{c(){e=P("span"),r=K(t),n=K(" stuck"),b(e,"class","tag mod-warning svelte-ztgdsf")},m(s,a){T(s,e,a),k(e,r),k(e,n)},p(s,a){a&4096&&t!==(t=s[12].failed+"")&&se(r,t)},d(s){s&&C(e)}}}function Gw(o){let e,t=o[12].pending+"",r,n;return{c(){e=P("span"),r=K(t),n=K(" queued"),b(e,"class","tag svelte-ztgdsf")},m(s,a){T(s,e,a),k(e,r),k(e,n)},p(s,a){a&4096&&t!==(t=s[12].pending+"")&&se(r,t)},d(s){s&&C(e)}}}function CM(o){let e,t=o[5].name+"",r,n,s,a,i,l=o[12].running>0&&zw(o),f=o[12].failed>0&&Kw(o),u=o[12].pending>0&&Gw(o);return{c(){e=P("div"),r=K(t),n=B(),s=P("span"),l&&l.c(),a=B(),f&&f.c(),i=B(),u&&u.c(),b(s,"class","sync-stats svelte-ztgdsf"),b(e,"class","folder-header svelte-ztgdsf")},m(d,m){T(d,e,m),k(e,r),k(e,n),k(e,s),l&&l.m(s,null),k(s,a),f&&f.m(s,null),k(s,i),u&&u.m(s,null)},p(d,m){m&32&&t!==(t=d[5].name+"")&&se(r,t),d[12].running>0?l?l.p(d,m):(l=zw(d),l.c(),l.m(s,a)):l&&(l.d(1),l=null),d[12].failed>0?f?f.p(d,m):(f=Kw(d),f.c(),f.m(s,i)):f&&(f.d(1),f=null),d[12].pending>0?u?u.p(d,m):(u=Gw(d),u.c(),u.m(s,null)):u&&(u.d(1),u=null)},d(d){d&&C(e),l&&l.d(),f&&f.d(),u&&u.d()}}}function TM(o){let e,t;return e=new uo({props:{folder:o[5],$$slots:{default:[CM]},$$scope:{ctx:o}}}),{c(){V(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},p(r,n){let s={};n&32&&(s.folder=r[5]),n&536875040&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function PM(o){let e,t,r,n,s,a,i=!o[5]&&Rw(o),l=!o[5]&&Ow(o),f=[vM,_M],u=[];function d(m,x){return m[5]&&m[12]?0:1}return n=d(o,-1),s=u[n]=f[n](o),{c(){e=P("div"),i&&i.c(),t=B(),l&&l.c(),r=B(),s.c(),b(e,"class","setting-item-container")},m(m,x){T(m,e,x),i&&i.m(e,null),k(e,t),l&&l.m(e,null),k(e,r),u[n].m(e,null),a=!0},p(m,[x]){m[5]?i&&(be(),D(i,1,1,()=>{i=null}),we()):i?x&32&&L(i,1):(i=Rw(m),i.c(),L(i,1),i.m(e,t)),m[5]?l&&(be(),D(l,1,1,()=>{l=null}),we()):l?(l.p(m,x),x&32&&L(l,1)):(l=Ow(m),l.c(),L(l,1),l.m(e,r));let h=n;n=d(m,x),n===h?u[n].p(m,x):(be(),D(u[h],1,1,()=>{u[h]=null}),we(),s=u[n],s?s.p(m,x):(s=u[n]=f[n](m),s.c()),L(s,1),s.m(e,null))},i(m){a||(L(i),L(l),L(s),a=!0)},o(m){D(i),D(l),D(s),a=!1},d(m){m&&C(e),i&&i.d(),l&&l.d(),u[n].d()}}}function DM(o,e,t){let r,n,s,a,i,l,f,u,d,m,x,{backgroundSync:h}=e,{sharedFolders:_}=e,{focusedFolderGuid:w}=e,v={},A=0,U=0,I=0,F=0,{activeSync:$,activeDownloads:E}=h;me(o,$,G=>t(21,x=G)),me(o,E,G=>t(20,m=G));function M(G){t(1,v[G]=!v[G],v),t(1,v),t(6,r),t(17,_)}function R(){l?h.resume():h.pause()}let q=G=>M(G.guid),J=(G,z)=>z.key==="Enter"&&M(G.guid);return o.$$set=G=>{"backgroundSync"in G&&t(0,h=G.backgroundSync),"sharedFolders"in G&&t(17,_=G.sharedFolders),"focusedFolderGuid"in G&&t(18,w=G.focusedFolderGuid)},o.$$.update=()=>{if(o.$$.dirty&131072){e:t(6,r=_.items().sort((G,z)=>G.name.localeCompare(z.name)))}if(o.$$.dirty&66){e:r.forEach(G=>{G.guid in v||t(1,v[G.guid]=!0,v)}),t(1,v),t(6,r),t(17,_)}if(o.$$.dirty&393216){e:t(5,n=w?_.items().find(G=>G.guid===w):void 0)}if(o.$$.dirty&3145793){e:t(4,s=new Map(r.map(G=>{var z,W;return[G.guid,{progress:((z=h.getGroupProgress(G))===null||z===void 0?void 0:z.percent)||0,running:[...x.items(),...m.items()].filter(oe=>oe.sharedFolder.guid===G.guid).length,failed:((W=h.syncGroups.get(G))===null||W===void 0?void 0:W.status)==="failed"?1:0,pending:[...h.pendingSyncs,...h.pendingDownloads].filter(oe=>oe.sharedFolder.guid===G.guid).length,completed:(()=>{let oe=h.syncGroups.get(G);return((oe==null?void 0:oe.completedSyncs)||0)+((oe==null?void 0:oe.completedDownloads)||0)})(),sharedFolder:G}]})))}if(o.$$.dirty&48){e:t(12,a=n?s.get(n.guid):void 0)}if(o.$$.dirty&1){e:t(19,i=h.getQueueStatus())}if(o.$$.dirty&524288){e:t(9,l=i.isPaused)}if(o.$$.dirty&524288){e:f=i.syncsActive>0||i.downloadsActive>0}if(o.$$.dirty&16){e:{let G=0,z=0,W=0,oe=0;for(let Ie of s.values())G+=Ie.running,z+=Ie.failed,W+=Ie.pending,oe+=Ie.completed;t(2,A=G),t(7,U=z),t(3,I=W),t(8,F=oe)}}if(o.$$.dirty&4){e:t(11,u=A>0)}if(o.$$.dirty&8){e:t(10,d=I>0)}},[h,v,A,I,s,n,r,U,F,l,d,u,a,$,E,M,R,_,w,i,m,x,q,J]}var im=class extends Z{constructor(e){super(),ee(this,e,DM,PM,Q,{backgroundSync:0,sharedFolders:17,focusedFolderGuid:18},xM)}},jw=im;var ci=class extends Yw.Modal{constructor(t,r,n,s){super(t);this.backgroundSync=r;this.sharedFolders=n;this.focusedFolderGuid=s}onOpen(){let{contentEl:t}=this;t.empty(),this.component=new jw({target:t,props:{backgroundSync:this.backgroundSync,sharedFolders:this.sharedFolders,focusedFolderGuid:this.focusedFolderGuid,closeModal:()=>this.close()}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};function lm(o){return o.startsWith("v")?o.slice(1):o}function AM(o,e){return o.map((t,r)=>[t,e[r]])}function MM(o,e){try{let t=lm(o).split(".").map(parseInt),r=lm(e).split(".").map(parseInt);for(let[n,s]of AM(t,r))if(n>s)return!0}catch(t){}return!1}var Tc=class extends St{constructor(t,r,n){super("UpdateManager");this.plugin=t;this.timeProvider=r;this.releaseSettings=n;this.updateCheckInterval=null;this.lastReleaseCheck=0;this.lastChannelCheck=0;this.CHECK_INTERVAL=1e3*60*60*24;this.githubReleases=new Ro("system3-relay/releases"),this.releaseChannels=new Ro("system3-relay/releaseChannels")}get releases(){return[...this.githubReleases.values()].sort((t,r)=>r.tag_name.localeCompare(t.tag_name,void 0,{numeric:!0,sensitivity:"base"}))}get beta(){return this.releaseChannels.get("beta")}get stable(){return this.releaseChannels.get("stable")}async fetchReleases(){let r=await wr("https://api.github.com/repos/No-Instructions/Relay/releases",{headers:{Accept:"application/vnd.github.v3+json","User-Agent":"Relay-Obsidian-Plugin"}});if(!r.ok)throw new Error(`GitHub API error: ${r.status}`);let n=await r.json();return this.debug("GitHub releases fetched:",n),n}async fetchLatestRelease(){try{let n="https://api.github.com/repos/No-Instructions/Relay/releases/latest";this.debug(`Fetching latest release from: ${n}`);let s=await wr(n,{headers:{"User-Agent":"Relay-Obsidian-Plugin"}});if(!s.ok)throw new Error(`GitHub API error: ${s.status}`);return await s.json()}catch(t){return this.error("Failed to fetch latest release:",t),null}}async fetchLatestTagFromChannel(t){try{let r={beta:"manifest-beta.json",stable:"manifest.json"}[t],n=r?await this.fetchRepoManifest(r):null;return n?(console.warn("repo manifest",n),n.version):null}catch(r){this.error("Failed to check for updates:",r)}return null}async getReleases(){try{let t=Date.now();if(t-this.lastReleaseCheck<5*60*1e3&&this.githubReleases.size>0)return[...this.githubReleases.values()];this.lastReleaseCheck=t,(await this.fetchReleases()).forEach(s=>{this.githubReleases.set(s.tag_name,s)});let n=await this.fetchLatestRelease();n&&(n.latest=!0,this.githubReleases.set(n.tag_name,n)),this.notifyListeners()}catch(t){this.error("Failed to fetch GitHub releases:",t)}return[...this.githubReleases.values()]}async getChannelRelease(){let t=Date.now(),r=this.releaseChannels.get(this.releaseSettings.get().channel);if(t-this.lastChannelCheck<5*60*1e3&&r)return r;this.lastReleaseCheck=t;let n=await this.getReleases();if(n.length===0)return this.debug("No releases found"),null;let s=this.releaseSettings.get().channel;if(!s)return null;let a=await this.fetchLatestTagFromChannel(s);if(!a)return null;let i=n.find(l=>lm(l.tag_name)===a);return i?(this.releaseChannels.set(s,i),this.notifyListeners(),i):null}async update(){await this.getReleases(),await this.getChannelRelease()}start(){this.update(),this.updateCheckInterval=this.timeProvider.setInterval(()=>this.update(),this.CHECK_INTERVAL)}stop(){this.updateCheckInterval!==null&&(this.timeProvider.clearInterval(this.updateCheckInterval),this.updateCheckInterval=null)}async fetchRepoManifest(t,r="main"){try{let a=`https://raw.githubusercontent.com/No-Instructions/Relay/${r}/${t}`;this.debug(`Fetching ${a}`);let i=await wr(a);if(!i.ok)throw new Error("unable to fetch manifest");return await i.json()}catch(n){return this.error("Failed to fetch:",n),null}}async fetchReleaseManifest(t){try{let r=t.assets.find(a=>a.name==="manifest.json");if(!r)return this.debug("No manifest found in release assets"),null;this.debug("Fetching manifest from release asset:",r.browser_download_url);let n=await wr(r.browser_download_url,{headers:{Accept:"application/octet-stream","User-Agent":"Relay-Obsidian-Plugin"}});if(!n.ok)throw new Error(`Failed to fetch manifest asset: ${n.status}`);let s=await n.json();return this.debug("manifest fetched:",s),s}catch(r){return this.error("Failed to fetch manifest for release:",t,r),null}}getNewRelease(){let t=this.releaseChannels.get(this.releaseSettings.get().channel);if(t&&MM(t.tag_name,this.plugin.version))return t}async installUpdate(t){let r=await this.fetchReleaseManifest(t);try{this.debug(`Installing update from v${this.plugin.version} to v${r.version}...`,r),await this.plugin.app.plugins.installPlugin("No-Instructions/Relay",r.version,r),this.notifyListeners(),this.debug("Update complete. Reloading plugin...");let n="system3-relay",s=this.plugin.app.plugins;return await s.disablePlugin(n),await s.enablePlugin(n),!0}catch(n){return this.error("Failed to install update:",n),!1}}applyAutomaticUpdates(){if(this.releaseSettings.get().automaticUpdates){let t=this.getNewRelease();t&&this.installUpdate(t)}}destroy(){this.stop(),this.githubReleases=null,this.releaseChannels=null,super.destroy()}};var p_=require("obsidian");var u_=require("obsidian");function EM(o){Pe(o,"svelte-12doke6",'.modal-content.svelte-12doke6.svelte-12doke6{padding:0;display:flex;flex-direction:column;height:100%}.settings-container.svelte-12doke6.svelte-12doke6{margin:0 1rem;border-bottom:1px solid var(--background-modifier-border);margin-bottom:1rem}.settings-spacer.svelte-12doke6.svelte-12doke6{height:0.5rem}.checkbox-container.svelte-12doke6.svelte-12doke6{cursor:pointer}.loading-text.svelte-12doke6.svelte-12doke6,.no-releases-text.svelte-12doke6.svelte-12doke6{padding:12px;text-align:center;color:var(--text-muted);font-style:italic}.release-tags-container.svelte-12doke6.svelte-12doke6{display:flex;flex-wrap:wrap;column-gap:8px;row-gap:4px;padding:0 1rem 1rem;max-height:160px;overflow-y:auto}.release-tag-item.svelte-12doke6.svelte-12doke6{display:flex;justify-content:center;align-items:center;background-color:var(--background-secondary);border:1px solid var(--background-modifier-border);border-radius:4px;padding:4px 8px;height:24px;cursor:pointer;opacity:0.7;position:relative}.release-tag-item.svelte-12doke6.svelte-12doke6:hover{background-color:var(--background-modifier-hover);opacity:0.9}.release-tag-item[aria-selected="true"].svelte-12doke6.svelte-12doke6{background-color:var(--color-accent);border-color:var(--background-modifier-border);border-bottom-width:2px;opacity:1}.release-tag-item.current-version.svelte-12doke6.svelte-12doke6{border-width:1px}.release-tag-item.development-version.svelte-12doke6.svelte-12doke6{border-width:1px}.release-tag-item.main-branch-version.svelte-12doke6.svelte-12doke6{border-width:1px}.release-tag-item.beta-version.svelte-12doke6.svelte-12doke6{font-weight:bold}.release-tag-item.stable-version.svelte-12doke6.svelte-12doke6{font-weight:bold}.prerelease-badge.svelte-12doke6.svelte-12doke6{font-size:0.7em;color:var(--text-on-accent);border-radius:4px;padding:2px 6px;margin-left:8px;vertical-align:middle;text-transform:uppercase}.channel-badge.svelte-12doke6.svelte-12doke6{font-size:0.7em;border-radius:4px;padding:2px 6px;margin-left:8px;vertical-align:middle;text-transform:uppercase}.beta-badge.svelte-12doke6.svelte-12doke6{background-color:var(--background-modifier-hover);color:var(--text-normal)}.stable-badge.svelte-12doke6.svelte-12doke6{background-color:var(--background-modifier-hover);color:var(--text-normal)}.tag-name.svelte-12doke6.svelte-12doke6{font-weight:bold;font-size:0.8em;display:flex;align-items:center}.manifest-container.svelte-12doke6.svelte-12doke6{flex:1;display:flex;flex-direction:column;border:1px solid var(--background-modifier-border);border-radius:8px;background-color:var(--background-secondary);margin:0 1rem 1rem;overflow:hidden}.manifest-header.svelte-12doke6.svelte-12doke6{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;background-color:var(--background-secondary-alt);border-bottom:1px solid var(--background-modifier-border)}.manifest-header.svelte-12doke6 h3.svelte-12doke6{margin:0;font-size:1.1em;color:var(--text-normal);display:flex;align-items:center}.manifest-header-actions.svelte-12doke6.svelte-12doke6{display:flex;align-items:center;gap:10px}.manifest-close-btn.svelte-12doke6.svelte-12doke6{cursor:pointer;font-size:1.2em;background:transparent;border:none;color:var(--text-normal)}.manifest-content.svelte-12doke6.svelte-12doke6{padding:16px;border-top:1px solid var(--background-modifier-border)}.manifest-field.svelte-12doke6.svelte-12doke6{margin-bottom:8px;display:flex;align-items:flex-start}.manifest-label.svelte-12doke6.svelte-12doke6{font-weight:bold;min-width:120px;color:var(--text-normal)}.manifest-value.svelte-12doke6.svelte-12doke6{flex:1}.manifest-version-mismatch.svelte-12doke6.svelte-12doke6{margin-left:10px;color:var(--text-error);font-size:0.85em;display:flex;align-items:center;gap:4px}.manifest-version-mismatch-icon.svelte-12doke6.svelte-12doke6{font-size:1.2em}.release-changelog.svelte-12doke6.svelte-12doke6{padding:16px;overflow:hidden;display:flex;flex-direction:column;height:320px}.release-changelog-content.svelte-12doke6.svelte-12doke6{overflow-x:auto;margin:0;font-size:0.85em;flex:1;overflow-y:auto;line-height:1.4}.currently-installed.svelte-12doke6.svelte-12doke6{color:var(--interactive-accent);font-weight:bold;padding:4px 8px;border-radius:4px}.install-version-btn.svelte-12doke6.svelte-12doke6{font-size:0.9em;padding:4px 12px;cursor:pointer}.manifest-error.svelte-12doke6.svelte-12doke6{padding:16px;text-align:center;background-color:var(--background-modifier-error);border-radius:6px;color:var(--text-on-accent);margin:0 1rem 1rem}.manifest-error-message.svelte-12doke6.svelte-12doke6{margin-bottom:12px}')}function Jw(o,e,t){let r=o.slice();return r[71]=e[t],r}function FM(o){let e,t;return e=new fr({props:{name:"Automatically install updates",$$slots:{default:[RM]},$$scope:{ctx:o}}}),{c(){V(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},p(r,n){let s={};n[0]&128|n[2]&4096&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function RM(o){let e,t,r,n,s,a;return{c(){e=P("div"),t=P("input"),r=B(),n=P("div"),b(t,"type","checkbox"),t.checked=o[7],b(n,"class","checkbox-toggle"),b(e,"class","checkbox-container svelte-12doke6"),b(e,"role","checkbox"),b(e,"aria-checked",o[7]),b(e,"tabindex","0"),ze(e,"is-enabled",o[7])},m(i,l){T(i,e,l),k(e,t),k(e,r),k(e,n),s||(a=[re(e,"click",o[44]),re(e,"keydown",o[45])],s=!0)},p(i,l){l[0]&128&&(t.checked=i[7]),l[0]&128&&b(e,"aria-checked",i[7]),l[0]&128&&ze(e,"is-enabled",i[7])},d(i){i&&C(e),s=!1,ke(a)}}}function Xw(o){let e,t;return e=new fr({props:{name:"Show all releases",$$slots:{default:[OM]},$$scope:{ctx:o}}}),{c(){V(e.$$.fragment)},m(r,n){N(e,r,n),t=!0},p(r,n){let s={};n[0]&64|n[2]&4096&&(s.$$scope={dirty:n,ctx:r}),e.$set(s)},i(r){t||(L(e.$$.fragment,r),t=!0)},o(r){D(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function OM(o){let e,t,r,n,s,a;return{c(){e=P("div"),t=P("input"),r=B(),n=P("div"),b(t,"type","checkbox"),t.checked=o[6],b(n,"class","checkbox-toggle"),b(e,"class","checkbox-container svelte-12doke6"),b(e,"role","checkbox"),b(e,"aria-checked",o[6]),b(e,"tabindex","0"),ze(e,"is-enabled",o[6])},m(i,l){T(i,e,l),k(e,t),k(e,r),k(e,n),s||(a=[re(e,"click",o[46]),re(e,"keydown",o[47])],s=!0)},p(i,l){l[0]&64&&(t.checked=i[6]),l[0]&64&&b(e,"aria-checked",i[6]),l[0]&64&&ze(e,"is-enabled",i[6])},d(i){i&&C(e),s=!1,ke(a)}}}function UM(o){let e,t,r=(!o[1]||o[7])&&Qw(o);function n(i,l){if(i[12])return VM;if(i[17])return HM}let s=n(o,[-1,-1,-1]),a=s&&s(o);return{c(){r&&r.c(),e=B(),a&&a.c(),t=Le()},m(i,l){r&&r.m(i,l),T(i,e,l),a&&a.m(i,l),T(i,t,l)},p(i,l){!i[1]||i[7]?r?r.p(i,l):(r=Qw(i),r.c(),r.m(e.parentNode,e)):r&&(r.d(1),r=null),s===(s=n(i,l))&&a?a.p(i,l):(a&&a.d(1),a=s&&s(i),a&&(a.c(),a.m(t.parentNode,t)))},d(i){i&&(C(e),C(t)),r&&r.d(i),a&&a.d(i)}}}function $M(o){let e;return{c(){e=P("div"),e.textContent="No matching releases found with the current filter",b(e,"class","no-releases-text svelte-12doke6")},m(t,r){T(t,e,r)},p:X,d(t){t&&C(e)}}}function BM(o){let e;return{c(){e=P("div"),e.textContent="No GitHub releases found",b(e,"class","no-releases-text svelte-12doke6")},m(t,r){T(t,e,r)},p:X,d(t){t&&C(e)}}}function NM(o){let e;return{c(){e=P("div"),e.textContent="Loading GitHub releases...",b(e,"class","loading-text svelte-12doke6")},m(t,r){T(t,e,r)},p:X,d(t){t&&C(e)}}}function Qw(o){let e,t,r,n=!o[7]&&!o[9].some(o[43]),s,a=o[5]&&Zw(o),i=o[4]&&e_(o),l=n&&t_(o),f=!o[7]&&!o[1]&&r_(o);return{c(){e=P("div"),a&&a.c(),t=B(),i&&i.c(),r=B(),l&&l.c(),s=B(),f&&f.c(),b(e,"class","release-tags-container svelte-12doke6")},m(u,d){T(u,e,d),a&&a.m(e,null),k(e,t),i&&i.m(e,null),k(e,r),l&&l.m(e,null),k(e,s),f&&f.m(e,null)},p(u,d){u[5]?a?a.p(u,d):(a=Zw(u),a.c(),a.m(e,t)):a&&(a.d(1),a=null),u[4]?i?i.p(u,d):(i=e_(u),i.c(),i.m(e,r)):i&&(i.d(1),i=null),d[0]&640&&(n=!u[7]&&!u[9].some(u[43])),n?l?l.p(u,d):(l=t_(u),l.c(),l.m(e,s)):l&&(l.d(1),l=null),!u[7]&&!u[1]?f?f.p(u,d):(f=r_(u),f.c(),f.m(e,null)):f&&(f.d(1),f=null)},d(u){u&&C(e),a&&a.d(),i&&i.d(),l&&l.d(),f&&f.d()}}}function Zw(o){let e,t,r,n,s;return{c(){e=P("div"),t=P("div"),t.textContent="Stable",b(t,"class","tag-name svelte-12doke6"),b(e,"class","release-tag-item main-branch-version stable-version svelte-12doke6"),b(e,"role","tab"),b(e,"aria-selected",r=o[10]==="stable"),b(e,"tabindex","0")},m(a,i){T(a,e,i),k(e,t),n||(s=[re(e,"click",o[48]),re(e,"keydown",o[49])],n=!0)},p(a,i){i[0]&1024&&r!==(r=a[10]==="stable")&&b(e,"aria-selected",r)},d(a){a&&C(e),n=!1,ke(s)}}}function e_(o){let e,t,r,n,s;return{c(){e=P("div"),t=P("div"),t.textContent="Beta",b(t,"class","tag-name svelte-12doke6"),b(e,"class","release-tag-item main-branch-version beta-version svelte-12doke6"),b(e,"role","tab"),b(e,"aria-selected",r=o[10]==="beta"),b(e,"tabindex","0")},m(a,i){T(a,e,i),k(e,t),n||(s=[re(e,"click",o[50]),re(e,"keydown",o[51])],n=!0)},p(a,i){i[0]&1024&&r!==(r=a[10]==="beta")&&b(e,"aria-selected",r)},d(a){a&&C(e),n=!1,ke(s)}}}function t_(o){let e,t,r,n,s;return{c(){e=P("div"),t=P("div"),t.textContent="Dev",b(t,"class","tag-name svelte-12doke6"),b(e,"class","release-tag-item development-version svelte-12doke6"),b(e,"role","tab"),b(e,"aria-selected",r=o[11]===o[0].version),b(e,"tabindex","0")},m(a,i){T(a,e,i),k(e,t),n||(s=[re(e,"click",o[52]),re(e,"keydown",o[53])],n=!0)},p(a,i){i[0]&2049&&r!==(r=a[11]===a[0].version)&&b(e,"aria-selected",r)},d(a){a&&C(e),n=!1,ke(s)}}}function r_(o){let e,t=Fe(o[9]),r=[];for(let n=0;n<t.length;n+=1)r[n]=o_(Jw(o,t,n));return{c(){for(let n=0;n<r.length;n+=1)r[n].c();e=Le()},m(n,s){for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(n,s);T(n,e,s)},p(n,s){if(s[0]&536873472|s[1]&130){t=Fe(n[9]);let a;for(a=0;a<t.length;a+=1){let i=Jw(n,t,a);r[a]?r[a].p(i,s):(r[a]=o_(i),r[a].c(),r[a].m(e.parentNode,e))}for(;a<r.length;a+=1)r[a].d(1);r.length=t.length}},d(n){n&&C(e),it(r,n)}}}function o_(o){let e,t,r=o[71].tag_name+"",n,s,a,i,l,f;function u(){return o[54](o[71])}function d(...m){return o[55](o[71],...m)}return{c(){e=P("div"),t=P("div"),n=K(r),s=B(),b(t,"class","tag-name svelte-12doke6"),b(e,"class",a="release-tag-item "+(o[29](o[71].tag_name)?"current-version":"")+" "+(f_(o[71])?"pre-release":"")+" svelte-12doke6"),b(e,"role","tab"),b(e,"aria-selected",i=o[11]===o[71].tag_name),b(e,"tabindex","0")},m(m,x){T(m,e,x),k(e,t),k(t,n),k(e,s),l||(f=[re(e,"click",u),re(e,"keydown",d)],l=!0)},p(m,x){o=m,x[0]&512&&r!==(r=o[71].tag_name+"")&&se(n,r),x[0]&512&&a!==(a="release-tag-item "+(o[29](o[71].tag_name)?"current-version":"")+" "+(f_(o[71])?"pre-release":"")+" svelte-12doke6")&&b(e,"class",a),x[0]&2560&&i!==(i=o[11]===o[71].tag_name)&&b(e,"aria-selected",i)},d(m){m&&C(e),l=!1,ke(f)}}}function HM(o){let e,t,r,n,s,a,i;return{c(){e=P("div"),t=P("div"),r=K(o[17]),n=B(),s=P("button"),s.textContent="Close",b(t,"class","manifest-error-message svelte-12doke6"),b(s,"class","manifest-close-btn svelte-12doke6"),b(e,"class","manifest-error svelte-12doke6")},m(l,f){T(l,e,f),k(e,t),k(t,r),k(e,n),k(e,s),a||(i=re(s,"click",o[40]),a=!0)},p(l,f){f[0]&131072&&se(r,l[17])},d(l){l&&C(e),a=!1,i()}}}function VM(o){var G;let e,t,r,n,s,a,i=(G=o[41](o[11]))==null?void 0:G.prerelease,l,f,u,d,m,x,h,_,w,v,A=i&&n_(o),U=o[13][o[11]]==="beta-alias"&&s_(o),I=o[13][o[11]]==="stable-alias"&&a_(o);function F(z,W){if(W[0]&18432&&(m=null),W[0]&2048&&(x=null),m==null&&(m=!!((z[41](z[11])||z[14][z[11]]==="stable-alias"||z[14][z[11]]==="beta-alias")&&!z[29](z[11]))),m)return WM;if(x==null&&(x=!!z[29](z[11])),x)return qM}let $=F(o,[-1,-1,-1]),E=$&&$(o);function M(z,W){return z[14][z[11]]==="stable-alias"||z[14][z[11]]==="beta-alias"||z[10]==="development"?YM:z[11]?jM:GM}let R=M(o,[-1,-1,-1]),q=R(o),J=o[16]&&i_(o);return{c(){e=P("div"),t=P("div"),r=P("h3"),n=K("Release Details: "),s=K(o[11]),a=B(),A&&A.c(),l=B(),U&&U.c(),f=B(),I&&I.c(),u=B(),d=P("div"),E&&E.c(),h=B(),_=P("div"),w=P("div"),q.c(),v=B(),J&&J.c(),b(r,"class","svelte-12doke6"),b(d,"class","manifest-header-actions svelte-12doke6"),b(t,"class","manifest-header svelte-12doke6"),b(w,"class","release-changelog-content svelte-12doke6"),b(_,"class","release-changelog svelte-12doke6"),b(e,"class","manifest-container svelte-12doke6")},m(z,W){T(z,e,W),k(e,t),k(t,r),k(r,n),k(r,s),k(r,a),A&&A.m(r,null),k(r,l),U&&U.m(r,null),k(r,f),I&&I.m(r,null),k(t,u),k(t,d),E&&E.m(d,null),k(e,h),k(e,_),k(_,w),q.m(w,null),k(e,v),J&&J.m(e,null)},p(z,W){var oe;W[0]&2048&&se(s,z[11]),W[0]&2048&&(i=(oe=z[41](z[11]))==null?void 0:oe.prerelease),i?A||(A=n_(z),A.c(),A.m(r,l)):A&&(A.d(1),A=null),z[13][z[11]]==="beta-alias"?U||(U=s_(z),U.c(),U.m(r,f)):U&&(U.d(1),U=null),z[13][z[11]]==="stable-alias"?I||(I=a_(z),I.c(),I.m(r,null)):I&&(I.d(1),I=null),$===($=F(z,W))&&E?E.p(z,W):(E&&E.d(1),E=$&&$(z),E&&(E.c(),E.m(d,null))),R===(R=M(z,W))&&q?q.p(z,W):(q.d(1),q=R(z),q&&(q.c(),q.m(w,null))),z[16]?J?J.p(z,W):(J=i_(z),J.c(),J.m(e,null)):J&&(J.d(1),J=null)},d(z){z&&C(e),A&&A.d(),U&&U.d(),I&&I.d(),E&&E.d(),q.d(),J&&J.d()}}}function n_(o){let e;return{c(){e=P("span"),e.textContent="Pre-release",b(e,"class","prerelease-badge svelte-12doke6")},m(t,r){T(t,e,r)},d(t){t&&C(e)}}}function s_(o){let e;return{c(){e=P("span"),e.textContent="Beta",b(e,"class","channel-badge beta-badge svelte-12doke6")},m(t,r){T(t,e,r)},d(t){t&&C(e)}}}function a_(o){let e;return{c(){e=P("span"),e.textContent="Stable",b(e,"class","channel-badge stable-badge svelte-12doke6")},m(t,r){T(t,e,r)},d(t){t&&C(e)}}}function qM(o){let e;return{c(){e=P("span"),e.textContent="Installed",b(e,"class","currently-installed svelte-12doke6")},m(t,r){T(t,e,r)},p:X,d(t){t&&C(e)}}}function WM(o){let e,t,r,n;function s(l,f){return l[15]===l[11]?KM:zM}let a=s(o,[-1,-1,-1]),i=a(o);return{c(){e=P("button"),i.c(),b(e,"class","install-version-btn mod-cta svelte-12doke6"),e.disabled=t=o[15]===o[11]||o[2]},m(l,f){T(l,e,f),i.m(e,null),r||(n=re(e,"click",o[56]),r=!0)},p(l,f){a!==(a=s(l,f))&&(i.d(1),i=a(l),i&&(i.c(),i.m(e,null))),f[0]&34820&&t!==(t=l[15]===l[11]||l[2])&&(e.disabled=t)},d(l){l&&C(e),i.d(),r=!1,n()}}}function zM(o){let e;return{c(){e=K("Install")},m(t,r){T(t,e,r)},d(t){t&&C(e)}}}function KM(o){let e;return{c(){e=K("Installing...")},m(t,r){T(t,e,r)},d(t){t&&C(e)}}}function GM(o){let e;return{c(){e=K('"No changelog available"')},m(t,r){T(t,e,r)},p:X,d(t){t&&C(e)}}}function jM(o){var n;let e,t,r={ctx:o,current:null,token:null,hasCatch:!1,pending:QM,then:XM,catch:JM,value:70};return Bs(t=o[37](((n=o[41](o[11]))==null?void 0:n.body)||"No changelog available"),r),{c(){e=Le(),r.block.c()},m(s,a){T(s,e,a),r.block.m(s,r.anchor=a),r.mount=()=>e.parentNode,r.anchor=e},p(s,a){var i;o=s,r.ctx=o,a[0]&2048&&t!==(t=o[37](((i=o[41](o[11]))==null?void 0:i.body)||"No changelog available"))&&Bs(t,r)||Pl(r,o,a)},d(s){s&&C(e),r.block.d(s),r.token=null,r=null}}}function YM(o){let e;function t(s,a){if(s[14][s[11]]==="stable-alias")return tE;if(s[14][s[11]]==="beta-alias")return eE;if(s[11]===s[0].version)return ZM}let r=t(o,[-1,-1,-1]),n=r&&r(o);return{c(){n&&n.c(),e=Le()},m(s,a){n&&n.m(s,a),T(s,e,a)},p(s,a){r!==(r=t(s,a))&&(n&&n.d(1),n=r&&r(s),n&&(n.c(),n.m(e.parentNode,e)))},d(s){s&&C(e),n&&n.d(s)}}}function JM(o){return{c:X,m:X,p:X,d:X}}function XM(o){let e,t=o[70]+"",r;return{c(){e=new Rs(!1),r=Le(),e.a=r},m(n,s){e.m(t,n,s),T(n,r,s)},p(n,s){s[0]&2048&&t!==(t=n[70]+"")&&e.p(t)},d(n){n&&(C(r),e.d())}}}function QM(o){let e;return{c(){e=K('"loading..."')},m(t,r){T(t,e,r)},p:X,d(t){t&&C(e)}}}function ZM(o){let e;return{c(){e=P("p"),e.textContent="Current development version"},m(t,r){T(t,e,r)},d(t){t&&C(e)}}}function eE(o){let e;return{c(){e=P("p"),e.textContent="Current beta release from main branch manifest-beta.json"},m(t,r){T(t,e,r)},d(t){t&&C(e)}}}function tE(o){let e;return{c(){e=P("p"),e.textContent="Current stable release from main branch manifest.json"},m(t,r){T(t,e,r)},d(t){t&&C(e)}}}function i_(o){let e,t,r,n,s,a=o[12].version+"",i,l,f=o[11]!==o[12].version&&!o[11].startsWith("v"+o[12].version),u,d,m,x,h,_=o[12].name+"",w,v,A,U,I,F,$=o[12].author+"",E,M,R,q,J,G,z=o[12].description+"",W,oe,Ie,De,Me,Ye,Re=o[12].isDesktopOnly?"Yes":"No",de,ce,te,$e,Lt,Mt,Et=o[12].minAppVersion+"",ht,gt=f&&l_(o);return{c(){e=P("div"),t=P("div"),r=P("span"),r.textContent="Version:",n=B(),s=P("span"),i=K(a),l=B(),gt&&gt.c(),u=B(),d=P("div"),m=P("span"),m.textContent="Name:",x=B(),h=P("span"),w=K(_),v=B(),A=P("div"),U=P("span"),U.textContent="Author:",I=B(),F=P("span"),E=K($),M=B(),R=P("div"),q=P("span"),q.textContent="Description:",J=B(),G=P("span"),W=K(z),oe=B(),Ie=P("div"),De=P("span"),De.textContent="isDesktopOnly:",Me=B(),Ye=P("span"),de=K(Re),ce=B(),te=P("div"),$e=P("span"),$e.textContent="minAppVersion:",Lt=B(),Mt=P("span"),ht=K(Et),b(r,"class","manifest-label svelte-12doke6"),b(s,"class","manifest-value svelte-12doke6"),b(t,"class","manifest-field svelte-12doke6"),b(m,"class","manifest-label svelte-12doke6"),b(h,"class","manifest-value svelte-12doke6"),b(d,"class","manifest-field svelte-12doke6"),b(U,"class","manifest-label svelte-12doke6"),b(F,"class","manifest-value svelte-12doke6"),b(A,"class","manifest-field svelte-12doke6"),b(q,"class","manifest-label svelte-12doke6"),b(G,"class","manifest-value svelte-12doke6"),b(R,"class","manifest-field svelte-12doke6"),b(De,"class","manifest-label svelte-12doke6"),b(Ye,"class","manifest-value svelte-12doke6"),b(Ie,"class","manifest-field svelte-12doke6"),b($e,"class","manifest-label svelte-12doke6"),b(Mt,"class","manifest-value svelte-12doke6"),b(te,"class","manifest-field svelte-12doke6"),b(e,"class","manifest-content svelte-12doke6")},m(ut,Wt){T(ut,e,Wt),k(e,t),k(t,r),k(t,n),k(t,s),k(s,i),k(t,l),gt&&gt.m(t,null),k(e,u),k(e,d),k(d,m),k(d,x),k(d,h),k(h,w),k(e,v),k(e,A),k(A,U),k(A,I),k(A,F),k(F,E),k(e,M),k(e,R),k(R,q),k(R,J),k(R,G),k(G,W),k(e,oe),k(e,Ie),k(Ie,De),k(Ie,Me),k(Ie,Ye),k(Ye,de),k(e,ce),k(e,te),k(te,$e),k(te,Lt),k(te,Mt),k(Mt,ht)},p(ut,Wt){Wt[0]&4096&&a!==(a=ut[12].version+"")&&se(i,a),Wt[0]&6144&&(f=ut[11]!==ut[12].version&&!ut[11].startsWith("v"+ut[12].version)),f?gt||(gt=l_(ut),gt.c(),gt.m(t,null)):gt&&(gt.d(1),gt=null),Wt[0]&4096&&_!==(_=ut[12].name+"")&&se(w,_),Wt[0]&4096&&$!==($=ut[12].author+"")&&se(E,$),Wt[0]&4096&&z!==(z=ut[12].description+"")&&se(W,z),Wt[0]&4096&&Re!==(Re=ut[12].isDesktopOnly?"Yes":"No")&&se(de,Re),Wt[0]&4096&&Et!==(Et=ut[12].minAppVersion+"")&&se(ht,Et)},d(ut){ut&&C(e),gt&&gt.d()}}}function l_(o){let e;return{c(){e=P("span"),e.innerHTML=`<span class="manifest-version-mismatch-icon svelte-12doke6">\u26A0\uFE0F</span>
									Version mismatch`,b(e,"class","manifest-version-mismatch svelte-12doke6")},m(t,r){T(t,e,r)},d(t){t&&C(e)}}}function rE(o){let e,t=o[1]?"Relay installer":"Relay releases",r,n,s,a,i,l,f=Ot().enableAutomaticUpdatesOption,u,d,m,x=f&&FM(o),h=!o[7]&&!o[1]&&Xw(o);function _(A,U){return A[8]?NM:A[3].length===0?BM:A[9].length===0?$M:UM}let w=_(o,[-1,-1,-1]),v=w(o);return{c(){e=P("div"),r=K(t),n=B(),s=P("div"),a=P("div"),i=B(),l=P("div"),x&&x.c(),u=B(),h&&h.c(),d=B(),v.c(),b(e,"class","modal-title"),b(a,"class","settings-spacer svelte-12doke6"),b(l,"class","settings-container svelte-12doke6"),b(s,"class","modal-content svelte-12doke6")},m(A,U){T(A,e,U),k(e,r),T(A,n,U),T(A,s,U),k(s,a),k(s,i),k(s,l),x&&x.m(l,null),k(l,u),h&&h.m(l,null),k(s,d),v.m(s,null),m=!0},p(A,U){(!m||U[0]&2)&&t!==(t=A[1]?"Relay installer":"Relay releases")&&se(r,t),f&&x.p(A,U),!A[7]&&!A[1]?h?(h.p(A,U),U[0]&130&&L(h,1)):(h=Xw(A),h.c(),L(h,1),h.m(l,null)):h&&(be(),D(h,1,1,()=>{h=null}),we()),w===(w=_(A,U))&&v?v.p(A,U):(v.d(1),v=w(A),v&&(v.c(),v.m(s,null)))},i(A){m||(L(x),L(h),m=!0)},o(A){D(x),D(h),m=!1},d(A){A&&(C(e),C(n),C(s)),x&&x.d(),h&&h.d(),v.d()}}}var c_="system3-relay";function qn(o){return o.startsWith("v")?o.substring(1):o}function f_(o){return(o==null?void 0:o.prerelease)===!0}function oE(o,e,t){let r,n,s,a,i,l,f,u,d,m,x,h,_,w,v,A,U,{plugin:I}=e,{version:F}=e,$=_e(I.manifest.version),E=_e(!1),M=_e(""),R=_e(""),q=_e(!1);me(o,q,Y=>t(8,u=Y));let J=_e(!1);me(o,J,Y=>t(6,l=Y));let G=_e(null);me(o,G,Y=>t(12,h=Y));let z=_e("");me(o,z,Y=>t(11,x=Y));let W=_e(null),oe=_e(null);me(o,oe,Y=>t(17,U=Y));let Ie=_e(!1);me(o,Ie,Y=>t(16,A=Y));let De=_e(null);me(o,De,Y=>t(5,s=Y));let Me=_e(null);me(o,Me,Y=>t(4,n=Y));let Ye=_e(null);me(o,Ye,Y=>t(58,i=Y));let Re=_e(null);me(o,Re,Y=>t(57,a=Y));let de=_e(!1),ce=!1,te=_e(null);me(o,te,Y=>t(15,v=Y));let $e=I.app;function Lt(Y){let fe=qn(Y),st=qn(I.version);return fe===st}let Mt=_e({});me(o,Mt,Y=>t(14,w=Y));let Et=_e({});me(o,Et,Y=>t(13,_=Y));let ht=_e(I.releaseSettings.get().channel);me(o,ht,Y=>t(10,m=Y));let gt=_e(!1);me(o,gt,Y=>t(7,f=Y));function ut(Y){return Ge(this,void 0,void 0,function*(){gt.set(Y);let fe=I.releaseSettings.get().channel;ht.set(fe),I.releaseSettings.update(st=>Object.assign(Object.assign({},st),{automaticUpdates:Y})),ot(fe)})}er(()=>{Qs(),Wt(),!F&&!r.some(Y=>{Y.tag_name,I.version})?(I.releaseSettings.update(Y=>Object.assign(Object.assign({},Y),{automaticUpdates:!1})),ht.set(null)):ht.set(I.releaseSettings.get().channel),G.set({version:F||I.version,name:I.manifest.name,author:I.manifest.author,description:I.manifest.description,isDesktopOnly:I.manifest.isDesktopOnly,minAppVersion:I.manifest.minAppVersion}),z.set(F||I.version)});function Wt(){return Ge(this,void 0,void 0,function*(){de.set(!0);try{let Y=yield I.updateManager.fetchRepoManifest("manifest.json");Y&&(De.set(Y),Ye.set(Y.version));let fe=yield I.updateManager.fetchRepoManifest("manifest-beta.json");fe&&(Me.set(fe),Re.set(fe.version))}catch(Y){I.error("Error fetching main branch manifests:",Y)}finally{de.set(!1)}})}let mn=fo(I.updateManager,()=>I.updateManager.releases);me(o,mn,Y=>t(3,r=Y));let Wn=fo([mn,J],()=>r&&r.length>0?zn(l).sort():[]);me(o,Wn,Y=>t(9,d=Y)),r.forEach(Y=>Ge(void 0,void 0,void 0,function*(){try{let fe=yield I.updateManager.fetchReleaseManifest(Y);fe&&Mt.update(st=>Object.assign(Object.assign({},st),{[Y.tag_name]:fe.version}))}catch(fe){}}));function Qs(){return Ge(this,void 0,void 0,function*(){q.set(!0);try{yield I.updateManager.getReleases(),zn(l)}catch(Y){I.error("Error refreshing GitHub releases:",Y)}finally{q.set(!1)}})}function Zs(Y){return Ge(this,void 0,void 0,function*(){let fe=document.createElement("div");return yield u_.MarkdownRenderer.render(I.app,Y,fe,"",I),fe.innerHTML})}function zn(Y){return Y?r:F?r.filter(fe=>F===qn(fe.tag_name)):r.filter(fe=>{let st=fe.tag_name;return ea(fe)})}function ea(Y){if(Y.prerelease||Y.draft)return!1;if(Y.latest||qn(Y.tag_name)===i||qn(Y.tag_name)===a)return!0;let fe=new Date(Y.created_at),st=new Date;return st.setMonth(st.getMonth()-3),fe>st}function kr(Y){return Ge(this,void 0,void 0,function*(){oe.set(null),W.set(Y);try{let fe=ho(Y);if(!fe){oe.set(`Could not find release for ${Y}`);return}let st=yield I.updateManager.fetchReleaseManifest(fe);st?(G.set(st),z.set(Y),Ie.set(!1),Mt.update(go=>Object.assign(Object.assign({},go),{[Y]:st.version}))):oe.set(`Could not find manifest for ${Y}`)}catch(fe){I.error("Error fetching manifest:",fe),oe.set(`Error fetching manifest: ${fe.message||"Unknown error"}`)}finally{W.set(null)}})}function ot(Y){let fe=Y==="stable"?s:n;if(fe){let st=fe.version;ht.set(Y);let go=[...r.values()].find(nr=>qn(nr.tag_name)===qn(st));go?(Y==="stable"?Et.update(nr=>Object.assign(Object.assign({},nr),{[go.tag_name]:"stable-alias"})):Et.update(nr=>Object.assign(Object.assign({},nr),{[go.tag_name]:"beta-alias"})),kr(go.tag_name)):(G.set(fe),z.set(st),Y==="stable"?Et.update(nr=>Object.assign(Object.assign({},nr),{[st]:"stable-alias"})):Et.update(nr=>Object.assign(Object.assign({},nr),{[st]:"beta-alias"})),Ie.set(!1))}else oe.set(`Could not find ${Y} manifest`)}function Ht(){G.set(null),z.set(""),oe.set(null)}function ho(Y){return[...r.values()].find(fe=>fe.tag_name===Y)}function hn(Y){return Ge(this,void 0,void 0,function*(){try{te.set(Y);let fe=ho(Y);if(!fe)throw new Error(`Could not find release for ${Y}`);let st=yield I.updateManager.fetchReleaseManifest(fe);if(!st)throw new Error(`Could not find manifest for ${Y}`);t(2,ce=!0),yield $e.plugins.installPlugin(I.repo,Y,st),yield $e.plugins.disablePlugin(c_),yield $e.plugins.enablePlugin(c_)}catch(fe){console.error(`Error installing version ${Y}:`,fe),I&&I.error(`Error installing version ${Y}:`,fe)}finally{I&&(t(2,ce=!1),te.set(null))}})}let ne=Y=>Lt(Y.tag_name),We=()=>{ut(!f)},nt=Y=>{(Y.key==="Enter"||Y.key===" ")&&ut(!f)},tt=()=>{J.update(Y=>!Y)},Ae=Y=>{(Y.key==="Enter"||Y.key===" ")&&J.update(fe=>!fe)},Yr=()=>{I.releaseSettings.update(Y=>({...Y,channel:"stable"})),ht.set("stable"),ot("stable")},Jr=Y=>{(Y.key==="Enter"||Y.key===" ")&&(I.releaseSettings.update(fe=>({...fe,channel:"stable"})),ht.set("stable"),ot("stable"))},ui=()=>{I.releaseSettings.update(Y=>({...Y,channel:"beta"})),ht.set("beta"),ot("beta")},Dc=Y=>{(Y.key==="Enter"||Y.key===" ")&&(I.releaseSettings.update(fe=>({...fe,channel:"beta"})),ht.set("beta"),ot("beta"))},Ac=()=>{ht.set(null),G.set({version:I.manifest.version,name:I.manifest.name,author:I.manifest.author,description:I.manifest.description,isDesktopOnly:I.manifest.isDesktopOnly,minAppVersion:I.manifest.minAppVersion}),z.set(I.version),Ie.set(!1)},di=Y=>{(Y.key==="Enter"||Y.key===" ")&&(ht.set(null),G.set({version:I.manifest.version,name:I.manifest.name,author:I.manifest.author,description:I.manifest.description,isDesktopOnly:I.manifest.isDesktopOnly,minAppVersion:I.manifest.minAppVersion}),z.set(I.version),Ie.set(!1))},zt=Y=>{ht.set(null),kr(Y.tag_name)},pi=(Y,fe)=>{(fe.key==="Enter"||fe.key===" ")&&(ht.set(null),kr(Y.tag_name))},ta=async()=>{hn(x)};return o.$$set=Y=>{"plugin"in Y&&t(0,I=Y.plugin),"version"in Y&&t(1,F=Y.version)},[I,F,ce,r,n,s,l,f,u,d,m,x,h,_,w,v,A,U,q,J,G,z,oe,Ie,De,Me,Ye,Re,te,Lt,Mt,Et,ht,gt,ut,mn,Wn,Zs,kr,ot,Ht,ho,hn,ne,We,nt,tt,Ae,Yr,Jr,ui,Dc,Ac,di,zt,pi,ta]}var cm=class extends Z{constructor(e){super(),ee(this,e,oE,rE,Q,{plugin:0,version:1},EM,[-1,-1,-1])}},d_=cm;var fi=class extends p_.Modal{constructor(t,r,n){super(t);this.plugin=r;this.version=n}onOpen(){let{contentEl:t}=this;this.component=new d_({target:t,props:{plugin:this.plugin,version:this.version}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var nE={debugging:!1},sE={release:{channel:"stable",automaticUpdates:!1},sharedFolders:[],...xl,...nE},Pc=class extends g_.Plugin{constructor(){super(...arguments);this.webviewerPatched=!1;this.openModals=[];this.interceptedUrls=[];this.fileDiffMergeWarningKey="file-diff-merge-warning";this.version="0.4.9";this.repo="No-Instructions/Relay"}enableDebugging(t){hl(!0),console.warn("RelayInstances",Dt),t&&this.debugSettings.update(r=>({...r,debugging:!0}))}disableDebugging(t){hl(!1),t&&this.debugSettings.update(r=>({...r,debugging:!1}))}toggleDebugging(t){let r=!this.debugSettings.get().debugging;return hl(r),t&&this.debugSettings.update(n=>({...n,debugging:r})),r}buildApiUrl(t){return"https://api.system3.md"+t}async onload(){this.appId=this.app.appId;let t=Nt.moment.now();Dt.set(this,"plugin"),this.timeProvider=new Ds,this.register(()=>{this.timeProvider.destroy()}),fx(new Ic(this.app.vault),this.timeProvider,".obsidian/plugins/system3-relay/relay.log",{maxFileSize:5*1024*1024,maxBackups:3,disableConsole:!1}),this.notifier=new kc,this.toast=px(this.notifier),this.debug=Ce("[System 3][Relay]","debug"),this.log=Ce("[System 3][Relay]","log"),this.warn=Ce("[System 3][Relay]","warn"),this.error=Ce("[System 3][Relay]","error"),this.settings=new Sc(this,sE),await this.settings.load(),this.featureSettings=new jr(this.settings,"(enable*)"),this.debugSettings=new jr(this.settings,"(debugging)"),this.folderSettings=new jr(this.settings,"sharedFolders"),this.releaseSettings=new jr(this.settings,"release"),qt.getInstance().setSettings(this.featureSettings),this.settingsTab=new Zl(this.app,this),this.addRibbonIcon("satellite","Relay",()=>{this.openSettings()}),this.updateManager=new Tc(this,this.timeProvider,this.releaseSettings),Ot().enableAutomaticUpdatesOption&&this.updateManager.applyAutomaticUpdates(),this.debugSettings.subscribe(s=>{s.debugging?(this.enableDebugging(),this.removeCommand("enable-debugging"),this.addCommand({id:"toggle-feature-flags",name:"Show feature flags",callback:()=>{let a=new _c(this.app,()=>{this.reload()});this.openModals.push(a),a.open()}}),this.addCommand({id:"send-bug-report",name:"Send bug report",callback:()=>{let a=new Lc(this.app,this);this.openModals.push(a),a.open()}}),this.addCommand({id:"show-debug-info",name:"Show debug info",callback:()=>{let a=new vc(this.app,this);this.openModals.push(a),a.open()}}),this.addCommand({id:"show-release-manager",name:"Show releases",callback:()=>{let a=new fi(this.app,this);this.openModals.push(a),a.open()}}),this.addCommand({id:"analyze-indexeddb",name:"Analyze database",callback:()=>{let a=new Cc(this.app,this);this.openModals.push(a),a.open()}}),this.addCommand({id:"disable-debugging",name:"Disable debugging",callback:()=>{this.disableDebugging(!0)}}),this.addCommand({id:"show-sync-status",name:"Sync status",callback:()=>{let a=new ci(this.app,this.backgroundSync,this.sharedFolders);this.openModals.push(a),a.open()}})):(this.removeCommand("toggle-feature-flags"),this.removeCommand("send-bug-report"),this.removeCommand("show-debug-info"),this.removeCommand("show-sync-status"),this.removeCommand("show-release-manager"),this.removeCommand("disable-debugging"),this.addCommand({id:"enable-debugging",name:"Enable debugging",callback:()=>{this.enableDebugging(!0)}}))}),this.addCommand({id:"reload",name:"Reload Relay",callback:()=>{this.reload()}}),this.updateManager.subscribe(()=>{let s=this.updateManager.getNewRelease();s?(this.removeCommand("update-plugin"),this.addCommand({id:"update-plugin",name:`Update Plugin (${this.version} \u2192 ${s.tag_name})`,callback:async()=>{await this.updateManager.installUpdate(s)}}),this.log(`Update available: v${this.version} \u2192 ${s.tag_name}`)):this.removeCommand("update-plugin")}),this.vault=this.app.vault;let n=this.vault.getName();this.fileManager=this.app.fileManager,this.loginManager=new sc(this.vault.getName(),this.openSettings.bind(this),this.timeProvider,this.patchWebviewer.bind(this)),this.relayManager=new wc(this.loginManager),this.sharedFolders=new kl(this.relayManager,this.vault,this._createSharedFolder.bind(this),this.folderSettings),this.tokenStore=new xc(this.loginManager,this.timeProvider,n,3),this.networkStatus=new Bb(this.timeProvider,"https://api.system3.md/health?version=0.4.9"),this.backgroundSync=new Ol(this.loginManager,this.timeProvider,this.sharedFolders),this.loginManager.setup()||new Nt.Notice("Please sign in to use relay"),this.app.workspace.onLayoutReady(()=>{this.sharedFolders.load(),this._liveViews=new Bl(this.app,this.sharedFolders,this.loginManager,this.networkStatus),this.registerEditorExtension(this._liveViews.extensions),this.register(this.loginManager.on(()=>{this.loginManager.loggedIn?this._onLogin():this._onLogout()})),this.tokenStore.start(),m_.Platform.isIosApp||(this.networkStatus.addEventListener("offline",()=>{this.tokenStore.stop(),this.sharedFolders.forEach(s=>s.disconnect()),this._liveViews.goOffline()}),this.networkStatus.addEventListener("online",()=>{this.tokenStore.start(),this.relayManager.subscribe(),this.relayManager.update(),this._liveViews.goOnline()}),this.networkStatus.start()),this.registerView(qs,s=>new $l(s)),this.registerEvent(this.app.workspace.on("file-menu",(s,a)=>{if(a instanceof Nt.TFolder){let i=this.sharedFolders.find(l=>l.path===a.path);if(!i)return;i.relayId&&s.addItem(l=>{l.setTitle(i.connected?"Disconnect":"Connect").setIcon("satellite").onClick(()=>{i.connected?(i.shouldConnect=!1,i.disconnect()):(i.shouldConnect=!0,i.connect()),this._liveViews.refresh("folder connection toggle")})}),s.addItem(l=>{l.setTitle("Folder settings").setIcon("gear").onClick(()=>{this.openSettings(`/shared-folders?id=${i.guid}&relay=${i.relayId}`)})}),i.relayId&&Ot().enableSyncModal&&s.addItem(l=>{l.setTitle("Sync Status").setIcon("list-checks").onClick(()=>{let f=new ci(this.app,this.backgroundSync,this.sharedFolders,i.guid);this.openModals.push(f),f.open()})}),Ot().enableSyncMenu&&i.relayId&&i.connected&&s.addItem(l=>{l.setTitle("Sync").setIcon("folder-sync").onClick(()=>{i.netSync()})})}})),this.setup(),this._liveViews.refresh("init"),this.loadTime=Nt.moment.now()-t})}async reload(){let t=this.manifest.id,r=this.app.plugins;await r.disablePlugin(t),await r.enablePlugin(t)}_createSharedFolder(t,r,n,s){let a=new jr(this.settings,`sharedFolders/[guid=${r}]`);return a.flush(),new Sl(this.appId,r,t,this.loginManager,this.vault,this.fileManager,this.tokenStore,this.relayManager,this.backgroundSync,a,n,s)}_onLogout(){var t,r;(t=this.tokenStore)==null||t.clear(),(r=this.relayManager)==null||r.logout(),this._liveViews.refresh("logout")}_onLogin(){var t;this.sharedFolders.load(),(t=this.relayManager)==null||t.login(),this._liveViews.refresh("login")}async openSettings(t="/"){let r=this.app.setting;await r.open(),await r.openTabById("system3-relay"),this.settingsTab.navigateTo(t)}patchWebviewer(){var r,n,s;let t=this;try{if(this.webviewerPatched)return;let a=(n=(r=this.app.internalPlugins)==null?void 0:r.plugins)==null?void 0:n.webviewer;if(!((s=a==null?void 0:a.instance)!=null&&s.options)||!a.enabled){this.warn("Webviewer plugin not found or not initialized");return}let i=a.instance.options,l=Object.getOwnPropertyDescriptor(i,"openExternalURLs");if(!l){this.warn("Could not find openExternalURLs property");return}Object.defineProperty(i,"openExternalURLs",{get(){var m;let d=window.event;if((d==null?void 0:d.type)==="open-url"&&((m=d==null?void 0:d.detail)!=null&&m.url)){let x=d.detail.url;for(let h of t.interceptedUrls)if(typeof h=="string"&&x.startsWith(h)||h instanceof RegExp&&h.test(x))return t.log("Intercepted webviewer, opening in default browser",d.detail.url),!1}return l.value},set(d){l.value=d},configurable:!0}),this.register(()=>{Object.defineProperty(i,"openExternalURLs",l)});let f=this.loginManager.webviewIntercept();this.debug("Intercepting Webviewer for URL pattern",f.source),this.interceptedUrls.push(f);let u=new RegExp("https://api.system3.md".replace("/","\\/")+".*");this.debug("Intercepting Webviewer for URL pattern",u.source),this.interceptedUrls.push(u),this.webviewerPatched=!0,this.debug("patched webviewer options")}catch(a){this.error("Failed to patch webviewer:",a)}}setup(){this.folderNavDecorations=new Vl(this.vault,this.app.workspace,this.sharedFolders,this.backgroundSync),this.folderNavDecorations.refresh(),this.addSettingTab(this.settingsTab);let t=Ce("[Live][Workspace]","log");this.registerEvent(this.app.workspace.on("file-open",f=>{t("file-open"),i._liveViews.refresh("file-open")})),this.registerEvent(this.app.workspace.on("layout-change",()=>{t("layout-change"),this._liveViews.refresh("layout-change")}));let r=Ce("[System 3][Relay][Vault]","log"),n=f=>{let u=f.error;u&&u instanceof Vn&&this.toast(u)};window.addEventListener("error",n,!0),this.register(()=>window.removeEventListener("error",n,!0));let s=f=>{f.reason instanceof Vn&&this.toast(f.reason)},a=f=>s(f);window.addEventListener("unhandledrejection",a,!0),this.register(()=>window.removeEventListener("unhandledrejection",a,!0)),this.registerEvent(this.app.vault.on("create",f=>{let u=this.sharedFolders.lookup(f.path);if(u){let d=u.getVirtualPath(f.path);u.placeHold([f]).length>0?u.uploadFile(d):u.whenReady().then(x=>{x.getFile(d)})}})),this.registerEvent(this.app.vault.on("delete",f=>{if(f instanceof Nt.TFolder){let d=this.sharedFolders.find(m=>m.path===f.path);if(d){this.sharedFolders.delete(d);return}}let u=this.sharedFolders.lookup(f.path);u&&(r("Delete",f.path),u.whenReady().then(d=>{d.proxy.deleteFile(f.path)}))})),this.registerEvent(this.app.vault.on("rename",(f,u)=>{if(f instanceof Nt.TFolder){let h=this.sharedFolders.find(_=>_.path==u);if(h){h.move(f.path),this.sharedFolders.update();return}}let d=this.sharedFolders.lookup(u),m=this.sharedFolders.lookup(f.path),x=d||m;d&&m?(r("Rename",f.path,u),d.renameFile(f,u),m.renameFile(f,u),this._liveViews.refresh("rename"),this.folderNavDecorations.quickRefresh()):x&&(r("Rename",f,u),x.renameFile(f,u),this._liveViews.refresh("rename"),this.folderNavDecorations.quickRefresh())})),this.registerEvent(this.app.vault.on("modify",f=>{this.sharedFolders.lookup(f.path)&&(r("Modify",f.path),Ot().enableDesyncPill&&this.folderNavDecorations.quickRefresh(),this.app.metadataCache.trigger("resolve",f))}));let i=this,l=Ga(Nt.MarkdownView.prototype,{onUnloadFile(f){return function(u){return i._liveViews.wipe(),f.call(this,u)}}});this.register(l),this.patchWebviewer(),io(Ar.enableNewLinkFormat,()=>{let f=Ga(Nt.MetadataCache.prototype,{fileToLinktext(u){return function(d,m,x){if(i.sharedFolders.lookup(d.path)){x===void 0&&(x=!0);let _=d.extension==="md"&&x?d.basename:d.name,w=(0,Nt.normalizePath)(d.name),v=i.app.metadataCache.uniqueFileLookup.get(w.toLowerCase());if(v&&v.length===1&&v[0]===d)return _;{let A=d.extension==="md"&&x?d.path.slice(0,d.path.length-3):d.path,U=(0,h_.relative)(m,A);return U==="../"+_?"./"+_:U}}return u.call(this,d,m,x)}}});this.register(f)}),this.registerObsidianProtocolHandler("relay/settings/relays",async f=>{let u=f,d=new URLSearchParams({...u}).toString(),m=`/${u.action.split("/").slice(-1)}?${d}`;this.openSettings(m)}),this.registerObsidianProtocolHandler("relay/settings/shared-folders",async f=>{let u=f,d=new URLSearchParams({...u}).toString(),m=`/${u.action.split("/").slice(-1)}?${d}`;this.openSettings(m)}),this.registerObsidianProtocolHandler("relay/upgrade",async f=>{var m;let d=(m=f.version)==null?void 0:m.trim();this.installVersion(d)}),this.backgroundSync.start(),this.updateManager.start()}installVersion(t){let r=new fi(this.app,this,t);this.openModals.push(r),r.open()}removeCommand(t){if((0,Nt.requireApiVersion)("1.7.2"))super.removeCommand(t);else{let r=this.app,n=r.commands,s=`system3-relay:${t}`;(n.commands.hasOwnProperty(s)||r.hotkeyManager.removeDefaultHotkeys(s))&&(delete n.commands[s],delete n.editorCommands[s])}}onunload(){var t,r,n,s,a,i,l,f,u,d,m,x,h,_;(t=this.timeProvider)==null||t.destroy(),(r=this.folderNavDecorations)==null||r.destroy(),this.app.workspace.detachLeavesOfType(qs),this.updateManager&&(this.updateManager.destroy(),this.updateManager=null),(n=this._liveViews)==null||n.destroy(),this._liveViews=null,(s=this.relayManager)==null||s.destroy(),this.relayManager=null,(a=this.tokenStore)==null||a.stop(),(i=this.tokenStore)==null||i.clearState(),(l=this.tokenStore)==null||l.destroy(),this.tokenStore=null,(f=this.networkStatus)==null||f.stop(),(u=this.networkStatus)==null||u.destroy(),this.networkStatus=null,this.openModals.forEach(w=>{w.close()}),this.openModals.length=0,(d=this.sharedFolders)==null||d.destroy(),this.sharedFolders=null,(m=this.settingsTab)==null||m.destroy(),this.settingsTab=null,(x=this.loginManager)==null||x.destroy(),this.loginManager=null,(h=this.backgroundSync)==null||h.destroy(),this.backgroundSync=null,(_=this.app)==null||_.workspace.updateOptions(),this.app=null,this.fileManager=null,this.manifest=null,this.vault=null,this.debugSettings.destroy(),this.debugSettings=null,this.folderSettings.destroy(),this.folderSettings=null,this.featureSettings.destroy(),this.featureSettings=null,this.releaseSettings.destroy(),this.releaseSettings=null,this.interceptedUrls.length=0,qt.destroy(),Mr.destroy(),this.notifier=null,this.toast=null,hx(),du()}async loadSettings(){this.settings.load()}async saveSettings(){await this.settings.save()}};
/*! Bundled license information:

moment/moment.js:
  (*! moment.js *)
  (*! version : 2.29.4 *)
  (*! authors : Tim Wood, Iskren Chernev, Moment.js contributors *)
  (*! license : MIT *)
  (*! momentjs.com *)

lucide-svelte/dist/defaultAttributes.js:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/arrow-right-left.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/arrow-up-down.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/chevron-left.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/chevron-right.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/circle-check-big.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/circle-help.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/clock.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/download.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/folder.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/info.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/layers.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/message-square-heart.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/pause.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/play.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/refresh-cw.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/satellite.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/settings.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/triangle-alert.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/upload.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/index.js:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/aliases.js:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)
*/

/* nosourcemap */