/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var h0=Object.create;var ya=Object.defineProperty;var g0=Object.getOwnPropertyDescriptor;var y0=Object.getOwnPropertyNames;var x0=Object.getPrototypeOf,b0=Object.prototype.hasOwnProperty;var w0=(o,e,t)=>e in o?ya(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var $i=(o,e)=>()=>(e||o((e={exports:{}}).exports,e),e.exports),lf=(o,e)=>{for(var t in e)ya(o,t,{get:e[t],enumerable:!0})},nh=(o,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of y0(e))!b0.call(o,s)&&s!==t&&ya(o,s,{get:()=>e[s],enumerable:!(r=g0(e,s))||r.enumerable});return o};var vs=(o,e,t)=>(t=o!=null?h0(x0(o)):{},nh(e||!o||!o.__esModule?ya(t,"default",{value:o,enumerable:!0}):t,o)),_0=o=>nh(ya({},"__esModule",{value:!0}),o);var mt=(o,e,t)=>(w0(o,typeof e!="symbol"?e+"":e,t),t);var xa=$i((TM,ih)=>{"use strict";function Qr(o){if(typeof o!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(o))}function ah(o,e){for(var t="",r=0,s=-1,n=0,a,i=0;i<=o.length;++i){if(i<o.length)a=o.charCodeAt(i);else{if(a===47)break;a=47}if(a===47){if(!(s===i-1||n===1))if(s!==i-1&&n===2){if(t.length<2||r!==2||t.charCodeAt(t.length-1)!==46||t.charCodeAt(t.length-2)!==46){if(t.length>2){var l=t.lastIndexOf("/");if(l!==t.length-1){l===-1?(t="",r=0):(t=t.slice(0,l),r=t.length-1-t.lastIndexOf("/")),s=i,n=0;continue}}else if(t.length===2||t.length===1){t="",r=0,s=i,n=0;continue}}e&&(t.length>0?t+="/..":t="..",r=2)}else t.length>0?t+="/"+o.slice(s+1,i):t=o.slice(s+1,i),r=i-s-1;s=i,n=0}else a===46&&n!==-1?++n:n=-1}return t}function v0(o,e){var t=e.dir||e.root,r=e.base||(e.name||"")+(e.ext||"");return t?t===e.root?t+r:t+o+r:r}var tn={resolve:function(){for(var e="",t=!1,r,s=arguments.length-1;s>=-1&&!t;s--){var n;s>=0?n=arguments[s]:(r===void 0&&(r=process.cwd()),n=r),Qr(n),n.length!==0&&(e=n+"/"+e,t=n.charCodeAt(0)===47)}return e=ah(e,!t),t?e.length>0?"/"+e:"/":e.length>0?e:"."},normalize:function(e){if(Qr(e),e.length===0)return".";var t=e.charCodeAt(0)===47,r=e.charCodeAt(e.length-1)===47;return e=ah(e,!t),e.length===0&&!t&&(e="."),e.length>0&&r&&(e+="/"),t?"/"+e:e},isAbsolute:function(e){return Qr(e),e.length>0&&e.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var e,t=0;t<arguments.length;++t){var r=arguments[t];Qr(r),r.length>0&&(e===void 0?e=r:e+="/"+r)}return e===void 0?".":tn.normalize(e)},relative:function(e,t){if(Qr(e),Qr(t),e===t||(e=tn.resolve(e),t=tn.resolve(t),e===t))return"";for(var r=1;r<e.length&&e.charCodeAt(r)===47;++r);for(var s=e.length,n=s-r,a=1;a<t.length&&t.charCodeAt(a)===47;++a);for(var i=t.length,l=i-a,f=n<l?n:l,u=-1,d=0;d<=f;++d){if(d===f){if(l>f){if(t.charCodeAt(a+d)===47)return t.slice(a+d+1);if(d===0)return t.slice(a+d)}else n>f&&(e.charCodeAt(r+d)===47?u=d:d===0&&(u=0));break}var m=e.charCodeAt(r+d),y=t.charCodeAt(a+d);if(m!==y)break;m===47&&(u=d)}var h="";for(d=r+u+1;d<=s;++d)(d===s||e.charCodeAt(d)===47)&&(h.length===0?h+="..":h+="/..");return h.length>0?h+t.slice(a+u):(a+=u,t.charCodeAt(a)===47&&++a,t.slice(a))},_makeLong:function(e){return e},dirname:function(e){if(Qr(e),e.length===0)return".";for(var t=e.charCodeAt(0),r=t===47,s=-1,n=!0,a=e.length-1;a>=1;--a)if(t=e.charCodeAt(a),t===47){if(!n){s=a;break}}else n=!1;return s===-1?r?"/":".":r&&s===1?"//":e.slice(0,s)},basename:function(e,t){if(t!==void 0&&typeof t!="string")throw new TypeError('"ext" argument must be a string');Qr(e);var r=0,s=-1,n=!0,a;if(t!==void 0&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";var i=t.length-1,l=-1;for(a=e.length-1;a>=0;--a){var f=e.charCodeAt(a);if(f===47){if(!n){r=a+1;break}}else l===-1&&(n=!1,l=a+1),i>=0&&(f===t.charCodeAt(i)?--i===-1&&(s=a):(i=-1,s=l))}return r===s?s=l:s===-1&&(s=e.length),e.slice(r,s)}else{for(a=e.length-1;a>=0;--a)if(e.charCodeAt(a)===47){if(!n){r=a+1;break}}else s===-1&&(n=!1,s=a+1);return s===-1?"":e.slice(r,s)}},extname:function(e){Qr(e);for(var t=-1,r=0,s=-1,n=!0,a=0,i=e.length-1;i>=0;--i){var l=e.charCodeAt(i);if(l===47){if(!n){r=i+1;break}continue}s===-1&&(n=!1,s=i+1),l===46?t===-1?t=i:a!==1&&(a=1):t!==-1&&(a=-1)}return t===-1||s===-1||a===0||a===1&&t===s-1&&t===r+1?"":e.slice(t,s)},format:function(e){if(e===null||typeof e!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return v0("/",e)},parse:function(e){Qr(e);var t={root:"",dir:"",base:"",ext:"",name:""};if(e.length===0)return t;var r=e.charCodeAt(0),s=r===47,n;s?(t.root="/",n=1):n=0;for(var a=-1,i=0,l=-1,f=!0,u=e.length-1,d=0;u>=n;--u){if(r=e.charCodeAt(u),r===47){if(!f){i=u+1;break}continue}l===-1&&(f=!1,l=u+1),r===46?a===-1?a=u:d!==1&&(d=1):a!==-1&&(d=-1)}return a===-1||l===-1||d===0||d===1&&a===l-1&&a===i+1?l!==-1&&(i===0&&s?t.base=t.name=e.slice(1,l):t.base=t.name=e.slice(i,l)):(i===0&&s?(t.name=e.slice(1,a),t.base=e.slice(1,l)):(t.name=e.slice(i,a),t.base=e.slice(i,l)),t.ext=e.slice(a,l)),i>0?t.dir=e.slice(0,i-1):s&&(t.dir="/"),t},sep:"/",delimiter:":",win32:null,posix:null};tn.posix=tn;ih.exports=tn});var By=$i((t3,$y)=>{var Ey=require("url").parse,sC=require("events"),nC=require("https"),aC=require("http"),iC=require("util"),lC=["pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","secureProtocol","servername","checkServerIdentity"],Uy=[239,187,191],cC=58,fC=32,Ry=10,uC=13,Oy=1024*256,dC=/^(cookie|authorization)$/i;function pC(o){return Uy.every(function(e,t){return o[t]===e})}function bt(o,e){var t=bt.CONNECTING,r=e&&e.headers,s=!1;Object.defineProperty(this,"readyState",{get:function(){return t}}),Object.defineProperty(this,"url",{get:function(){return o}});var n=this;n.reconnectInterval=1e3,n.connectionInProgress=!1;function a(w){t!==bt.CLOSED&&(t=bt.CONNECTING,h("error",new Ga("error",{message:w})),m&&(o=m,m=null,s=!1),setTimeout(function(){t!==bt.CONNECTING||n.connectionInProgress||(n.connectionInProgress=!0,y())},n.reconnectInterval))}var i,l="";r&&r["Last-Event-ID"]&&(l=r["Last-Event-ID"],delete r["Last-Event-ID"]);var f=!1,u="",d="",m=null;function y(){var w=Ey(o),v=w.protocol==="https:";if(w.headers={"Cache-Control":"no-cache",Accept:"text/event-stream"},l&&(w.headers["Last-Event-ID"]=l),r){var M=s?hC(r):r;for(var O in M){var A=M[O];A&&(w.headers[O]=A)}}w.rejectUnauthorized=!(e&&!e.rejectUnauthorized),e&&e.createConnection!==void 0&&(w.createConnection=e.createConnection);var E=e&&e.proxy;if(E){var R=Ey(e.proxy);v=R.protocol==="https:",w.protocol=v?"https:":"http:",w.path=o,w.headers.Host=w.host,w.hostname=R.hostname,w.host=R.host,w.port=R.port}if(e&&e.https){for(var F in e.https)if(lC.indexOf(F)!==-1){var D=e.https[F];D!==void 0&&(w[F]=D)}}e&&e.withCredentials!==void 0&&(w.withCredentials=e.withCredentials),i=(v?nC:aC).request(w,function(B){if(n.connectionInProgress=!1,B.statusCode===500||B.statusCode===502||B.statusCode===503||B.statusCode===504){h("error",new Ga("error",{status:B.statusCode,message:B.statusMessage})),a();return}if(B.statusCode===301||B.statusCode===302||B.statusCode===307){var q=B.headers.location;if(!q){h("error",new Ga("error",{status:B.statusCode,message:B.statusMessage}));return}var J=new URL(o).origin,K=new URL(q).origin;s=J!==K,B.statusCode===307&&(m=o),o=q,process.nextTick(y);return}if(B.statusCode!==200)return h("error",new Ga("error",{status:B.statusCode,message:B.statusMessage})),n.close();t=bt.OPEN,B.on("close",function(){B.removeAllListeners("close"),B.removeAllListeners("end"),a()}),B.on("end",function(){B.removeAllListeners("close"),B.removeAllListeners("end"),a()}),h("open",new Ga("open"));var z,W,re=0,Le=-1,le=0,Ce=0;B.on("data",function(Ke){z?(Ke.length>z.length-Ce&&(le=z.length*2+Ke.length,le>Oy&&(le=z.length+Ke.length+Oy),W=Buffer.alloc(le),z.copy(W,0,0,Ce),z=W),Ke.copy(z,Ce),Ce+=Ke.length):(z=Ke,pC(z)&&(z=z.slice(Uy.length)),Ce=z.length);for(var Re=0,de=Ce;Re<de;){f&&(z[Re]===Ry&&++Re,f=!1);for(var fe=-1,oe=Le,Be,At=re;fe<0&&At<de;++At)Be=z[At],Be===cC?oe<0&&(oe=At-Re):Be===uC?(f=!0,fe=At-Re):Be===Ry&&(fe=At-Re);if(fe<0){re=de-Re,Le=oe;break}else re=0,Le=-1;_(z,Re,oe,fe),Re+=fe+1}Re===de?(z=void 0,Ce=0):Re>0&&(z=z.slice(Re,Ce),Ce=z.length)})}),i.on("error",function(B){n.connectionInProgress=!1,a(B.message)}),i.setNoDelay&&i.setNoDelay(!0),i.end()}y();function h(){n.listeners(arguments[0]).length>0&&n.emit.apply(n,arguments)}this._close=function(){t!==bt.CLOSED&&(t=bt.CLOSED,i.abort&&i.abort(),i.xhr&&i.xhr.abort&&i.xhr.abort())};function _(w,v,M,O){if(O===0){if(u.length>0){var A=d||"message";h(A,new mC(A,{data:u.slice(0,-1),lastEventId:l,origin:new URL(o).origin})),u=""}d=void 0}else if(M>0){var E=M<0,R=0,F=w.slice(v,v+(E?O:M)).toString();E?R=O:w[v+M+1]!==fC?R=M+1:R=M+2,v+=R;var D=O-R,B=w.slice(v,v+D).toString();if(F==="data")u+=B+`
`;else if(F==="event")d=B;else if(F==="id")l=B;else if(F==="retry"){var q=parseInt(B,10);Number.isNaN(q)||(n.reconnectInterval=q)}}}}$y.exports=bt;iC.inherits(bt,sC.EventEmitter);bt.prototype.constructor=bt;["open","error","message"].forEach(function(o){Object.defineProperty(bt.prototype,"on"+o,{get:function(){var t=this.listeners(o)[0];return t?t._listener?t._listener:t:void 0},set:function(t){this.removeAllListeners(o),this.addEventListener(o,t)}})});Object.defineProperty(bt,"CONNECTING",{enumerable:!0,value:0});Object.defineProperty(bt,"OPEN",{enumerable:!0,value:1});Object.defineProperty(bt,"CLOSED",{enumerable:!0,value:2});bt.prototype.CONNECTING=0;bt.prototype.OPEN=1;bt.prototype.CLOSED=2;bt.prototype.close=function(){this._close()};bt.prototype.addEventListener=function(e,t){typeof t=="function"&&(t._listener=t,this.on(e,t))};bt.prototype.dispatchEvent=function(e){if(!e.type)throw new Error("UNSPECIFIED_EVENT_TYPE_ERR");this.emit(e.type,e.detail)};bt.prototype.removeEventListener=function(e,t){typeof t=="function"&&(t._listener=void 0,this.removeListener(e,t))};function Ga(o,e){if(Object.defineProperty(this,"type",{writable:!1,value:o,enumerable:!0}),e)for(var t in e)e.hasOwnProperty(t)&&Object.defineProperty(this,t,{writable:!1,value:e[t],enumerable:!0})}function mC(o,e){Object.defineProperty(this,"type",{writable:!1,value:o,enumerable:!0});for(var t in e)e.hasOwnProperty(t)&&Object.defineProperty(this,t,{writable:!1,value:e[t],enumerable:!0})}function hC(o){var e={};for(var t in o)dC.test(t)||(e[t]=o[t]);return e}});var Ed=$i((D$,Gn)=>{var ae=function(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32},rt=-1,st=1,Ue=0;ae.Diff=function(o,e){return[o,e]};ae.prototype.diff_main=function(o,e,t,r){typeof r=="undefined"&&(this.Diff_Timeout<=0?r=Number.MAX_VALUE:r=new Date().getTime()+this.Diff_Timeout*1e3);var s=r;if(o==null||e==null)throw new Error("Null input. (diff_main)");if(o==e)return o?[new ae.Diff(Ue,o)]:[];typeof t=="undefined"&&(t=!0);var n=t,a=this.diff_commonPrefix(o,e),i=o.substring(0,a);o=o.substring(a),e=e.substring(a),a=this.diff_commonSuffix(o,e);var l=o.substring(o.length-a);o=o.substring(0,o.length-a),e=e.substring(0,e.length-a);var f=this.diff_compute_(o,e,n,s);return i&&f.unshift(new ae.Diff(Ue,i)),l&&f.push(new ae.Diff(Ue,l)),this.diff_cleanupMerge(f),f};ae.prototype.diff_compute_=function(o,e,t,r){var s;if(!o)return[new ae.Diff(st,e)];if(!e)return[new ae.Diff(rt,o)];var n=o.length>e.length?o:e,a=o.length>e.length?e:o,i=n.indexOf(a);if(i!=-1)return s=[new ae.Diff(st,n.substring(0,i)),new ae.Diff(Ue,a),new ae.Diff(st,n.substring(i+a.length))],o.length>e.length&&(s[0][0]=s[2][0]=rt),s;if(a.length==1)return[new ae.Diff(rt,o),new ae.Diff(st,e)];var l=this.diff_halfMatch_(o,e);if(l){var f=l[0],u=l[1],d=l[2],m=l[3],y=l[4],h=this.diff_main(f,d,t,r),_=this.diff_main(u,m,t,r);return h.concat([new ae.Diff(Ue,y)],_)}return t&&o.length>100&&e.length>100?this.diff_lineMode_(o,e,r):this.diff_bisect_(o,e,r)};ae.prototype.diff_lineMode_=function(o,e,t){var r=this.diff_linesToChars_(o,e);o=r.chars1,e=r.chars2;var s=r.lineArray,n=this.diff_main(o,e,!1,t);this.diff_charsToLines_(n,s),this.diff_cleanupSemantic(n),n.push(new ae.Diff(Ue,""));for(var a=0,i=0,l=0,f="",u="";a<n.length;){switch(n[a][0]){case st:l++,u+=n[a][1];break;case rt:i++,f+=n[a][1];break;case Ue:if(i>=1&&l>=1){n.splice(a-i-l,i+l),a=a-i-l;for(var d=this.diff_main(f,u,!1,t),m=d.length-1;m>=0;m--)n.splice(a,0,d[m]);a=a+d.length}l=0,i=0,f="",u="";break}a++}return n.pop(),n};ae.prototype.diff_bisect_=function(o,e,t){for(var r=o.length,s=e.length,n=Math.ceil((r+s)/2),a=n,i=2*n,l=new Array(i),f=new Array(i),u=0;u<i;u++)l[u]=-1,f[u]=-1;l[a+1]=0,f[a+1]=0;for(var d=r-s,m=d%2!=0,y=0,h=0,_=0,w=0,v=0;v<n&&!(new Date().getTime()>t);v++){for(var M=-v+y;M<=v-h;M+=2){var O=a+M,A;M==-v||M!=v&&l[O-1]<l[O+1]?A=l[O+1]:A=l[O-1]+1;for(var E=A-M;A<r&&E<s&&o.charAt(A)==e.charAt(E);)A++,E++;if(l[O]=A,A>r)h+=2;else if(E>s)y+=2;else if(m){var R=a+d-M;if(R>=0&&R<i&&f[R]!=-1){var F=r-f[R];if(A>=F)return this.diff_bisectSplit_(o,e,A,E,t)}}}for(var D=-v+_;D<=v-w;D+=2){var R=a+D,F;D==-v||D!=v&&f[R-1]<f[R+1]?F=f[R+1]:F=f[R-1]+1;for(var B=F-D;F<r&&B<s&&o.charAt(r-F-1)==e.charAt(s-B-1);)F++,B++;if(f[R]=F,F>r)w+=2;else if(B>s)_+=2;else if(!m){var O=a+d-D;if(O>=0&&O<i&&l[O]!=-1){var A=l[O],E=a+A-O;if(F=r-F,A>=F)return this.diff_bisectSplit_(o,e,A,E,t)}}}}return[new ae.Diff(rt,o),new ae.Diff(st,e)]};ae.prototype.diff_bisectSplit_=function(o,e,t,r,s){var n=o.substring(0,t),a=e.substring(0,r),i=o.substring(t),l=e.substring(r),f=this.diff_main(n,a,!1,s),u=this.diff_main(i,l,!1,s);return f.concat(u)};ae.prototype.diff_linesToChars_=function(o,e){var t=[],r={};t[0]="";function s(l){for(var f="",u=0,d=-1,m=t.length;d<l.length-1;){d=l.indexOf(`
`,u),d==-1&&(d=l.length-1);var y=l.substring(u,d+1);(r.hasOwnProperty?r.hasOwnProperty(y):r[y]!==void 0)?f+=String.fromCharCode(r[y]):(m==n&&(y=l.substring(u),d=l.length),f+=String.fromCharCode(m),r[y]=m,t[m++]=y),u=d+1}return f}var n=4e4,a=s(o);n=65535;var i=s(e);return{chars1:a,chars2:i,lineArray:t}};ae.prototype.diff_charsToLines_=function(o,e){for(var t=0;t<o.length;t++){for(var r=o[t][1],s=[],n=0;n<r.length;n++)s[n]=e[r.charCodeAt(n)];o[t][1]=s.join("")}};ae.prototype.diff_commonPrefix=function(o,e){if(!o||!e||o.charAt(0)!=e.charAt(0))return 0;for(var t=0,r=Math.min(o.length,e.length),s=r,n=0;t<s;)o.substring(n,s)==e.substring(n,s)?(t=s,n=t):r=s,s=Math.floor((r-t)/2+t);return s};ae.prototype.diff_commonSuffix=function(o,e){if(!o||!e||o.charAt(o.length-1)!=e.charAt(e.length-1))return 0;for(var t=0,r=Math.min(o.length,e.length),s=r,n=0;t<s;)o.substring(o.length-s,o.length-n)==e.substring(e.length-s,e.length-n)?(t=s,n=t):r=s,s=Math.floor((r-t)/2+t);return s};ae.prototype.diff_commonOverlap_=function(o,e){var t=o.length,r=e.length;if(t==0||r==0)return 0;t>r?o=o.substring(t-r):t<r&&(e=e.substring(0,t));var s=Math.min(t,r);if(o==e)return s;for(var n=0,a=1;;){var i=o.substring(s-a),l=e.indexOf(i);if(l==-1)return n;a+=l,(l==0||o.substring(s-a)==e.substring(0,a))&&(n=a,a++)}};ae.prototype.diff_halfMatch_=function(o,e){if(this.Diff_Timeout<=0)return null;var t=o.length>e.length?o:e,r=o.length>e.length?e:o;if(t.length<4||r.length*2<t.length)return null;var s=this;function n(h,_,w){for(var v=h.substring(w,w+Math.floor(h.length/4)),M=-1,O="",A,E,R,F;(M=_.indexOf(v,M+1))!=-1;){var D=s.diff_commonPrefix(h.substring(w),_.substring(M)),B=s.diff_commonSuffix(h.substring(0,w),_.substring(0,M));O.length<B+D&&(O=_.substring(M-B,M)+_.substring(M,M+D),A=h.substring(0,w-B),E=h.substring(w+D),R=_.substring(0,M-B),F=_.substring(M+D))}return O.length*2>=h.length?[A,E,R,F,O]:null}var a=n(t,r,Math.ceil(t.length/4)),i=n(t,r,Math.ceil(t.length/2)),l;if(!a&&!i)return null;i?a?l=a[4].length>i[4].length?a:i:l=i:l=a;var f,u,d,m;o.length>e.length?(f=l[0],u=l[1],d=l[2],m=l[3]):(d=l[0],m=l[1],f=l[2],u=l[3]);var y=l[4];return[f,u,d,m,y]};ae.prototype.diff_cleanupSemantic=function(o){for(var e=!1,t=[],r=0,s=null,n=0,a=0,i=0,l=0,f=0;n<o.length;)o[n][0]==Ue?(t[r++]=n,a=l,i=f,l=0,f=0,s=o[n][1]):(o[n][0]==st?l+=o[n][1].length:f+=o[n][1].length,s&&s.length<=Math.max(a,i)&&s.length<=Math.max(l,f)&&(o.splice(t[r-1],0,new ae.Diff(rt,s)),o[t[r-1]+1][0]=st,r--,r--,n=r>0?t[r-1]:-1,a=0,i=0,l=0,f=0,s=null,e=!0)),n++;for(e&&this.diff_cleanupMerge(o),this.diff_cleanupSemanticLossless(o),n=1;n<o.length;){if(o[n-1][0]==rt&&o[n][0]==st){var u=o[n-1][1],d=o[n][1],m=this.diff_commonOverlap_(u,d),y=this.diff_commonOverlap_(d,u);m>=y?(m>=u.length/2||m>=d.length/2)&&(o.splice(n,0,new ae.Diff(Ue,d.substring(0,m))),o[n-1][1]=u.substring(0,u.length-m),o[n+1][1]=d.substring(m),n++):(y>=u.length/2||y>=d.length/2)&&(o.splice(n,0,new ae.Diff(Ue,u.substring(0,y))),o[n-1][0]=st,o[n-1][1]=d.substring(0,d.length-y),o[n+1][0]=rt,o[n+1][1]=u.substring(y),n++),n++}n++}};ae.prototype.diff_cleanupSemanticLossless=function(o){function e(y,h){if(!y||!h)return 6;var _=y.charAt(y.length-1),w=h.charAt(0),v=_.match(ae.nonAlphaNumericRegex_),M=w.match(ae.nonAlphaNumericRegex_),O=v&&_.match(ae.whitespaceRegex_),A=M&&w.match(ae.whitespaceRegex_),E=O&&_.match(ae.linebreakRegex_),R=A&&w.match(ae.linebreakRegex_),F=E&&y.match(ae.blanklineEndRegex_),D=R&&h.match(ae.blanklineStartRegex_);return F||D?5:E||R?4:v&&!O&&A?3:O||A?2:v||M?1:0}for(var t=1;t<o.length-1;){if(o[t-1][0]==Ue&&o[t+1][0]==Ue){var r=o[t-1][1],s=o[t][1],n=o[t+1][1],a=this.diff_commonSuffix(r,s);if(a){var i=s.substring(s.length-a);r=r.substring(0,r.length-a),s=i+s.substring(0,s.length-a),n=i+n}for(var l=r,f=s,u=n,d=e(r,s)+e(s,n);s.charAt(0)===n.charAt(0);){r+=s.charAt(0),s=s.substring(1)+n.charAt(0),n=n.substring(1);var m=e(r,s)+e(s,n);m>=d&&(d=m,l=r,f=s,u=n)}o[t-1][1]!=l&&(l?o[t-1][1]=l:(o.splice(t-1,1),t--),o[t][1]=f,u?o[t+1][1]=u:(o.splice(t+1,1),t--))}t++}};ae.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/;ae.whitespaceRegex_=/\s/;ae.linebreakRegex_=/[\r\n]/;ae.blanklineEndRegex_=/\n\r?\n$/;ae.blanklineStartRegex_=/^\r?\n\r?\n/;ae.prototype.diff_cleanupEfficiency=function(o){for(var e=!1,t=[],r=0,s=null,n=0,a=!1,i=!1,l=!1,f=!1;n<o.length;)o[n][0]==Ue?(o[n][1].length<this.Diff_EditCost&&(l||f)?(t[r++]=n,a=l,i=f,s=o[n][1]):(r=0,s=null),l=f=!1):(o[n][0]==rt?f=!0:l=!0,s&&(a&&i&&l&&f||s.length<this.Diff_EditCost/2&&a+i+l+f==3)&&(o.splice(t[r-1],0,new ae.Diff(rt,s)),o[t[r-1]+1][0]=st,r--,s=null,a&&i?(l=f=!0,r=0):(r--,n=r>0?t[r-1]:-1,l=f=!1),e=!0)),n++;e&&this.diff_cleanupMerge(o)};ae.prototype.diff_cleanupMerge=function(o){o.push(new ae.Diff(Ue,""));for(var e=0,t=0,r=0,s="",n="",a;e<o.length;)switch(o[e][0]){case st:r++,n+=o[e][1],e++;break;case rt:t++,s+=o[e][1],e++;break;case Ue:t+r>1?(t!==0&&r!==0&&(a=this.diff_commonPrefix(n,s),a!==0&&(e-t-r>0&&o[e-t-r-1][0]==Ue?o[e-t-r-1][1]+=n.substring(0,a):(o.splice(0,0,new ae.Diff(Ue,n.substring(0,a))),e++),n=n.substring(a),s=s.substring(a)),a=this.diff_commonSuffix(n,s),a!==0&&(o[e][1]=n.substring(n.length-a)+o[e][1],n=n.substring(0,n.length-a),s=s.substring(0,s.length-a))),e-=t+r,o.splice(e,t+r),s.length&&(o.splice(e,0,new ae.Diff(rt,s)),e++),n.length&&(o.splice(e,0,new ae.Diff(st,n)),e++),e++):e!==0&&o[e-1][0]==Ue?(o[e-1][1]+=o[e][1],o.splice(e,1)):e++,r=0,t=0,s="",n="";break}o[o.length-1][1]===""&&o.pop();var i=!1;for(e=1;e<o.length-1;)o[e-1][0]==Ue&&o[e+1][0]==Ue&&(o[e][1].substring(o[e][1].length-o[e-1][1].length)==o[e-1][1]?(o[e][1]=o[e-1][1]+o[e][1].substring(0,o[e][1].length-o[e-1][1].length),o[e+1][1]=o[e-1][1]+o[e+1][1],o.splice(e-1,1),i=!0):o[e][1].substring(0,o[e+1][1].length)==o[e+1][1]&&(o[e-1][1]+=o[e+1][1],o[e][1]=o[e][1].substring(o[e+1][1].length)+o[e+1][1],o.splice(e+1,1),i=!0)),e++;i&&this.diff_cleanupMerge(o)};ae.prototype.diff_xIndex=function(o,e){var t=0,r=0,s=0,n=0,a;for(a=0;a<o.length&&(o[a][0]!==st&&(t+=o[a][1].length),o[a][0]!==rt&&(r+=o[a][1].length),!(t>e));a++)s=t,n=r;return o.length!=a&&o[a][0]===rt?n:n+(e-s)};ae.prototype.diff_prettyHtml=function(o){for(var e=[],t=/&/g,r=/</g,s=/>/g,n=/\n/g,a=0;a<o.length;a++){var i=o[a][0],l=o[a][1],f=l.replace(t,"&amp;").replace(r,"&lt;").replace(s,"&gt;").replace(n,"&para;<br>");switch(i){case st:e[a]='<ins style="background:#e6ffe6;">'+f+"</ins>";break;case rt:e[a]='<del style="background:#ffe6e6;">'+f+"</del>";break;case Ue:e[a]="<span>"+f+"</span>";break}}return e.join("")};ae.prototype.diff_text1=function(o){for(var e=[],t=0;t<o.length;t++)o[t][0]!==st&&(e[t]=o[t][1]);return e.join("")};ae.prototype.diff_text2=function(o){for(var e=[],t=0;t<o.length;t++)o[t][0]!==rt&&(e[t]=o[t][1]);return e.join("")};ae.prototype.diff_levenshtein=function(o){for(var e=0,t=0,r=0,s=0;s<o.length;s++){var n=o[s][0],a=o[s][1];switch(n){case st:t+=a.length;break;case rt:r+=a.length;break;case Ue:e+=Math.max(t,r),t=0,r=0;break}}return e+=Math.max(t,r),e};ae.prototype.diff_toDelta=function(o){for(var e=[],t=0;t<o.length;t++)switch(o[t][0]){case st:e[t]="+"+encodeURI(o[t][1]);break;case rt:e[t]="-"+o[t][1].length;break;case Ue:e[t]="="+o[t][1].length;break}return e.join("	").replace(/%20/g," ")};ae.prototype.diff_fromDelta=function(o,e){for(var t=[],r=0,s=0,n=e.split(/\t/g),a=0;a<n.length;a++){var i=n[a].substring(1);switch(n[a].charAt(0)){case"+":try{t[r++]=new ae.Diff(st,decodeURI(i))}catch(u){throw new Error("Illegal escape in diff_fromDelta: "+i)}break;case"-":case"=":var l=parseInt(i,10);if(isNaN(l)||l<0)throw new Error("Invalid number in diff_fromDelta: "+i);var f=o.substring(s,s+=l);n[a].charAt(0)=="="?t[r++]=new ae.Diff(Ue,f):t[r++]=new ae.Diff(rt,f);break;default:if(n[a])throw new Error("Invalid diff operation in diff_fromDelta: "+n[a])}}if(s!=o.length)throw new Error("Delta length ("+s+") does not equal source text length ("+o.length+").");return t};ae.prototype.match_main=function(o,e,t){if(o==null||e==null||t==null)throw new Error("Null input. (match_main)");return t=Math.max(0,Math.min(t,o.length)),o==e?0:o.length?o.substring(t,t+e.length)==e?t:this.match_bitap_(o,e,t):-1};ae.prototype.match_bitap_=function(o,e,t){if(e.length>this.Match_MaxBits)throw new Error("Pattern too long for this browser.");var r=this.match_alphabet_(e),s=this;function n(A,E){var R=A/e.length,F=Math.abs(t-E);return s.Match_Distance?R+F/s.Match_Distance:F?1:R}var a=this.Match_Threshold,i=o.indexOf(e,t);i!=-1&&(a=Math.min(n(0,i),a),i=o.lastIndexOf(e,t+e.length),i!=-1&&(a=Math.min(n(0,i),a)));var l=1<<e.length-1;i=-1;for(var f,u,d=e.length+o.length,m,y=0;y<e.length;y++){for(f=0,u=d;f<u;)n(y,t+u)<=a?f=u:d=u,u=Math.floor((d-f)/2+f);d=u;var h=Math.max(1,t-u+1),_=Math.min(t+u,o.length)+e.length,w=Array(_+2);w[_+1]=(1<<y)-1;for(var v=_;v>=h;v--){var M=r[o.charAt(v-1)];if(y===0?w[v]=(w[v+1]<<1|1)&M:w[v]=(w[v+1]<<1|1)&M|((m[v+1]|m[v])<<1|1)|m[v+1],w[v]&l){var O=n(y,v-1);if(O<=a)if(a=O,i=v-1,i>t)h=Math.max(1,2*t-i);else break}}if(n(y+1,t)>a)break;m=w}return i};ae.prototype.match_alphabet_=function(o){for(var e={},t=0;t<o.length;t++)e[o.charAt(t)]=0;for(var t=0;t<o.length;t++)e[o.charAt(t)]|=1<<o.length-t-1;return e};ae.prototype.patch_addContext_=function(o,e){if(e.length!=0){if(o.start2===null)throw Error("patch not initialized");for(var t=e.substring(o.start2,o.start2+o.length1),r=0;e.indexOf(t)!=e.lastIndexOf(t)&&t.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)r+=this.Patch_Margin,t=e.substring(o.start2-r,o.start2+o.length1+r);r+=this.Patch_Margin;var s=e.substring(o.start2-r,o.start2);s&&o.diffs.unshift(new ae.Diff(Ue,s));var n=e.substring(o.start2+o.length1,o.start2+o.length1+r);n&&o.diffs.push(new ae.Diff(Ue,n)),o.start1-=s.length,o.start2-=s.length,o.length1+=s.length+n.length,o.length2+=s.length+n.length}};ae.prototype.patch_make=function(o,e,t){var r,s;if(typeof o=="string"&&typeof e=="string"&&typeof t=="undefined")r=o,s=this.diff_main(r,e,!0),s.length>2&&(this.diff_cleanupSemantic(s),this.diff_cleanupEfficiency(s));else if(o&&typeof o=="object"&&typeof e=="undefined"&&typeof t=="undefined")s=o,r=this.diff_text1(s);else if(typeof o=="string"&&e&&typeof e=="object"&&typeof t=="undefined")r=o,s=e;else if(typeof o=="string"&&typeof e=="string"&&t&&typeof t=="object")r=o,s=t;else throw new Error("Unknown call format to patch_make.");if(s.length===0)return[];for(var n=[],a=new ae.patch_obj,i=0,l=0,f=0,u=r,d=r,m=0;m<s.length;m++){var y=s[m][0],h=s[m][1];switch(!i&&y!==Ue&&(a.start1=l,a.start2=f),y){case st:a.diffs[i++]=s[m],a.length2+=h.length,d=d.substring(0,f)+h+d.substring(f);break;case rt:a.length1+=h.length,a.diffs[i++]=s[m],d=d.substring(0,f)+d.substring(f+h.length);break;case Ue:h.length<=2*this.Patch_Margin&&i&&s.length!=m+1?(a.diffs[i++]=s[m],a.length1+=h.length,a.length2+=h.length):h.length>=2*this.Patch_Margin&&i&&(this.patch_addContext_(a,u),n.push(a),a=new ae.patch_obj,i=0,u=d,l=f);break}y!==st&&(l+=h.length),y!==rt&&(f+=h.length)}return i&&(this.patch_addContext_(a,u),n.push(a)),n};ae.prototype.patch_deepCopy=function(o){for(var e=[],t=0;t<o.length;t++){var r=o[t],s=new ae.patch_obj;s.diffs=[];for(var n=0;n<r.diffs.length;n++)s.diffs[n]=new ae.Diff(r.diffs[n][0],r.diffs[n][1]);s.start1=r.start1,s.start2=r.start2,s.length1=r.length1,s.length2=r.length2,e[t]=s}return e};ae.prototype.patch_apply=function(o,e){if(o.length==0)return[e,[]];o=this.patch_deepCopy(o);var t=this.patch_addPadding(o);e=t+e+t,this.patch_splitMax(o);for(var r=0,s=[],n=0;n<o.length;n++){var a=o[n].start2+r,i=this.diff_text1(o[n].diffs),l,f=-1;if(i.length>this.Match_MaxBits?(l=this.match_main(e,i.substring(0,this.Match_MaxBits),a),l!=-1&&(f=this.match_main(e,i.substring(i.length-this.Match_MaxBits),a+i.length-this.Match_MaxBits),(f==-1||l>=f)&&(l=-1))):l=this.match_main(e,i,a),l==-1)s[n]=!1,r-=o[n].length2-o[n].length1;else{s[n]=!0,r=l-a;var u;if(f==-1?u=e.substring(l,l+i.length):u=e.substring(l,f+this.Match_MaxBits),i==u)e=e.substring(0,l)+this.diff_text2(o[n].diffs)+e.substring(l+i.length);else{var d=this.diff_main(i,u,!1);if(i.length>this.Match_MaxBits&&this.diff_levenshtein(d)/i.length>this.Patch_DeleteThreshold)s[n]=!1;else{this.diff_cleanupSemanticLossless(d);for(var m=0,y,h=0;h<o[n].diffs.length;h++){var _=o[n].diffs[h];_[0]!==Ue&&(y=this.diff_xIndex(d,m)),_[0]===st?e=e.substring(0,l+y)+_[1]+e.substring(l+y):_[0]===rt&&(e=e.substring(0,l+y)+e.substring(l+this.diff_xIndex(d,m+_[1].length))),_[0]!==rt&&(m+=_[1].length)}}}}}return e=e.substring(t.length,e.length-t.length),[e,s]};ae.prototype.patch_addPadding=function(o){for(var e=this.Patch_Margin,t="",r=1;r<=e;r++)t+=String.fromCharCode(r);for(var r=0;r<o.length;r++)o[r].start1+=e,o[r].start2+=e;var s=o[0],n=s.diffs;if(n.length==0||n[0][0]!=Ue)n.unshift(new ae.Diff(Ue,t)),s.start1-=e,s.start2-=e,s.length1+=e,s.length2+=e;else if(e>n[0][1].length){var a=e-n[0][1].length;n[0][1]=t.substring(n[0][1].length)+n[0][1],s.start1-=a,s.start2-=a,s.length1+=a,s.length2+=a}if(s=o[o.length-1],n=s.diffs,n.length==0||n[n.length-1][0]!=Ue)n.push(new ae.Diff(Ue,t)),s.length1+=e,s.length2+=e;else if(e>n[n.length-1][1].length){var a=e-n[n.length-1][1].length;n[n.length-1][1]+=t.substring(0,a),s.length1+=a,s.length2+=a}return t};ae.prototype.patch_splitMax=function(o){for(var e=this.Match_MaxBits,t=0;t<o.length;t++)if(!(o[t].length1<=e)){var r=o[t];o.splice(t--,1);for(var s=r.start1,n=r.start2,a="";r.diffs.length!==0;){var i=new ae.patch_obj,l=!0;for(i.start1=s-a.length,i.start2=n-a.length,a!==""&&(i.length1=i.length2=a.length,i.diffs.push(new ae.Diff(Ue,a)));r.diffs.length!==0&&i.length1<e-this.Patch_Margin;){var f=r.diffs[0][0],u=r.diffs[0][1];f===st?(i.length2+=u.length,n+=u.length,i.diffs.push(r.diffs.shift()),l=!1):f===rt&&i.diffs.length==1&&i.diffs[0][0]==Ue&&u.length>2*e?(i.length1+=u.length,s+=u.length,l=!1,i.diffs.push(new ae.Diff(f,u)),r.diffs.shift()):(u=u.substring(0,e-i.length1-this.Patch_Margin),i.length1+=u.length,s+=u.length,f===Ue?(i.length2+=u.length,n+=u.length):l=!1,i.diffs.push(new ae.Diff(f,u)),u==r.diffs[0][1]?r.diffs.shift():r.diffs[0][1]=r.diffs[0][1].substring(u.length))}a=this.diff_text2(i.diffs),a=a.substring(a.length-this.Patch_Margin);var d=this.diff_text1(r.diffs).substring(0,this.Patch_Margin);d!==""&&(i.length1+=d.length,i.length2+=d.length,i.diffs.length!==0&&i.diffs[i.diffs.length-1][0]===Ue?i.diffs[i.diffs.length-1][1]+=d:i.diffs.push(new ae.Diff(Ue,d))),l||o.splice(++t,0,i)}}};ae.prototype.patch_toText=function(o){for(var e=[],t=0;t<o.length;t++)e[t]=o[t];return e.join("")};ae.prototype.patch_fromText=function(o){var e=[];if(!o)return e;for(var t=o.split(`
`),r=0,s=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;r<t.length;){var n=t[r].match(s);if(!n)throw new Error("Invalid patch string: "+t[r]);var a=new ae.patch_obj;for(e.push(a),a.start1=parseInt(n[1],10),n[2]===""?(a.start1--,a.length1=1):n[2]=="0"?a.length1=0:(a.start1--,a.length1=parseInt(n[2],10)),a.start2=parseInt(n[3],10),n[4]===""?(a.start2--,a.length2=1):n[4]=="0"?a.length2=0:(a.start2--,a.length2=parseInt(n[4],10)),r++;r<t.length;){var i=t[r].charAt(0);try{var l=decodeURI(t[r].substring(1))}catch(f){throw new Error("Illegal escape in patch_fromText: "+l)}if(i=="-")a.diffs.push(new ae.Diff(rt,l));else if(i=="+")a.diffs.push(new ae.Diff(st,l));else if(i==" ")a.diffs.push(new ae.Diff(Ue,l));else{if(i=="@")break;if(i!=="")throw new Error('Invalid patch mode "'+i+'" in: '+l)}r++}}return e};ae.patch_obj=function(){this.diffs=[],this.start1=null,this.start2=null,this.length1=0,this.length2=0};ae.patch_obj.prototype.toString=function(){var o,e;this.length1===0?o=this.start1+",0":this.length1==1?o=this.start1+1:o=this.start1+1+","+this.length1,this.length2===0?e=this.start2+",0":this.length2==1?e=this.start2+1:e=this.start2+1+","+this.length2;for(var t=["@@ -"+o+" +"+e+` @@
`],r,s=0;s<this.diffs.length;s++){switch(this.diffs[s][0]){case st:r="+";break;case rt:r="-";break;case Ue:r=" ";break}t[s+1]=r+encodeURI(this.diffs[s][1])+`
`}return t.join("").replace(/%20/g," ")};Gn.exports=ae;Gn.exports.diff_match_patch=ae;Gn.exports.DIFF_DELETE=rt;Gn.exports.DIFF_INSERT=st;Gn.exports.DIFF_EQUAL=Ue});var bb=$i(($p,ea)=>{(function(o,e){typeof $p=="object"&&typeof ea!="undefined"?ea.exports=e():typeof define=="function"&&define.amd?define(e):o.moment=e()})($p,function(){"use strict";var o;function e(){return o.apply(null,arguments)}function t(c){o=c}function r(c){return c instanceof Array||Object.prototype.toString.call(c)==="[object Array]"}function s(c){return c!=null&&Object.prototype.toString.call(c)==="[object Object]"}function n(c,p){return Object.prototype.hasOwnProperty.call(c,p)}function a(c){if(Object.getOwnPropertyNames)return Object.getOwnPropertyNames(c).length===0;var p;for(p in c)if(n(c,p))return!1;return!0}function i(c){return c===void 0}function l(c){return typeof c=="number"||Object.prototype.toString.call(c)==="[object Number]"}function f(c){return c instanceof Date||Object.prototype.toString.call(c)==="[object Date]"}function u(c,p){var g=[],x,k=c.length;for(x=0;x<k;++x)g.push(p(c[x],x));return g}function d(c,p){for(var g in p)n(p,g)&&(c[g]=p[g]);return n(p,"toString")&&(c.toString=p.toString),n(p,"valueOf")&&(c.valueOf=p.valueOf),c}function m(c,p,g,x){return Um(c,p,g,x,!0).utc()}function y(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidEra:null,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1,parsedDateParts:[],era:null,meridiem:null,rfc2822:!1,weekdayMismatch:!1}}function h(c){return c._pf==null&&(c._pf=y()),c._pf}var _;Array.prototype.some?_=Array.prototype.some:_=function(c){var p=Object(this),g=p.length>>>0,x;for(x=0;x<g;x++)if(x in p&&c.call(this,p[x],x,p))return!0;return!1};function w(c){if(c._isValid==null){var p=h(c),g=_.call(p.parsedDateParts,function(k){return k!=null}),x=!isNaN(c._d.getTime())&&p.overflow<0&&!p.empty&&!p.invalidEra&&!p.invalidMonth&&!p.invalidWeekday&&!p.weekdayMismatch&&!p.nullInput&&!p.invalidFormat&&!p.userInvalidated&&(!p.meridiem||p.meridiem&&g);if(c._strict&&(x=x&&p.charsLeftOver===0&&p.unusedTokens.length===0&&p.bigHour===void 0),Object.isFrozen==null||!Object.isFrozen(c))c._isValid=x;else return x}return c._isValid}function v(c){var p=m(NaN);return c!=null?d(h(p),c):h(p).userInvalidated=!0,p}var M=e.momentProperties=[],O=!1;function A(c,p){var g,x,k,U=M.length;if(i(p._isAMomentObject)||(c._isAMomentObject=p._isAMomentObject),i(p._i)||(c._i=p._i),i(p._f)||(c._f=p._f),i(p._l)||(c._l=p._l),i(p._strict)||(c._strict=p._strict),i(p._tzm)||(c._tzm=p._tzm),i(p._isUTC)||(c._isUTC=p._isUTC),i(p._offset)||(c._offset=p._offset),i(p._pf)||(c._pf=h(p)),i(p._locale)||(c._locale=p._locale),U>0)for(g=0;g<U;g++)x=M[g],k=p[x],i(k)||(c[x]=k);return c}function E(c){A(this,c),this._d=new Date(c._d!=null?c._d.getTime():NaN),this.isValid()||(this._d=new Date(NaN)),O===!1&&(O=!0,e.updateOffset(this),O=!1)}function R(c){return c instanceof E||c!=null&&c._isAMomentObject!=null}function F(c){e.suppressDeprecationWarnings===!1&&typeof console!="undefined"&&console.warn&&console.warn("Deprecation warning: "+c)}function D(c,p){var g=!0;return d(function(){if(e.deprecationHandler!=null&&e.deprecationHandler(null,c),g){var x=[],k,U,j,Ie=arguments.length;for(U=0;U<Ie;U++){if(k="",typeof arguments[U]=="object"){k+=`
[`+U+"] ";for(j in arguments[0])n(arguments[0],j)&&(k+=j+": "+arguments[0][j]+", ");k=k.slice(0,-2)}else k=arguments[U];x.push(k)}F(c+`
Arguments: `+Array.prototype.slice.call(x).join("")+`
`+new Error().stack),g=!1}return p.apply(this,arguments)},p)}var B={};function q(c,p){e.deprecationHandler!=null&&e.deprecationHandler(c,p),B[c]||(F(p),B[c]=!0)}e.suppressDeprecationWarnings=!1,e.deprecationHandler=null;function J(c){return typeof Function!="undefined"&&c instanceof Function||Object.prototype.toString.call(c)==="[object Function]"}function K(c){var p,g;for(g in c)n(c,g)&&(p=c[g],J(p)?this[g]=p:this["_"+g]=p);this._config=c,this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)}function z(c,p){var g=d({},c),x;for(x in p)n(p,x)&&(s(c[x])&&s(p[x])?(g[x]={},d(g[x],c[x]),d(g[x],p[x])):p[x]!=null?g[x]=p[x]:delete g[x]);for(x in c)n(c,x)&&!n(p,x)&&s(c[x])&&(g[x]=d({},g[x]));return g}function W(c){c!=null&&this.set(c)}var re;Object.keys?re=Object.keys:re=function(c){var p,g=[];for(p in c)n(c,p)&&g.push(p);return g};var Le={sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"};function le(c,p,g){var x=this._calendar[c]||this._calendar.sameElse;return J(x)?x.call(p,g):x}function Ce(c,p,g){var x=""+Math.abs(c),k=p-x.length,U=c>=0;return(U?g?"+":"":"-")+Math.pow(10,Math.max(0,k)).toString().substr(1)+x}var Ke=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,Re=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,de={},fe={};function oe(c,p,g,x){var k=x;typeof x=="string"&&(k=function(){return this[x]()}),c&&(fe[c]=k),p&&(fe[p[0]]=function(){return Ce(k.apply(this,arguments),p[1],p[2])}),g&&(fe[g]=function(){return this.localeData().ordinal(k.apply(this,arguments),c)})}function Be(c){return c.match(/\[[\s\S]/)?c.replace(/^\[|\]$/g,""):c.replace(/\\/g,"")}function At(c){var p=c.match(Ke),g,x;for(g=0,x=p.length;g<x;g++)fe[p[g]]?p[g]=fe[p[g]]:p[g]=Be(p[g]);return function(k){var U="",j;for(j=0;j<x;j++)U+=J(p[j])?p[j].call(k,c):p[j];return U}}function Ot(c,p){return c.isValid()?(p=Ut(p,c.localeData()),de[p]=de[p]||At(p),de[p](c)):c.localeData().invalidDate()}function Ut(c,p){var g=5;function x(k){return p.longDateFormat(k)||k}for(Re.lastIndex=0;g>=0&&Re.test(c);)c=c.replace(Re,x),Re.lastIndex=0,g-=1;return c}var gt={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"};function yt(c){var p=this._longDateFormat[c],g=this._longDateFormat[c.toUpperCase()];return p||!g?p:(this._longDateFormat[c]=g.match(Ke).map(function(x){return x==="MMMM"||x==="MM"||x==="DD"||x==="dddd"?x.slice(1):x}).join(""),this._longDateFormat[c])}var pt="Invalid date";function Gt(){return this._invalidDate}var ys="%d",Gs=/\d{1,2}/;function na(c){return this._ordinal.replace("%d",c)}var aa={future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",w:"a week",ww:"%d weeks",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function js(c,p,g,x){var k=this._relativeTime[g];return J(k)?k(c,p,g,x):k.replace(/%d/i,c)}function ia(c,p){var g=this._relativeTime[c>0?"future":"past"];return J(g)?g(p):g.replace(/%s/i,p)}var Ir={};function nt(c,p){var g=c.toLowerCase();Ir[g]=Ir[g+"s"]=Ir[p]=c}function Wt(c){return typeof c=="string"?Ir[c]||Ir[c.toLowerCase()]:void 0}function go(c){var p={},g,x;for(x in c)n(c,x)&&(g=Wt(x),g&&(p[g]=c[x]));return p}var xs={};function se(c,p){xs[c]=p}function ze(c){var p=[],g;for(g in c)n(c,g)&&p.push({unit:g,priority:xs[g]});return p.sort(function(x,k){return x.priority-k.priority}),p}function at(c){return c%4===0&&c%100!==0||c%400===0}function ot(c){return c<0?Math.ceil(c)||0:Math.floor(c)}function Me(c){var p=+c,g=0;return p!==0&&isFinite(p)&&(g=ot(p)),g}function Yr(c,p){return function(g){return g!=null?(bi(this,c,g),e.updateOffset(this,p),this):Jr(this,c)}}function Jr(c,p){return c.isValid()?c._d["get"+(c._isUTC?"UTC":"")+p]():NaN}function bi(c,p,g){c.isValid()&&!isNaN(g)&&(p==="FullYear"&&at(c.year())&&c.month()===1&&c.date()===29?(g=Me(g),c._d["set"+(c._isUTC?"UTC":"")+p](g,c.month(),Li(g,c.month()))):c._d["set"+(c._isUTC?"UTC":"")+p](g))}function Nc(c){return c=Wt(c),J(this[c])?this[c]():this}function Hc(c,p){if(typeof c=="object"){c=go(c);var g=ze(c),x,k=g.length;for(x=0;x<k;x++)this[g[x].unit](c[g[x].unit])}else if(c=Wt(c),J(this[c]))return this[c](p);return this}var wi=/\d/,jt=/\d\d/,_i=/\d{3}/,la=/\d{4}/,Y=/[+-]?\d{6}/,ue=/\d\d?/,it=/\d\d\d\d?/,yo=/\d\d\d\d\d\d?/,ar=/\d{1,3}/,Vc=/\d{1,4}/,vi=/[+-]?\d{1,6}/,Ys=/\d+/,Si=/[+-]?\d+/,R_=/Z|[+-]\d\d:?\d\d/gi,ki=/Z|[+-]\d\d(?::?\d\d)?/gi,O_=/[+-]?\d+(\.\d{1,3})?/,ca=/[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFF07\uFF10-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i,Ii;Ii={};function me(c,p,g){Ii[c]=J(p)?p:function(x,k){return x&&g?g:p}}function U_(c,p){return n(Ii,c)?Ii[c](p._strict,p._locale):new RegExp($_(c))}function $_(c){return hr(c.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(p,g,x,k,U){return g||x||k||U}))}function hr(c){return c.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}var qc={};function Qe(c,p){var g,x=p,k;for(typeof c=="string"&&(c=[c]),l(p)&&(x=function(U,j){j[p]=Me(U)}),k=c.length,g=0;g<k;g++)qc[c[g]]=x}function fa(c,p){Qe(c,function(g,x,k,U){k._w=k._w||{},p(g,k._w,k,U)})}function B_(c,p,g){p!=null&&n(qc,c)&&qc[c](p,g._a,g,c)}var zt=0,xo=1,Xr=2,It=3,Rr=4,bo=5,bs=6,N_=7,H_=8;function V_(c,p){return(c%p+p)%p}var wt;Array.prototype.indexOf?wt=Array.prototype.indexOf:wt=function(c){var p;for(p=0;p<this.length;++p)if(this[p]===c)return p;return-1};function Li(c,p){if(isNaN(c)||isNaN(p))return NaN;var g=V_(p,12);return c+=(p-g)/12,g===1?at(c)?29:28:31-g%7%2}oe("M",["MM",2],"Mo",function(){return this.month()+1}),oe("MMM",0,0,function(c){return this.localeData().monthsShort(this,c)}),oe("MMMM",0,0,function(c){return this.localeData().months(this,c)}),nt("month","M"),se("month",8),me("M",ue),me("MM",ue,jt),me("MMM",function(c,p){return p.monthsShortRegex(c)}),me("MMMM",function(c,p){return p.monthsRegex(c)}),Qe(["M","MM"],function(c,p){p[xo]=Me(c)-1}),Qe(["MMM","MMMM"],function(c,p,g,x){var k=g._locale.monthsParse(c,x,g._strict);k!=null?p[xo]=k:h(g).invalidMonth=c});var q_="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),vm="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),Sm=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/,W_=ca,z_=ca;function K_(c,p){return c?r(this._months)?this._months[c.month()]:this._months[(this._months.isFormat||Sm).test(p)?"format":"standalone"][c.month()]:r(this._months)?this._months:this._months.standalone}function G_(c,p){return c?r(this._monthsShort)?this._monthsShort[c.month()]:this._monthsShort[Sm.test(p)?"format":"standalone"][c.month()]:r(this._monthsShort)?this._monthsShort:this._monthsShort.standalone}function j_(c,p,g){var x,k,U,j=c.toLocaleLowerCase();if(!this._monthsParse)for(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[],x=0;x<12;++x)U=m([2e3,x]),this._shortMonthsParse[x]=this.monthsShort(U,"").toLocaleLowerCase(),this._longMonthsParse[x]=this.months(U,"").toLocaleLowerCase();return g?p==="MMM"?(k=wt.call(this._shortMonthsParse,j),k!==-1?k:null):(k=wt.call(this._longMonthsParse,j),k!==-1?k:null):p==="MMM"?(k=wt.call(this._shortMonthsParse,j),k!==-1?k:(k=wt.call(this._longMonthsParse,j),k!==-1?k:null)):(k=wt.call(this._longMonthsParse,j),k!==-1?k:(k=wt.call(this._shortMonthsParse,j),k!==-1?k:null))}function Y_(c,p,g){var x,k,U;if(this._monthsParseExact)return j_.call(this,c,p,g);for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),x=0;x<12;x++){if(k=m([2e3,x]),g&&!this._longMonthsParse[x]&&(this._longMonthsParse[x]=new RegExp("^"+this.months(k,"").replace(".","")+"$","i"),this._shortMonthsParse[x]=new RegExp("^"+this.monthsShort(k,"").replace(".","")+"$","i")),!g&&!this._monthsParse[x]&&(U="^"+this.months(k,"")+"|^"+this.monthsShort(k,""),this._monthsParse[x]=new RegExp(U.replace(".",""),"i")),g&&p==="MMMM"&&this._longMonthsParse[x].test(c))return x;if(g&&p==="MMM"&&this._shortMonthsParse[x].test(c))return x;if(!g&&this._monthsParse[x].test(c))return x}}function km(c,p){var g;if(!c.isValid())return c;if(typeof p=="string"){if(/^\d+$/.test(p))p=Me(p);else if(p=c.localeData().monthsParse(p),!l(p))return c}return g=Math.min(c.date(),Li(c.year(),p)),c._d["set"+(c._isUTC?"UTC":"")+"Month"](p,g),c}function Im(c){return c!=null?(km(this,c),e.updateOffset(this,!0),this):Jr(this,"Month")}function J_(){return Li(this.year(),this.month())}function X_(c){return this._monthsParseExact?(n(this,"_monthsRegex")||Lm.call(this),c?this._monthsShortStrictRegex:this._monthsShortRegex):(n(this,"_monthsShortRegex")||(this._monthsShortRegex=W_),this._monthsShortStrictRegex&&c?this._monthsShortStrictRegex:this._monthsShortRegex)}function Q_(c){return this._monthsParseExact?(n(this,"_monthsRegex")||Lm.call(this),c?this._monthsStrictRegex:this._monthsRegex):(n(this,"_monthsRegex")||(this._monthsRegex=z_),this._monthsStrictRegex&&c?this._monthsStrictRegex:this._monthsRegex)}function Lm(){function c(j,Ie){return Ie.length-j.length}var p=[],g=[],x=[],k,U;for(k=0;k<12;k++)U=m([2e3,k]),p.push(this.monthsShort(U,"")),g.push(this.months(U,"")),x.push(this.months(U,"")),x.push(this.monthsShort(U,""));for(p.sort(c),g.sort(c),x.sort(c),k=0;k<12;k++)p[k]=hr(p[k]),g[k]=hr(g[k]);for(k=0;k<24;k++)x[k]=hr(x[k]);this._monthsRegex=new RegExp("^("+x.join("|")+")","i"),this._monthsShortRegex=this._monthsRegex,this._monthsStrictRegex=new RegExp("^("+g.join("|")+")","i"),this._monthsShortStrictRegex=new RegExp("^("+p.join("|")+")","i")}oe("Y",0,0,function(){var c=this.year();return c<=9999?Ce(c,4):"+"+c}),oe(0,["YY",2],0,function(){return this.year()%100}),oe(0,["YYYY",4],0,"year"),oe(0,["YYYYY",5],0,"year"),oe(0,["YYYYYY",6,!0],0,"year"),nt("year","y"),se("year",1),me("Y",Si),me("YY",ue,jt),me("YYYY",Vc,la),me("YYYYY",vi,Y),me("YYYYYY",vi,Y),Qe(["YYYYY","YYYYYY"],zt),Qe("YYYY",function(c,p){p[zt]=c.length===2?e.parseTwoDigitYear(c):Me(c)}),Qe("YY",function(c,p){p[zt]=e.parseTwoDigitYear(c)}),Qe("Y",function(c,p){p[zt]=parseInt(c,10)});function ua(c){return at(c)?366:365}e.parseTwoDigitYear=function(c){return Me(c)+(Me(c)>68?1900:2e3)};var Cm=Yr("FullYear",!0);function Z_(){return at(this.year())}function ev(c,p,g,x,k,U,j){var Ie;return c<100&&c>=0?(Ie=new Date(c+400,p,g,x,k,U,j),isFinite(Ie.getFullYear())&&Ie.setFullYear(c)):Ie=new Date(c,p,g,x,k,U,j),Ie}function da(c){var p,g;return c<100&&c>=0?(g=Array.prototype.slice.call(arguments),g[0]=c+400,p=new Date(Date.UTC.apply(null,g)),isFinite(p.getUTCFullYear())&&p.setUTCFullYear(c)):p=new Date(Date.UTC.apply(null,arguments)),p}function Ci(c,p,g){var x=7+p-g,k=(7+da(c,0,x).getUTCDay()-p)%7;return-k+x-1}function Tm(c,p,g,x,k){var U=(7+g-x)%7,j=Ci(c,x,k),Ie=1+7*(p-1)+U+j,Ne,Ze;return Ie<=0?(Ne=c-1,Ze=ua(Ne)+Ie):Ie>ua(c)?(Ne=c+1,Ze=Ie-ua(c)):(Ne=c,Ze=Ie),{year:Ne,dayOfYear:Ze}}function pa(c,p,g){var x=Ci(c.year(),p,g),k=Math.floor((c.dayOfYear()-x-1)/7)+1,U,j;return k<1?(j=c.year()-1,U=k+wo(j,p,g)):k>wo(c.year(),p,g)?(U=k-wo(c.year(),p,g),j=c.year()+1):(j=c.year(),U=k),{week:U,year:j}}function wo(c,p,g){var x=Ci(c,p,g),k=Ci(c+1,p,g);return(ua(c)-x+k)/7}oe("w",["ww",2],"wo","week"),oe("W",["WW",2],"Wo","isoWeek"),nt("week","w"),nt("isoWeek","W"),se("week",5),se("isoWeek",5),me("w",ue),me("ww",ue,jt),me("W",ue),me("WW",ue,jt),fa(["w","ww","W","WW"],function(c,p,g,x){p[x.substr(0,1)]=Me(c)});function tv(c){return pa(c,this._week.dow,this._week.doy).week}var rv={dow:0,doy:6};function ov(){return this._week.dow}function sv(){return this._week.doy}function nv(c){var p=this.localeData().week(this);return c==null?p:this.add((c-p)*7,"d")}function av(c){var p=pa(this,1,4).week;return c==null?p:this.add((c-p)*7,"d")}oe("d",0,"do","day"),oe("dd",0,0,function(c){return this.localeData().weekdaysMin(this,c)}),oe("ddd",0,0,function(c){return this.localeData().weekdaysShort(this,c)}),oe("dddd",0,0,function(c){return this.localeData().weekdays(this,c)}),oe("e",0,0,"weekday"),oe("E",0,0,"isoWeekday"),nt("day","d"),nt("weekday","e"),nt("isoWeekday","E"),se("day",11),se("weekday",11),se("isoWeekday",11),me("d",ue),me("e",ue),me("E",ue),me("dd",function(c,p){return p.weekdaysMinRegex(c)}),me("ddd",function(c,p){return p.weekdaysShortRegex(c)}),me("dddd",function(c,p){return p.weekdaysRegex(c)}),fa(["dd","ddd","dddd"],function(c,p,g,x){var k=g._locale.weekdaysParse(c,x,g._strict);k!=null?p.d=k:h(g).invalidWeekday=c}),fa(["d","e","E"],function(c,p,g,x){p[x]=Me(c)});function iv(c,p){return typeof c!="string"?c:isNaN(c)?(c=p.weekdaysParse(c),typeof c=="number"?c:null):parseInt(c,10)}function lv(c,p){return typeof c=="string"?p.weekdaysParse(c)%7||7:isNaN(c)?null:c}function Wc(c,p){return c.slice(p,7).concat(c.slice(0,p))}var cv="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),Pm="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),fv="Su_Mo_Tu_We_Th_Fr_Sa".split("_"),uv=ca,dv=ca,pv=ca;function mv(c,p){var g=r(this._weekdays)?this._weekdays:this._weekdays[c&&c!==!0&&this._weekdays.isFormat.test(p)?"format":"standalone"];return c===!0?Wc(g,this._week.dow):c?g[c.day()]:g}function hv(c){return c===!0?Wc(this._weekdaysShort,this._week.dow):c?this._weekdaysShort[c.day()]:this._weekdaysShort}function gv(c){return c===!0?Wc(this._weekdaysMin,this._week.dow):c?this._weekdaysMin[c.day()]:this._weekdaysMin}function yv(c,p,g){var x,k,U,j=c.toLocaleLowerCase();if(!this._weekdaysParse)for(this._weekdaysParse=[],this._shortWeekdaysParse=[],this._minWeekdaysParse=[],x=0;x<7;++x)U=m([2e3,1]).day(x),this._minWeekdaysParse[x]=this.weekdaysMin(U,"").toLocaleLowerCase(),this._shortWeekdaysParse[x]=this.weekdaysShort(U,"").toLocaleLowerCase(),this._weekdaysParse[x]=this.weekdays(U,"").toLocaleLowerCase();return g?p==="dddd"?(k=wt.call(this._weekdaysParse,j),k!==-1?k:null):p==="ddd"?(k=wt.call(this._shortWeekdaysParse,j),k!==-1?k:null):(k=wt.call(this._minWeekdaysParse,j),k!==-1?k:null):p==="dddd"?(k=wt.call(this._weekdaysParse,j),k!==-1||(k=wt.call(this._shortWeekdaysParse,j),k!==-1)?k:(k=wt.call(this._minWeekdaysParse,j),k!==-1?k:null)):p==="ddd"?(k=wt.call(this._shortWeekdaysParse,j),k!==-1||(k=wt.call(this._weekdaysParse,j),k!==-1)?k:(k=wt.call(this._minWeekdaysParse,j),k!==-1?k:null)):(k=wt.call(this._minWeekdaysParse,j),k!==-1||(k=wt.call(this._weekdaysParse,j),k!==-1)?k:(k=wt.call(this._shortWeekdaysParse,j),k!==-1?k:null))}function xv(c,p,g){var x,k,U;if(this._weekdaysParseExact)return yv.call(this,c,p,g);for(this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]),x=0;x<7;x++){if(k=m([2e3,1]).day(x),g&&!this._fullWeekdaysParse[x]&&(this._fullWeekdaysParse[x]=new RegExp("^"+this.weekdays(k,"").replace(".","\\.?")+"$","i"),this._shortWeekdaysParse[x]=new RegExp("^"+this.weekdaysShort(k,"").replace(".","\\.?")+"$","i"),this._minWeekdaysParse[x]=new RegExp("^"+this.weekdaysMin(k,"").replace(".","\\.?")+"$","i")),this._weekdaysParse[x]||(U="^"+this.weekdays(k,"")+"|^"+this.weekdaysShort(k,"")+"|^"+this.weekdaysMin(k,""),this._weekdaysParse[x]=new RegExp(U.replace(".",""),"i")),g&&p==="dddd"&&this._fullWeekdaysParse[x].test(c))return x;if(g&&p==="ddd"&&this._shortWeekdaysParse[x].test(c))return x;if(g&&p==="dd"&&this._minWeekdaysParse[x].test(c))return x;if(!g&&this._weekdaysParse[x].test(c))return x}}function bv(c){if(!this.isValid())return c!=null?this:NaN;var p=this._isUTC?this._d.getUTCDay():this._d.getDay();return c!=null?(c=iv(c,this.localeData()),this.add(c-p,"d")):p}function wv(c){if(!this.isValid())return c!=null?this:NaN;var p=(this.day()+7-this.localeData()._week.dow)%7;return c==null?p:this.add(c-p,"d")}function _v(c){if(!this.isValid())return c!=null?this:NaN;if(c!=null){var p=lv(c,this.localeData());return this.day(this.day()%7?p:p-7)}else return this.day()||7}function vv(c){return this._weekdaysParseExact?(n(this,"_weekdaysRegex")||zc.call(this),c?this._weekdaysStrictRegex:this._weekdaysRegex):(n(this,"_weekdaysRegex")||(this._weekdaysRegex=uv),this._weekdaysStrictRegex&&c?this._weekdaysStrictRegex:this._weekdaysRegex)}function Sv(c){return this._weekdaysParseExact?(n(this,"_weekdaysRegex")||zc.call(this),c?this._weekdaysShortStrictRegex:this._weekdaysShortRegex):(n(this,"_weekdaysShortRegex")||(this._weekdaysShortRegex=dv),this._weekdaysShortStrictRegex&&c?this._weekdaysShortStrictRegex:this._weekdaysShortRegex)}function kv(c){return this._weekdaysParseExact?(n(this,"_weekdaysRegex")||zc.call(this),c?this._weekdaysMinStrictRegex:this._weekdaysMinRegex):(n(this,"_weekdaysMinRegex")||(this._weekdaysMinRegex=pv),this._weekdaysMinStrictRegex&&c?this._weekdaysMinStrictRegex:this._weekdaysMinRegex)}function zc(){function c(Yt,Io){return Io.length-Yt.length}var p=[],g=[],x=[],k=[],U,j,Ie,Ne,Ze;for(U=0;U<7;U++)j=m([2e3,1]).day(U),Ie=hr(this.weekdaysMin(j,"")),Ne=hr(this.weekdaysShort(j,"")),Ze=hr(this.weekdays(j,"")),p.push(Ie),g.push(Ne),x.push(Ze),k.push(Ie),k.push(Ne),k.push(Ze);p.sort(c),g.sort(c),x.sort(c),k.sort(c),this._weekdaysRegex=new RegExp("^("+k.join("|")+")","i"),this._weekdaysShortRegex=this._weekdaysRegex,this._weekdaysMinRegex=this._weekdaysRegex,this._weekdaysStrictRegex=new RegExp("^("+x.join("|")+")","i"),this._weekdaysShortStrictRegex=new RegExp("^("+g.join("|")+")","i"),this._weekdaysMinStrictRegex=new RegExp("^("+p.join("|")+")","i")}function Kc(){return this.hours()%12||12}function Iv(){return this.hours()||24}oe("H",["HH",2],0,"hour"),oe("h",["hh",2],0,Kc),oe("k",["kk",2],0,Iv),oe("hmm",0,0,function(){return""+Kc.apply(this)+Ce(this.minutes(),2)}),oe("hmmss",0,0,function(){return""+Kc.apply(this)+Ce(this.minutes(),2)+Ce(this.seconds(),2)}),oe("Hmm",0,0,function(){return""+this.hours()+Ce(this.minutes(),2)}),oe("Hmmss",0,0,function(){return""+this.hours()+Ce(this.minutes(),2)+Ce(this.seconds(),2)});function Am(c,p){oe(c,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),p)})}Am("a",!0),Am("A",!1),nt("hour","h"),se("hour",13);function Fm(c,p){return p._meridiemParse}me("a",Fm),me("A",Fm),me("H",ue),me("h",ue),me("k",ue),me("HH",ue,jt),me("hh",ue,jt),me("kk",ue,jt),me("hmm",it),me("hmmss",yo),me("Hmm",it),me("Hmmss",yo),Qe(["H","HH"],It),Qe(["k","kk"],function(c,p,g){var x=Me(c);p[It]=x===24?0:x}),Qe(["a","A"],function(c,p,g){g._isPm=g._locale.isPM(c),g._meridiem=c}),Qe(["h","hh"],function(c,p,g){p[It]=Me(c),h(g).bigHour=!0}),Qe("hmm",function(c,p,g){var x=c.length-2;p[It]=Me(c.substr(0,x)),p[Rr]=Me(c.substr(x)),h(g).bigHour=!0}),Qe("hmmss",function(c,p,g){var x=c.length-4,k=c.length-2;p[It]=Me(c.substr(0,x)),p[Rr]=Me(c.substr(x,2)),p[bo]=Me(c.substr(k)),h(g).bigHour=!0}),Qe("Hmm",function(c,p,g){var x=c.length-2;p[It]=Me(c.substr(0,x)),p[Rr]=Me(c.substr(x))}),Qe("Hmmss",function(c,p,g){var x=c.length-4,k=c.length-2;p[It]=Me(c.substr(0,x)),p[Rr]=Me(c.substr(x,2)),p[bo]=Me(c.substr(k))});function Lv(c){return(c+"").toLowerCase().charAt(0)==="p"}var Cv=/[ap]\.?m?\.?/i,Tv=Yr("Hours",!0);function Pv(c,p,g){return c>11?g?"pm":"PM":g?"am":"AM"}var Dm={calendar:Le,longDateFormat:gt,invalidDate:pt,ordinal:ys,dayOfMonthOrdinalParse:Gs,relativeTime:aa,months:q_,monthsShort:vm,week:rv,weekdays:cv,weekdaysMin:fv,weekdaysShort:Pm,meridiemParse:Cv},ft={},ma={},ha;function Av(c,p){var g,x=Math.min(c.length,p.length);for(g=0;g<x;g+=1)if(c[g]!==p[g])return g;return x}function Mm(c){return c&&c.toLowerCase().replace("_","-")}function Fv(c){for(var p=0,g,x,k,U;p<c.length;){for(U=Mm(c[p]).split("-"),g=U.length,x=Mm(c[p+1]),x=x?x.split("-"):null;g>0;){if(k=Ti(U.slice(0,g).join("-")),k)return k;if(x&&x.length>=g&&Av(U,x)>=g-1)break;g--}p++}return ha}function Dv(c){return c.match("^[^/\\\\]*$")!=null}function Ti(c){var p=null,g;if(ft[c]===void 0&&typeof ea!="undefined"&&ea&&ea.exports&&Dv(c))try{p=ha._abbr,g=require,g("./locale/"+c),Go(p)}catch(x){ft[c]=null}return ft[c]}function Go(c,p){var g;return c&&(i(p)?g=_o(c):g=Gc(c,p),g?ha=g:typeof console!="undefined"&&console.warn&&console.warn("Locale "+c+" not found. Did you forget to load it?")),ha._abbr}function Gc(c,p){if(p!==null){var g,x=Dm;if(p.abbr=c,ft[c]!=null)q("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale See http://momentjs.com/guides/#/warnings/define-locale/ for more info."),x=ft[c]._config;else if(p.parentLocale!=null)if(ft[p.parentLocale]!=null)x=ft[p.parentLocale]._config;else if(g=Ti(p.parentLocale),g!=null)x=g._config;else return ma[p.parentLocale]||(ma[p.parentLocale]=[]),ma[p.parentLocale].push({name:c,config:p}),null;return ft[c]=new W(z(x,p)),ma[c]&&ma[c].forEach(function(k){Gc(k.name,k.config)}),Go(c),ft[c]}else return delete ft[c],null}function Mv(c,p){if(p!=null){var g,x,k=Dm;ft[c]!=null&&ft[c].parentLocale!=null?ft[c].set(z(ft[c]._config,p)):(x=Ti(c),x!=null&&(k=x._config),p=z(k,p),x==null&&(p.abbr=c),g=new W(p),g.parentLocale=ft[c],ft[c]=g),Go(c)}else ft[c]!=null&&(ft[c].parentLocale!=null?(ft[c]=ft[c].parentLocale,c===Go()&&Go(c)):ft[c]!=null&&delete ft[c]);return ft[c]}function _o(c){var p;if(c&&c._locale&&c._locale._abbr&&(c=c._locale._abbr),!c)return ha;if(!r(c)){if(p=Ti(c),p)return p;c=[c]}return Fv(c)}function Ev(){return re(ft)}function jc(c){var p,g=c._a;return g&&h(c).overflow===-2&&(p=g[xo]<0||g[xo]>11?xo:g[Xr]<1||g[Xr]>Li(g[zt],g[xo])?Xr:g[It]<0||g[It]>24||g[It]===24&&(g[Rr]!==0||g[bo]!==0||g[bs]!==0)?It:g[Rr]<0||g[Rr]>59?Rr:g[bo]<0||g[bo]>59?bo:g[bs]<0||g[bs]>999?bs:-1,h(c)._overflowDayOfYear&&(p<zt||p>Xr)&&(p=Xr),h(c)._overflowWeeks&&p===-1&&(p=N_),h(c)._overflowWeekday&&p===-1&&(p=H_),h(c).overflow=p),c}var Rv=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,Ov=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d|))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,Uv=/Z|[+-]\d\d(?::?\d\d)?/,Pi=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/],["YYYYMM",/\d{6}/,!1],["YYYY",/\d{4}/,!1]],Yc=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],$v=/^\/?Date\((-?\d+)/i,Bv=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/,Nv={UT:0,GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function Em(c){var p,g,x=c._i,k=Rv.exec(x)||Ov.exec(x),U,j,Ie,Ne,Ze=Pi.length,Yt=Yc.length;if(k){for(h(c).iso=!0,p=0,g=Ze;p<g;p++)if(Pi[p][1].exec(k[1])){j=Pi[p][0],U=Pi[p][2]!==!1;break}if(j==null){c._isValid=!1;return}if(k[3]){for(p=0,g=Yt;p<g;p++)if(Yc[p][1].exec(k[3])){Ie=(k[2]||" ")+Yc[p][0];break}if(Ie==null){c._isValid=!1;return}}if(!U&&Ie!=null){c._isValid=!1;return}if(k[4])if(Uv.exec(k[4]))Ne="Z";else{c._isValid=!1;return}c._f=j+(Ie||"")+(Ne||""),Xc(c)}else c._isValid=!1}function Hv(c,p,g,x,k,U){var j=[Vv(c),vm.indexOf(p),parseInt(g,10),parseInt(x,10),parseInt(k,10)];return U&&j.push(parseInt(U,10)),j}function Vv(c){var p=parseInt(c,10);return p<=49?2e3+p:p<=999?1900+p:p}function qv(c){return c.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function Wv(c,p,g){if(c){var x=Pm.indexOf(c),k=new Date(p[0],p[1],p[2]).getDay();if(x!==k)return h(g).weekdayMismatch=!0,g._isValid=!1,!1}return!0}function zv(c,p,g){if(c)return Nv[c];if(p)return 0;var x=parseInt(g,10),k=x%100,U=(x-k)/100;return U*60+k}function Rm(c){var p=Bv.exec(qv(c._i)),g;if(p){if(g=Hv(p[4],p[3],p[2],p[5],p[6],p[7]),!Wv(p[1],g,c))return;c._a=g,c._tzm=zv(p[8],p[9],p[10]),c._d=da.apply(null,c._a),c._d.setUTCMinutes(c._d.getUTCMinutes()-c._tzm),h(c).rfc2822=!0}else c._isValid=!1}function Kv(c){var p=$v.exec(c._i);if(p!==null){c._d=new Date(+p[1]);return}if(Em(c),c._isValid===!1)delete c._isValid;else return;if(Rm(c),c._isValid===!1)delete c._isValid;else return;c._strict?c._isValid=!1:e.createFromInputFallback(c)}e.createFromInputFallback=D("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are discouraged. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.",function(c){c._d=new Date(c._i+(c._useUTC?" UTC":""))});function Js(c,p,g){return c!=null?c:p!=null?p:g}function Gv(c){var p=new Date(e.now());return c._useUTC?[p.getUTCFullYear(),p.getUTCMonth(),p.getUTCDate()]:[p.getFullYear(),p.getMonth(),p.getDate()]}function Jc(c){var p,g,x=[],k,U,j;if(!c._d){for(k=Gv(c),c._w&&c._a[Xr]==null&&c._a[xo]==null&&jv(c),c._dayOfYear!=null&&(j=Js(c._a[zt],k[zt]),(c._dayOfYear>ua(j)||c._dayOfYear===0)&&(h(c)._overflowDayOfYear=!0),g=da(j,0,c._dayOfYear),c._a[xo]=g.getUTCMonth(),c._a[Xr]=g.getUTCDate()),p=0;p<3&&c._a[p]==null;++p)c._a[p]=x[p]=k[p];for(;p<7;p++)c._a[p]=x[p]=c._a[p]==null?p===2?1:0:c._a[p];c._a[It]===24&&c._a[Rr]===0&&c._a[bo]===0&&c._a[bs]===0&&(c._nextDay=!0,c._a[It]=0),c._d=(c._useUTC?da:ev).apply(null,x),U=c._useUTC?c._d.getUTCDay():c._d.getDay(),c._tzm!=null&&c._d.setUTCMinutes(c._d.getUTCMinutes()-c._tzm),c._nextDay&&(c._a[It]=24),c._w&&typeof c._w.d!="undefined"&&c._w.d!==U&&(h(c).weekdayMismatch=!0)}}function jv(c){var p,g,x,k,U,j,Ie,Ne,Ze;p=c._w,p.GG!=null||p.W!=null||p.E!=null?(U=1,j=4,g=Js(p.GG,c._a[zt],pa(lt(),1,4).year),x=Js(p.W,1),k=Js(p.E,1),(k<1||k>7)&&(Ne=!0)):(U=c._locale._week.dow,j=c._locale._week.doy,Ze=pa(lt(),U,j),g=Js(p.gg,c._a[zt],Ze.year),x=Js(p.w,Ze.week),p.d!=null?(k=p.d,(k<0||k>6)&&(Ne=!0)):p.e!=null?(k=p.e+U,(p.e<0||p.e>6)&&(Ne=!0)):k=U),x<1||x>wo(g,U,j)?h(c)._overflowWeeks=!0:Ne!=null?h(c)._overflowWeekday=!0:(Ie=Tm(g,x,k,U,j),c._a[zt]=Ie.year,c._dayOfYear=Ie.dayOfYear)}e.ISO_8601=function(){},e.RFC_2822=function(){};function Xc(c){if(c._f===e.ISO_8601){Em(c);return}if(c._f===e.RFC_2822){Rm(c);return}c._a=[],h(c).empty=!0;var p=""+c._i,g,x,k,U,j,Ie=p.length,Ne=0,Ze,Yt;for(k=Ut(c._f,c._locale).match(Ke)||[],Yt=k.length,g=0;g<Yt;g++)U=k[g],x=(p.match(U_(U,c))||[])[0],x&&(j=p.substr(0,p.indexOf(x)),j.length>0&&h(c).unusedInput.push(j),p=p.slice(p.indexOf(x)+x.length),Ne+=x.length),fe[U]?(x?h(c).empty=!1:h(c).unusedTokens.push(U),B_(U,x,c)):c._strict&&!x&&h(c).unusedTokens.push(U);h(c).charsLeftOver=Ie-Ne,p.length>0&&h(c).unusedInput.push(p),c._a[It]<=12&&h(c).bigHour===!0&&c._a[It]>0&&(h(c).bigHour=void 0),h(c).parsedDateParts=c._a.slice(0),h(c).meridiem=c._meridiem,c._a[It]=Yv(c._locale,c._a[It],c._meridiem),Ze=h(c).era,Ze!==null&&(c._a[zt]=c._locale.erasConvertYear(Ze,c._a[zt])),Jc(c),jc(c)}function Yv(c,p,g){var x;return g==null?p:c.meridiemHour!=null?c.meridiemHour(p,g):(c.isPM!=null&&(x=c.isPM(g),x&&p<12&&(p+=12),!x&&p===12&&(p=0)),p)}function Jv(c){var p,g,x,k,U,j,Ie=!1,Ne=c._f.length;if(Ne===0){h(c).invalidFormat=!0,c._d=new Date(NaN);return}for(k=0;k<Ne;k++)U=0,j=!1,p=A({},c),c._useUTC!=null&&(p._useUTC=c._useUTC),p._f=c._f[k],Xc(p),w(p)&&(j=!0),U+=h(p).charsLeftOver,U+=h(p).unusedTokens.length*10,h(p).score=U,Ie?U<x&&(x=U,g=p):(x==null||U<x||j)&&(x=U,g=p,j&&(Ie=!0));d(c,g||p)}function Xv(c){if(!c._d){var p=go(c._i),g=p.day===void 0?p.date:p.day;c._a=u([p.year,p.month,g,p.hour,p.minute,p.second,p.millisecond],function(x){return x&&parseInt(x,10)}),Jc(c)}}function Qv(c){var p=new E(jc(Om(c)));return p._nextDay&&(p.add(1,"d"),p._nextDay=void 0),p}function Om(c){var p=c._i,g=c._f;return c._locale=c._locale||_o(c._l),p===null||g===void 0&&p===""?v({nullInput:!0}):(typeof p=="string"&&(c._i=p=c._locale.preparse(p)),R(p)?new E(jc(p)):(f(p)?c._d=p:r(g)?Jv(c):g?Xc(c):Zv(c),w(c)||(c._d=null),c))}function Zv(c){var p=c._i;i(p)?c._d=new Date(e.now()):f(p)?c._d=new Date(p.valueOf()):typeof p=="string"?Kv(c):r(p)?(c._a=u(p.slice(0),function(g){return parseInt(g,10)}),Jc(c)):s(p)?Xv(c):l(p)?c._d=new Date(p):e.createFromInputFallback(c)}function Um(c,p,g,x,k){var U={};return(p===!0||p===!1)&&(x=p,p=void 0),(g===!0||g===!1)&&(x=g,g=void 0),(s(c)&&a(c)||r(c)&&c.length===0)&&(c=void 0),U._isAMomentObject=!0,U._useUTC=U._isUTC=k,U._l=g,U._i=c,U._f=p,U._strict=x,Qv(U)}function lt(c,p,g,x){return Um(c,p,g,x,!1)}var eS=D("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var c=lt.apply(null,arguments);return this.isValid()&&c.isValid()?c<this?this:c:v()}),tS=D("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var c=lt.apply(null,arguments);return this.isValid()&&c.isValid()?c>this?this:c:v()});function $m(c,p){var g,x;if(p.length===1&&r(p[0])&&(p=p[0]),!p.length)return lt();for(g=p[0],x=1;x<p.length;++x)(!p[x].isValid()||p[x][c](g))&&(g=p[x]);return g}function rS(){var c=[].slice.call(arguments,0);return $m("isBefore",c)}function oS(){var c=[].slice.call(arguments,0);return $m("isAfter",c)}var sS=function(){return Date.now?Date.now():+new Date},ga=["year","quarter","month","week","day","hour","minute","second","millisecond"];function nS(c){var p,g=!1,x,k=ga.length;for(p in c)if(n(c,p)&&!(wt.call(ga,p)!==-1&&(c[p]==null||!isNaN(c[p]))))return!1;for(x=0;x<k;++x)if(c[ga[x]]){if(g)return!1;parseFloat(c[ga[x]])!==Me(c[ga[x]])&&(g=!0)}return!0}function aS(){return this._isValid}function iS(){return Or(NaN)}function Ai(c){var p=go(c),g=p.year||0,x=p.quarter||0,k=p.month||0,U=p.week||p.isoWeek||0,j=p.day||0,Ie=p.hour||0,Ne=p.minute||0,Ze=p.second||0,Yt=p.millisecond||0;this._isValid=nS(p),this._milliseconds=+Yt+Ze*1e3+Ne*6e4+Ie*1e3*60*60,this._days=+j+U*7,this._months=+k+x*3+g*12,this._data={},this._locale=_o(),this._bubble()}function Fi(c){return c instanceof Ai}function Qc(c){return c<0?Math.round(-1*c)*-1:Math.round(c)}function lS(c,p,g){var x=Math.min(c.length,p.length),k=Math.abs(c.length-p.length),U=0,j;for(j=0;j<x;j++)(g&&c[j]!==p[j]||!g&&Me(c[j])!==Me(p[j]))&&U++;return U+k}function Bm(c,p){oe(c,0,0,function(){var g=this.utcOffset(),x="+";return g<0&&(g=-g,x="-"),x+Ce(~~(g/60),2)+p+Ce(~~g%60,2)})}Bm("Z",":"),Bm("ZZ",""),me("Z",ki),me("ZZ",ki),Qe(["Z","ZZ"],function(c,p,g){g._useUTC=!0,g._tzm=Zc(ki,c)});var cS=/([\+\-]|\d\d)/gi;function Zc(c,p){var g=(p||"").match(c),x,k,U;return g===null?null:(x=g[g.length-1]||[],k=(x+"").match(cS)||["-",0,0],U=+(k[1]*60)+Me(k[2]),U===0?0:k[0]==="+"?U:-U)}function ef(c,p){var g,x;return p._isUTC?(g=p.clone(),x=(R(c)||f(c)?c.valueOf():lt(c).valueOf())-g.valueOf(),g._d.setTime(g._d.valueOf()+x),e.updateOffset(g,!1),g):lt(c).local()}function tf(c){return-Math.round(c._d.getTimezoneOffset())}e.updateOffset=function(){};function fS(c,p,g){var x=this._offset||0,k;if(!this.isValid())return c!=null?this:NaN;if(c!=null){if(typeof c=="string"){if(c=Zc(ki,c),c===null)return this}else Math.abs(c)<16&&!g&&(c=c*60);return!this._isUTC&&p&&(k=tf(this)),this._offset=c,this._isUTC=!0,k!=null&&this.add(k,"m"),x!==c&&(!p||this._changeInProgress?qm(this,Or(c-x,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,e.updateOffset(this,!0),this._changeInProgress=null)),this}else return this._isUTC?x:tf(this)}function uS(c,p){return c!=null?(typeof c!="string"&&(c=-c),this.utcOffset(c,p),this):-this.utcOffset()}function dS(c){return this.utcOffset(0,c)}function pS(c){return this._isUTC&&(this.utcOffset(0,c),this._isUTC=!1,c&&this.subtract(tf(this),"m")),this}function mS(){if(this._tzm!=null)this.utcOffset(this._tzm,!1,!0);else if(typeof this._i=="string"){var c=Zc(R_,this._i);c!=null?this.utcOffset(c):this.utcOffset(0,!0)}return this}function hS(c){return this.isValid()?(c=c?lt(c).utcOffset():0,(this.utcOffset()-c)%60===0):!1}function gS(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()}function yS(){if(!i(this._isDSTShifted))return this._isDSTShifted;var c={},p;return A(c,this),c=Om(c),c._a?(p=c._isUTC?m(c._a):lt(c._a),this._isDSTShifted=this.isValid()&&lS(c._a,p.toArray())>0):this._isDSTShifted=!1,this._isDSTShifted}function xS(){return this.isValid()?!this._isUTC:!1}function bS(){return this.isValid()?this._isUTC:!1}function Nm(){return this.isValid()?this._isUTC&&this._offset===0:!1}var wS=/^(-|\+)?(?:(\d*)[. ])?(\d+):(\d+)(?::(\d+)(\.\d*)?)?$/,_S=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;function Or(c,p){var g=c,x=null,k,U,j;return Fi(c)?g={ms:c._milliseconds,d:c._days,M:c._months}:l(c)||!isNaN(+c)?(g={},p?g[p]=+c:g.milliseconds=+c):(x=wS.exec(c))?(k=x[1]==="-"?-1:1,g={y:0,d:Me(x[Xr])*k,h:Me(x[It])*k,m:Me(x[Rr])*k,s:Me(x[bo])*k,ms:Me(Qc(x[bs]*1e3))*k}):(x=_S.exec(c))?(k=x[1]==="-"?-1:1,g={y:ws(x[2],k),M:ws(x[3],k),w:ws(x[4],k),d:ws(x[5],k),h:ws(x[6],k),m:ws(x[7],k),s:ws(x[8],k)}):g==null?g={}:typeof g=="object"&&("from"in g||"to"in g)&&(j=vS(lt(g.from),lt(g.to)),g={},g.ms=j.milliseconds,g.M=j.months),U=new Ai(g),Fi(c)&&n(c,"_locale")&&(U._locale=c._locale),Fi(c)&&n(c,"_isValid")&&(U._isValid=c._isValid),U}Or.fn=Ai.prototype,Or.invalid=iS;function ws(c,p){var g=c&&parseFloat(c.replace(",","."));return(isNaN(g)?0:g)*p}function Hm(c,p){var g={};return g.months=p.month()-c.month()+(p.year()-c.year())*12,c.clone().add(g.months,"M").isAfter(p)&&--g.months,g.milliseconds=+p-+c.clone().add(g.months,"M"),g}function vS(c,p){var g;return c.isValid()&&p.isValid()?(p=ef(p,c),c.isBefore(p)?g=Hm(c,p):(g=Hm(p,c),g.milliseconds=-g.milliseconds,g.months=-g.months),g):{milliseconds:0,months:0}}function Vm(c,p){return function(g,x){var k,U;return x!==null&&!isNaN(+x)&&(q(p,"moment()."+p+"(period, number) is deprecated. Please use moment()."+p+"(number, period). See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info."),U=g,g=x,x=U),k=Or(g,x),qm(this,k,c),this}}function qm(c,p,g,x){var k=p._milliseconds,U=Qc(p._days),j=Qc(p._months);c.isValid()&&(x=x==null?!0:x,j&&km(c,Jr(c,"Month")+j*g),U&&bi(c,"Date",Jr(c,"Date")+U*g),k&&c._d.setTime(c._d.valueOf()+k*g),x&&e.updateOffset(c,U||j))}var SS=Vm(1,"add"),kS=Vm(-1,"subtract");function Wm(c){return typeof c=="string"||c instanceof String}function IS(c){return R(c)||f(c)||Wm(c)||l(c)||CS(c)||LS(c)||c===null||c===void 0}function LS(c){var p=s(c)&&!a(c),g=!1,x=["years","year","y","months","month","M","days","day","d","dates","date","D","hours","hour","h","minutes","minute","m","seconds","second","s","milliseconds","millisecond","ms"],k,U,j=x.length;for(k=0;k<j;k+=1)U=x[k],g=g||n(c,U);return p&&g}function CS(c){var p=r(c),g=!1;return p&&(g=c.filter(function(x){return!l(x)&&Wm(c)}).length===0),p&&g}function TS(c){var p=s(c)&&!a(c),g=!1,x=["sameDay","nextDay","lastDay","nextWeek","lastWeek","sameElse"],k,U;for(k=0;k<x.length;k+=1)U=x[k],g=g||n(c,U);return p&&g}function PS(c,p){var g=c.diff(p,"days",!0);return g<-6?"sameElse":g<-1?"lastWeek":g<0?"lastDay":g<1?"sameDay":g<2?"nextDay":g<7?"nextWeek":"sameElse"}function AS(c,p){arguments.length===1&&(arguments[0]?IS(arguments[0])?(c=arguments[0],p=void 0):TS(arguments[0])&&(p=arguments[0],c=void 0):(c=void 0,p=void 0));var g=c||lt(),x=ef(g,this).startOf("day"),k=e.calendarFormat(this,x)||"sameElse",U=p&&(J(p[k])?p[k].call(this,g):p[k]);return this.format(U||this.localeData().calendar(k,this,lt(g)))}function FS(){return new E(this)}function DS(c,p){var g=R(c)?c:lt(c);return this.isValid()&&g.isValid()?(p=Wt(p)||"millisecond",p==="millisecond"?this.valueOf()>g.valueOf():g.valueOf()<this.clone().startOf(p).valueOf()):!1}function MS(c,p){var g=R(c)?c:lt(c);return this.isValid()&&g.isValid()?(p=Wt(p)||"millisecond",p==="millisecond"?this.valueOf()<g.valueOf():this.clone().endOf(p).valueOf()<g.valueOf()):!1}function ES(c,p,g,x){var k=R(c)?c:lt(c),U=R(p)?p:lt(p);return this.isValid()&&k.isValid()&&U.isValid()?(x=x||"()",(x[0]==="("?this.isAfter(k,g):!this.isBefore(k,g))&&(x[1]===")"?this.isBefore(U,g):!this.isAfter(U,g))):!1}function RS(c,p){var g=R(c)?c:lt(c),x;return this.isValid()&&g.isValid()?(p=Wt(p)||"millisecond",p==="millisecond"?this.valueOf()===g.valueOf():(x=g.valueOf(),this.clone().startOf(p).valueOf()<=x&&x<=this.clone().endOf(p).valueOf())):!1}function OS(c,p){return this.isSame(c,p)||this.isAfter(c,p)}function US(c,p){return this.isSame(c,p)||this.isBefore(c,p)}function $S(c,p,g){var x,k,U;if(!this.isValid())return NaN;if(x=ef(c,this),!x.isValid())return NaN;switch(k=(x.utcOffset()-this.utcOffset())*6e4,p=Wt(p),p){case"year":U=Di(this,x)/12;break;case"month":U=Di(this,x);break;case"quarter":U=Di(this,x)/3;break;case"second":U=(this-x)/1e3;break;case"minute":U=(this-x)/6e4;break;case"hour":U=(this-x)/36e5;break;case"day":U=(this-x-k)/864e5;break;case"week":U=(this-x-k)/6048e5;break;default:U=this-x}return g?U:ot(U)}function Di(c,p){if(c.date()<p.date())return-Di(p,c);var g=(p.year()-c.year())*12+(p.month()-c.month()),x=c.clone().add(g,"months"),k,U;return p-x<0?(k=c.clone().add(g-1,"months"),U=(p-x)/(x-k)):(k=c.clone().add(g+1,"months"),U=(p-x)/(k-x)),-(g+U)||0}e.defaultFormat="YYYY-MM-DDTHH:mm:ssZ",e.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";function BS(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")}function NS(c){if(!this.isValid())return null;var p=c!==!0,g=p?this.clone().utc():this;return g.year()<0||g.year()>9999?Ot(g,p?"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYYYY-MM-DD[T]HH:mm:ss.SSSZ"):J(Date.prototype.toISOString)?p?this.toDate().toISOString():new Date(this.valueOf()+this.utcOffset()*60*1e3).toISOString().replace("Z",Ot(g,"Z")):Ot(g,p?"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYY-MM-DD[T]HH:mm:ss.SSSZ")}function HS(){if(!this.isValid())return"moment.invalid(/* "+this._i+" */)";var c="moment",p="",g,x,k,U;return this.isLocal()||(c=this.utcOffset()===0?"moment.utc":"moment.parseZone",p="Z"),g="["+c+'("]',x=0<=this.year()&&this.year()<=9999?"YYYY":"YYYYYY",k="-MM-DD[T]HH:mm:ss.SSS",U=p+'[")]',this.format(g+x+k+U)}function VS(c){c||(c=this.isUtc()?e.defaultFormatUtc:e.defaultFormat);var p=Ot(this,c);return this.localeData().postformat(p)}function qS(c,p){return this.isValid()&&(R(c)&&c.isValid()||lt(c).isValid())?Or({to:this,from:c}).locale(this.locale()).humanize(!p):this.localeData().invalidDate()}function WS(c){return this.from(lt(),c)}function zS(c,p){return this.isValid()&&(R(c)&&c.isValid()||lt(c).isValid())?Or({from:this,to:c}).locale(this.locale()).humanize(!p):this.localeData().invalidDate()}function KS(c){return this.to(lt(),c)}function zm(c){var p;return c===void 0?this._locale._abbr:(p=_o(c),p!=null&&(this._locale=p),this)}var Km=D("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(c){return c===void 0?this.localeData():this.locale(c)});function Gm(){return this._locale}var Mi=1e3,Xs=60*Mi,Ei=60*Xs,jm=(365*400+97)*24*Ei;function Qs(c,p){return(c%p+p)%p}function Ym(c,p,g){return c<100&&c>=0?new Date(c+400,p,g)-jm:new Date(c,p,g).valueOf()}function Jm(c,p,g){return c<100&&c>=0?Date.UTC(c+400,p,g)-jm:Date.UTC(c,p,g)}function GS(c){var p,g;if(c=Wt(c),c===void 0||c==="millisecond"||!this.isValid())return this;switch(g=this._isUTC?Jm:Ym,c){case"year":p=g(this.year(),0,1);break;case"quarter":p=g(this.year(),this.month()-this.month()%3,1);break;case"month":p=g(this.year(),this.month(),1);break;case"week":p=g(this.year(),this.month(),this.date()-this.weekday());break;case"isoWeek":p=g(this.year(),this.month(),this.date()-(this.isoWeekday()-1));break;case"day":case"date":p=g(this.year(),this.month(),this.date());break;case"hour":p=this._d.valueOf(),p-=Qs(p+(this._isUTC?0:this.utcOffset()*Xs),Ei);break;case"minute":p=this._d.valueOf(),p-=Qs(p,Xs);break;case"second":p=this._d.valueOf(),p-=Qs(p,Mi);break}return this._d.setTime(p),e.updateOffset(this,!0),this}function jS(c){var p,g;if(c=Wt(c),c===void 0||c==="millisecond"||!this.isValid())return this;switch(g=this._isUTC?Jm:Ym,c){case"year":p=g(this.year()+1,0,1)-1;break;case"quarter":p=g(this.year(),this.month()-this.month()%3+3,1)-1;break;case"month":p=g(this.year(),this.month()+1,1)-1;break;case"week":p=g(this.year(),this.month(),this.date()-this.weekday()+7)-1;break;case"isoWeek":p=g(this.year(),this.month(),this.date()-(this.isoWeekday()-1)+7)-1;break;case"day":case"date":p=g(this.year(),this.month(),this.date()+1)-1;break;case"hour":p=this._d.valueOf(),p+=Ei-Qs(p+(this._isUTC?0:this.utcOffset()*Xs),Ei)-1;break;case"minute":p=this._d.valueOf(),p+=Xs-Qs(p,Xs)-1;break;case"second":p=this._d.valueOf(),p+=Mi-Qs(p,Mi)-1;break}return this._d.setTime(p),e.updateOffset(this,!0),this}function YS(){return this._d.valueOf()-(this._offset||0)*6e4}function JS(){return Math.floor(this.valueOf()/1e3)}function XS(){return new Date(this.valueOf())}function QS(){var c=this;return[c.year(),c.month(),c.date(),c.hour(),c.minute(),c.second(),c.millisecond()]}function ZS(){var c=this;return{years:c.year(),months:c.month(),date:c.date(),hours:c.hours(),minutes:c.minutes(),seconds:c.seconds(),milliseconds:c.milliseconds()}}function e1(){return this.isValid()?this.toISOString():null}function t1(){return w(this)}function r1(){return d({},h(this))}function o1(){return h(this).overflow}function s1(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}}oe("N",0,0,"eraAbbr"),oe("NN",0,0,"eraAbbr"),oe("NNN",0,0,"eraAbbr"),oe("NNNN",0,0,"eraName"),oe("NNNNN",0,0,"eraNarrow"),oe("y",["y",1],"yo","eraYear"),oe("y",["yy",2],0,"eraYear"),oe("y",["yyy",3],0,"eraYear"),oe("y",["yyyy",4],0,"eraYear"),me("N",rf),me("NN",rf),me("NNN",rf),me("NNNN",h1),me("NNNNN",g1),Qe(["N","NN","NNN","NNNN","NNNNN"],function(c,p,g,x){var k=g._locale.erasParse(c,x,g._strict);k?h(g).era=k:h(g).invalidEra=c}),me("y",Ys),me("yy",Ys),me("yyy",Ys),me("yyyy",Ys),me("yo",y1),Qe(["y","yy","yyy","yyyy"],zt),Qe(["yo"],function(c,p,g,x){var k;g._locale._eraYearOrdinalRegex&&(k=c.match(g._locale._eraYearOrdinalRegex)),g._locale.eraYearOrdinalParse?p[zt]=g._locale.eraYearOrdinalParse(c,k):p[zt]=parseInt(c,10)});function n1(c,p){var g,x,k,U=this._eras||_o("en")._eras;for(g=0,x=U.length;g<x;++g){switch(typeof U[g].since){case"string":k=e(U[g].since).startOf("day"),U[g].since=k.valueOf();break}switch(typeof U[g].until){case"undefined":U[g].until=1/0;break;case"string":k=e(U[g].until).startOf("day").valueOf(),U[g].until=k.valueOf();break}}return U}function a1(c,p,g){var x,k,U=this.eras(),j,Ie,Ne;for(c=c.toUpperCase(),x=0,k=U.length;x<k;++x)if(j=U[x].name.toUpperCase(),Ie=U[x].abbr.toUpperCase(),Ne=U[x].narrow.toUpperCase(),g)switch(p){case"N":case"NN":case"NNN":if(Ie===c)return U[x];break;case"NNNN":if(j===c)return U[x];break;case"NNNNN":if(Ne===c)return U[x];break}else if([j,Ie,Ne].indexOf(c)>=0)return U[x]}function i1(c,p){var g=c.since<=c.until?1:-1;return p===void 0?e(c.since).year():e(c.since).year()+(p-c.offset)*g}function l1(){var c,p,g,x=this.localeData().eras();for(c=0,p=x.length;c<p;++c)if(g=this.clone().startOf("day").valueOf(),x[c].since<=g&&g<=x[c].until||x[c].until<=g&&g<=x[c].since)return x[c].name;return""}function c1(){var c,p,g,x=this.localeData().eras();for(c=0,p=x.length;c<p;++c)if(g=this.clone().startOf("day").valueOf(),x[c].since<=g&&g<=x[c].until||x[c].until<=g&&g<=x[c].since)return x[c].narrow;return""}function f1(){var c,p,g,x=this.localeData().eras();for(c=0,p=x.length;c<p;++c)if(g=this.clone().startOf("day").valueOf(),x[c].since<=g&&g<=x[c].until||x[c].until<=g&&g<=x[c].since)return x[c].abbr;return""}function u1(){var c,p,g,x,k=this.localeData().eras();for(c=0,p=k.length;c<p;++c)if(g=k[c].since<=k[c].until?1:-1,x=this.clone().startOf("day").valueOf(),k[c].since<=x&&x<=k[c].until||k[c].until<=x&&x<=k[c].since)return(this.year()-e(k[c].since).year())*g+k[c].offset;return this.year()}function d1(c){return n(this,"_erasNameRegex")||of.call(this),c?this._erasNameRegex:this._erasRegex}function p1(c){return n(this,"_erasAbbrRegex")||of.call(this),c?this._erasAbbrRegex:this._erasRegex}function m1(c){return n(this,"_erasNarrowRegex")||of.call(this),c?this._erasNarrowRegex:this._erasRegex}function rf(c,p){return p.erasAbbrRegex(c)}function h1(c,p){return p.erasNameRegex(c)}function g1(c,p){return p.erasNarrowRegex(c)}function y1(c,p){return p._eraYearOrdinalRegex||Ys}function of(){var c=[],p=[],g=[],x=[],k,U,j=this.eras();for(k=0,U=j.length;k<U;++k)p.push(hr(j[k].name)),c.push(hr(j[k].abbr)),g.push(hr(j[k].narrow)),x.push(hr(j[k].name)),x.push(hr(j[k].abbr)),x.push(hr(j[k].narrow));this._erasRegex=new RegExp("^("+x.join("|")+")","i"),this._erasNameRegex=new RegExp("^("+p.join("|")+")","i"),this._erasAbbrRegex=new RegExp("^("+c.join("|")+")","i"),this._erasNarrowRegex=new RegExp("^("+g.join("|")+")","i")}oe(0,["gg",2],0,function(){return this.weekYear()%100}),oe(0,["GG",2],0,function(){return this.isoWeekYear()%100});function Ri(c,p){oe(0,[c,c.length],0,p)}Ri("gggg","weekYear"),Ri("ggggg","weekYear"),Ri("GGGG","isoWeekYear"),Ri("GGGGG","isoWeekYear"),nt("weekYear","gg"),nt("isoWeekYear","GG"),se("weekYear",1),se("isoWeekYear",1),me("G",Si),me("g",Si),me("GG",ue,jt),me("gg",ue,jt),me("GGGG",Vc,la),me("gggg",Vc,la),me("GGGGG",vi,Y),me("ggggg",vi,Y),fa(["gggg","ggggg","GGGG","GGGGG"],function(c,p,g,x){p[x.substr(0,2)]=Me(c)}),fa(["gg","GG"],function(c,p,g,x){p[x]=e.parseTwoDigitYear(c)});function x1(c){return Xm.call(this,c,this.week(),this.weekday(),this.localeData()._week.dow,this.localeData()._week.doy)}function b1(c){return Xm.call(this,c,this.isoWeek(),this.isoWeekday(),1,4)}function w1(){return wo(this.year(),1,4)}function _1(){return wo(this.isoWeekYear(),1,4)}function v1(){var c=this.localeData()._week;return wo(this.year(),c.dow,c.doy)}function S1(){var c=this.localeData()._week;return wo(this.weekYear(),c.dow,c.doy)}function Xm(c,p,g,x,k){var U;return c==null?pa(this,x,k).year:(U=wo(c,x,k),p>U&&(p=U),k1.call(this,c,p,g,x,k))}function k1(c,p,g,x,k){var U=Tm(c,p,g,x,k),j=da(U.year,0,U.dayOfYear);return this.year(j.getUTCFullYear()),this.month(j.getUTCMonth()),this.date(j.getUTCDate()),this}oe("Q",0,"Qo","quarter"),nt("quarter","Q"),se("quarter",7),me("Q",wi),Qe("Q",function(c,p){p[xo]=(Me(c)-1)*3});function I1(c){return c==null?Math.ceil((this.month()+1)/3):this.month((c-1)*3+this.month()%3)}oe("D",["DD",2],"Do","date"),nt("date","D"),se("date",9),me("D",ue),me("DD",ue,jt),me("Do",function(c,p){return c?p._dayOfMonthOrdinalParse||p._ordinalParse:p._dayOfMonthOrdinalParseLenient}),Qe(["D","DD"],Xr),Qe("Do",function(c,p){p[Xr]=Me(c.match(ue)[0])});var Qm=Yr("Date",!0);oe("DDD",["DDDD",3],"DDDo","dayOfYear"),nt("dayOfYear","DDD"),se("dayOfYear",4),me("DDD",ar),me("DDDD",_i),Qe(["DDD","DDDD"],function(c,p,g){g._dayOfYear=Me(c)});function L1(c){var p=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return c==null?p:this.add(c-p,"d")}oe("m",["mm",2],0,"minute"),nt("minute","m"),se("minute",14),me("m",ue),me("mm",ue,jt),Qe(["m","mm"],Rr);var C1=Yr("Minutes",!1);oe("s",["ss",2],0,"second"),nt("second","s"),se("second",15),me("s",ue),me("ss",ue,jt),Qe(["s","ss"],bo);var T1=Yr("Seconds",!1);oe("S",0,0,function(){return~~(this.millisecond()/100)}),oe(0,["SS",2],0,function(){return~~(this.millisecond()/10)}),oe(0,["SSS",3],0,"millisecond"),oe(0,["SSSS",4],0,function(){return this.millisecond()*10}),oe(0,["SSSSS",5],0,function(){return this.millisecond()*100}),oe(0,["SSSSSS",6],0,function(){return this.millisecond()*1e3}),oe(0,["SSSSSSS",7],0,function(){return this.millisecond()*1e4}),oe(0,["SSSSSSSS",8],0,function(){return this.millisecond()*1e5}),oe(0,["SSSSSSSSS",9],0,function(){return this.millisecond()*1e6}),nt("millisecond","ms"),se("millisecond",16),me("S",ar,wi),me("SS",ar,jt),me("SSS",ar,_i);var jo,Zm;for(jo="SSSS";jo.length<=9;jo+="S")me(jo,Ys);function P1(c,p){p[bs]=Me(("0."+c)*1e3)}for(jo="S";jo.length<=9;jo+="S")Qe(jo,P1);Zm=Yr("Milliseconds",!1),oe("z",0,0,"zoneAbbr"),oe("zz",0,0,"zoneName");function A1(){return this._isUTC?"UTC":""}function F1(){return this._isUTC?"Coordinated Universal Time":""}var ie=E.prototype;ie.add=SS,ie.calendar=AS,ie.clone=FS,ie.diff=$S,ie.endOf=jS,ie.format=VS,ie.from=qS,ie.fromNow=WS,ie.to=zS,ie.toNow=KS,ie.get=Nc,ie.invalidAt=o1,ie.isAfter=DS,ie.isBefore=MS,ie.isBetween=ES,ie.isSame=RS,ie.isSameOrAfter=OS,ie.isSameOrBefore=US,ie.isValid=t1,ie.lang=Km,ie.locale=zm,ie.localeData=Gm,ie.max=tS,ie.min=eS,ie.parsingFlags=r1,ie.set=Hc,ie.startOf=GS,ie.subtract=kS,ie.toArray=QS,ie.toObject=ZS,ie.toDate=XS,ie.toISOString=NS,ie.inspect=HS,typeof Symbol!="undefined"&&Symbol.for!=null&&(ie[Symbol.for("nodejs.util.inspect.custom")]=function(){return"Moment<"+this.format()+">"}),ie.toJSON=e1,ie.toString=BS,ie.unix=JS,ie.valueOf=YS,ie.creationData=s1,ie.eraName=l1,ie.eraNarrow=c1,ie.eraAbbr=f1,ie.eraYear=u1,ie.year=Cm,ie.isLeapYear=Z_,ie.weekYear=x1,ie.isoWeekYear=b1,ie.quarter=ie.quarters=I1,ie.month=Im,ie.daysInMonth=J_,ie.week=ie.weeks=nv,ie.isoWeek=ie.isoWeeks=av,ie.weeksInYear=v1,ie.weeksInWeekYear=S1,ie.isoWeeksInYear=w1,ie.isoWeeksInISOWeekYear=_1,ie.date=Qm,ie.day=ie.days=bv,ie.weekday=wv,ie.isoWeekday=_v,ie.dayOfYear=L1,ie.hour=ie.hours=Tv,ie.minute=ie.minutes=C1,ie.second=ie.seconds=T1,ie.millisecond=ie.milliseconds=Zm,ie.utcOffset=fS,ie.utc=dS,ie.local=pS,ie.parseZone=mS,ie.hasAlignedHourOffset=hS,ie.isDST=gS,ie.isLocal=xS,ie.isUtcOffset=bS,ie.isUtc=Nm,ie.isUTC=Nm,ie.zoneAbbr=A1,ie.zoneName=F1,ie.dates=D("dates accessor is deprecated. Use date instead.",Qm),ie.months=D("months accessor is deprecated. Use month instead",Im),ie.years=D("years accessor is deprecated. Use year instead",Cm),ie.zone=D("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",uS),ie.isDSTShifted=D("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",yS);function D1(c){return lt(c*1e3)}function M1(){return lt.apply(null,arguments).parseZone()}function eh(c){return c}var Ye=W.prototype;Ye.calendar=le,Ye.longDateFormat=yt,Ye.invalidDate=Gt,Ye.ordinal=na,Ye.preparse=eh,Ye.postformat=eh,Ye.relativeTime=js,Ye.pastFuture=ia,Ye.set=K,Ye.eras=n1,Ye.erasParse=a1,Ye.erasConvertYear=i1,Ye.erasAbbrRegex=p1,Ye.erasNameRegex=d1,Ye.erasNarrowRegex=m1,Ye.months=K_,Ye.monthsShort=G_,Ye.monthsParse=Y_,Ye.monthsRegex=Q_,Ye.monthsShortRegex=X_,Ye.week=tv,Ye.firstDayOfYear=sv,Ye.firstDayOfWeek=ov,Ye.weekdays=mv,Ye.weekdaysMin=gv,Ye.weekdaysShort=hv,Ye.weekdaysParse=xv,Ye.weekdaysRegex=vv,Ye.weekdaysShortRegex=Sv,Ye.weekdaysMinRegex=kv,Ye.isPM=Lv,Ye.meridiem=Pv;function Oi(c,p,g,x){var k=_o(),U=m().set(x,p);return k[g](U,c)}function th(c,p,g){if(l(c)&&(p=c,c=void 0),c=c||"",p!=null)return Oi(c,p,g,"month");var x,k=[];for(x=0;x<12;x++)k[x]=Oi(c,x,g,"month");return k}function sf(c,p,g,x){typeof c=="boolean"?(l(p)&&(g=p,p=void 0),p=p||""):(p=c,g=p,c=!1,l(p)&&(g=p,p=void 0),p=p||"");var k=_o(),U=c?k._week.dow:0,j,Ie=[];if(g!=null)return Oi(p,(g+U)%7,x,"day");for(j=0;j<7;j++)Ie[j]=Oi(p,(j+U)%7,x,"day");return Ie}function E1(c,p){return th(c,p,"months")}function R1(c,p){return th(c,p,"monthsShort")}function O1(c,p,g){return sf(c,p,g,"weekdays")}function U1(c,p,g){return sf(c,p,g,"weekdaysShort")}function $1(c,p,g){return sf(c,p,g,"weekdaysMin")}Go("en",{eras:[{since:"0001-01-01",until:1/0,offset:1,name:"Anno Domini",narrow:"AD",abbr:"AD"},{since:"0000-12-31",until:-1/0,offset:1,name:"Before Christ",narrow:"BC",abbr:"BC"}],dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(c){var p=c%10,g=Me(c%100/10)===1?"th":p===1?"st":p===2?"nd":p===3?"rd":"th";return c+g}}),e.lang=D("moment.lang is deprecated. Use moment.locale instead.",Go),e.langData=D("moment.langData is deprecated. Use moment.localeData instead.",_o);var vo=Math.abs;function B1(){var c=this._data;return this._milliseconds=vo(this._milliseconds),this._days=vo(this._days),this._months=vo(this._months),c.milliseconds=vo(c.milliseconds),c.seconds=vo(c.seconds),c.minutes=vo(c.minutes),c.hours=vo(c.hours),c.months=vo(c.months),c.years=vo(c.years),this}function rh(c,p,g,x){var k=Or(p,g);return c._milliseconds+=x*k._milliseconds,c._days+=x*k._days,c._months+=x*k._months,c._bubble()}function N1(c,p){return rh(this,c,p,1)}function H1(c,p){return rh(this,c,p,-1)}function oh(c){return c<0?Math.floor(c):Math.ceil(c)}function V1(){var c=this._milliseconds,p=this._days,g=this._months,x=this._data,k,U,j,Ie,Ne;return c>=0&&p>=0&&g>=0||c<=0&&p<=0&&g<=0||(c+=oh(nf(g)+p)*864e5,p=0,g=0),x.milliseconds=c%1e3,k=ot(c/1e3),x.seconds=k%60,U=ot(k/60),x.minutes=U%60,j=ot(U/60),x.hours=j%24,p+=ot(j/24),Ne=ot(sh(p)),g+=Ne,p-=oh(nf(Ne)),Ie=ot(g/12),g%=12,x.days=p,x.months=g,x.years=Ie,this}function sh(c){return c*4800/146097}function nf(c){return c*146097/4800}function q1(c){if(!this.isValid())return NaN;var p,g,x=this._milliseconds;if(c=Wt(c),c==="month"||c==="quarter"||c==="year")switch(p=this._days+x/864e5,g=this._months+sh(p),c){case"month":return g;case"quarter":return g/3;case"year":return g/12}else switch(p=this._days+Math.round(nf(this._months)),c){case"week":return p/7+x/6048e5;case"day":return p+x/864e5;case"hour":return p*24+x/36e5;case"minute":return p*1440+x/6e4;case"second":return p*86400+x/1e3;case"millisecond":return Math.floor(p*864e5)+x;default:throw new Error("Unknown unit "+c)}}function W1(){return this.isValid()?this._milliseconds+this._days*864e5+this._months%12*2592e6+Me(this._months/12)*31536e6:NaN}function So(c){return function(){return this.as(c)}}var z1=So("ms"),K1=So("s"),G1=So("m"),j1=So("h"),Y1=So("d"),J1=So("w"),X1=So("M"),Q1=So("Q"),Z1=So("y");function e0(){return Or(this)}function t0(c){return c=Wt(c),this.isValid()?this[c+"s"]():NaN}function _s(c){return function(){return this.isValid()?this._data[c]:NaN}}var r0=_s("milliseconds"),o0=_s("seconds"),s0=_s("minutes"),n0=_s("hours"),a0=_s("days"),i0=_s("months"),l0=_s("years");function c0(){return ot(this.days()/7)}var ko=Math.round,Zs={ss:44,s:45,m:45,h:22,d:26,w:null,M:11};function f0(c,p,g,x,k){return k.relativeTime(p||1,!!g,c,x)}function u0(c,p,g,x){var k=Or(c).abs(),U=ko(k.as("s")),j=ko(k.as("m")),Ie=ko(k.as("h")),Ne=ko(k.as("d")),Ze=ko(k.as("M")),Yt=ko(k.as("w")),Io=ko(k.as("y")),Yo=U<=g.ss&&["s",U]||U<g.s&&["ss",U]||j<=1&&["m"]||j<g.m&&["mm",j]||Ie<=1&&["h"]||Ie<g.h&&["hh",Ie]||Ne<=1&&["d"]||Ne<g.d&&["dd",Ne];return g.w!=null&&(Yo=Yo||Yt<=1&&["w"]||Yt<g.w&&["ww",Yt]),Yo=Yo||Ze<=1&&["M"]||Ze<g.M&&["MM",Ze]||Io<=1&&["y"]||["yy",Io],Yo[2]=p,Yo[3]=+c>0,Yo[4]=x,f0.apply(null,Yo)}function d0(c){return c===void 0?ko:typeof c=="function"?(ko=c,!0):!1}function p0(c,p){return Zs[c]===void 0?!1:p===void 0?Zs[c]:(Zs[c]=p,c==="s"&&(Zs.ss=p-1),!0)}function m0(c,p){if(!this.isValid())return this.localeData().invalidDate();var g=!1,x=Zs,k,U;return typeof c=="object"&&(p=c,c=!1),typeof c=="boolean"&&(g=c),typeof p=="object"&&(x=Object.assign({},Zs,p),p.s!=null&&p.ss==null&&(x.ss=p.s-1)),k=this.localeData(),U=u0(this,!g,x,k),g&&(U=k.pastFuture(+this,U)),k.postformat(U)}var af=Math.abs;function en(c){return(c>0)-(c<0)||+c}function Ui(){if(!this.isValid())return this.localeData().invalidDate();var c=af(this._milliseconds)/1e3,p=af(this._days),g=af(this._months),x,k,U,j,Ie=this.asSeconds(),Ne,Ze,Yt,Io;return Ie?(x=ot(c/60),k=ot(x/60),c%=60,x%=60,U=ot(g/12),g%=12,j=c?c.toFixed(3).replace(/\.?0+$/,""):"",Ne=Ie<0?"-":"",Ze=en(this._months)!==en(Ie)?"-":"",Yt=en(this._days)!==en(Ie)?"-":"",Io=en(this._milliseconds)!==en(Ie)?"-":"",Ne+"P"+(U?Ze+U+"Y":"")+(g?Ze+g+"M":"")+(p?Yt+p+"D":"")+(k||x||c?"T":"")+(k?Io+k+"H":"")+(x?Io+x+"M":"")+(c?Io+j+"S":"")):"P0D"}var je=Ai.prototype;je.isValid=aS,je.abs=B1,je.add=N1,je.subtract=H1,je.as=q1,je.asMilliseconds=z1,je.asSeconds=K1,je.asMinutes=G1,je.asHours=j1,je.asDays=Y1,je.asWeeks=J1,je.asMonths=X1,je.asQuarters=Q1,je.asYears=Z1,je.valueOf=W1,je._bubble=V1,je.clone=e0,je.get=t0,je.milliseconds=r0,je.seconds=o0,je.minutes=s0,je.hours=n0,je.days=a0,je.weeks=c0,je.months=i0,je.years=l0,je.humanize=m0,je.toISOString=Ui,je.toString=Ui,je.toJSON=Ui,je.locale=zm,je.localeData=Gm,je.toIsoString=D("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",Ui),je.lang=Km,oe("X",0,0,"unix"),oe("x",0,0,"valueOf"),me("x",Si),me("X",O_),Qe("X",function(c,p,g){g._d=new Date(parseFloat(c)*1e3)}),Qe("x",function(c,p,g){g._d=new Date(Me(c))});return e.version="2.29.4",t(lt),e.fn=ie,e.min=rS,e.max=oS,e.now=sS,e.utc=m,e.unix=D1,e.months=E1,e.isDate=f,e.locale=Go,e.invalid=v,e.duration=Or,e.isMoment=R,e.weekdays=O1,e.parseZone=M1,e.localeData=_o,e.isDuration=Fi,e.monthsShort=R1,e.weekdaysMin=$1,e.defineLocale=Gc,e.updateLocale=Mv,e.locales=Ev,e.weekdaysShort=U1,e.normalizeUnits=Wt,e.relativeTimeRounding=d0,e.relativeTimeThreshold=p0,e.calendarFormat=PS,e.prototype=ie,e.HTML5_FMT={DATETIME_LOCAL:"YYYY-MM-DDTHH:mm",DATETIME_LOCAL_SECONDS:"YYYY-MM-DDTHH:mm:ss",DATETIME_LOCAL_MS:"YYYY-MM-DDTHH:mm:ss.SSS",DATE:"YYYY-MM-DD",TIME:"HH:mm",TIME_SECONDS:"HH:mm:ss",TIME_MS:"HH:mm:ss.SSS",WEEK:"GGGG-[W]WW",MONTH:"YYYY-MM"},e})});var LM={};lf(LM,{default:()=>Bc});module.exports=_0(LM);var qt=require("obsidian"),D_=require("obsidian"),M_=vs(xa());var ct=require("obsidian");var Ft=()=>new Map,Bi=o=>{let e=Ft();return o.forEach((t,r)=>{e.set(r,t)}),e},Ur=(o,e,t)=>{let r=o.get(e);return r===void 0&&o.set(e,r=t()),r},lh=(o,e)=>{let t=[];for(let[r,s]of o)t.push(e(s,r));return t},ch=(o,e)=>{for(let[t,r]of o)if(e(r,t))return!0;return!1};var Zr=()=>new Set;var Ni=o=>o[o.length-1];var fh=(o,e)=>{for(let t=0;t<e.length;t++)o.push(e[t])},$r=Array.from;var ff=Array.isArray;var Hi=class{constructor(){this._observers=Ft()}on(e,t){return Ur(this._observers,e,Zr).add(t),t}once(e,t){let r=(...s)=>{this.off(e,r),t(...s)};this.on(e,r)}off(e,t){let r=this._observers.get(e);r!==void 0&&(r.delete(t),r.size===0&&this._observers.delete(e))}emit(e,t){return $r((this._observers.get(e)||Ft()).values()).forEach(r=>r(...t))}destroy(){this._observers=Ft()}},rn=class{constructor(){this._observers=Ft()}on(e,t){Ur(this._observers,e,Zr).add(t)}once(e,t){let r=(...s)=>{this.off(e,r),t(...s)};this.on(e,r)}off(e,t){let r=this._observers.get(e);r!==void 0&&(r.delete(t),r.size===0&&this._observers.delete(e))}emit(e,t){return $r((this._observers.get(e)||Ft()).values()).forEach(r=>r(...t))}destroy(){this._observers=Ft()}};var ir=Math.floor;var on=Math.abs;var sn=(o,e)=>o<e?o:e,Br=(o,e)=>o>e?o:e,AM=Number.isNaN;var Vi=o=>o!==0?o<0:1/o<0;var df=Number.MAX_SAFE_INTEGER,FM=Number.MIN_SAFE_INTEGER,DM=1<<31;var uh=Number.isInteger||(o=>typeof o=="number"&&isFinite(o)&&ir(o)===o),MM=Number.isNaN,EM=Number.parseInt;var S0=String.fromCharCode,RM=String.fromCodePoint,OM=S0(65535),k0=o=>o.toLowerCase(),I0=/^\s*/g,L0=o=>o.replace(I0,""),C0=/([A-Z])/g,pf=(o,e)=>L0(o.replace(C0,t=>`${e}${k0(t)}`));var T0=o=>{let e=unescape(encodeURIComponent(o)),t=e.length,r=new Uint8Array(t);for(let s=0;s<t;s++)r[s]=e.codePointAt(s);return r},ln=typeof TextEncoder!="undefined"?new TextEncoder:null,P0=o=>ln.encode(o),ph=ln?P0:T0;var an=typeof TextDecoder=="undefined"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});an&&an.decode(new Uint8Array).length===1&&(an=null);var Ss=class{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}},Is=()=>new Ss;var A0=o=>{let e=o.cpos;for(let t=0;t<o.bufs.length;t++)e+=o.bufs[t].length;return e};var gr=o=>{let e=new Uint8Array(A0(o)),t=0;for(let r=0;r<o.bufs.length;r++){let s=o.bufs[r];e.set(s,t),t+=s.length}return e.set(new Uint8Array(o.cbuf.buffer,0,o.cpos),t),e},F0=(o,e)=>{let t=o.cbuf.length;t-o.cpos<e&&(o.bufs.push(new Uint8Array(o.cbuf.buffer,0,o.cpos)),o.cbuf=new Uint8Array(Br(t,e)*2),o.cpos=0)},Dt=(o,e)=>{let t=o.cbuf.length;o.cpos===t&&(o.bufs.push(o.cbuf),o.cbuf=new Uint8Array(t*2),o.cpos=0),o.cbuf[o.cpos++]=e};var Wi=Dt;var Ee=(o,e)=>{for(;e>127;)Dt(o,128|127&e),e=ir(e/128);Dt(o,127&e)},zi=(o,e)=>{let t=Vi(e);for(t&&(e=-e),Dt(o,(e>63?128:0)|(t?64:0)|63&e),e=ir(e/64);e>0;)Dt(o,(e>127?128:0)|127&e),e=ir(e/128)},hf=new Uint8Array(3e4),D0=hf.length/3,M0=(o,e)=>{if(e.length<D0){let t=ln.encodeInto(e,hf).written||0;Ee(o,t);for(let r=0;r<t;r++)Dt(o,hf[r])}else Mt(o,ph(e))},E0=(o,e)=>{let t=unescape(encodeURIComponent(e)),r=t.length;Ee(o,r);for(let s=0;s<r;s++)Dt(o,t.codePointAt(s))},Lo=ln&&ln.encodeInto?M0:E0;var _a=(o,e)=>{let t=o.cbuf.length,r=o.cpos,s=sn(t-r,e.length),n=e.length-s;o.cbuf.set(e.subarray(0,s),r),o.cpos+=s,n>0&&(o.bufs.push(o.cbuf),o.cbuf=new Uint8Array(Br(t*2,n)),o.cbuf.set(e.subarray(s)),o.cpos=n)},Mt=(o,e)=>{Ee(o,e.byteLength),_a(o,e)},gf=(o,e)=>{F0(o,e);let t=new DataView(o.cbuf.buffer,o.cpos,e);return o.cpos+=e,t},R0=(o,e)=>gf(o,4).setFloat32(0,e,!1),O0=(o,e)=>gf(o,8).setFloat64(0,e,!1),U0=(o,e)=>gf(o,8).setBigInt64(0,e,!1);var hh=new DataView(new ArrayBuffer(4)),$0=o=>(hh.setFloat32(0,o),hh.getFloat32(0)===o),fn=(o,e)=>{switch(typeof e){case"string":Dt(o,119),Lo(o,e);break;case"number":uh(e)&&on(e)<=2147483647?(Dt(o,125),zi(o,e)):$0(e)?(Dt(o,124),R0(o,e)):(Dt(o,123),O0(o,e));break;case"bigint":Dt(o,122),U0(o,e);break;case"object":if(e===null)Dt(o,126);else if(ff(e)){Dt(o,117),Ee(o,e.length);for(let t=0;t<e.length;t++)fn(o,e[t])}else if(e instanceof Uint8Array)Dt(o,116),Mt(o,e);else{Dt(o,118);let t=Object.keys(e);Ee(o,t.length);for(let r=0;r<t.length;r++){let s=t[r];Lo(o,s),fn(o,e[s])}}break;case"boolean":Dt(o,e?120:121);break;default:Dt(o,127)}},wa=class extends Ss{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&Ee(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}};var gh=o=>{o.count>0&&(zi(o.encoder,o.count===1?o.s:-o.s),o.count>1&&Ee(o.encoder,o.count-2))},ks=class{constructor(){this.encoder=new Ss,this.s=0,this.count=0}write(e){this.s===e?this.count++:(gh(this),this.count=1,this.s=e)}toUint8Array(){return gh(this),gr(this.encoder)}};var yh=o=>{if(o.count>0){let e=o.diff*2+(o.count===1?0:1);zi(o.encoder,e),o.count>1&&Ee(o.encoder,o.count-2)}},un=class{constructor(){this.encoder=new Ss,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(yh(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return yh(this),gr(this.encoder)}},qi=class{constructor(){this.sarr=[],this.s="",this.lensE=new ks}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){let e=new Ss;return this.sarr.push(this.s),this.s="",Lo(e,this.sarr.join("")),_a(e,this.lensE.toUint8Array()),gr(e)}};var Cr=o=>new Error(o),Nr=()=>{throw Cr("Method unimplemented")},Tr=()=>{throw Cr("Unexpected case")};var xh=Cr("Unexpected end of array"),bh=Cr("Integer out of Range"),dn=class{constructor(e){this.arr=e,this.pos=0}},Vr=o=>new dn(o),wh=o=>o.pos!==o.arr.length;var B0=(o,e)=>{let t=new Uint8Array(o.arr.buffer,o.pos+o.arr.byteOffset,e);return o.pos+=e,t},$t=o=>B0(o,Fe(o));var Ls=o=>o.arr[o.pos++];var Fe=o=>{let e=0,t=1,r=o.arr.length;for(;o.pos<r;){let s=o.arr[o.pos++];if(e=e+(s&127)*t,t*=128,s<128)return e;if(e>df)throw bh}throw xh},Gi=o=>{let e=o.arr[o.pos++],t=e&63,r=64,s=(e&64)>0?-1:1;if(!(e&128))return s*t;let n=o.arr.length;for(;o.pos<n;){if(e=o.arr[o.pos++],t=t+(e&127)*r,r*=128,e<128)return s*t;if(t>df)throw bh}throw xh};var N0=o=>{let e=Fe(o);if(e===0)return"";{let t=String.fromCodePoint(Ls(o));if(--e<100)for(;e--;)t+=String.fromCodePoint(Ls(o));else for(;e>0;){let r=e<1e4?e:1e4,s=o.arr.subarray(o.pos,o.pos+r);o.pos+=r,t+=String.fromCodePoint.apply(null,s),e-=r}return decodeURIComponent(escape(t))}},H0=o=>an.decode($t(o)),Hr=an?H0:N0;var bf=(o,e)=>{let t=new DataView(o.arr.buffer,o.arr.byteOffset+o.pos,e);return o.pos+=e,t},V0=o=>bf(o,4).getFloat32(0,!1),q0=o=>bf(o,8).getFloat64(0,!1),W0=o=>bf(o,8).getBigInt64(0,!1);var z0=[o=>{},o=>null,Gi,V0,q0,W0,o=>!1,o=>!0,Hr,o=>{let e=Fe(o),t={};for(let r=0;r<e;r++){let s=Hr(o);t[s]=pn(o)}return t},o=>{let e=Fe(o),t=[];for(let r=0;r<e;r++)t.push(pn(o));return t},$t],pn=o=>z0[127-Ls(o)](o),va=class extends dn{constructor(e,t){super(e),this.reader=t,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),wh(this)?this.count=Fe(this)+1:this.count=-1),this.count--,this.s}};var Cs=class extends dn{constructor(e){super(e),this.s=0,this.count=0}read(){if(this.count===0){this.s=Gi(this);let e=Vi(this.s);this.count=1,e&&(this.s=-this.s,this.count=Fe(this)+2)}return this.count--,this.s}};var mn=class extends dn{constructor(e){super(e),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){let e=Gi(this),t=e&1;this.diff=ir(e/2),this.count=1,t&&(this.count=Fe(this)+2)}return this.s+=this.diff,this.count--,this.s}},Ki=class{constructor(e){this.decoder=new Cs(e),this.str=Hr(this.decoder),this.spos=0}read(){let e=this.spos+this.decoder.read(),t=this.str.slice(this.spos,e);return this.spos=e,t}};var BM=crypto.subtle,_h=crypto.getRandomValues.bind(crypto);var Sa=()=>_h(new Uint32Array(1))[0];var K0=[1e7]+-1e3+-4e3+-8e3+-1e11,hn=()=>K0.replace(/[018]/g,o=>(o^Sa()&15>>o/4).toString(16));var Ts=Date.now;var Co=o=>new Promise(o);var G0=Promise.all.bind(Promise);var _f=o=>o===void 0?null:o;var vf=class{constructor(){this.map=new Map}setItem(e,t){this.map.set(e,t)}getItem(e){return this.map.get(e)}},kh=new vf,Y0=!0;try{typeof localStorage!="undefined"&&localStorage&&(kh=localStorage,Y0=!1)}catch(o){}var Ih=kh;var Lh=Object.assign,X0=Object.keys,Ch=(o,e)=>{for(let t in o)e(o[t],t)};var ka=o=>X0(o).length;var Th=o=>{for(let e in o)return!1;return!0},Q0=(o,e)=>{for(let t in o)if(!e(o[t],t))return!1;return!0},Sf=(o,e)=>Object.prototype.hasOwnProperty.call(o,e),kf=(o,e)=>o===e||ka(o)===ka(e)&&Q0(o,(t,r)=>(t!==void 0||Sf(e,r))&&e[r]===t);var Ia=(o,e,t=0)=>{try{for(;t<o.length;t++)o[t](...e)}finally{t<o.length&&Ia(o,e,t+1)}};var Ah=o=>o,Z0=(o,e)=>o===e;var gn=(o,e)=>{if(o==null||e==null)return Z0(o,e);if(o.constructor!==e.constructor)return!1;if(o===e)return!0;switch(o.constructor){case ArrayBuffer:o=new Uint8Array(o),e=new Uint8Array(e);case Uint8Array:{if(o.byteLength!==e.byteLength)return!1;for(let t=0;t<o.length;t++)if(o[t]!==e[t])return!1;break}case Set:{if(o.size!==e.size)return!1;for(let t of o)if(!e.has(t))return!1;break}case Map:{if(o.size!==e.size)return!1;for(let t of o.keys())if(!e.has(t)||!gn(o.get(t),e.get(t)))return!1;break}case Object:if(ka(o)!==ka(e))return!1;for(let t in o)if(!Sf(o,t)||!gn(o[t],e[t]))return!1;break;case Array:if(o.length!==e.length)return!1;for(let t=0;t<o.length;t++)if(!gn(o[t],e[t]))return!1;break;default:return!1}return!0},Fh=(o,e)=>e.includes(o);var La=typeof process!="undefined"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process!="undefined"?process:0)==="[object process]";var VM=typeof navigator!="undefined"?/Mac/.test(navigator.platform):!1,eo,ek=[],tk=()=>{if(eo===void 0)if(La){eo=Ft();let o=process.argv,e=null;for(let t=0;t<o.length;t++){let r=o[t];r[0]==="-"?(e!==null&&eo.set(e,""),e=r):e!==null?(eo.set(e,r),e=null):ek.push(r)}e!==null&&eo.set(e,"")}else typeof location=="object"?(eo=Ft(),(location.search||"?").slice(1).split("&").forEach(o=>{if(o.length!==0){let[e,t]=o.split("=");eo.set(`--${pf(e,"-")}`,t),eo.set(`-${pf(e,"-")}`,t)}})):eo=Ft();return eo},Lf=o=>tk().has(o);var Cf=o=>La?_f(process.env[o.toUpperCase().replaceAll("-","_")]):_f(Ih.getItem(o));var rk=o=>Lf("--"+o)||Cf(o)!==null,qM=rk("production"),Dh=La&&Fh(process.env.FORCE_COLOR,["true","1","2"]),Mh=!Lf("no-colors")&&(!La||process.stdout.isTTY||Dh)&&(!La||Lf("color")||Dh||Cf("COLORTERM")!==null||(Cf("TERM")||"").includes("color"));var sk=o=>new Uint8Array(o);var Eh=o=>{let e=sk(o.byteLength);return e.set(o),e};var Tf=class{constructor(e,t){this.left=e,this.right=t}},Jt=(o,e)=>new Tf(o,e);var Rh=(o,e)=>o.forEach(t=>e(t.left,t.right));var to=typeof document!="undefined"?document:{},ak=o=>to.createElement(o),ik=()=>to.createDocumentFragment(),lk=o=>to.createTextNode(o),WM=typeof DOMParser!="undefined"?new DOMParser:null;var ck=(o,e)=>(Rh(e,(t,r)=>{r===!1?o.removeAttribute(t):r===!0?o.setAttribute(t,""):o.setAttribute(t,r)}),o);var fk=o=>{let e=ik();for(let t=0;t<o.length;t++)$h(e,o[t]);return e},Oh=(o,e)=>($h(o,fk(e)),o);var Ca=(o,e=[],t=[])=>Oh(ck(ak(o),e),t);var yn=lk;var Uh=o=>lh(o,(e,t)=>`${t}:${e};`).join("");var $h=(o,e)=>o.appendChild(e),zM=to.ELEMENT_NODE,KM=to.TEXT_NODE,GM=to.CDATA_SECTION_NODE,jM=to.COMMENT_NODE,YM=to.DOCUMENT_NODE,JM=to.DOCUMENT_TYPE_NODE,XM=to.DOCUMENT_FRAGMENT_NODE;var ro=Symbol;var Ta=ro(),Pa=ro(),Af=ro(),Ff=ro(),Df=ro(),Aa=ro(),Mf=ro(),Fa=ro(),Ef=ro(),Nh=o=>{var s;o.length===1&&((s=o[0])==null?void 0:s.constructor)===Function&&(o=o[0]());let e=[],t=[],r=0;for(;r<o.length;r++){let n=o[r];n===void 0?e.push("undefined"):n.constructor===String||n.constructor===Number?e.push(n):n.constructor===Object&&t.push(JSON.stringify(n))}return t};var QM=Ts();var pk={[Ta]:Jt("font-weight","bold"),[Pa]:Jt("font-weight","normal"),[Af]:Jt("color","blue"),[Df]:Jt("color","green"),[Ff]:Jt("color","grey"),[Aa]:Jt("color","red"),[Mf]:Jt("color","purple"),[Fa]:Jt("color","orange"),[Ef]:Jt("color","black")},mk=o=>{var a;o.length===1&&((a=o[0])==null?void 0:a.constructor)===Function&&(o=o[0]());let e=[],t=[],r=Ft(),s=[],n=0;for(;n<o.length;n++){let i=o[n],l=pk[i];if(l!==void 0)r.set(l.left,l.right);else{if(i===void 0)break;if(i.constructor===String||i.constructor===Number){let f=Uh(r);n>0||f.length>0?(e.push("%c"+i),t.push(f)):e.push(i)}else break}}for(n>0&&(s=t,s.unshift(e.join("")));n<o.length;n++){let i=o[n];i instanceof Symbol||s.push(i)}return s},hk=Mh?mk:Nh,Hh=(...o)=>{console.log(...hk(o)),gk.forEach(e=>e.print(o))};var gk=Zr();var Vh=o=>({[Symbol.iterator](){return this},next:o}),qh=(o,e)=>Vh(()=>{let t;do t=o.next();while(!t.done&&!e(t.value));return t}),Yi=(o,e)=>Vh(()=>{let{done:t,value:r}=o.next();return{done:t,value:t?void 0:e(r)}});var Ma=class{constructor(e,t){this.clock=e,this.len=t}},Ps=class{constructor(){this.clients=new Map}},sg=(o,e,t)=>e.clients.forEach((r,s)=>{let n=o.doc.store.clients.get(s);for(let a=0;a<r.length;a++){let i=r[a];pg(o,n,i.clock,i.len,t)}}),_k=(o,e)=>{let t=0,r=o.length-1;for(;t<=r;){let s=ir((t+r)/2),n=o[s],a=n.clock;if(a<=e){if(e<a+n.len)return s;t=s+1}else r=s-1}return null},Jf=(o,e)=>{let t=o.clients.get(e.client);return t!==void 0&&_k(t,e.clock)!==null},Xf=o=>{o.clients.forEach(e=>{e.sort((s,n)=>s.clock-n.clock);let t,r;for(t=1,r=1;t<e.length;t++){let s=e[r-1],n=e[t];s.clock+s.len>=n.clock?s.len=Br(s.len,n.clock+n.len-s.clock):(r<t&&(e[r]=n),r++)}e.length=r})},Of=o=>{let e=new Ps;for(let t=0;t<o.length;t++)o[t].clients.forEach((r,s)=>{if(!e.clients.has(s)){let n=r.slice();for(let a=t+1;a<o.length;a++)fh(n,o[a].clients.get(s)||[]);e.clients.set(s,n)}});return Xf(e),e},rl=(o,e,t,r)=>{Ur(o.clients,e,()=>[]).push(new Ma(t,r))},Qf=()=>new Ps,vk=o=>{let e=Qf();return o.clients.forEach((t,r)=>{let s=[];for(let n=0;n<t.length;n++){let a=t[n];if(a.deleted){let i=a.id.clock,l=a.length;if(n+1<t.length)for(let f=t[n+1];n+1<t.length&&f.deleted;f=t[++n+1])l+=f.length;s.push(new Ma(i,l))}}s.length>0&&e.clients.set(r,s)}),e},es=(o,e)=>{Ee(o.restEncoder,e.clients.size),$r(e.clients.entries()).sort((t,r)=>r[0]-t[0]).forEach(([t,r])=>{o.resetDsCurVal(),Ee(o.restEncoder,t);let s=r.length;Ee(o.restEncoder,s);for(let n=0;n<s;n++){let a=r[n];o.writeDsClock(a.clock),o.writeDsLen(a.len)}})},Ea=o=>{let e=new Ps,t=Fe(o.restDecoder);for(let r=0;r<t;r++){o.resetDsCurVal();let s=Fe(o.restDecoder),n=Fe(o.restDecoder);if(n>0){let a=Ur(e.clients,s,()=>[]);for(let i=0;i<n;i++)a.push(new Ma(o.readDsClock(),o.readDsLen()))}}return e},Kh=(o,e,t)=>{let r=new Ps,s=Fe(o.restDecoder);for(let n=0;n<s;n++){o.resetDsCurVal();let a=Fe(o.restDecoder),i=Fe(o.restDecoder),l=t.clients.get(a)||[],f=kt(t,a);for(let u=0;u<i;u++){let d=o.readDsClock(),m=d+o.readDsLen();if(d<f){f<m&&rl(r,a,f,m-f);let y=so(l,d),h=l[y];for(!h.deleted&&h.id.clock<d&&(l.splice(y+1,0,ul(e,h,d-h.id.clock)),y++);y<l.length&&(h=l[y++],h.id.clock<m);)h.deleted||(m<h.id.clock+h.length&&l.splice(y,0,ul(e,h,m-h.id.clock)),h.delete(e))}else rl(r,a,d,m-d)}}if(r.clients.size>0){let n=new To;return Ee(n.restEncoder,0),es(n,r),n.toUint8Array()}return null};var ng=Sa,yr=class extends Hi{constructor({guid:e=hn(),collectionid:t=null,gc:r=!0,gcFilter:s=()=>!0,meta:n=null,autoLoad:a=!1,shouldLoad:i=!0}={}){super(),this.gc=r,this.gcFilter=s,this.clientID=ng(),this.guid=e,this.collectionid=t,this.share=new Map,this.store=new il,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=i,this.autoLoad=a,this.meta=n,this.isLoaded=!1,this.isSynced=!1,this.whenLoaded=Co(f=>{this.on("load",()=>{this.isLoaded=!0,f(this)})});let l=()=>Co(f=>{let u=d=>{(d===void 0||d===!0)&&(this.off("sync",u),f())};this.on("sync",u)});this.on("sync",f=>{f===!1&&this.isSynced&&(this.whenSynced=l()),this.isSynced=f===void 0||f===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=l()}load(){let e=this._item;e!==null&&!this.shouldLoad&&et(e.parent.doc,t=>{t.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set($r(this.subdocs).map(e=>e.guid))}transact(e,t=null){return et(this,e,t)}get(e,t=Lt){let r=Ur(this.share,e,()=>{let n=new t;return n._integrate(this,null),n}),s=r.constructor;if(t!==Lt&&s!==t)if(s===Lt){let n=new t;n._map=r._map,r._map.forEach(a=>{for(;a!==null;a=a.left)a.parent=n}),n._start=r._start;for(let a=n._start;a!==null;a=a.right)a.parent=n;return n._length=r._length,this.share.set(e,n),n._integrate(this,null),n}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return r}getArray(e=""){return this.get(e,oo)}getText(e=""){return this.get(e,os)}getMap(e=""){return this.get(e,Po)}getXmlElement(e=""){return this.get(e,ss)}getXmlFragment(e=""){return this.get(e,Ao)}toJSON(){let e={};return this.share.forEach((t,r)=>{e[r]=t.toJSON()}),e}destroy(){$r(this.subdocs).forEach(t=>t.destroy());let e=this._item;if(e!==null){this._item=null;let t=e.content;t.doc=new yr({guid:this.guid,...t.opts,shouldLoad:!1}),t.doc._item=e,et(e.parent.doc,r=>{let s=t.doc;e.deleted||r.subdocsAdded.add(s),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}},wn=class{constructor(e){this.restDecoder=e}resetDsCurVal(){}readDsClock(){return Fe(this.restDecoder)}readDsLen(){return Fe(this.restDecoder)}},ol=class extends wn{readLeftID(){return He(Fe(this.restDecoder),Fe(this.restDecoder))}readRightID(){return He(Fe(this.restDecoder),Fe(this.restDecoder))}readClient(){return Fe(this.restDecoder)}readInfo(){return Ls(this.restDecoder)}readString(){return Hr(this.restDecoder)}readParentInfo(){return Fe(this.restDecoder)===1}readTypeRef(){return Fe(this.restDecoder)}readLen(){return Fe(this.restDecoder)}readAny(){return pn(this.restDecoder)}readBuf(){return Eh($t(this.restDecoder))}readJSON(){return JSON.parse(Hr(this.restDecoder))}readKey(){return Hr(this.restDecoder)}},Uf=class{constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=Fe(this.restDecoder),this.dsCurrVal}readDsLen(){let e=Fe(this.restDecoder)+1;return this.dsCurrVal+=e,e}},ts=class extends Uf{constructor(e){super(e),this.keys=[],Fe(e),this.keyClockDecoder=new mn($t(e)),this.clientDecoder=new Cs($t(e)),this.leftClockDecoder=new mn($t(e)),this.rightClockDecoder=new mn($t(e)),this.infoDecoder=new va($t(e),Ls),this.stringDecoder=new Ki($t(e)),this.parentInfoDecoder=new va($t(e),Ls),this.typeRefDecoder=new Cs($t(e)),this.lenDecoder=new Cs($t(e))}readLeftID(){return new Zo(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new Zo(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return pn(this.restDecoder)}readBuf(){return $t(this.restDecoder)}readJSON(){return pn(this.restDecoder)}readKey(){let e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{let t=this.stringDecoder.read();return this.keys.push(t),t}}},_n=class{constructor(){this.restEncoder=Is()}toUint8Array(){return gr(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){Ee(this.restEncoder,e)}writeDsLen(e){Ee(this.restEncoder,e)}},As=class extends _n{writeLeftID(e){Ee(this.restEncoder,e.client),Ee(this.restEncoder,e.clock)}writeRightID(e){Ee(this.restEncoder,e.client),Ee(this.restEncoder,e.clock)}writeClient(e){Ee(this.restEncoder,e)}writeInfo(e){Wi(this.restEncoder,e)}writeString(e){Lo(this.restEncoder,e)}writeParentInfo(e){Ee(this.restEncoder,e?1:0)}writeTypeRef(e){Ee(this.restEncoder,e)}writeLen(e){Ee(this.restEncoder,e)}writeAny(e){fn(this.restEncoder,e)}writeBuf(e){Mt(this.restEncoder,e)}writeJSON(e){Lo(this.restEncoder,JSON.stringify(e))}writeKey(e){Lo(this.restEncoder,e)}},sl=class{constructor(){this.restEncoder=Is(),this.dsCurrVal=0}toUint8Array(){return gr(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){let t=e-this.dsCurrVal;this.dsCurrVal=e,Ee(this.restEncoder,t)}writeDsLen(e){e===0&&Tr(),Ee(this.restEncoder,e-1),this.dsCurrVal+=e}},To=class extends sl{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new un,this.clientEncoder=new ks,this.leftClockEncoder=new un,this.rightClockEncoder=new un,this.infoEncoder=new wa(Wi),this.stringEncoder=new qi,this.parentInfoEncoder=new wa(Wi),this.typeRefEncoder=new ks,this.lenEncoder=new ks}toUint8Array(){let e=Is();return Ee(e,0),Mt(e,this.keyClockEncoder.toUint8Array()),Mt(e,this.clientEncoder.toUint8Array()),Mt(e,this.leftClockEncoder.toUint8Array()),Mt(e,this.rightClockEncoder.toUint8Array()),Mt(e,gr(this.infoEncoder)),Mt(e,this.stringEncoder.toUint8Array()),Mt(e,gr(this.parentInfoEncoder)),Mt(e,this.typeRefEncoder.toUint8Array()),Mt(e,this.lenEncoder.toUint8Array()),_a(e,gr(this.restEncoder)),gr(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){fn(this.restEncoder,e)}writeBuf(e){Mt(this.restEncoder,e)}writeJSON(e){fn(this.restEncoder,e)}writeKey(e){let t=this.keyMap.get(e);t===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(t)}},Sk=(o,e,t,r)=>{r=Br(r,e[0].id.clock);let s=so(e,r);Ee(o.restEncoder,e.length-s),o.writeClient(t),Ee(o.restEncoder,r);let n=e[s];n.write(o,r-n.id.clock);for(let a=s+1;a<e.length;a++)e[a].write(o,0)},Zf=(o,e,t)=>{let r=new Map;t.forEach((s,n)=>{kt(e,n)>s&&r.set(n,s)}),dl(e).forEach((s,n)=>{t.has(n)||r.set(n,0)}),Ee(o.restEncoder,r.size),$r(r.entries()).sort((s,n)=>n[0]-s[0]).forEach(([s,n])=>{Sk(o,e.clients.get(s),s,n)})},kk=(o,e)=>{let t=Ft(),r=Fe(o.restDecoder);for(let s=0;s<r;s++){let n=Fe(o.restDecoder),a=new Array(n),i=o.readClient(),l=Fe(o.restDecoder);t.set(i,{i:0,refs:a});for(let f=0;f<n;f++){let u=o.readInfo();switch(31&u){case 0:{let d=o.readLen();a[f]=new lr(He(i,l),d),l+=d;break}case 10:{let d=Fe(o.restDecoder);a[f]=new cr(He(i,l),d),l+=d;break}default:{let d=(u&192)===0,m=new ut(He(i,l),null,(u&128)===128?o.readLeftID():null,null,(u&64)===64?o.readRightID():null,d?o.readParentInfo()?e.get(o.readString()):o.readLeftID():null,d&&(u&32)===32?o.readString():null,Dg(o,u));a[f]=m,l+=m.length}}}}return t},Ik=(o,e,t)=>{let r=[],s=$r(t.keys()).sort((y,h)=>y-h);if(s.length===0)return null;let n=()=>{if(s.length===0)return null;let y=t.get(s[s.length-1]);for(;y.refs.length===y.i;)if(s.pop(),s.length>0)y=t.get(s[s.length-1]);else return null;return y},a=n();if(a===null)return null;let i=new il,l=new Map,f=(y,h)=>{let _=l.get(y);(_==null||_>h)&&l.set(y,h)},u=a.refs[a.i++],d=new Map,m=()=>{for(let y of r){let h=y.id.client,_=t.get(h);_?(_.i--,i.clients.set(h,_.refs.slice(_.i)),t.delete(h),_.i=0,_.refs=[]):i.clients.set(h,[y]),s=s.filter(w=>w!==h)}r.length=0};for(;;){if(u.constructor!==cr){let h=Ur(d,u.id.client,()=>kt(e,u.id.client))-u.id.clock;if(h<0)r.push(u),f(u.id.client,u.id.clock-1),m();else{let _=u.getMissing(o,e);if(_!==null){r.push(u);let w=t.get(_)||{refs:[],i:0};if(w.refs.length===w.i)f(_,kt(e,_)),m();else{u=w.refs[w.i++];continue}}else(h===0||h<u.length)&&(u.integrate(o,h),d.set(u.id.client,u.id.clock+u.length))}}if(r.length>0)u=r.pop();else if(a!==null&&a.i<a.refs.length)u=a.refs[a.i++];else{if(a=n(),a===null)break;u=a.refs[a.i++]}}if(i.clients.size>0){let y=new To;return Zf(y,i,new Map),Ee(y.restEncoder,0),{missing:l,update:y.toUint8Array()}}return null},Lk=(o,e)=>Zf(o,e.doc.store,e.beforeState),Ck=(o,e,t,r=new ts(o))=>et(e,s=>{s.local=!1;let n=!1,a=s.doc,i=a.store,l=kk(r,a),f=Ik(s,i,l),u=i.pendingStructs;if(u){for(let[m,y]of u.missing)if(y<kt(i,m)){n=!0;break}if(f){for(let[m,y]of f.missing){let h=u.missing.get(m);(h==null||h>y)&&u.missing.set(m,y)}u.update=ll([u.update,f.update])}}else i.pendingStructs=f;let d=Kh(r,s,i);if(i.pendingDs){let m=new ts(Vr(i.pendingDs));Fe(m.restDecoder);let y=Kh(m,s,i);d&&y?i.pendingDs=ll([d,y]):i.pendingDs=d||y}else i.pendingDs=d;if(n){let m=i.pendingStructs.update;i.pendingStructs=null,ag(s.doc,m)}},t,!1);var ag=(o,e,t,r=ts)=>{let s=Vr(e);Ck(s,o,t,new r(s))},Mo=(o,e,t)=>ag(o,e,t,ol),Tk=(o,e,t=new Map)=>{Zf(o,e.store,t),es(o,vk(e.store))},Pk=(o,e=new Uint8Array([0]),t=new To)=>{let r=ig(e);Tk(t,o,r);let s=[t.toUint8Array()];if(o.store.pendingDs&&s.push(o.store.pendingDs),o.store.pendingStructs&&s.push(Vk(o.store.pendingStructs.update,e)),s.length>1){if(t.constructor===As)return Nk(s.map((n,a)=>a===0?n:Wk(n)));if(t.constructor===To)return ll(s)}return s[0]},Es=(o,e)=>Pk(o,e,new As),Ak=o=>{let e=new Map,t=Fe(o.restDecoder);for(let r=0;r<t;r++){let s=Fe(o.restDecoder),n=Fe(o.restDecoder);e.set(s,n)}return e},ig=o=>Ak(new wn(Vr(o))),lg=(o,e)=>(Ee(o.restEncoder,e.size),$r(e.entries()).sort((t,r)=>r[0]-t[0]).forEach(([t,r])=>{Ee(o.restEncoder,t),Ee(o.restEncoder,r)}),o),Fk=(o,e)=>lg(o,dl(e.store)),Dk=(o,e=new sl)=>(o instanceof Map?lg(e,o):Fk(e,o),e.toUint8Array()),cg=o=>Dk(o,new _n),$f=class{constructor(){this.l=[]}},Gh=()=>new $f,jh=(o,e)=>o.l.push(e),Yh=(o,e)=>{let t=o.l,r=t.length;o.l=t.filter(s=>e!==s),r===o.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},fg=(o,e,t)=>Ia(o.l,[e,t]),Zo=class{constructor(e,t){this.client=e,this.clock=t}},bn=(o,e)=>o===e||o!==null&&e!==null&&o.client===e.client&&o.clock===e.clock,He=(o,e)=>new Zo(o,e);var ug=o=>{for(let[e,t]of o.doc.share.entries())if(t===o)return e;throw Tr()};var nl=class{constructor(e,t=e.getMap("users")){let r=new Map;this.yusers=t,this.doc=e,this.clients=new Map,this.dss=r;let s=(n,a)=>{let i=n.get("ds"),l=n.get("ids"),f=u=>this.clients.set(u,a);i.observe(u=>{u.changes.added.forEach(d=>{d.content.getContent().forEach(m=>{m instanceof Uint8Array&&this.dss.set(a,Of([this.dss.get(a)||Qf(),Ea(new wn(Vr(m)))]))})})}),this.dss.set(a,Of(i.map(u=>Ea(new wn(Vr(u)))))),l.observe(u=>u.changes.added.forEach(d=>d.content.getContent().forEach(f))),l.forEach(f)};t.observe(n=>{n.keysChanged.forEach(a=>s(t.get(a),a))}),t.forEach(s)}setUserMapping(e,t,r,{filter:s=()=>!0}={}){let n=this.yusers,a=n.get(r);a||(a=new Po,a.set("ids",new oo),a.set("ds",new oo),n.set(r,a)),a.get("ids").push([t]),n.observe(i=>{setTimeout(()=>{let l=n.get(r);if(l!==a){a=l,this.clients.forEach((d,m)=>{r===d&&a.get("ids").push([m])});let f=new _n,u=this.dss.get(r);u&&(es(f,u),a.get("ds").push([f.toUint8Array()]))}},0)}),e.on("afterTransaction",i=>{setTimeout(()=>{let l=a.get("ds"),f=i.deleteSet;if(i.local&&f.clients.size>0&&s(i,f)){let u=new _n;es(u,f),l.push([u.toUint8Array()])}})})}getUserByClientId(e){return this.clients.get(e)||null}getUserByDeletedId(e){for(let[t,r]of this.dss.entries())if(Jf(r,e))return t;return null}},al=class{constructor(e,t,r,s=0){this.type=e,this.tname=t,this.item=r,this.assoc=s}};var eu=o=>new al(o.type==null?null:He(o.type.client,o.type.clock),o.tname||null,o.item==null?null:He(o.item.client,o.item.clock),o.assoc==null?0:o.assoc),Bf=class{constructor(e,t,r=0){this.type=e,this.index=t,this.assoc=r}},Mk=(o,e,t=0)=>new Bf(o,e,t),Ji=(o,e,t)=>{let r=null,s=null;return o._item===null?s=ug(o):r=He(o._item.id.client,o._item.id.clock),new al(r,s,e,t)},tu=(o,e,t=0)=>{let r=o._start;if(t<0){if(e===0)return Ji(o,null,t);e--}for(;r!==null;){if(!r.deleted&&r.countable){if(r.length>e)return Ji(o,He(r.id.client,r.id.clock+e),t);e-=r.length}if(r.right===null&&t<0)return Ji(o,r.lastId,t);r=r.right}return Ji(o,null,t)};var ru=(o,e)=>{let t=e.store,r=o.item,s=o.type,n=o.tname,a=o.assoc,i=null,l=0;if(r!==null){if(kt(t,r.client)<=r.clock)return null;let f=og(t,r),u=f.item;if(!(u instanceof ut))return null;if(i=u.parent,i._item===null||!i._item.deleted){l=u.deleted||!u.countable?0:f.diff+(a>=0?0:1);let d=u.left;for(;d!==null;)!d.deleted&&d.countable&&(l+=d.length),d=d.left}}else{if(n!==null)i=e.get(n);else if(s!==null){if(kt(t,s.client)<=s.clock)return null;let{item:f}=og(t,s);if(f instanceof ut&&f.content instanceof Ar)i=f.content.type;else return null}else throw Tr();a>=0?l=i._length:l=0}return Mk(i,l,o.assoc)},ou=(o,e)=>o===e||o!==null&&e!==null&&o.tname===e.tname&&bn(o.item,e.item)&&bn(o.type,e.type)&&o.assoc===e.assoc,Nf=class{constructor(e,t){this.ds=e,this.sv=t}};var Ek=(o,e)=>new Nf(o,e),lE=Ek(Qf(),new Map);var xn=(o,e)=>e===void 0?!o.deleted:e.sv.has(o.id.client)&&(e.sv.get(o.id.client)||0)>o.id.clock&&!Jf(e.ds,o.id),Hf=(o,e)=>{let t=Ur(o.meta,Hf,Zr),r=o.doc.store;t.has(e)||(e.sv.forEach((s,n)=>{s<kt(r,n)&&rs(o,He(n,s))}),sg(o,e.ds,s=>{}),t.add(e))};var il=class{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}},dl=o=>{let e=new Map;return o.clients.forEach((t,r)=>{let s=t[t.length-1];e.set(r,s.id.clock+s.length)}),e},kt=(o,e)=>{let t=o.clients.get(e);if(t===void 0)return 0;let r=t[t.length-1];return r.id.clock+r.length},dg=(o,e)=>{let t=o.clients.get(e.id.client);if(t===void 0)t=[],o.clients.set(e.id.client,t);else{let r=t[t.length-1];if(r.id.clock+r.length!==e.id.clock)throw Tr()}t.push(e)},so=(o,e)=>{let t=0,r=o.length-1,s=o[r],n=s.id.clock;if(n===e)return r;let a=ir(e/(n+s.length-1)*r);for(;t<=r;){if(s=o[a],n=s.id.clock,n<=e){if(e<n+s.length)return a;t=a+1}else r=a-1;a=ir((t+r)/2)}throw Tr()},Rk=(o,e)=>{let t=o.clients.get(e.client);return t[so(t,e.clock)]},Zi=Rk,Vf=(o,e,t)=>{let r=so(e,t),s=e[r];return s.id.clock<t&&s instanceof ut?(e.splice(r+1,0,ul(o,s,t-s.id.clock)),r+1):r},rs=(o,e)=>{let t=o.doc.store.clients.get(e.client);return t[Vf(o,t,e.clock)]},Jh=(o,e,t)=>{let r=e.clients.get(t.client),s=so(r,t.clock),n=r[s];return t.clock!==n.id.clock+n.length-1&&n.constructor!==lr&&r.splice(s+1,0,ul(o,n,t.clock-n.id.clock+1)),n},Ok=(o,e,t)=>{let r=o.clients.get(e.id.client);r[so(r,e.id.clock)]=t},pg=(o,e,t,r,s)=>{if(r===0)return;let n=t+r,a=Vf(o,e,t),i;do i=e[a++],n<i.id.clock+i.length&&Vf(o,e,n),s(i);while(a<e.length&&e[a].id.clock<n)},qf=class{constructor(e,t,r){this.doc=e,this.deleteSet=new Ps,this.beforeState=dl(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=t,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}},Xh=(o,e)=>e.deleteSet.clients.size===0&&!ch(e.afterState,(t,r)=>e.beforeState.get(r)!==t)?!1:(Xf(e.deleteSet),Lk(o,e),es(o,e.deleteSet),!0),Qh=(o,e,t)=>{let r=e._item;(r===null||r.id.clock<(o.beforeState.get(r.id.client)||0)&&!r.deleted)&&Ur(o.changed,e,Zr).add(t)},el=(o,e)=>{let t=o[e],r=o[e-1],s=e;for(;s>0;t=r,r=o[--s-1]){if(r.deleted===t.deleted&&r.constructor===t.constructor&&r.mergeWith(t)){t instanceof ut&&t.parentSub!==null&&t.parent._map.get(t.parentSub)===t&&t.parent._map.set(t.parentSub,r);continue}break}let n=e-s;return n&&o.splice(e+1-n,n),n},Uk=(o,e,t)=>{for(let[r,s]of o.clients.entries()){let n=e.clients.get(r);for(let a=s.length-1;a>=0;a--){let i=s[a],l=i.clock+i.len;for(let f=so(n,i.clock),u=n[f];f<n.length&&u.id.clock<l;u=n[++f]){let d=n[f];if(i.clock+i.len<=d.id.clock)break;d instanceof ut&&d.deleted&&!d.keep&&t(d)&&d.gc(e,!1)}}}},$k=(o,e)=>{o.clients.forEach((t,r)=>{let s=e.clients.get(r);for(let n=t.length-1;n>=0;n--){let a=t[n],i=sn(s.length-1,1+so(s,a.clock+a.len-1));for(let l=i,f=s[l];l>0&&f.id.clock>=a.clock;f=s[l])l-=1+el(s,l)}})};var mg=(o,e)=>{if(e<o.length){let t=o[e],r=t.doc,s=r.store,n=t.deleteSet,a=t._mergeStructs;try{Xf(n),t.afterState=dl(t.doc.store),r.emit("beforeObserverCalls",[t,r]);let i=[];t.changed.forEach((l,f)=>i.push(()=>{(f._item===null||!f._item.deleted)&&f._callObserver(t,l)})),i.push(()=>{t.changedParentTypes.forEach((l,f)=>{f._dEH.l.length>0&&(f._item===null||!f._item.deleted)&&(l=l.filter(u=>u.target._item===null||!u.target._item.deleted),l.forEach(u=>{u.currentTarget=f,u._path=null}),l.sort((u,d)=>u.path.length-d.path.length),fg(f._dEH,l,t))})}),i.push(()=>r.emit("afterTransaction",[t,r])),Ia(i,[]),t._needFormattingCleanup&&tI(t)}finally{r.gc&&Uk(n,s,r.gcFilter),$k(n,s),t.afterState.forEach((u,d)=>{let m=t.beforeState.get(d)||0;if(m!==u){let y=s.clients.get(d),h=Br(so(y,m),1);for(let _=y.length-1;_>=h;)_-=1+el(y,_)}});for(let u=a.length-1;u>=0;u--){let{client:d,clock:m}=a[u].id,y=s.clients.get(d),h=so(y,m);h+1<y.length&&el(y,h+1)>1||h>0&&el(y,h)}if(!t.local&&t.afterState.get(r.clientID)!==t.beforeState.get(r.clientID)&&(Hh(Fa,Ta,"[yjs] ",Pa,Aa,"Changed the client-id because another client seems to be using it."),r.clientID=ng()),r.emit("afterTransactionCleanup",[t,r]),r._observers.has("update")){let u=new As;Xh(u,t)&&r.emit("update",[u.toUint8Array(),t.origin,r,t])}if(r._observers.has("updateV2")){let u=new To;Xh(u,t)&&r.emit("updateV2",[u.toUint8Array(),t.origin,r,t])}let{subdocsAdded:i,subdocsLoaded:l,subdocsRemoved:f}=t;(i.size>0||f.size>0||l.size>0)&&(i.forEach(u=>{u.clientID=r.clientID,u.collectionid==null&&(u.collectionid=r.collectionid),r.subdocs.add(u)}),f.forEach(u=>r.subdocs.delete(u)),r.emit("subdocs",[{loaded:l,added:i,removed:f},r,t]),f.forEach(u=>u.destroy())),o.length<=e+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,o])):mg(o,e+1)}}},et=(o,e,t=null,r=!0)=>{let s=o._transactionCleanups,n=!1,a=null;o._transaction===null&&(n=!0,o._transaction=new qf(o,t,r),s.push(o._transaction),s.length===1&&o.emit("beforeAllTransactions",[o]),o.emit("beforeTransaction",[o._transaction,o]));try{a=e(o._transaction)}finally{if(n){let i=o._transaction===s[0];o._transaction=null,i&&mg(s,0)}}return a};function*Bk(o){let e=Fe(o.restDecoder);for(let t=0;t<e;t++){let r=Fe(o.restDecoder),s=o.readClient(),n=Fe(o.restDecoder);for(let a=0;a<r;a++){let i=o.readInfo();if(i===10){let l=Fe(o.restDecoder);yield new cr(He(s,n),l),n+=l}else if(31&i){let l=(i&192)===0,f=new ut(He(s,n),null,(i&128)===128?o.readLeftID():null,null,(i&64)===64?o.readRightID():null,l?o.readParentInfo()?o.readString():o.readLeftID():null,l&&(i&32)===32?o.readString():null,Dg(o,i));yield f,n+=f.length}else{let l=o.readLen();yield new lr(He(s,n),l),n+=l}}}}var Ra=class{constructor(e,t){this.gen=Bk(e),this.curr=null,this.done=!1,this.filterSkips=t,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===cr);return this.curr}};var Oa=class{constructor(e){this.currClient=0,this.startClock=0,this.written=0,this.encoder=e,this.clientStructs=[]}},Nk=o=>ll(o,ol,As);var Hk=(o,e)=>{if(o.constructor===lr){let{client:t,clock:r}=o.id;return new lr(He(t,r+e),o.length-e)}else if(o.constructor===cr){let{client:t,clock:r}=o.id;return new cr(He(t,r+e),o.length-e)}else{let t=o,{client:r,clock:s}=t.id;return new ut(He(r,s+e),null,He(r,s+e-1),null,t.rightOrigin,t.parent,t.parentSub,t.content.splice(e))}},ll=(o,e=ts,t=To)=>{if(o.length===1)return o[0];let r=o.map(u=>new e(Vr(u))),s=r.map(u=>new Ra(u,!0)),n=null,a=new t,i=new Oa(a);for(;s=s.filter(m=>m.curr!==null),s.sort((m,y)=>{if(m.curr.id.client===y.curr.id.client){let h=m.curr.id.clock-y.curr.id.clock;return h===0?m.curr.constructor===y.curr.constructor?0:m.curr.constructor===cr?1:-1:h}else return y.curr.id.client-m.curr.id.client}),s.length!==0;){let u=s[0],d=u.curr.id.client;if(n!==null){let m=u.curr,y=!1;for(;m!==null&&m.id.clock+m.length<=n.struct.id.clock+n.struct.length&&m.id.client>=n.struct.id.client;)m=u.next(),y=!0;if(m===null||m.id.client!==d||y&&m.id.clock>n.struct.id.clock+n.struct.length)continue;if(d!==n.struct.id.client)Xo(i,n.struct,n.offset),n={struct:m,offset:0},u.next();else if(n.struct.id.clock+n.struct.length<m.id.clock)if(n.struct.constructor===cr)n.struct.length=m.id.clock+m.length-n.struct.id.clock;else{Xo(i,n.struct,n.offset);let h=m.id.clock-n.struct.id.clock-n.struct.length;n={struct:new cr(He(d,n.struct.id.clock+n.struct.length),h),offset:0}}else{let h=n.struct.id.clock+n.struct.length-m.id.clock;h>0&&(n.struct.constructor===cr?n.struct.length-=h:m=Hk(m,h)),n.struct.mergeWith(m)||(Xo(i,n.struct,n.offset),n={struct:m,offset:0},u.next())}}else n={struct:u.curr,offset:0},u.next();for(let m=u.curr;m!==null&&m.id.client===d&&m.id.clock===n.struct.id.clock+n.struct.length&&m.constructor!==cr;m=u.next())Xo(i,n.struct,n.offset),n={struct:m,offset:0}}n!==null&&(Xo(i,n.struct,n.offset),n=null),su(i);let l=r.map(u=>Ea(u)),f=Of(l);return es(a,f),a.toUint8Array()},Vk=(o,e,t=ts,r=To)=>{let s=ig(e),n=new r,a=new Oa(n),i=new t(Vr(o)),l=new Ra(i,!1);for(;l.curr;){let u=l.curr,d=u.id.client,m=s.get(d)||0;if(l.curr.constructor===cr){l.next();continue}if(u.id.clock+u.length>m)for(Xo(a,u,Br(m-u.id.clock,0)),l.next();l.curr&&l.curr.id.client===d;)Xo(a,l.curr,0),l.next();else for(;l.curr&&l.curr.id.client===d&&l.curr.id.clock+l.curr.length<=m;)l.next()}su(a);let f=Ea(i);return es(n,f),n.toUint8Array()};var hg=o=>{o.written>0&&(o.clientStructs.push({written:o.written,restEncoder:gr(o.encoder.restEncoder)}),o.encoder.restEncoder=Is(),o.written=0)},Xo=(o,e,t)=>{o.written>0&&o.currClient!==e.id.client&&hg(o),o.written===0&&(o.currClient=e.id.client,o.encoder.writeClient(e.id.client),Ee(o.encoder.restEncoder,e.id.clock+t)),e.write(o.encoder,t),o.written++},su=o=>{hg(o);let e=o.encoder.restEncoder;Ee(e,o.clientStructs.length);for(let t=0;t<o.clientStructs.length;t++){let r=o.clientStructs[t];Ee(e,r.written),_a(e,r.restEncoder)}},qk=(o,e,t,r)=>{let s=new t(Vr(o)),n=new Ra(s,!1),a=new r,i=new Oa(a);for(let f=n.curr;f!==null;f=n.next())Xo(i,e(f),0);su(i);let l=Ea(s);return es(a,l),a.toUint8Array()};var Wk=o=>qk(o,Ah,ts,As),Zh="You must not compute changes after the event-handler fired.",vn=class{constructor(e,t){this.target=e,this.currentTarget=e,this.transaction=t,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=zk(this.currentTarget,this.target))}deletes(e){return Jf(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw Cr(Zh);let e=new Map,t=this.target;this.transaction.changed.get(t).forEach(s=>{if(s!==null){let n=t._map.get(s),a,i;if(this.adds(n)){let l=n.left;for(;l!==null&&this.adds(l);)l=l.left;if(this.deletes(n))if(l!==null&&this.deletes(l))a="delete",i=Ni(l.content.getContent());else return;else l!==null&&this.deletes(l)?(a="update",i=Ni(l.content.getContent())):(a="add",i=void 0)}else if(this.deletes(n))a="delete",i=Ni(n.content.getContent());else return;e.set(s,{action:a,oldValue:i})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw Cr(Zh);let t=this.target,r=Zr(),s=Zr(),n=[];if(e={added:r,deleted:s,delta:n,keys:this.keys},this.transaction.changed.get(t).has(null)){let i=null,l=()=>{i&&n.push(i)};for(let f=t._start;f!==null;f=f.right)f.deleted?this.deletes(f)&&!this.adds(f)&&((i===null||i.delete===void 0)&&(l(),i={delete:0}),i.delete+=f.length,s.add(f)):this.adds(f)?((i===null||i.insert===void 0)&&(l(),i={insert:[]}),i.insert=i.insert.concat(f.content.getContent()),r.add(f)):((i===null||i.retain===void 0)&&(l(),i={retain:0}),i.retain+=f.length);i!==null&&i.retain===void 0&&l()}this._changes=e}return e}},zk=(o,e)=>{let t=[];for(;e._item!==null&&e!==o;){if(e._item.parentSub!==null)t.unshift(e._item.parentSub);else{let r=0,s=e._item.parent._start;for(;s!==e._item&&s!==null;)s.deleted||r++,s=s.right;t.unshift(r)}e=e._item.parent}return t},gg=80,nu=0,Wf=class{constructor(e,t){e.marker=!0,this.p=e,this.index=t,this.timestamp=nu++}},Kk=o=>{o.timestamp=nu++},yg=(o,e,t)=>{o.p.marker=!1,o.p=e,e.marker=!0,o.index=t,o.timestamp=nu++},Gk=(o,e,t)=>{if(o.length>=gg){let r=o.reduce((s,n)=>s.timestamp<n.timestamp?s:n);return yg(r,e,t),r}else{let r=new Wf(e,t);return o.push(r),r}},pl=(o,e)=>{if(o._start===null||e===0||o._searchMarker===null)return null;let t=o._searchMarker.length===0?null:o._searchMarker.reduce((n,a)=>on(e-n.index)<on(e-a.index)?n:a),r=o._start,s=0;for(t!==null&&(r=t.p,s=t.index,Kk(t));r.right!==null&&s<e;){if(!r.deleted&&r.countable){if(e<s+r.length)break;s+=r.length}r=r.right}for(;r.left!==null&&s>e;)r=r.left,!r.deleted&&r.countable&&(s-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(s-=r.length);return t!==null&&on(t.index-s)<r.parent.length/gg?(yg(t,r,s),t):Gk(o._searchMarker,r,s)},Ua=(o,e,t)=>{for(let r=o.length-1;r>=0;r--){let s=o[r];if(t>0){let n=s.p;for(n.marker=!1;n&&(n.deleted||!n.countable);)n=n.left,n&&!n.deleted&&n.countable&&(s.index-=n.length);if(n===null||n.marker===!0){o.splice(r,1);continue}s.p=n,n.marker=!0}(e<s.index||t>0&&e===s.index)&&(s.index=Br(e,s.index+t))}};var ml=(o,e,t)=>{let r=o,s=e.changedParentTypes;for(;Ur(s,o,()=>[]).push(t),o._item!==null;)o=o._item.parent;fg(r._eH,t,e)},Lt=class{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=Gh(),this._dEH=Gh(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,t){this.doc=e,this._item=t}_copy(){throw Nr()}clone(){throw Nr()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,t){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){jh(this._eH,e)}observeDeep(e){jh(this._dEH,e)}unobserve(e){Yh(this._eH,e)}unobserveDeep(e){Yh(this._dEH,e)}toJSON(){}},xg=(o,e,t)=>{e<0&&(e=o._length+e),t<0&&(t=o._length+t);let r=t-e,s=[],n=o._start;for(;n!==null&&r>0;){if(n.countable&&!n.deleted){let a=n.content.getContent();if(a.length<=e)e-=a.length;else{for(let i=e;i<a.length&&r>0;i++)s.push(a[i]),r--;e=0}}n=n.right}return s},bg=o=>{let e=[],t=o._start;for(;t!==null;){if(t.countable&&!t.deleted){let r=t.content.getContent();for(let s=0;s<r.length;s++)e.push(r[s])}t=t.right}return e};var $a=(o,e)=>{let t=0,r=o._start;for(;r!==null;){if(r.countable&&!r.deleted){let s=r.content.getContent();for(let n=0;n<s.length;n++)e(s[n],t++,o)}r=r.right}},wg=(o,e)=>{let t=[];return $a(o,(r,s)=>{t.push(e(r,s,o))}),t},jk=o=>{let e=o._start,t=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(t===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};t=e.content.getContent(),r=0,e=e.right}let s=t[r++];return t.length<=r&&(t=null),{done:!1,value:s}}}},_g=(o,e)=>{let t=pl(o,e),r=o._start;for(t!==null&&(r=t.p,e-=t.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(e<r.length)return r.content.getContent()[e];e-=r.length}},cl=(o,e,t,r)=>{let s=t,n=o.doc,a=n.clientID,i=n.store,l=t===null?e._start:t.right,f=[],u=()=>{f.length>0&&(s=new ut(He(a,kt(i,a)),s,s&&s.lastId,l,l&&l.id,e,null,new Do(f)),s.integrate(o,0),f=[])};r.forEach(d=>{if(d===null)f.push(d);else switch(d.constructor){case Number:case Object:case Boolean:case Array:case String:f.push(d);break;default:switch(u(),d.constructor){case Uint8Array:case ArrayBuffer:s=new ut(He(a,kt(i,a)),s,s&&s.lastId,l,l&&l.id,e,null,new Fs(new Uint8Array(d))),s.integrate(o,0);break;case yr:s=new ut(He(a,kt(i,a)),s,s&&s.lastId,l,l&&l.id,e,null,new Ms(d)),s.integrate(o,0);break;default:if(d instanceof Lt)s=new ut(He(a,kt(i,a)),s,s&&s.lastId,l,l&&l.id,e,null,new Ar(d)),s.integrate(o,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},vg=()=>Cr("Length exceeded!"),Sg=(o,e,t,r)=>{if(t>e._length)throw vg();if(t===0)return e._searchMarker&&Ua(e._searchMarker,t,r.length),cl(o,e,null,r);let s=t,n=pl(e,t),a=e._start;for(n!==null&&(a=n.p,t-=n.index,t===0&&(a=a.prev,t+=a&&a.countable&&!a.deleted?a.length:0));a!==null;a=a.right)if(!a.deleted&&a.countable){if(t<=a.length){t<a.length&&rs(o,He(a.id.client,a.id.clock+t));break}t-=a.length}return e._searchMarker&&Ua(e._searchMarker,s,r.length),cl(o,e,a,r)},Yk=(o,e,t)=>{let s=(e._searchMarker||[]).reduce((n,a)=>a.index>n.index?a:n,{index:0,p:e._start}).p;if(s)for(;s.right;)s=s.right;return cl(o,e,s,t)},kg=(o,e,t,r)=>{if(r===0)return;let s=t,n=r,a=pl(e,t),i=e._start;for(a!==null&&(i=a.p,t-=a.index);i!==null&&t>0;i=i.right)!i.deleted&&i.countable&&(t<i.length&&rs(o,He(i.id.client,i.id.clock+t)),t-=i.length);for(;r>0&&i!==null;)i.deleted||(r<i.length&&rs(o,He(i.id.client,i.id.clock+r)),i.delete(o),r-=i.length),i=i.right;if(r>0)throw vg();e._searchMarker&&Ua(e._searchMarker,s,-n+r)},fl=(o,e,t)=>{let r=e._map.get(t);r!==void 0&&r.delete(o)},au=(o,e,t,r)=>{let s=e._map.get(t)||null,n=o.doc,a=n.clientID,i;if(r==null)i=new Do([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:i=new Do([r]);break;case Uint8Array:i=new Fs(r);break;case yr:i=new Ms(r);break;default:if(r instanceof Lt)i=new Ar(r);else throw new Error("Unexpected content type")}new ut(He(a,kt(n.store,a)),s,s&&s.lastId,null,null,e,t,i).integrate(o,0)},iu=(o,e)=>{let t=o._map.get(e);return t!==void 0&&!t.deleted?t.content.getContent()[t.length-1]:void 0},Ig=o=>{let e={};return o._map.forEach((t,r)=>{t.deleted||(e[r]=t.content.getContent()[t.length-1])}),e},Lg=(o,e)=>{let t=o._map.get(e);return t!==void 0&&!t.deleted};var Jk=(o,e)=>{let t={};return o._map.forEach((r,s)=>{let n=r;for(;n!==null&&(!e.sv.has(n.id.client)||n.id.clock>=(e.sv.get(n.id.client)||0));)n=n.left;n!==null&&xn(n,e)&&(t[s]=n.content.getContent()[n.length-1])}),t},Xi=o=>qh(o.entries(),e=>!e[1].deleted),zf=class extends vn{constructor(e,t){super(e,t),this._transaction=t}},oo=class extends Lt{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){let t=new oo;return t.push(e),t}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new oo}clone(){let e=new oo;return e.insert(0,this.toArray().map(t=>t instanceof Lt?t.clone():t)),e}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}_callObserver(e,t){super._callObserver(e,t),ml(this,e,new zf(this,e))}insert(e,t){this.doc!==null?et(this.doc,r=>{Sg(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}push(e){this.doc!==null?et(this.doc,t=>{Yk(t,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,t=1){this.doc!==null?et(this.doc,r=>{kg(r,this,e,t)}):this._prelimContent.splice(e,t)}get(e){return _g(this,e)}toArray(){return bg(this)}slice(e=0,t=this.length){return xg(this,e,t)}toJSON(){return this.map(e=>e instanceof Lt?e.toJSON():e)}map(e){return wg(this,e)}forEach(e){$a(this,e)}[Symbol.iterator](){return jk(this)}_write(e){e.writeTypeRef(yI)}},Xk=o=>new oo,Kf=class extends vn{constructor(e,t,r){super(e,t),this.keysChanged=r}},Po=class extends Lt{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,t){super._integrate(e,t),this._prelimContent.forEach((r,s)=>{this.set(s,r)}),this._prelimContent=null}_copy(){return new Po}clone(){let e=new Po;return this.forEach((t,r)=>{e.set(r,t instanceof Lt?t.clone():t)}),e}_callObserver(e,t){ml(this,e,new Kf(this,e,t))}toJSON(){let e={};return this._map.forEach((t,r)=>{if(!t.deleted){let s=t.content.getContent()[t.length-1];e[r]=s instanceof Lt?s.toJSON():s}}),e}get size(){return[...Xi(this._map)].length}keys(){return Yi(Xi(this._map),e=>e[0])}values(){return Yi(Xi(this._map),e=>e[1].content.getContent()[e[1].length-1])}entries(){return Yi(Xi(this._map),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this._map.forEach((t,r)=>{t.deleted||e(t.content.getContent()[t.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?et(this.doc,t=>{fl(t,this,e)}):this._prelimContent.delete(e)}set(e,t){return this.doc!==null?et(this.doc,r=>{au(r,this,e,t)}):this._prelimContent.set(e,t),t}get(e){return iu(this,e)}has(e){return Lg(this,e)}clear(){this.doc!==null?et(this.doc,e=>{this.forEach(function(t,r,s){fl(e,s,r)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(xI)}},Qk=o=>new Po,Qo=(o,e)=>o===e||typeof o=="object"&&typeof e=="object"&&o&&e&&kf(o,e),Ba=class{constructor(e,t,r,s){this.left=e,this.right=t,this.index=r,this.currentAttributes=s}forward(){switch(this.right===null&&Tr(),this.right.content.constructor){case _t:this.right.deleted||Ln(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}},eg=(o,e,t)=>{for(;e.right!==null&&t>0;){switch(e.right.content.constructor){case _t:e.right.deleted||Ln(e.currentAttributes,e.right.content);break;default:e.right.deleted||(t<e.right.length&&rs(o,He(e.right.id.client,e.right.id.clock+t)),e.index+=e.right.length,t-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},Qi=(o,e,t,r)=>{let s=new Map,n=r?pl(e,t):null;if(n){let a=new Ba(n.p.left,n.p,n.index,s);return eg(o,a,t-n.index)}else{let a=new Ba(null,e._start,0,s);return eg(o,a,t)}},Cg=(o,e,t,r)=>{for(;t.right!==null&&(t.right.deleted===!0||t.right.content.constructor===_t&&Qo(r.get(t.right.content.key),t.right.content.value));)t.right.deleted||r.delete(t.right.content.key),t.forward();let s=o.doc,n=s.clientID;r.forEach((a,i)=>{let l=t.left,f=t.right,u=new ut(He(n,kt(s.store,n)),l,l&&l.lastId,f,f&&f.id,e,null,new _t(i,a));u.integrate(o,0),t.right=u,t.forward()})},Ln=(o,e)=>{let{key:t,value:r}=e;r===null?o.delete(t):o.set(t,r)},Tg=(o,e)=>{var t;for(;o.right!==null;){if(!(o.right.deleted||o.right.content.constructor===_t&&Qo((t=e[o.right.content.key])!=null?t:null,o.right.content.value)))break;o.forward()}},Pg=(o,e,t,r)=>{var i;let s=o.doc,n=s.clientID,a=new Map;for(let l in r){let f=r[l],u=(i=t.currentAttributes.get(l))!=null?i:null;if(!Qo(u,f)){a.set(l,u);let{left:d,right:m}=t;t.right=new ut(He(n,kt(s.store,n)),d,d&&d.lastId,m,m&&m.id,e,null,new _t(l,f)),t.right.integrate(o,0),t.forward()}}return a},Rf=(o,e,t,r,s)=>{t.currentAttributes.forEach((m,y)=>{s[y]===void 0&&(s[y]=null)});let n=o.doc,a=n.clientID;Tg(t,s);let i=Pg(o,e,t,s),l=r.constructor===String?new Pr(r):r instanceof Lt?new Ar(r):new Fo(r),{left:f,right:u,index:d}=t;e._searchMarker&&Ua(e._searchMarker,t.index,l.getLength()),u=new ut(He(a,kt(n.store,a)),f,f&&f.lastId,u,u&&u.id,e,null,l),u.integrate(o,0),t.right=u,t.index=d,t.forward(),Cg(o,e,t,i)},tg=(o,e,t,r,s)=>{let n=o.doc,a=n.clientID;Tg(t,s);let i=Pg(o,e,t,s);e:for(;t.right!==null&&(r>0||i.size>0&&(t.right.deleted||t.right.content.constructor===_t));){if(!t.right.deleted)switch(t.right.content.constructor){case _t:{let{key:l,value:f}=t.right.content,u=s[l];if(u!==void 0){if(Qo(u,f))i.delete(l);else{if(r===0)break e;i.set(l,f)}t.right.delete(o)}else t.currentAttributes.set(l,f);break}default:r<t.right.length&&rs(o,He(t.right.id.client,t.right.id.clock+r)),r-=t.right.length;break}t.forward()}if(r>0){let l="";for(;r>0;r--)l+=`
`;t.right=new ut(He(a,kt(n.store,a)),t.left,t.left&&t.left.lastId,t.right,t.right&&t.right.id,e,null,new Pr(l)),t.right.integrate(o,0),t.forward()}Cg(o,e,t,i)},Ag=(o,e,t,r,s)=>{var f,u;let n=e,a=Ft();for(;n&&(!n.countable||n.deleted);){if(!n.deleted&&n.content.constructor===_t){let d=n.content;a.set(d.key,d)}n=n.right}let i=0,l=!1;for(;e!==n;){if(t===e&&(l=!0),!e.deleted){let d=e.content;switch(d.constructor){case _t:{let{key:m,value:y}=d,h=(f=r.get(m))!=null?f:null;(a.get(m)!==d||h===y)&&(e.delete(o),i++,!l&&((u=s.get(m))!=null?u:null)===y&&h!==y&&(h===null?s.delete(m):s.set(m,h))),!l&&!e.deleted&&Ln(s,d);break}}}e=e.right}return i},Zk=(o,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;let t=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===_t){let r=e.content.key;t.has(r)?e.delete(o):t.add(r)}e=e.left}},eI=o=>{let e=0;return et(o.doc,t=>{let r=o._start,s=o._start,n=Ft(),a=Bi(n);for(;s;){if(s.deleted===!1)switch(s.content.constructor){case _t:Ln(a,s.content);break;default:e+=Ag(t,r,s,n,a),n=Bi(a),r=s;break}s=s.right}}),e},tI=o=>{let e=new Set,t=o.doc;for(let[r,s]of o.afterState.entries()){let n=o.beforeState.get(r)||0;s!==n&&pg(o,t.store.clients.get(r),n,s,a=>{!a.deleted&&a.content.constructor===_t&&a.constructor!==lr&&e.add(a.parent)})}et(t,r=>{sg(o,o.deleteSet,s=>{if(s instanceof lr||!s.parent._hasFormatting||e.has(s.parent))return;let n=s.parent;s.content.constructor===_t?e.add(n):Zk(r,s)});for(let s of e)eI(s)})},rg=(o,e,t)=>{let r=t,s=Bi(e.currentAttributes),n=e.right;for(;t>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case Ar:case Fo:case Pr:t<e.right.length&&rs(o,He(e.right.id.client,e.right.id.clock+t)),t-=e.right.length,e.right.delete(o);break}e.forward()}n&&Ag(o,n,e.right,s,e.currentAttributes);let a=(e.left||e.right).parent;return a._searchMarker&&Ua(a._searchMarker,e.index,-r+t),e},Gf=class extends vn{constructor(e,t,r){super(e,t),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(s=>{s===null?this.childListChanged=!0:this.keysChanged.add(s)})}get changes(){if(this._changes===null){let e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){let e=this.target.doc,t=[];et(e,r=>{var y,h,_;let s=new Map,n=new Map,a=this.target._start,i=null,l={},f="",u=0,d=0,m=()=>{if(i!==null){let w=null;switch(i){case"delete":d>0&&(w={delete:d}),d=0;break;case"insert":(typeof f=="object"||f.length>0)&&(w={insert:f},s.size>0&&(w.attributes={},s.forEach((v,M)=>{v!==null&&(w.attributes[M]=v)}))),f="";break;case"retain":u>0&&(w={retain:u},Th(l)||(w.attributes=Lh({},l))),u=0;break}w&&t.push(w),i=null}};for(;a!==null;){switch(a.content.constructor){case Ar:case Fo:this.adds(a)?this.deletes(a)||(m(),i="insert",f=a.content.getContent()[0],m()):this.deletes(a)?(i!=="delete"&&(m(),i="delete"),d+=1):a.deleted||(i!=="retain"&&(m(),i="retain"),u+=1);break;case Pr:this.adds(a)?this.deletes(a)||(i!=="insert"&&(m(),i="insert"),f+=a.content.str):this.deletes(a)?(i!=="delete"&&(m(),i="delete"),d+=a.length):a.deleted||(i!=="retain"&&(m(),i="retain"),u+=a.length);break;case _t:{let{key:w,value:v}=a.content;if(this.adds(a)){if(!this.deletes(a)){let M=(y=s.get(w))!=null?y:null;Qo(M,v)?v!==null&&a.delete(r):(i==="retain"&&m(),Qo(v,(h=n.get(w))!=null?h:null)?delete l[w]:l[w]=v)}}else if(this.deletes(a)){n.set(w,v);let M=(_=s.get(w))!=null?_:null;Qo(M,v)||(i==="retain"&&m(),l[w]=M)}else if(!a.deleted){n.set(w,v);let M=l[w];M!==void 0&&(Qo(M,v)?M!==null&&a.delete(r):(i==="retain"&&m(),v===null?delete l[w]:l[w]=v))}a.deleted||(i==="insert"&&m(),Ln(s,a.content));break}}a=a.right}for(m();t.length>0;){let w=t[t.length-1];if(w.retain!==void 0&&w.attributes===void 0)t.pop();else break}}),this._delta=t}return this._delta}},os=class extends Lt{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this._length}_integrate(e,t){super._integrate(e,t);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new os}clone(){let e=new os;return e.applyDelta(this.toDelta()),e}_callObserver(e,t){super._callObserver(e,t);let r=new Gf(this,e,t);ml(this,e,r),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){let e="",t=this._start;for(;t!==null;)!t.deleted&&t.countable&&t.content.constructor===Pr&&(e+=t.content.str),t=t.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:t=!0}={}){this.doc!==null?et(this.doc,r=>{let s=new Ba(null,this._start,0,new Map);for(let n=0;n<e.length;n++){let a=e[n];if(a.insert!==void 0){let i=!t&&typeof a.insert=="string"&&n===e.length-1&&s.right===null&&a.insert.slice(-1)===`
`?a.insert.slice(0,-1):a.insert;(typeof i!="string"||i.length>0)&&Rf(r,this,s,i,a.attributes||{})}else a.retain!==void 0?tg(r,this,s,a.retain,a.attributes||{}):a.delete!==void 0&&rg(r,s,a.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,t,r){let s=[],n=new Map,a=this.doc,i="",l=this._start;function f(){if(i.length>0){let d={},m=!1;n.forEach((h,_)=>{m=!0,d[_]=h});let y={insert:i};m&&(y.attributes=d),s.push(y),i=""}}let u=()=>{for(;l!==null;){if(xn(l,e)||t!==void 0&&xn(l,t))switch(l.content.constructor){case Pr:{let d=n.get("ychange");e!==void 0&&!xn(l,e)?(d===void 0||d.user!==l.id.client||d.type!=="removed")&&(f(),n.set("ychange",r?r("removed",l.id):{type:"removed"})):t!==void 0&&!xn(l,t)?(d===void 0||d.user!==l.id.client||d.type!=="added")&&(f(),n.set("ychange",r?r("added",l.id):{type:"added"})):d!==void 0&&(f(),n.delete("ychange")),i+=l.content.str;break}case Ar:case Fo:{f();let d={insert:l.content.getContent()[0]};if(n.size>0){let m={};d.attributes=m,n.forEach((y,h)=>{m[h]=y})}s.push(d);break}case _t:xn(l,e)&&(f(),Ln(n,l.content));break}l=l.right}f()};return e||t?et(a,d=>{e&&Hf(d,e),t&&Hf(d,t),u()},"cleanup"):u(),s}insert(e,t,r){if(t.length<=0)return;let s=this.doc;s!==null?et(s,n=>{let a=Qi(n,this,e,!r);r||(r={},a.currentAttributes.forEach((i,l)=>{r[l]=i})),Rf(n,this,a,t,r)}):this._pending.push(()=>this.insert(e,t,r))}insertEmbed(e,t,r){let s=this.doc;s!==null?et(s,n=>{let a=Qi(n,this,e,!r);Rf(n,this,a,t,r||{})}):this._pending.push(()=>this.insertEmbed(e,t,r||{}))}delete(e,t){if(t===0)return;let r=this.doc;r!==null?et(r,s=>{rg(s,Qi(s,this,e,!0),t)}):this._pending.push(()=>this.delete(e,t))}format(e,t,r){if(t===0)return;let s=this.doc;s!==null?et(s,n=>{let a=Qi(n,this,e,!1);a.right!==null&&tg(n,this,a,t,r)}):this._pending.push(()=>this.format(e,t,r))}removeAttribute(e){this.doc!==null?et(this.doc,t=>{fl(t,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,t){this.doc!==null?et(this.doc,r=>{au(r,this,e,t)}):this._pending.push(()=>this.setAttribute(e,t))}getAttribute(e){return iu(this,e)}getAttributes(){return Ig(this)}_write(e){e.writeTypeRef(bI)}},rI=o=>new os,Da=class{constructor(e,t=()=>!0){this._filter=t,this._root=e,this._currentNode=e._start,this._firstCall=!0}[Symbol.iterator](){return this}next(){let e=this._currentNode,t=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(t)))do if(t=e.content.type,!e.deleted&&(t.constructor===ss||t.constructor===Ao)&&t._start!==null)e=t._start;else for(;e!==null;)if(e.right!==null){e=e.right;break}else e.parent===this._root?e=null:e=e.parent._item;while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}},Ao=class extends Lt{constructor(){super(),this._prelimContent=[]}get firstChild(){let e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Ao}clone(){let e=new Ao;return e.insert(0,this.toArray().map(t=>t instanceof Lt?t.clone():t)),e}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new Da(this,e)}querySelector(e){e=e.toUpperCase();let r=new Da(this,s=>s.nodeName&&s.nodeName.toUpperCase()===e).next();return r.done?null:r.value}querySelectorAll(e){return e=e.toUpperCase(),$r(new Da(this,t=>t.nodeName&&t.nodeName.toUpperCase()===e))}_callObserver(e,t){ml(this,e,new jf(this,t,e))}toString(){return wg(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,t={},r){let s=e.createDocumentFragment();return r!==void 0&&r._createAssociation(s,this),$a(this,n=>{s.insertBefore(n.toDOM(e,t,r),null)}),s}insert(e,t){this.doc!==null?et(this.doc,r=>{Sg(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}insertAfter(e,t){if(this.doc!==null)et(this.doc,r=>{let s=e&&e instanceof Lt?e._item:e;cl(r,this,s,t)});else{let r=this._prelimContent,s=e===null?0:r.findIndex(n=>n===e)+1;if(s===0&&e!==null)throw Cr("Reference item not found");r.splice(s,0,...t)}}delete(e,t=1){this.doc!==null?et(this.doc,r=>{kg(r,this,e,t)}):this._prelimContent.splice(e,t)}toArray(){return bg(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return _g(this,e)}slice(e=0,t=this.length){return xg(this,e,t)}forEach(e){$a(this,e)}_write(e){e.writeTypeRef(_I)}},oI=o=>new Ao,ss=class extends Ao{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){let e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){let e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,t){super._integrate(e,t),this._prelimAttrs.forEach((r,s)=>{this.setAttribute(s,r)}),this._prelimAttrs=null}_copy(){return new ss(this.nodeName)}clone(){let e=new ss(this.nodeName),t=this.getAttributes();return Ch(t,(r,s)=>{typeof r=="string"&&e.setAttribute(s,r)}),e.insert(0,this.toArray().map(r=>r instanceof Lt?r.clone():r)),e}toString(){let e=this.getAttributes(),t=[],r=[];for(let i in e)r.push(i);r.sort();let s=r.length;for(let i=0;i<s;i++){let l=r[i];t.push(l+'="'+e[l]+'"')}let n=this.nodeName.toLocaleLowerCase(),a=t.length>0?" "+t.join(" "):"";return`<${n}${a}>${super.toString()}</${n}>`}removeAttribute(e){this.doc!==null?et(this.doc,t=>{fl(t,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,t){this.doc!==null?et(this.doc,r=>{au(r,this,e,t)}):this._prelimAttrs.set(e,t)}getAttribute(e){return iu(this,e)}hasAttribute(e){return Lg(this,e)}getAttributes(e){return e?Jk(this,e):Ig(this)}toDOM(e=document,t={},r){let s=e.createElement(this.nodeName),n=this.getAttributes();for(let a in n){let i=n[a];typeof i=="string"&&s.setAttribute(a,i)}return $a(this,a=>{s.appendChild(a.toDOM(e,t,r))}),r!==void 0&&r._createAssociation(s,this),s}_write(e){e.writeTypeRef(wI),e.writeKey(this.nodeName)}},sI=o=>new ss(o.readKey()),jf=class extends vn{constructor(e,t,r){super(e,r),this.childListChanged=!1,this.attributesChanged=new Set,t.forEach(s=>{s===null?this.childListChanged=!0:this.attributesChanged.add(s)})}},Sn=class extends Po{constructor(e){super(),this.hookName=e}_copy(){return new Sn(this.hookName)}clone(){let e=new Sn(this.hookName);return this.forEach((t,r)=>{e.set(r,t)}),e}toDOM(e=document,t={},r){let s=t[this.hookName],n;return s!==void 0?n=s.createDom(this):n=document.createElement(this.hookName),n.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(n,this),n}_write(e){e.writeTypeRef(vI),e.writeKey(this.hookName)}},nI=o=>new Sn(o.readKey()),kn=class extends os{get nextSibling(){let e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){let e=this._item?this._item.prev:null;return e?e.content.type:null}_copy(){return new kn}clone(){let e=new kn;return e.applyDelta(this.toDelta()),e}toDOM(e=document,t,r){let s=e.createTextNode(this.toString());return r!==void 0&&r._createAssociation(s,this),s}toString(){return this.toDelta().map(e=>{let t=[];for(let s in e.attributes){let n=[];for(let a in e.attributes[s])n.push({key:a,value:e.attributes[s][a]});n.sort((a,i)=>a.key<i.key?-1:1),t.push({nodeName:s,attrs:n})}t.sort((s,n)=>s.nodeName<n.nodeName?-1:1);let r="";for(let s=0;s<t.length;s++){let n=t[s];r+=`<${n.nodeName}`;for(let a=0;a<n.attrs.length;a++){let i=n.attrs[a];r+=` ${i.key}="${i.value}"`}r+=">"}r+=e.insert;for(let s=t.length-1;s>=0;s--)r+=`</${t[s].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef(SI)}},aI=o=>new kn,Na=class{constructor(e,t){this.id=e,this.length=t}get deleted(){throw Nr()}mergeWith(e){return!1}write(e,t,r){throw Nr()}integrate(e,t){throw Nr()}},iI=0,lr=class extends Na{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,t){t>0&&(this.id.clock+=t,this.length-=t),dg(e.doc.store,this)}write(e,t){e.writeInfo(iI),e.writeLen(this.length-t)}getMissing(e,t){return null}},Fs=class{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Fs(this.content)}splice(e){throw Nr()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeBuf(this.content)}getRef(){return 3}},lI=o=>new Fs(o.readBuf()),Ds=class{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Ds(this.len)}splice(e){let t=new Ds(this.len-e);return this.len=e,t}mergeWith(e){return this.len+=e.len,!0}integrate(e,t){rl(e.deleteSet,t.id.client,t.id.clock,this.len),t.markDeleted()}delete(e){}gc(e){}write(e,t){e.writeLen(this.len-t)}getRef(){return 1}},cI=o=>new Ds(o.readLen()),Fg=(o,e)=>new yr({guid:o,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1}),Ms=class{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;let t={};this.opts=t,e.gc||(t.gc=!1),e.autoLoad&&(t.autoLoad=!0),e.meta!==null&&(t.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Ms(Fg(this.doc.guid,this.opts))}splice(e){throw Nr()}mergeWith(e){return!1}integrate(e,t){this.doc._item=t,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,t){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}},fI=o=>new Ms(Fg(o.readString(),o.readAny())),Fo=class{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new Fo(this.embed)}splice(e){throw Nr()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeJSON(this.embed)}getRef(){return 5}},uI=o=>new Fo(o.readJSON()),_t=class{constructor(e,t){this.key=e,this.value=t}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new _t(this.key,this.value)}splice(e){throw Nr()}mergeWith(e){return!1}integrate(e,t){let r=t.parent;r._searchMarker=null,r._hasFormatting=!0}delete(e){}gc(e){}write(e,t){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}},dI=o=>new _t(o.readKey(),o.readJSON()),In=class{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new In(this.arr)}splice(e){let t=new In(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){let r=this.arr.length;e.writeLen(r-t);for(let s=t;s<r;s++){let n=this.arr[s];e.writeString(n===void 0?"undefined":JSON.stringify(n))}}getRef(){return 2}},pI=o=>{let e=o.readLen(),t=[];for(let r=0;r<e;r++){let s=o.readString();s==="undefined"?t.push(void 0):t.push(JSON.parse(s))}return new In(t)},Do=class{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Do(this.arr)}splice(e){let t=new Do(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){let r=this.arr.length;e.writeLen(r-t);for(let s=t;s<r;s++){let n=this.arr[s];e.writeAny(n)}}getRef(){return 8}},mI=o=>{let e=o.readLen(),t=[];for(let r=0;r<e;r++)t.push(o.readAny());return new Do(t)},Pr=class{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Pr(this.str)}splice(e){let t=new Pr(this.str.slice(e));this.str=this.str.slice(0,e);let r=this.str.charCodeAt(e-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,e-1)+"\uFFFD",t.str="\uFFFD"+t.str.slice(1)),t}mergeWith(e){return this.str+=e.str,!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeString(t===0?this.str:this.str.slice(t))}getRef(){return 4}},hI=o=>new Pr(o.readString()),gI=[Xk,Qk,rI,sI,oI,nI,aI],yI=0,xI=1,bI=2,wI=3,_I=4,vI=5,SI=6,Ar=class{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new Ar(this.type._copy())}splice(e){throw Nr()}mergeWith(e){return!1}integrate(e,t){this.type._integrate(e.doc,t)}delete(e){let t=this.type._start;for(;t!==null;)t.deleted?t.id.clock<(e.beforeState.get(t.id.client)||0)&&e._mergeStructs.push(t):t.delete(e),t=t.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(e.beforeState.get(r.id.client)||0)&&e._mergeStructs.push(r):r.delete(e)}),e.changed.delete(this.type)}gc(e){let t=this.type._start;for(;t!==null;)t.gc(e,!0),t=t.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(e,!0),r=r.left}),this.type._map=new Map}write(e,t){this.type._write(e)}getRef(){return 7}},kI=o=>new Ar(gI[o.readTypeRef()](o)),og=(o,e)=>{let t=e,r=0,s;do r>0&&(t=He(t.client,t.clock+r)),s=Zi(o,t),r=t.clock-s.id.clock,t=s.redone;while(t!==null&&s instanceof ut);return{item:s,diff:r}};var ul=(o,e,t)=>{let{client:r,clock:s}=e.id,n=new ut(He(r,s+t),e,He(r,s+t-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(t));return e.deleted&&n.markDeleted(),e.keep&&(n.keep=!0),e.redone!==null&&(n.redone=He(e.redone.client,e.redone.clock+t)),e.right=n,n.right!==null&&(n.right.left=n),o._mergeStructs.push(n),n.parentSub!==null&&n.right===null&&n.parent._map.set(n.parentSub,n),e.length=t,n};var ut=class extends Na{constructor(e,t,r,s,n,a,i,l){super(e,l.getLength()),this.origin=r,this.left=t,this.right=s,this.rightOrigin=n,this.parent=a,this.parentSub=i,this.redone=null,this.content=l,this.info=this.content.isCountable()?2:0}set marker(e){(this.info&8)>0!==e&&(this.info^=8)}get marker(){return(this.info&8)>0}get keep(){return(this.info&1)>0}set keep(e){this.keep!==e&&(this.info^=1)}get countable(){return(this.info&2)>0}get deleted(){return(this.info&4)>0}set deleted(e){this.deleted!==e&&(this.info^=4)}markDeleted(){this.info|=4}getMissing(e,t){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=kt(t,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=kt(t,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===Zo&&this.id.client!==this.parent.client&&this.parent.clock>=kt(t,this.parent.client))return this.parent.client;if(this.origin&&(this.left=Jh(e,t,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=rs(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===lr||this.right&&this.right.constructor===lr)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===ut&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===ut&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===Zo){let r=Zi(t,this.parent);r.constructor===lr?this.parent=null:this.parent=r.content.type}return null}integrate(e,t){if(t>0&&(this.id.clock+=t,this.left=Jh(e,e.doc.store,He(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(t),this.length-=t),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,s;if(r!==null)s=r.right;else if(this.parentSub!==null)for(s=this.parent._map.get(this.parentSub)||null;s!==null&&s.left!==null;)s=s.left;else s=this.parent._start;let n=new Set,a=new Set;for(;s!==null&&s!==this.right;){if(a.add(s),n.add(s),bn(this.origin,s.origin)){if(s.id.client<this.id.client)r=s,n.clear();else if(bn(this.rightOrigin,s.rightOrigin))break}else if(s.origin!==null&&a.has(Zi(e.doc.store,s.origin)))n.has(Zi(e.doc.store,s.origin))||(r=s,n.clear());else break;s=s.right}this.left=r}if(this.left!==null){let r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),dg(e.doc.store,this),this.content.integrate(e,this),Qh(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new lr(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:He(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&bn(e.origin,this.lastId)&&this.right===e&&bn(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){let t=this.parent._searchMarker;return t&&t.forEach(r=>{r.p===e&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){let t=this.parent;this.countable&&this.parentSub===null&&(t._length-=this.length),this.markDeleted(),rl(e.deleteSet,this.id.client,this.id.clock,this.length),Qh(e,t,this.parentSub),this.content.delete(e)}}gc(e,t){if(!this.deleted)throw Tr();this.content.gc(e),t?Ok(e,this,new lr(this.id,this.length)):this.content=new Ds(this.length)}write(e,t){let r=t>0?He(this.id.client,this.id.clock+t-1):this.origin,s=this.rightOrigin,n=this.parentSub,a=this.content.getRef()&31|(r===null?0:128)|(s===null?0:64)|(n===null?0:32);if(e.writeInfo(a),r!==null&&e.writeLeftID(r),s!==null&&e.writeRightID(s),r===null&&s===null){let i=this.parent;if(i._item!==void 0){let l=i._item;if(l===null){let f=ug(i);e.writeParentInfo(!0),e.writeString(f)}else e.writeParentInfo(!1),e.writeLeftID(l.id)}else i.constructor===String?(e.writeParentInfo(!0),e.writeString(i)):i.constructor===Zo?(e.writeParentInfo(!1),e.writeLeftID(i)):Tr();n!==null&&e.writeString(n)}this.content.write(e,t)}},Dg=(o,e)=>II[e&31](o),II=[()=>{Tr()},cI,pI,lI,hI,uI,dI,kI,mI,fI,()=>{Tr()}],LI=10,cr=class extends Na{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,t){Tr()}write(e,t){e.writeInfo(LI),Ee(e.restEncoder,this.length-t)}getMissing(e,t){return null}},Mg=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:{},Eg="__ $YJS$ __";Mg[Eg]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");Mg[Eg]=!0;var Rs=o=>Co((e,t)=>{o.onerror=r=>t(new Error(r.target.error)),o.onsuccess=r=>e(r.target.result)}),Rg=(o,e)=>Co((t,r)=>{let s=indexedDB.open(o);s.onupgradeneeded=n=>e(n.target.result),s.onerror=n=>r(Cr(n.target.error)),s.onsuccess=n=>{let a=n.target.result;a.onversionchange=()=>{a.close()},t(a)}}),Og=o=>Rs(indexedDB.deleteDatabase(o)),Ug=(o,e)=>e.forEach(t=>o.createObjectStore.apply(o,t)),no=(o,e,t="readwrite")=>{let r=o.transaction(e,t);return e.map(s=>AI(r,s))},Os=(o,e)=>Rs(o.count(e)),$g=(o,e)=>Rs(o.get(e)),lu=(o,e)=>Rs(o.delete(e)),Bg=(o,e,t)=>Rs(o.put(e,t));var hl=(o,e)=>Rs(o.add(e)),Ng=(o,e,t)=>Rs(o.getAll(e,t));var CI=(o,e,t)=>{let r=null;return PI(o,e,s=>(r=s,!1),t).then(()=>r)},Hg=(o,e=null)=>CI(o,e,"prev");var TI=(o,e)=>Co((t,r)=>{o.onerror=r,o.onsuccess=async s=>{let n=s.target.result;if(n===null||await e(n)===!1)return t();n.continue()}});var PI=(o,e,t,r="next")=>TI(o.openKeyCursor(e,r),s=>t(s.key)),AI=(o,e)=>o.objectStore(e);var Vg=(o,e)=>IDBKeyRange.upperBound(o,e),qg=(o,e)=>IDBKeyRange.lowerBound(o,e);var fu="custom",Wg="updates",zg=500,Kg=(o,e=()=>{},t=()=>{})=>{let[r]=no(o.db,[Wg]);return Ng(r,qg(o._dbref,!1)).then(s=>{o._destroyed||(e(r),et(o.doc,()=>{s.forEach(n=>Mo(o.doc,n))},o,!1),t(r))}).then(()=>Hg(r).then(s=>{o._dbref=s+1})).then(()=>Os(r).then(s=>{o._dbsize=s})).then(()=>r)},FI=(o,e=!0)=>Kg(o).then(t=>{(e||o._dbsize>=zg)&&hl(t,Es(o.doc)).then(()=>lu(t,Vg(o._dbref,!0))).then(()=>Os(t).then(r=>{o._dbsize=r}))});var Cn=class extends rn{constructor(e,t){super(),this.doc=t,this.name=e,this._dbref=0,this._dbsize=0,this._destroyed=!1,this.db=null,this.synced=!1,this._db=Rg(e,r=>Ug(r,[["updates",{autoIncrement:!0}],["custom"]])),this.whenSynced=Co(r=>this.on("synced",()=>r(this))),this._db.then(r=>{this.db=r,Kg(this,a=>hl(a,Es(t)),()=>{if(this._destroyed)return this;this.synced=!0,this.emit("synced",[this])})}),this._storeTimeout=1e3,this._storeTimeoutId=null,this._storeUpdate=(r,s)=>{if(this.db&&s!==this){let[n]=no(this.db,[Wg]);hl(n,r),++this._dbsize>=zg&&(this._storeTimeoutId!==null&&clearTimeout(this._storeTimeoutId),this._storeTimeoutId=setTimeout(()=>{FI(this,!1),this._storeTimeoutId=null},this._storeTimeout))}},t.on("update",this._storeUpdate),this.destroy=this.destroy.bind(this),t.on("destroy",this.destroy)}destroy(){return this._storeTimeoutId&&clearTimeout(this._storeTimeoutId),this.doc.off("update",this._storeUpdate),this.doc.off("destroy",this.destroy),this._destroyed=!0,this._db.then(e=>{e.close()})}clearData(){return this.destroy().then(()=>{Og(this.name)})}get(e){return this._db.then(t=>{let[r]=no(t,[fu],"readonly");return $g(r,e)})}set(e,t){return this._db.then(r=>{let[s]=no(r,[fu]);return Bg(s,t,e)})}del(e){return this._db.then(t=>{let[r]=no(t,[fu]);return lu(r,e)})}};var _r=vs(xa());var Gg=0,gl=1,jg=2,yl=(o,e)=>{Ee(o,Gg);let t=cg(e);Mt(o,t)},uu=(o,e,t)=>{Ee(o,gl),Mt(o,Es(e,t))},DI=(o,e,t)=>uu(e,t,$t(o)),Yg=(o,e,t)=>{try{Mo(e,$t(o),t)}catch(r){console.error("Caught error while handling a Yjs update",r)}},Jg=(o,e)=>{Ee(o,jg),Mt(o,e)},MI=Yg,Xg=(o,e,t,r)=>{let s=Fe(o);switch(s){case Gg:DI(o,e,t);break;case gl:Yg(o,t,r);break;case jg:MI(o,t,r);break;default:throw new Error("Unknown message type")}return s};var RI=0;var Qg=(o,e,t)=>{switch(Fe(o)){case RI:t(e,Hr(o))}};var du=3e4,xl=class extends rn{constructor(e){super(),this.doc=e,this.clientID=e.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{let t=Ts();this.getLocalState()!==null&&du/2<=t-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());let r=[];this.meta.forEach((s,n)=>{n!==this.clientID&&du<=t-s.lastUpdated&&this.states.has(n)&&r.push(n)}),r.length>0&&bl(this,r,"timeout")},ir(du/10)),e.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(e){let t=this.clientID,r=this.meta.get(t),s=r===void 0?0:r.clock+1,n=this.states.get(t);e===null?this.states.delete(t):this.states.set(t,e),this.meta.set(t,{clock:s,lastUpdated:Ts()});let a=[],i=[],l=[],f=[];e===null?f.push(t):n==null?e!=null&&a.push(t):(i.push(t),gn(n,e)||l.push(t)),(a.length>0||l.length>0||f.length>0)&&this.emit("change",[{added:a,updated:l,removed:f},"local"]),this.emit("update",[{added:a,updated:i,removed:f},"local"])}setLocalStateField(e,t){let r=this.getLocalState();r!==null&&this.setLocalState({...r,[e]:t})}getStates(){return this.states}},bl=(o,e,t)=>{let r=[];for(let s=0;s<e.length;s++){let n=e[s];if(o.states.has(n)){if(o.states.delete(n),n===o.clientID){let a=o.meta.get(n);o.meta.set(n,{clock:a.clock+1,lastUpdated:Ts()})}r.push(n)}}r.length>0&&(o.emit("change",[{added:[],updated:[],removed:r},t]),o.emit("update",[{added:[],updated:[],removed:r},t]))},Tn=(o,e,t=o.states)=>{let r=e.length,s=Is();Ee(s,r);for(let n=0;n<r;n++){let a=e[n],i=t.get(a)||null,l=o.meta.get(a).clock;Ee(s,a),Ee(s,l),Lo(s,JSON.stringify(i))}return gr(s)};var Zg=(o,e,t)=>{let r=Vr(e),s=Ts(),n=[],a=[],i=[],l=[],f=Fe(r);for(let u=0;u<f;u++){let d=Fe(r),m=Fe(r),y=JSON.parse(Hr(r)),h=o.meta.get(d),_=o.states.get(d),w=h===void 0?0:h.clock;(w<m||w===m&&y===null&&o.states.has(d))&&(y===null?d===o.clientID&&o.getLocalState()!=null?m++:o.states.delete(d):o.states.set(d,y),o.meta.set(d,{clock:m,lastUpdated:s}),h===void 0&&y!==null?n.push(d):h!==void 0&&y===null?l.push(d):y!==null&&(gn(y,_)||i.push(d),a.push(d)))}(n.length>0||i.length>0||l.length>0)&&o.emit("change",[{added:n,updated:i,removed:l},t]),(n.length>0||a.length>0||l.length>0)&&o.emit("update",[{added:n,updated:a,removed:l},t])};var An=()=>new Map,sy=(o,e,t)=>{let r=o.get(e);return r===void 0&&o.set(e,r=t()),r},ny=()=>new Set,$I=Array.from,dE=Array.isArray,ay=String.fromCharCode,pE=String.fromCodePoint,mE=ay(65535),BI=o=>o.toLowerCase(),NI=/^\s*/g,HI=o=>o.replace(NI,""),VI=/([A-Z])/g,ey=(o,e)=>HI(o.replace(VI,t=>`${e}${BI(t)}`)),qI=o=>{let e=unescape(encodeURIComponent(o)),t=e.length,r=new Uint8Array(t);for(let s=0;s<t;s++)r[s]=e.codePointAt(s);return r},Va=typeof TextEncoder!="undefined"?new TextEncoder:null,WI=o=>Va.encode(o),zI=Va?WI:qI,pu=typeof TextDecoder=="undefined"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});pu&&pu.decode(new Uint8Array).length===1&&(pu=null);var ty=o=>o===void 0?null:o,KI=class{constructor(){this.map=new Map}setItem(o,e){this.map.set(o,e)}getItem(o){return this.map.get(o)}},iy=new KI,bu=!0;try{typeof localStorage!="undefined"&&(iy=localStorage,bu=!1)}catch(o){}var ly=iy,GI=o=>bu||addEventListener("storage",o),jI=o=>bu||removeEventListener("storage",o),YI=(o,e)=>{let t=[];for(let r in o)t.push(e(o[r],r));return t},JI=(o,e)=>e.includes(o),Mn=typeof process!="undefined"&&process.release&&/node|io\.js/.test(process.release.name),cy=typeof window!="undefined"&&typeof document!="undefined"&&!Mn,hE=typeof navigator!="undefined"?/Mac/.test(navigator.platform):!1,ao,XI=[],QI=()=>{if(ao===void 0)if(Mn){ao=An();let o=process.argv,e=null;for(let t=0;t<o.length;t++){let r=o[t];r[0]==="-"?(e!==null&&ao.set(e,""),e=r):e!==null?(ao.set(e,r),e=null):XI.push(r)}e!==null&&ao.set(e,"")}else typeof location=="object"?(ao=An(),(location.search||"?").slice(1).split("&").forEach(o=>{if(o.length!==0){let[e,t]=o.split("=");ao.set(`--${ey(e,"-")}`,t),ao.set(`-${ey(e,"-")}`,t)}})):ao=An();return ao},hu=o=>QI().has(o),gu=o=>ty(Mn?process.env[o.toUpperCase()]:ly.getItem(o)),ZI=o=>hu("--"+o)||gu(o)!==null,gE=ZI("production"),ry=Mn&&JI(process.env.FORCE_COLOR,["true","1","2"]),yE=!hu("no-colors")&&(!Mn||process.stdout.isTTY||ry)&&(!Mn||hu("color")||ry||gu("COLORTERM")!==null||(gu("TERM")||"").includes("color")),fy=Math.floor,uy=(o,e)=>o<e?o:e,eL=(o,e)=>o>e?o:e,xE=Number.isNaN,tL=Math.pow,dy=128,rL=1<<17,oL=1<<18,sL=1<<19,nL=1<<20,aL=1<<21,iL=1<<22,lL=1<<23,cL=1<<24,fL=1<<25,uL=1<<26,dL=1<<27,pL=1<<28,mL=1<<29,hL=1<<30,bE=1<<31,wl=127,wE=rL-1,_E=oL-1,vE=sL-1,SE=nL-1,kE=aL-1,IE=iL-1,LE=lL-1,CE=cL-1,TE=fL-1,PE=uL-1,AE=dL-1,FE=pL-1,DE=mL-1,ME=hL-1,gL=Number.MAX_SAFE_INTEGER,EE=Number.MIN_SAFE_INTEGER,RE=1<<31,OE=Number.isInteger||(o=>typeof o=="number"&&isFinite(o)&&fy(o)===o),UE=Number.isNaN,$E=Number.parseInt,yL=class{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}},qr=()=>new yL,wu=o=>{let e=o.cpos;for(let t=0;t<o.bufs.length;t++)e+=o.bufs[t].length;return e},Fr=o=>{let e=new Uint8Array(wu(o)),t=0;for(let r=0;r<o.bufs.length;r++){let s=o.bufs[r];e.set(s,t),t+=s.length}return e.set(hy(o.cbuf.buffer,0,o.cpos),t),e},_l=(o,e)=>{let t=o.cbuf.length;o.cpos===t&&(o.bufs.push(o.cbuf),o.cbuf=new Uint8Array(t*2),o.cpos=0),o.cbuf[o.cpos++]=e},Xt=(o,e)=>{for(;e>wl;)_l(o,dy|wl&e),e=fy(e/128);_l(o,wl&e)},yu=new Uint8Array(3e4),xL=yu.length/3,bL=(o,e)=>{if(e.length<xL){let t=Va.encodeInto(e,yu).written||0;Xt(o,t);for(let r=0;r<t;r++)_l(o,yu[r])}else Fn(o,zI(e))},wL=(o,e)=>{let t=unescape(encodeURIComponent(e)),r=t.length;Xt(o,r);for(let s=0;s<r;s++)_l(o,t.codePointAt(s))},BE=Va&&Va.encodeInto?bL:wL,_L=(o,e)=>{let t=o.cbuf.length,r=o.cpos,s=uy(t-r,e.length),n=e.length-s;o.cbuf.set(e.subarray(0,s),r),o.cpos+=s,n>0&&(o.bufs.push(o.cbuf),o.cbuf=new Uint8Array(eL(t*2,n)),o.cbuf.set(e.subarray(s)),o.cpos=n)},Fn=(o,e)=>{Xt(o,e.byteLength),_L(o,e)},NE=new DataView(new ArrayBuffer(4)),py=o=>new Error(o),vL=py("Unexpected end of array"),SL=py("Integer out of Range"),kL=class{constructor(o){this.arr=o,this.pos=0}},IL=o=>new kL(o),LL=(o,e)=>{let t=hy(o.arr.buffer,o.pos+o.arr.byteOffset,e);return o.pos+=e,t},CL=o=>LL(o,my(o)),my=o=>{let e=0,t=1,r=o.arr.length;for(;o.pos<r;){let s=o.arr[o.pos++];if(e=e+(s&wl)*t,t*=128,s<dy)return e;if(e>gL)throw SL}throw vL},TL=o=>new Uint8Array(o),hy=(o,e,t)=>new Uint8Array(o,e,t),PL=o=>new Uint8Array(o),AL=o=>{let e="";for(let t=0;t<o.byteLength;t++)e+=ay(o[t]);return btoa(e)},FL=o=>Buffer.from(o.buffer,o.byteOffset,o.byteLength).toString("base64"),DL=o=>{let e=atob(o),t=TL(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t},ML=o=>{let e=Buffer.from(o,"base64");return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)},EL=cy?AL:FL,RL=cy?DL:ML,gy=new Map,OL=class{constructor(o){this.room=o,this.onmessage=null,this._onChange=e=>e.key===o&&this.onmessage!==null&&this.onmessage({data:RL(e.newValue||"")}),GI(this._onChange)}postMessage(o){ly.setItem(this.room,EL(PL(o)))}close(){jI(this._onChange)}},UL=typeof BroadcastChannel=="undefined"?OL:BroadcastChannel,_u=o=>sy(gy,o,()=>{let e=ny(),t=new UL(o);return t.onmessage=r=>e.forEach(s=>s(r.data,"broadcastchannel")),{bc:t,subs:e}}),$L=(o,e)=>(_u(o).subs.add(e),e),BL=(o,e)=>{let t=_u(o),r=t.subs.delete(e);return r&&t.subs.size===0&&(t.bc.close(),gy.delete(o)),r},Pn=(o,e,t=null)=>{let r=_u(o);r.bc.postMessage(e),r.subs.forEach(s=>s(e,t))},xu=Date.now,NL=class{constructor(){this._observers=An()}on(o,e){sy(this._observers,o,ny).add(e)}once(o,e){let t=(...r)=>{this.off(o,t),e(...r)};this.on(o,t)}off(o,e){let t=this._observers.get(o);t!==void 0&&(t.delete(e),t.size===0&&this._observers.delete(o))}emit(o,e){return $I((this._observers.get(o)||An()).values()).forEach(t=>t(...e))}destroy(){this._observers=An()}},HL=o=>YI(o,(e,t)=>`${encodeURIComponent(t)}=${encodeURIComponent(e)}`).join("&"),Us=0,yy=3,Dn=1,VL=2,qa=[];qa[Us]=(o,e,t,r,s)=>{Xt(o,Us);let n=Xg(e,o,t.doc,t);r&&n===gl&&!t.synced&&(t.synced=!0)};qa[yy]=(o,e,t,r,s)=>{Xt(o,Dn),Fn(o,Tn(t.awareness,Array.from(t.awareness.getStates().keys())))};qa[Dn]=(o,e,t,r,s)=>{Zg(t.awareness,CL(e),t)};qa[VL]=(o,e,t,r,s)=>{Qg(e,t.doc,(n,a)=>qL(t,a))};var oy=3e4,qL=(o,e)=>console.warn(`Permission denied to access ${o.url}.
${e}`),xy=(o,e,t)=>{let r=IL(e),s=qr(),n=my(r),a=o.messageHandlers[n];return a?a(s,r,o,t,n):console.error("Unable to compute message"),s},by=o=>{if(o.shouldConnect&&o.ws===null){let e=new o._WS(o.url);e.binaryType="arraybuffer",o.ws=e,o.wsconnecting=!0,o.wsconnected=!1,o.synced=!1,e.onmessage=t=>{o.wsLastMessageReceived=xu();let r=xy(o,new Uint8Array(t.data),!0);wu(r)>1&&e.send(Fr(r))},e.onerror=t=>{o.emit("connection-error",[t,o])},e.onclose=t=>{o.emit("connection-close",[t,o]),o.ws=null,o.wsconnecting=!1,o.wsconnected?(o.wsconnected=!1,o.synced=!1,bl(o.awareness,Array.from(o.awareness.getStates().keys()).filter(r=>r!==o.doc.clientID),o),o.emit("status",[{status:"disconnected"}])):o.wsUnsuccessfulReconnects++,setTimeout(by,uy(tL(2,o.wsUnsuccessfulReconnects)*100,o.maxBackoffTime),o)},e.onopen=()=>{o.wsLastMessageReceived=xu(),o.wsconnecting=!1,o.wsconnected=!0,o.wsUnsuccessfulReconnects=0,o.emit("status",[{status:"connected"}]);let t=qr();if(Xt(t,Us),yl(t,o.doc),e.send(Fr(t)),o.awareness.getLocalState()!==null){let r=qr();Xt(r,Dn),Fn(r,Tn(o.awareness,[o.doc.clientID])),e.send(Fr(r))}},o.emit("status",[{status:"connecting"}])}},mu=(o,e)=>{let t=o.ws;o.wsconnected&&t&&t.readyState===t.OPEN&&t.send(e),o.bcconnected&&Pn(o.bcChannel,e,o)},wy=class extends NL{constructor(o,e,t,{connect:r=!0,awareness:s=new xl(t),params:n={},WebSocketPolyfill:a=WebSocket,resyncInterval:i=-1,maxBackoffTime:l=2500,disableBc:f=!1}={}){for(super();o[o.length-1]==="/";)o=o.slice(0,o.length-1);let u=HL(n);this.maxBackoffTime=l,this.bcChannel=o+"/"+e,this.url=o+"/"+e+(u.length===0?"":"?"+u),this.roomname=e,this.doc=t,this._WS=a,this.awareness=s,this.wsconnected=!1,this.wsconnecting=!1,this.bcconnected=!1,this.disableBc=f,this.wsUnsuccessfulReconnects=0,this.messageHandlers=qa.slice(),this._synced=!1,this.ws=null,this.wsLastMessageReceived=0,this.shouldConnect=r,this._resyncInterval=0,i>0&&(this._resyncInterval=setInterval(()=>{if(this.ws&&this.ws.readyState===WebSocket.OPEN){let d=qr();Xt(d,Us),yl(d,t),this.ws.send(Fr(d))}},i)),this._bcSubscriber=(d,m)=>{if(m!==this){let y=xy(this,new Uint8Array(d),!1);wu(y)>1&&Pn(this.bcChannel,Fr(y),this)}},this._updateHandler=(d,m)=>{if(m!==this){let y=qr();Xt(y,Us),Jg(y,d),mu(this,Fr(y))}},this.doc.on("update",this._updateHandler),this._awarenessUpdateHandler=({added:d,updated:m,removed:y},h)=>{let _=d.concat(m).concat(y),w=qr();Xt(w,Dn),Fn(w,Tn(s,_)),mu(this,Fr(w))},this._unloadHandler=()=>{bl(this.awareness,[t.clientID],"window unload")},typeof window!="undefined"?window.addEventListener("unload",this._unloadHandler):typeof process!="undefined"&&process.on("exit",this._unloadHandler),s.on("update",this._awarenessUpdateHandler),this._checkInterval=setInterval(()=>{var d;this.wsconnected&&oy<xu()-this.wsLastMessageReceived&&((d=this.ws)==null||d.close())},oy/10),r&&this.connect()}get synced(){return this._synced}set synced(o){this._synced!==o&&(this._synced=o,this.emit("synced",[o]),this.emit("sync",[o]))}destroy(){this._resyncInterval!==0&&clearInterval(this._resyncInterval),clearInterval(this._checkInterval),this.disconnect(),typeof window!="undefined"?window.removeEventListener("unload",this._unloadHandler):typeof process!="undefined"&&process.off("exit",this._unloadHandler),this.awareness.off("update",this._awarenessUpdateHandler),this.doc.off("update",this._updateHandler),super.destroy()}connectBc(){if(this.disableBc)return;this.bcconnected||($L(this.bcChannel,this._bcSubscriber),this.bcconnected=!0);let o=qr();Xt(o,Us),yl(o,this.doc),Pn(this.bcChannel,Fr(o),this);let e=qr();Xt(e,Us),uu(e,this.doc),Pn(this.bcChannel,Fr(e),this);let t=qr();Xt(t,yy),Pn(this.bcChannel,Fr(t),this);let r=qr();Xt(r,Dn),Fn(r,Tn(this.awareness,[this.doc.clientID])),Pn(this.bcChannel,Fr(r),this)}disconnectBc(){let o=qr();Xt(o,Dn),Fn(o,Tn(this.awareness,[this.doc.clientID],new Map)),mu(this,Fr(o)),this.bcconnected&&(BL(this.bcChannel,this._bcSubscriber),this.bcconnected=!1)}disconnect(){this.shouldConnect=!1,this.disconnectBc(),this.ws!==null&&this.ws.close()}connect(){this.shouldConnect=!0,!this.wsconnected&&this.ws===null&&(by(this),this.connectBc())}};var Et=new WeakMap,_y=!1;function Sl(o){_y=o}var Wr={maxFileSize:1024*1024,maxBackups:5,disableConsole:!1,batchInterval:1e3,maxRetries:3},Qt,Zt,vl=[];function vy(o,e,t,r){Zt=o,Qt=t,r&&(Wr={...Wr,...r}),e.setInterval(vu,Wr.batchInterval)}async function vu(){if(vl.length===0)return;let o=[...vl];vl.length=0;for(let e=0;e<Wr.maxRetries;e++)try{await WL();let t=o.map(Sy).join(`
`)+`
`;await Zt.append(Qt,t);return}catch(t){console.error(`Failed to write logs (attempt ${e+1}):`,t),e===Wr.maxRetries-1&&console.error("Max retries reached. Discarding log entries.")}}async function WL(){let o=await Zt.stat(Qt);if(o&&o.size>Wr.maxFileSize){for(let e=Wr.maxBackups;e>0;e--){let t=`${Qt}.${e}`,r=`${Qt}.${e+1}`;await Zt.exists(t)&&(e===Wr.maxBackups?await Zt.remove(t):await Zt.rename(t,r))}await Zt.exists(Qt)&&await Zt.rename(Qt,`${Qt}.1`),await Zt.write(Qt,"")}}function Sy(o){return`[${o.timestamp}] [${o.level.toUpperCase()}] ${o.message}
    at ${o.callerInfo}`}function zL(o,e){return e?t=>(o.notify(t.name+`
`+t.message),t):t=>(o.notify(t.name+`:
An error has occurred, please reload Obsidian.`),t)}var KL=["token","authorization","email"];function GL(o){if(typeof o=="object"&&o!==null){let e=new WeakSet;try{return JSON.stringify(o,(t,r)=>{var s;if(typeof r=="object"&&r!==null){if(e.has(r))return"[Circular]";e.add(r)}return typeof t=="string"&&KL.some(n=>t.toLowerCase().includes(n.toLowerCase()))?"[REDACTED]":r instanceof Error?{name:r.name,message:r.message,stack:(s=r.stack)==null?void 0:s.split(`
`).map(n=>n.trim()).join(" ")}:r},2)}catch(t){return t instanceof Error?t instanceof RangeError?`[Complex Object: ${Object.prototype.toString.call(o)}]`:`[Unserializable: ${t.message}]`:"[Unknown Error]"}}return String(o)}function Pe(o,e="log"){return(...t)=>{if(_y){let r=new Date().toISOString(),s=new Error().stack,n=s?s.split(`
`)[2].trim():"",a=t.map(GL).join(" "),i={timestamp:r,level:e,message:`${o}: ${a}`,callerInfo:n};Wr.disableConsole||console[e](Sy(i)),vl.push(i)}}}async function kl(){let o=[];await Zt.exists(Qt)&&o.push(Qt);for(let e=1;e<=Wr.maxBackups;e++){let t=`${Qt}.${e}`;await Zt.exists(t)&&o.push(t)}return o}async function ky(){let o=[];if(await Zt.exists(Qt)){let e=await Zt.read(Qt);o.push(e)}for(let e=1;e<=Wr.maxBackups;e++){let t=`${Qt}.${e}`;if(await Zt.exists(t)){let r=await Zt.read(t);o.push(r)}}return o.reverse().join(`
`)}var Ct=class{constructor(e){let t=e||this.constructor.name;this.debug=Pe(`[${t}]`,"debug"),this.log=Pe(`[${t}]`,"log"),this.warn=Pe(`[${t}]`,"warn"),this.error=Pe(`[${t}]`,"error")}setLoggers(e){this.debug=Pe(`[${e}]`,"debug"),this.log=Pe(`[${e}]`,"log"),this.warn=Pe(`[${e}]`,"warn"),this.error=Pe(`[${e}]`,"error")}},jL=!1;function Iy(o){return zL(o,jL)}var Su=class{constructor(){this.platform="s3rn";this.product="relay"}},ku=class{constructor(e){this.relayId=e;this.platform="s3rn";this.product="relay"}},Eo=class{constructor(e,t){this.relayId=e;this.folderId=t;this.platform="s3rn";this.product="relay"}},zr=class{constructor(e,t,r){this.relayId=e;this.folderId=t;this.documentId=r;this.platform="s3rn";this.product="relay"}},ns=class{constructor(e,t,r){this.relayId=e;this.folderId=t;this.fileId=r;this.platform="s3rn";this.product="relay"}},io=class{constructor(e){this.folderId=e;this.platform="s3rn";this.product="relay"}},Ro=class{constructor(e,t){this.folderId=e;this.documentId=t;this.platform="s3rn";this.product="relay"}},Wa=class{constructor(e,t){this.folderId=e;this.fileId=t;this.platform="s3rn";this.product="relay"}},Tt=class{static validateUUID(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e)}static encode(e){let t=`${e.platform}:${e.product}`;if("relayId"in e){if(!this.validateUUID(e.relayId))throw new Error("Invalid relay UUID");t+=`:relay:${e.relayId}`}if("folderId"in e){if(!this.validateUUID(e.folderId))throw new Error("Invalid folder UUID");t+=`:folder:${e.folderId}`}if("documentId"in e){if(!this.validateUUID(e.documentId))throw new Error("Invalid document UUID");t+=`:doc:${e.documentId}`}if("fileId"in e){if(!this.validateUUID(e.fileId))throw new Error("Invalid document UUID");t+=`:file:${e.fileId}`}return t}static decode(e){let t=e.split(":");if(t.length<3)throw new Error("Invalid s3rn format");let[,r,s,n,a,i,l,f]=t;if(!this.validateUUID(n))throw new Error("Invalid UUID");if(i&&!this.validateUUID(i))throw new Error("Invalid UUID");if(f&&!this.validateUUID(f))throw new Error("Invalid UUID");if(r==="relay"&&s==="relay"&&a==="folder"&&l==="doc")return new zr(n,i,f);if(r==="relay"&&s==="relay"&&a==="folder"&&l==="file")return new ns(n,i,f);if(r==="relay"&&s==="relay"&&a=="folder")return new Eo(n,i);if(r==="relay"&&s==="folder"&&a==="document")return new Ro(n,i);if(r==="relay"&&s==="folder")return new io(n);if(r==="relay"&&s==="relay")return new ku(n);if(s===void 0)return new Su;throw new Error("Invalid s3rn format for the given product type")}};function YL(o){if(typeof window!="undefined"&&window.btoa)return window.btoa(o);if(typeof Buffer!="undefined")return Buffer.from(o).toString("base64");throw new Error("Unable to encode to Base64")}function Ly(o){let e=JSON.stringify(o),t=YL(e);return t=t.replace("+","-").replace("/","_").replace(/=+$/,""),t}var Il={enableUpdateYDocFromDiskBuffer:!1,enableDocumentStatus:!1,enableDebugFileTag:!1,enableNewLinkFormat:!1,enableDeltaLogging:!1,enableHTTPSync:!1,enableSyncMenu:!0,enableDocumentServer:!1,enableDocumentHistory:!1,enableEditorTweens:!1,enableSyncModal:!1,enableDesyncPill:!1,enableAutomaticUpdatesOption:!1,enableAttachmentSync:!1,enableNetworkLogging:!1};function JL(){return new Proxy({},{get:(o,e)=>e})}var Dr=JL();var En=class{constructor(){this.timeouts=[],this.intervals=[]}getTime(){return Date.now()}setInterval(e,t){let r=window.setInterval(e,t);return this.intervals.push(r),r}clearInterval(e){window.clearInterval(e)}setTimeout(e,t){let r=window.setTimeout(()=>{this.timeouts.remove(r),e()},t);return this.timeouts.push(r),r}clearTimeout(e){window.clearTimeout(e)}destroy(){for(let e of this.timeouts)this.clearTimeout(e);this.timeouts=[];for(let e of this.intervals)this.clearInterval(e);this.intervals=[]}debounce(e,t=500){let r;return(...s)=>{r&&clearTimeout(r),r=setTimeout(()=>{e(...s)},t)}}};var Bt=class{constructor(e,t=20){this.timeProvider=e;this.deliveryWindow=t;this.mailboxes=new Map;this.allMailLog=[];this.deliveredMailLog=[];this.isDelivering=!1;this.deliveryInterval=null;this.currentTransactionId=0;this.isInTransaction=!1}static getInstance(){if(this._destroyed)throw new Error("tried to access postie during teardown");return Bt.instance||(Bt.instance=new Bt(new En),Et.set(this.instance,"postie")),Bt.instance}beginTransaction(){this.isInTransaction=!0,this.currentTransactionId++}commitTransaction(){this.isInTransaction=!1,this.isDelivering||this.scheduleDelivery()}send(e,t,r=!1){let s={sender:e,recipient:t,transactionId:this.currentTransactionId,timestamp:Date.now(),recipientOrigin:this.getFunctionOrigin(t)};this.allMailLog.push(s),this.mailboxes.has(t)||this.mailboxes.set(t,new Set),this.mailboxes.get(t).add(e),r?this.deliverImmediate(e,t):!this.isInTransaction&&!this.isDelivering&&this.scheduleDelivery()}deliverImmediate(e,t){t(e),this.deliveredMailLog.push({sender:e,recipient:t,transactionId:this.currentTransactionId,timestamp:Date.now(),recipientOrigin:this.getFunctionOrigin(t)})}scheduleDelivery(){this.isDelivering=!0,this.deliveryInterval=this.timeProvider.setTimeout(()=>{this.deliver(),this.deliveryInterval=null,this.isDelivering=!1,this.mailboxes.size>0&&!this.isInTransaction&&this.scheduleDelivery()},this.deliveryWindow)}deliver(){let e=Pe("[postie]","debug");for(let[t,r]of this.mailboxes){for(let s of r)t(s),e("send",s.constructor.name,t),this.deliveredMailLog.push({sender:s,recipient:t,transactionId:this.currentTransactionId,timestamp:Date.now(),recipientOrigin:this.getFunctionOrigin(t)});r.clear()}}getAllMailLog(){return[...this.allMailLog]}getDeliveredMailLog(){return[...this.deliveredMailLog]}prettyPrintAllMailLog(){Pe("[postie]","warn")("All Mail Log:"),this.prettyPrintMailLog(this.allMailLog)}prettyPrintDeliveredMailLog(){Pe("[postie]","warn")("Delivered Mail Log:"),this.prettyPrintMailLog(this.deliveredMailLog)}prettyPrintMailLog(e){let t=Pe("[postie]","warn");e.forEach((r,s)=>{t(`Mail #${s+1}:`),t(`  Timestamp: ${new Date(r.timestamp).toISOString()}`),t(`  Transaction ID: ${r.transactionId}`),t(`  Sender: ${r.sender.observableName||r.sender.constructor.name}`),t(`  Recipient: ${r.recipient.name||"Anonymous function"}`),t(`  Recipient Origin: ${r.recipientOrigin||"Unknown"}`),t("---")})}getFunctionOrigin(e){if(e.name)return e.name;let t=e.toString(),r=t.match(/^(function|class)?\s*([^\s(]*)/);if(r&&r[2])return r[2];let s=200,n=t.replace(/\s+/g," ").slice(0,s);return n.length===s&&(n+="..."),`AnonymousFunction(${n})`}static destroy(){Bt.instance&&(Bt.instance.mailboxes=null,Bt.instance.allMailLog=[],Bt.instance.deliveredMailLog=[],Bt.instance.timeProvider.destroy(),Bt.instance.timeProvider=null,Bt.instance.isDelivering=!1,Bt.instance.isInTransaction=!1,Bt.instance.currentTransactionId=0,Bt._destroyed=!0,Bt.instance=void 0)}},Mr=Bt;Mr._destroyed=!1;var Iu=new Map;function Cy(){for(let[,o]of Iu)o();Iu.clear()}var xt=class extends Ct{constructor(t){super();this.observableName=t;this.destroyed=!1;Iu.set(this,()=>{this._listeners&&this._listeners.size>0&&this.warn(`Missing tear down of ${this._listeners.size} listeners on ${this.observableName}`)}),this._listeners=new Set,this.unsubscribes=[]}notifyListeners(){for(let t of this._listeners)Mr.getInstance().send(this,t)}on(t){return this._listeners.add(t),()=>{this.off(t)}}subscribe(t){return this._listeners.add(t),Mr.getInstance().send(this,t,!0),()=>{this.unsubscribe(t)}}off(t){this._listeners.delete(t)}unsubscribe(t){this._listeners&&this._listeners.delete(t)}destroy(){var t;this.destroyed=!0,this.unsubscribes&&this.unsubscribes.forEach(r=>{r()}),(t=this._listeners)==null||t.clear(),this._listeners=null}};function Xe(){return{...Kt.getInstance().flags}}function lo(o,e,t=()=>{}){Kt.getInstance().flags[o]?e():t()}function Ty(o,e,t=()=>{}){o.forEach(r=>{if(Kt.getInstance().flags[r]){e();return}}),t()}var Kt=class extends xt{constructor(){super();this.flags=Il}static getInstance(){return Kt.instance||(Kt.instance=new Kt),Kt.instance}setSettings(t){this.settings=t,this.settings.subscribe(r=>{this.flags={...this.flags,...r},this.notifyListeners()})}getFlag(t){return this.flags[t]}setFlag(t,r){this.settings&&this.settings.update(s=>({...s,[t]:r}))}static destroy(){Kt.instance=null}};var XL={3:"disconnected",2:"disconnected",1:"connected",0:"connecting"};function Py(o,e,t){let r={token:o.token},s=new wy(o.url,o.docId,e,{connect:!1,params:r,disableBc:!0});return t&&s.awareness.setLocalStateField("user",{name:t.name,color:t.color.color,colorLight:t.color.light}),s}var $s=class extends Ct{constructor(t,r,s,n){var f;super();this.guid=t;this._s3rn=r;this.tokenStore=s;this.loginManager=n;this._providerSynced=!1;this.PROVIDER_MAX_ERRORS=3;this.listeners=new Map,this.loginManager=n;let a=(f=this.loginManager)==null?void 0:f.user;this.ydoc=new yr,Xe().enableDocumentHistory&&(this.ydoc.gc=!1),a&&new nl(this.ydoc).setUserMapping(this.ydoc,this.ydoc.clientID,a.id),this.tokenStore=s,this.clientToken=this.tokenStore.getTokenSync(Tt.encode(this.s3rn))||{token:"",url:"",docId:"-",expiryTime:0},this._provider=Py(this.clientToken,this.ydoc,a);let i=this.providerConnectionErrorSubscription(u=>{this.log(`[${this.path}] disconnection event`,u);let d=this._provider.url&&this._provider.shouldConnect&&this._provider.wsUnsuccessfulReconnects<this.PROVIDER_MAX_ERRORS;this.disconnect(),d&&this.connect()});i.on(),this._offConnectionError=i.off;let l=this.providerStateSubscription(u=>{this.notifyListeners()});l.on(),this._offState=l.off}get s3rn(){return this._s3rn}set s3rn(t){this._s3rn=t,this.refreshProvider(this.clientToken)}get debuggerUrl(){return`https://debugger.y-sweet.dev/?payload=${Ly(this.clientToken)}`}notifyListeners(){this.debug("[Provider State]",this.path,this.state),this.listeners.forEach(t=>{t(this.state)})}subscribe(t,r){return this.listeners.set(t,r),()=>{this.unsubscribe(t)}}unsubscribe(t){this.listeners.delete(t)}async getProviderToken(){return this.log("get provider token"),this.tokenStore.getToken(Tt.encode(this.s3rn),this.path||"unknown",this.refreshProvider.bind(this))}providerActive(){var t;if(this.clientToken){let r=this._provider.url==this.clientToken.url,s=Date.now()>(((t=this.clientToken)==null?void 0:t.expiryTime)||0);return r&&!s}return!1}refreshProvider(t){var a;this.clientToken=t;let r=new yr,s=Py(t,r),n=s.url;if(this._provider){if(this._provider.url!==n){this._provider.url=n,this._provider.wsUnsuccessfulReconnects=0;let i=this._provider.url.replace(/token=[^&]+/,"token=[REDACTED]");this.log(`Token Refreshed: setting new provider url, ${i}`),(a=this._provider.ws)==null||a.close()}}else throw new Error("missing provider!");s.awareness.destroy(),s.destroy(),r.destroy()}get connected(){return this.state.status==="connected"}connect(){return this.connected?Promise.resolve(!0):this.getProviderToken().then(t=>(this.refreshProvider(t),this._provider.connect(),this.notifyListeners(),!0)).catch(t=>!1)}get state(){var t;return{status:XL[((t=this._provider.ws)==null?void 0:t.readyState)||3],intent:this.intent}}get intent(){return this._provider.shouldConnect?"connected":"disconnected"}get synced(){return this._providerSynced}disconnect(){var t;this._provider.shouldConnect=!1,(t=this._provider.ws)==null||t.close(),this._provider.ws=null,this.tokenStore.removeFromRefreshQueue(this.guid),this.notifyListeners()}withActiveProvider(){return this.providerActive()?new Promise(t=>{t(this)}):this.getProviderToken().then(t=>this)}onceConnected(){return new Promise(t=>{let r=s=>{s.status==="connected"&&t()};this._provider.on("status",r)})}onceProviderSynced(){return this.synced?new Promise(t=>{t()}):new Promise(t=>{this._provider.once("synced",()=>{this._providerSynced=!0,t()})})}reset(){this.disconnect(),this.clientToken={token:"",url:"",docId:"-",expiryTime:0}}_injectIntent(t){return s=>{t({status:s.status,intent:this.intent})}}providerConnectionErrorSubscription(t){return{on:()=>{this._provider.on("connection-error",t)},off:()=>{this._provider.off("connection-error",t)}}}providerStateSubscription(t){return{on:()=>{this._provider.on("status",this._injectIntent(t))},off:()=>{this._provider.off("status",this._injectIntent(t))}}}destroy(){this._offConnectionError&&this._offConnectionError(),this._offState&&this._offState(),this._provider&&(this._provider.disconnect(),this._provider.awareness.destroy(),this._provider._observers.clear(),this._provider.destroy(),window.clearInterval(this._provider.awareness._checkInterval)),this.loginManager=null}};var as=class{constructor(e,t,r){this.vault=e;this.contents=r;this.parent=null;this.path=t,this.name=t.split("/").pop()||"",this.extension=this.name.includes(".")&&this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.stat={ctime:Date.now(),mtime:Date.now(),size:0}}delete(){return Promise.resolve()}rename(e){return this.path=e,this.name=e.split("/").pop()||"",this.extension=this.name.includes(".")&&this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),Promise.resolve()}getBasePath(){return this.path.substring(0,this.path.lastIndexOf("/"))}},Ll=class{constructor(){this.dbName="RelayDiskBuffer";this.storeName="diskBuffers";this.dbPromise=null}async getDB(){return this.dbPromise||(this.dbPromise=this.openDB()),this.dbPromise}async openDB(){return new Promise((e,t)=>{let r=indexedDB.open(this.dbName,1);r.onerror=()=>t(r.error),r.onsuccess=()=>e(r.result),r.onupgradeneeded=s=>{s.target.result.createObjectStore(this.storeName,{keyPath:"guid"})}})}async saveDiskBuffer(e,t){let r=await this.getDB();return new Promise((s,n)=>{try{let l=r.transaction(this.storeName,"readwrite").objectStore(this.storeName).put({guid:e,contents:t});l.onerror=()=>n(l.error),l.onsuccess=()=>s()}catch(a){n(a)}})}async loadDiskBuffer(e){let t=await this.getDB();return new Promise((r,s)=>{try{let i=t.transaction(this.storeName,"readonly").objectStore(this.storeName).get(e);i.onerror=()=>s(i.error),i.onsuccess=()=>r(i.result?i.result.contents:null)}catch(n){s(n)}})}async removeDiskBuffer(e){let t=await this.getDB();return new Promise((r,s)=>{try{let i=t.transaction(this.storeName,"readwrite").objectStore(this.storeName).delete(e);i.onerror=()=>s(i.error),i.onsuccess=()=>r()}catch(n){s(n)}})}};var is=class{constructor(e,t){this.currentPromise=null;this.promiseFunction=e,this.checkFunction=t}getPromise(){let[e,t]=this.checkFunction(),r=s=>{if(this.currentPromise&&this.resolver){let n=this.resolver;n(s),this.timeoutId&&clearTimeout(this.timeoutId),this.resolver=void 0}return this.currentPromise};if(e){let s=r(t);if(s)return s}return this.currentPromise||(this.currentPromise=new Promise((s,n)=>{this.resolver=s,this.timeoutId=window.setTimeout(()=>{Pe("[Promise]","debug")("Dependency stuck after 3s. Checking.",this.promiseFunction.toString());let[a,i]=this.checkFunction();a&&r(i)},3e3),this.promiseFunction().then(a=>{this.timeoutId&&clearTimeout(this.timeoutId),s(a)},a=>{this.timeoutId&&clearTimeout(this.timeoutId),this.currentPromise=null,n(a)})})),this.currentPromise}destroy(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=void 0),this.currentPromise=null,this.resolver=void 0}},Cl=class{constructor(e){this.currentPromise=null;this.promiseFunction=e}getPromise(){return this.currentPromise||(this.currentPromise=new Promise((e,t)=>{this.timeoutId=window.setTimeout(()=>{Pe("[Promise]","error")("SharedPromise stuck after 3s:",this.promiseFunction.toString())},3e3),this.promiseFunction().then(r=>{this.timeoutId&&clearTimeout(this.timeoutId),this.currentPromise=null,e(r)},r=>{this.timeoutId&&clearTimeout(this.timeoutId),this.currentPromise=null,t(r)})})),this.currentPromise}destroy(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=void 0),this.currentPromise=null}};function Tl(o,...e){return new Promise((t,r)=>{let s=window.setTimeout(()=>{Pe("[Promise]","error")("Promise stuck after 3s:",...e)},3e3);o.then(n=>{clearTimeout(s),t(n)},n=>{clearTimeout(s),r(n)})})}var QL={md:"text/markdown",txt:"text/plain",json:"application/json",js:"application/javascript",ts:"application/typescript",html:"text/html",css:"text/css",png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",svg:"image/svg+xml",pdf:"application/pdf",canvas:"application/json",webp:"image/webp",avif:"image/avif",bmp:"image/bmp",mp3:"audio/mpeg",wav:"audio/wav",m4a:"audio/x-m4a",flac:"audio/flac",ogg:"audio/ogg",oga:"audio/ogg",opus:"audio/opus",mp4:"video/mp4",webm:"video/webm",ogv:"video/ogg",mov:"video/quicktime",mkv:"video/x-matroska","3gp":"video/3gpp"};function Rn(o){var t;let e=((t=o.split(".").pop())==null?void 0:t.toLowerCase())||"";return QL[e]||"application/octet-stream"}function Oo(o){return o instanceof vt}var vt=class extends $s{constructor(t,r,s,n){let a=n.relayId?new zr(n.relayId,n.guid,r):new Ro(n.guid,r);super(r,a,n.tokenStore,s);this.whenSyncedPromise=null;this.persistenceSynced=!1;this.userLock=!1;this.unsubscribes=[];this._parent=n,this.path=t,this.name="[CRDT] "+t.split("/").pop()||"",this.setLoggers(this.name),this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.vault=this._parent.vault,this.stat={ctime:Date.now(),mtime:Date.now(),size:0},this._diskBufferStore=this.sharedFolder.diskBufferStore,this.unsubscribes.push(this._parent.subscribe(this.path,i=>{i.intent==="disconnected"&&this.disconnect()})),this.setLoggers(`[SharedDoc](${this.path})`);try{let i=`${this.sharedFolder.appId}-relay-doc-${this.guid}`;this._persistence=new Cn(i,this.ydoc)}catch(i){throw this.warn("Unable to open persistence.",this.guid),console.error(i),i}this.whenSynced().then(()=>{let i=l=>{let f=l.transaction.origin;l.changes.keys.size!==0&&f!=this&&this.updateStats()};this.ytext.observe(i),this.unsubscribes.push(()=>{var l;(l=this.ytext)==null||l.unobserve(i)}),this.updateStats();try{this._persistence.set("path",this.path),this._persistence.set("relay",this.sharedFolder.relayId||""),this._persistence.set("appId",this.sharedFolder.appId),this._persistence.set("s3rn",Tt.encode(this.s3rn))}catch(l){}(async()=>(await this.getServerSynced()||(await this.onceProviderSynced(),await this.markSynced()),this.sharedFolder.markUploaded(this)))()}),lo(Dr.enableDeltaLogging,()=>{let i=l=>{var u,d;let f="";f+=`Transaction origin: ${l.transaction.origin} ${(d=(u=l.transaction.origin)==null?void 0:u.constructor)==null?void 0:d.name}
`;for(let m of l.changes.delta)f+=`insert: ${m.insert}

retain: ${m.retain}

delete: ${m.delete}
`;this.debug(f)};this.ytext.observe(i),this.unsubscribes.push(()=>{this.ytext.unobserve(i)})}),this._tfile=null}move(t){this.path=t,this.name=t.split("/").pop()||"",this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.updateStats()}get parent(){var t;return((t=this.tfile)==null?void 0:t.parent)||null}get sharedFolder(){return this._parent}get tfile(){return this._tfile||(this._tfile=this._parent.getTFile(this)),this._tfile}get ytext(){return this.ydoc.getText("contents")}get text(){return this.ytext?this.ytext.toString():""}async diskBuffer(t=!1){if(t||this._diskBuffer===void 0){let r;try{let s=await this._parent.diskBufferStore.loadDiskBuffer(this.guid).catch(n=>null);return s!==null&&s!==""?r=s:r=await this._parent.read(this),this.setDiskBuffer(r.replace(`\r
`,`
`))}catch(s){throw console.error(s),s}}return this._diskBuffer}setDiskBuffer(t){return this._diskBuffer?this._diskBuffer.contents=t:this._diskBuffer=new as(this._parent.vault,"local disk",t),this._parent.diskBufferStore.saveDiskBuffer(this.guid,t).catch(r=>{}),this._diskBuffer}async clearDiskBuffer(){this._diskBuffer&&(this._diskBuffer.contents="",this._diskBuffer=void 0),await this._parent.diskBufferStore.removeDiskBuffer(this.guid).catch(t=>{})}async checkStale(){await this.whenSynced();let r=(await this.diskBuffer(!0)).contents,s=this.text!==r;return s||this.clearDiskBuffer(),s}async connect(){return this.sharedFolder.s3rn instanceof io?!1:(this.s3rn instanceof Ro&&(this.sharedFolder.relayId?this.s3rn=new zr(this.sharedFolder.relayId,this.sharedFolder.guid,this.guid):this.s3rn=new Ro(this.sharedFolder.guid,this.guid)),this.sharedFolder.shouldConnect&&this.sharedFolder.connect().then(t=>super.connect()))}get ready(){return this._persistence.synced&&(this.synced||!!this._serverSynced||this._origin==="local")}hasLocalDB(){return!!this._serverSynced||this._persistence._dbsize>3||!!(this._dbsize&&this._dbsize>3)}async awaitingUpdates(){return await this.whenSynced(),await this.getServerSynced(),this._awaitingUpdates?(this._awaitingUpdates=!this.hasLocalDB(),this._awaitingUpdates):!1}async whenReady(){let t=async()=>await this.awaitingUpdates()?(this.log("awaiting updates"),this.connect(),await this.onceConnected(),this.log("connected"),await this.onceProviderSynced(),this.log("synced"),this):this;return this.readyPromise=this.readyPromise||new is(t,()=>[this.ready,this]),this.readyPromise.getPromise()}whenSynced(){let t=async()=>(await this.sharedFolder.whenSynced(),this._persistence.synced&&!this.persistenceSynced?(await this.count(),this.persistenceSynced=!0,Promise.resolve()):new Promise(r=>{this.persistenceSynced&&r(),this._persistence.once("synced",async()=>{await this.count(),this.persistenceSynced=!0,r()})}));return this.whenSyncedPromise=this.whenSyncedPromise||new is(t,()=>[this.persistenceSynced,void 0]),this.whenSyncedPromise.getPromise()}async hasKnownPeers(){return await this.whenSynced(),this.hasLocalDB()}get mimetype(){return Rn(this.path)}async markOrigin(t){this._origin=t,await this._persistence.set("origin",t)}async getOrigin(){return this._origin!==void 0?this._origin:(this._origin=await this._persistence.get("origin"),this._origin)}async markSynced(){this._serverSynced=!0,await this._persistence.set("serverSync",1)}async getServerSynced(){return this._serverSynced!==void 0?this._serverSynced:await this._persistence.get("serverSync")===1?(this._serverSynced=!0,this._serverSynced):!1}async count(){if(this._persistence.db===null)throw new Error("database not ready yet");if(this._dbsize)return this._dbsize;if(this._persistence._dbsize>3)return this._dbsize=this._persistence._dbsize,this._dbsize;let[t]=no(this._persistence.db,["updates"],"readonly"),r=await Os(t);return this._dbsize=r,this._dbsize}get dbsize(){if(!this._dbsize)throw new Error("dbsize accessed before count");return this._persistence._dbsize===0&&this._dbsize?this._dbsize:this._persistence._dbsize}static checkExtension(t){return t.endsWith(".md")}destroy(){var t,r;this.unsubscribes.forEach(s=>{s()}),super.destroy(),this.ydoc.destroy(),this._diskBuffer&&(this._diskBuffer.contents="",this._diskBuffer=void 0),this._diskBufferStore=null,(t=this.whenSyncedPromise)==null||t.destroy(),this.whenSyncedPromise=null,(r=this.readyPromise)==null||r.destroy(),this.readyPromise=null}async read(){return this.text}async rename(t){this.move(t)}async cleanup(){var t;(t=this._diskBufferStore)==null||t.removeDiskBuffer(this.guid)}updateStats(){this.stat.mtime=Date.now(),this.stat.size=this.text.length}async write(t){this.ytext.delete(0,this.ytext.length),this.ytext.insert(0,t),this.updateStats()}async append(t){this.ytext.insert(this.ytext.length,t),this.updateStats()}};var ls=class extends xt{constructor(){super();this._set=new Set}add(t){return this._set.add(t),this.notifyListeners(),this}delete(t){let r=this._set.delete(t);return r&&this.notifyListeners(),r}clear(){this._set.clear(),this.notifyListeners()}has(t){return this._set.has(t)}items(){return[...this._set]}get size(){return this._set.size}map(t){return this.items().map(t)}forEach(t){this.items().forEach(t)}find(t){return this.items().find(t)}some(t){for(let r of this._set)if(t(r))return!0;return!1}filter(t){let r=[];for(let s of this._set)t(s)&&r.push(s);return r}};var Uo=class{constructor(e){this.seperator="/";this.namespace=e}fullKey(e){return`${this.namespace}${this.seperator}${e}`}get size(){return Object.keys(localStorage).filter(e=>e.startsWith(this.namespace+this.seperator)).length}clear(){Object.keys(localStorage).filter(e=>e.startsWith(this.namespace+this.seperator)).forEach(e=>localStorage.removeItem(e))}delete(e){let t=this.fullKey(e),r=localStorage.getItem(t)!==null;return localStorage.removeItem(t),r}forEach(e,t){Object.keys(localStorage).filter(r=>r.startsWith(this.namespace+this.seperator)).forEach(r=>{let s=r.split(`${this.namespace}${this.seperator}`)[1],n=this.get(s);e.call(t,n,s,this)})}get(e){let t=this.fullKey(e),r=localStorage.getItem(t);return r?JSON.parse(r):void 0}has(e){let t=this.fullKey(e);return localStorage.getItem(t)!==null}set(e,t){let r=this.fullKey(e);return localStorage.setItem(r,JSON.stringify(t)),this}keys(){return Object.keys(localStorage).filter(t=>t.startsWith(this.namespace+this.seperator)).map(t=>t.split(`${this.namespace}${this.seperator}`)[1]).values()}values(){return Array.from(this.keys()).map(t=>this.get(t)).values()}entries(){return Array.from(this.keys()).map(t=>[t,this.get(t)]).values()}[Symbol.iterator](){return this.entries()}get[Symbol.toStringTag](){return"LocalStorage"}};var Lu=require("obsidian");function Cu(o){return o instanceof xr}var xr=class extends Ct{constructor(t,r,s,n){super();this.path=t;this.guid=r;this.relayManager=s;this._tfolder=null;this.ready=!1;this.createPromise=null;this.connected=!0;this._parent=n,this.name=this.path.split("/").pop()||"",this.vault=this._parent.vault;let a=this.vault.getAbstractFileByPath(this.sharedFolder.getPath(t));a instanceof Lu.TFolder?(this._tfolder=a,this.ready=!0):(this.createPromise=this.vault.createFolder(this.sharedFolder.getPath(t)),this.createPromise.then(i=>{this._tfolder=i,this.ready=!0})),this.synctime=0,this.setLoggers(`[SyncFolder](${this.path})`),this.offFolderStatusListener=this._parent.subscribe(this.path,i=>{i.intent==="disconnected"&&this.disconnect()}),(async()=>(this.createPromise&&await this.createPromise,n.markUploaded(this)))(),this.log("created")}static fromTFolder(t,r,s){return console.log("virtualpath for new syncfolder",r.getVirtualPath(s.path)),new xr(r.getVirtualPath(s.path),hn(),t,r)}disconnect(){this.connected=!1}move(t){t!==this.path&&(this.log("setting new path",t),this.path=t,this.name=t.split("/").pop()||"",this.setLoggers(`[SharedFolder](${this.path})`))}static checkPath(t){var s;return!((s=t.split("/").pop())==null?void 0:s.includes("."))}get tfolder(){let t=this.vault.getAbstractFileByPath(this.sharedFolder.getPath(this.path));if(t instanceof Lu.TFolder)return t;throw new Error("TFolder API used before file existed")}get parent(){var t;return((t=this.tfolder)==null?void 0:t.parent)||null}get sharedFolder(){return this._parent}async connect(){return this.sharedFolder.shouldConnect&&this.sharedFolder.connect().then(t=>(this.connected=!0,this.connected))}async rename(t){this.move(t)}async delete(){return this.vault.delete(this.tfolder)}cleanup(){}destroy(){var t;(t=this.offFolderStatusListener)==null||t.call(this),this.offFolderStatusListener=null,this._parent=null,this.relayManager=null,this._tfolder=null}};var co=vs(xa());var Pl,ZL=new Uint8Array(16);function Tu(){if(!Pl&&(Pl=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Pl))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Pl(ZL)}var Nt=[];for(let o=0;o<256;++o)Nt.push((o+256).toString(16).slice(1));function Ay(o,e=0){return Nt[o[e+0]]+Nt[o[e+1]]+Nt[o[e+2]]+Nt[o[e+3]]+"-"+Nt[o[e+4]]+Nt[o[e+5]]+"-"+Nt[o[e+6]]+Nt[o[e+7]]+"-"+Nt[o[e+8]]+Nt[o[e+9]]+"-"+Nt[o[e+10]]+Nt[o[e+11]]+Nt[o[e+12]]+Nt[o[e+13]]+Nt[o[e+14]]+Nt[o[e+15]]}var eC=typeof crypto!="undefined"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Pu={randomUUID:eC};function tC(o,e,t){if(Pu.randomUUID&&!e&&!o)return Pu.randomUUID();o=o||{};let r=o.random||(o.rng||Tu)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(let s=0;s<16;++s)e[t+s]=r[s];return e}return Ay(r)}var On=tC;var rC={images:"image",audio:"audio",videos:"video",pdfs:"pdf",otherTypes:"file"};function Au(o){return(o==null?void 0:o.type)==="markdown"}function Fy(o){return(o==null?void 0:o.type)==="folder"}function Ka(o){return{version:0,id:o,type:"markdown"}}function Al(o){return{version:0,id:o,type:"folder"}}function Dy(o,e,t,r,s){return s||(s=Date.now()),{version:0,id:e,type:o,mimetype:t,synctime:s,hash:r}}var Fu=class extends xt{constructor(t,r){super();this.syncSettings=t;this.configs=r;this.protocols=new Map;r=r||Fu.defaults,r.forEach(([s,n])=>this.protocols.set(s,n)),this.unsubscribes.push(t.subscribe(s=>{this.updateFromSettings(s)}))}setEnabled(t,r){let s=this.protocols.get(t);s&&(s.enabled=r)}canSync(t,r){var a,i;if(t.endsWith(".md")||!((a=t.split("/").pop())==null?void 0:a.includes(".")))return!0;if(!Xe().enableAttachmentSync)return!1;if(r){let l=this.protocols.get(r.type);return l?l.enabled&&r.version<=l.maxVersion:!1}let n=this.getTypeForPath(t);return!!((i=this.protocols.get(n))!=null&&i.enabled)}updateFromSettings(t){Object.entries(rC).forEach(([r,s])=>{this.setEnabled(s,t[r])})}getEnabledFileSyncTypes(){if(!Xe().enableAttachmentSync)return["markdown"];let t=[];return this.protocols.forEach((r,s)=>{r!=null&&r.enabled&&s!=="folder"&&t.push(s)}),t}getTypeForPath(t){let r=Rn(t);for(let[s,n]of this.protocols)if(n.mimetypes.includes(r))return s;return"file"}},za=Fu;za.defaults=[["folder",{maxVersion:0,mimetypes:[],enabled:!0}],["markdown",{maxVersion:0,mimetypes:["text/markdown"],enabled:!0}],["image",{maxVersion:0,mimetypes:["image/png","image/jpeg","image/gif","image/svg+xml","image/webp","image/avif","image/bmp"],enabled:!0}],["pdf",{maxVersion:0,mimetypes:["application/pdf"],enabled:!0}],["audio",{maxVersion:0,mimetypes:["audio/mpeg","audio/wav","audio/flac","audio/mp4","audio/x-m4a","audio/ogg","audio/opus"],enabled:!0}],["video",{maxVersion:0,mimetypes:["video/mp4","video/webm","video/ogg","video/quicktime","video/x-matroska"],enabled:!0}],["file",{maxVersion:0,mimetypes:["application/octet-stream"],enabled:!1}]];var Fl=class extends xt{constructor(t,r,s,n){super();this.ydoc=t;this.namespace=r;this.pendingUpload=s;this.syncSettingsManager=n;this.legacyIds=this.ydoc.getMap("docs"),this.meta=this.ydoc.getMap("filemeta_v0"),this.overlay=new Map,this.renames=new Map,this.deleteSet=new Set,this.typeRegistry=new za(this.syncSettingsManager)}assertVPath(t){if(t.startsWith(this.namespace+co.sep))throw new Error("Expected virtual path"+t)}print(){this.log("files",Array.from(this.meta.entries()).map(([t,r])=>({path:t,...r}))),this.log("pending...",Array.from(this.pendingUpload.entries()).map(([t,r])=>({path:t,guid:r})))}canSync(t){let r=this.getMeta(t);return this.typeRegistry.canSync(t,r)}resolveMove(t){this.log("resolving alias",t),this.renames.delete(t)}resolveAll(){this.renames.clear()}move(t,r){this.log("moving file",t,"to",r),this.assertVPath(t),this.assertVPath(r),this.renames.set(t,r);let s=this.pendingUpload.get(t);s&&(this.pendingUpload.set(r,s),this.pendingUpload.delete(t)),this.deleteSet.has(t)&&(this.deleteSet.add(r),this.deleteSet.delete(t));let n=this.overlay.get(t);n&&(this.overlay.set(r,n),this.overlay.delete(t));let a=this.meta.get(t);Fy(a)?this.moveFolder(t,r):a&&(this.set(r,a),this.delete(t))}new(t){this.assertVPath(t);let r=On();return this.pendingUpload.set(t,r),r}forEach(t){this.meta.forEach((r,s)=>{this.deleteSet.has(s)||t(r,s)}),this.overlay.forEach((r,s)=>{this.deleteSet.has(s)||t(r,s)})}has(t){return this.renames.has(t)&&(t=this.renames.get(t)),this.deleteSet.has(t)?!1:this.meta.has(t)||this.legacyIds.has(t)||this.overlay.has(t)||this.pendingUpload.has(t)}set(t,r){this.assertVPath(t),Au(r)&&this.legacyIds.get(t)!==r.id&&this.legacyIds.set(t,r.id);let s=this.meta.get(t);s&&s.id===r.id&&s.mimetype==r.mimetype&&s.type===r.type&&s.hash===r.hash||(this.log("metadata write (path, existing, meta)",t,s,r),this.meta.set(t,r),this.pendingUpload.has(t)&&this.pendingUpload.delete(t))}processFolderOperation(t){let r=new Map,s=new Map;t.changes.keys.forEach((n,a)=>{if(n.action==="delete"){let i=n.oldValue;(i==null?void 0:i.type)==="folder"&&r.set(i.id,a)}else if(n.action==="add"||n.action==="update"){let i=this.meta.get(a);(i==null?void 0:i.type)==="folder"&&s.set(i.id,a)}}),r.forEach((n,a)=>{let i=s.get(a);if(i&&n!==i){this.log(`Detected folder move from ${n} to ${i}`);let l=new Map;this.meta.forEach((f,u)=>{u.startsWith(i+co.sep)&&l.set(u,f)}),this.renames.set(n,i),this.log("setting alias",n,i),this.log("paths to move",l),l.forEach((f,u)=>{let d=u.slice(i.length),m=n+d;this.renames.set(m,u),this.log("setting alias",m,u)})}})}start(){lo(Dr.enableDeltaLogging,()=>{let s=n=>{var i,l;let a="";a+=`Transaction origin: ${n.transaction.origin}${(l=(i=n.transaction.origin)==null?void 0:i.constructor)==null?void 0:l.name}
`,n.changes.keys.forEach((f,u)=>{f.action==="add"&&(a+=`Added ${u}: ${this.get(u)}
`),f.action==="update"&&(a+=`Updated ${u}: ${this.get(u)}
`),f.action==="delete"&&(a+=`Deleted ${u}
`)}),this.debug(a)};this.legacyIds.observe(s),this.meta.observe(s),this.unsubscribes.push(()=>{this.legacyIds.unobserve(s)}),this.unsubscribes.push(()=>{this.meta.unobserve(s)})});let t=async s=>{if(s.changes.keys.size===0){this.log("no changes detected");return}s.transaction.origin!=this&&(this.processFolderOperation(s),this.notifyListeners())},r=async s=>{this.migrateUp(),this.notifyListeners()};this.legacyIds.observe(r),this.meta.observe(t),this.unsubscribes.push(()=>{this.legacyIds.unobserve(r)}),this.unsubscribes.push(()=>{this.meta.unobserve(t)}),this.unsubscribes.push(this.typeRegistry.subscribe(()=>{this.log("type registry change"),this.notifyListeners()}))}get(t){if(this.assertVPath(t),this.renames.has(t)&&(t=this.renames.get(t)),this.deleteSet.has(t))return;let r=this.pendingUpload.get(t);if(r)return r;let s=this.getMeta(t);if(s)return s.id}getMeta(t){if(this.assertVPath(t),this.renames.has(t)&&(t=this.renames.get(t)),this.deleteSet.has(t))return;let r=this.meta.get(t)||this.overlay.get(t),s=this.legacyIds.has(t);if(!r&&this.legacyIds.has(t)){let n=this.legacyIds.get(t),a=Ka(n);return this.overlay.set(t,a),a}if(r){if(Au(r)&&!s){this.deleteSet.add(t);return}return r}}delete(t){return this.assertVPath(t),this.legacyIds.delete(t),this.pendingUpload.delete(t),this.meta.delete(t)}get remoteIds(){let t=new Set;return this.forEach(r=>{t.add(r.id)}),t}commit(){this.overlay.size>0&&this.log("committing overlay",[...this.overlay.keys()]),this.overlay.forEach((t,r)=>{this.set(r,t),t.type==="markdown"&&this.legacyIds.get(r)!==t.id&&this.legacyIds.set(r,t.id)}),this.overlay=new Map,this.deleteSet.size>0&&this.log("committing deleteSet",[...this.deleteSet]),this.deleteSet.forEach(t=>this.delete(t)),this.deleteSet=new Set}detectFolderMoves(){let t=new Map,r=new Set;this.legacyIds.forEach((n,a)=>{let i;if(this.meta.forEach((l,f)=>{l.type==="markdown"&&l.id===n&&f!==a&&(i=f)}),i){let l=(0,co.dirname)(i),f=(0,co.dirname)(a);l!==f&&t.set(l,f)}}),Array.from(t.entries()).sort(([n],[a])=>a.length-n.length).forEach(([n,a])=>{r.has(n)||(this.moveFolder(n,a),r.add(n))})}moveFolder(t,r){this.log("moving folder",t,"to",r);let s=new Map;this.meta.forEach((a,i)=>{(i===t||i.startsWith(t+co.sep))&&s.set(i,a)}),this.overlay.forEach((a,i)=>{(i===t||i.startsWith(t+co.sep))&&s.set(i,a)});let n=this.meta.get(t);n&&(this.meta.set(r,n),this.meta.delete(t)),s.forEach((a,i)=>{if(i===t)return;let l=i.slice(t.length),f=r+l;this.move(i,f)})}markUploaded(t,r){if(!this.has(t))throw new Error(`unexpected vpath ${t} marked uploaded`);this.set(t,r)}migrateFile(t,r){var i;if(this.assertVPath(r),((i=this.meta.get(r))==null?void 0:i.id)===t)return;let s=new Set,n=r.split(co.sep),a="";for(let l=0;l<n.length-1;l++)a=n.slice(0,l+1).join(co.sep),s.add(a);this.meta.has(r)||this.overlay.has(r)||r.endsWith(".md")&&(this.warn(`migrated legacy key on ${r}`),this.overlay.set(r,Ka(t))),s.forEach(l=>{if(l&&!(this.meta.has(l)||this.overlay.has(l))){let f=On();console.log("creating folder path",l,f),this.overlay.set(l,Al(f))}})}migrateUp(){this.detectFolderMoves(),this.legacyIds.forEach((t,r)=>{this.migrateFile(t,r)})}destroy(){super.destroy(),this.overlay.clear(),this.deleteSet.clear(),this.renames.clear(),this.legacyIds=null,this.meta=null}};function My(o,e,t=(r,s)=>r.substring(s.length).replace(/^\/+/,"")){return new Proxy(o,{get(r,s){let n=r[s];return typeof n=="function"?function(...a){return a.length>0&&typeof a[0]=="string"&&(a[0]=t(a[0],e)),n.apply(r,a)}:n}})}var Ny=require("obsidian"),Hy=require("obsidian");if(globalThis.Response===void 0||globalThis.Headers===void 0)try{if(console.warn("[Relay] Polyfilling Fetch API (Electron Bug: https://github.com/electron/electron/pull/42419)"),globalThis.blinkfetch){globalThis.fetch=globalThis.blinkFetch;let o=["fetch","Response","FormData","Request","Headers"];for(let e of o)globalThis[e]=globalThis[`blink${e}`]}}catch(o){console.error(o)}globalThis.EventSource===void 0&&(Hy.Platform.isMobile?console.warn("[Relay] Polyfilling EventSource API required, but unable to polyfill on Mobile"):(console.warn("[Relay] Polyfilling EventSource API"),globalThis.EventSource=By()));var Pt=async(o,e)=>{let t=o instanceof URL?o.toString():o,r=(e==null?void 0:e.method)||"GET",s=Object.assign({},e==null?void 0:e.headers,{"Relay-Version":"0.4.10"}),n={url:t,method:r,body:e==null?void 0:e.body,headers:s,throw:!1},a;if(a=await(0,Ny.requestUrl)(n),!a.arrayBuffer.byteLength)return new Response(null,{status:a.status,statusText:a.status.toString(),headers:new Headers(a.headers)});let i=new Response(a.arrayBuffer,{status:a.status,statusText:a.status.toString(),headers:new Headers(a.headers)});if(Object.defineProperty(i,"json",{value:async()=>JSON.parse(a.text)}),Xe().enableNetworkLogging){let f=a.status>=500?"error":a.status>=400?"warn":"debug",u=a.text,d;if((a.headers["content-type"]||"").includes("application/json"))try{d=JSON.parse(u)}catch(y){}Pe("[CustomFetch]",f)(a.status.toString(),r,t,d||u)}if(a.status>=500)throw new Error(a.text);return i};var er=class extends Error{constructor(e){var t,r,s,n;super("ClientResponseError"),this.url="",this.status=0,this.response={},this.isAbort=!1,this.originalError=null,Object.setPrototypeOf(this,er.prototype),e!==null&&typeof e=="object"&&(this.url=typeof e.url=="string"?e.url:"",this.status=typeof e.status=="number"?e.status:0,this.isAbort=!!e.isAbort,this.originalError=e.originalError,e.response!==null&&typeof e.response=="object"?this.response=e.response:e.data!==null&&typeof e.data=="object"?this.response=e.data:this.response={}),this.originalError||e instanceof er||(this.originalError=e),typeof DOMException!="undefined"&&e instanceof DOMException&&(this.isAbort=!0),this.name="ClientResponseError "+this.status,this.message=(t=this.response)==null?void 0:t.message,this.message||(this.isAbort?this.message="The request was autocancelled. You can find more info in https://github.com/pocketbase/js-sdk#auto-cancellation.":(n=(s=(r=this.originalError)==null?void 0:r.cause)==null?void 0:s.message)!=null&&n.includes("ECONNREFUSED ::1")?this.message="Failed to connect to the PocketBase server. Try changing the SDK URL from localhost to 127.0.0.1 (https://github.com/pocketbase/js-sdk/issues/21).":this.message="Something went wrong while processing your request.")}get data(){return this.response}toJSON(){return{...this}}},Dl=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function gC(o,e){let t={};if(typeof o!="string")return t;let r=Object.assign({},e||{}).decode||yC,s=0;for(;s<o.length;){let n=o.indexOf("=",s);if(n===-1)break;let a=o.indexOf(";",s);if(a===-1)a=o.length;else if(a<n){s=o.lastIndexOf(";",n-1)+1;continue}let i=o.slice(s,n).trim();if(t[i]===void 0){let l=o.slice(n+1,a).trim();l.charCodeAt(0)===34&&(l=l.slice(1,-1));try{t[i]=r(l)}catch(f){t[i]=l}}s=a+1}return t}function Vy(o,e,t){let r=Object.assign({},t||{}),s=r.encode||xC;if(!Dl.test(o))throw new TypeError("argument name is invalid");let n=s(e);if(n&&!Dl.test(n))throw new TypeError("argument val is invalid");let a=o+"="+n;if(r.maxAge!=null){let i=r.maxAge-0;if(isNaN(i)||!isFinite(i))throw new TypeError("option maxAge is invalid");a+="; Max-Age="+Math.floor(i)}if(r.domain){if(!Dl.test(r.domain))throw new TypeError("option domain is invalid");a+="; Domain="+r.domain}if(r.path){if(!Dl.test(r.path))throw new TypeError("option path is invalid");a+="; Path="+r.path}if(r.expires){if(!function(l){return Object.prototype.toString.call(l)==="[object Date]"||l instanceof Date}(r.expires)||isNaN(r.expires.valueOf()))throw new TypeError("option expires is invalid");a+="; Expires="+r.expires.toUTCString()}if(r.httpOnly&&(a+="; HttpOnly"),r.secure&&(a+="; Secure"),r.priority)switch(typeof r.priority=="string"?r.priority.toLowerCase():r.priority){case"low":a+="; Priority=Low";break;case"medium":a+="; Priority=Medium";break;case"high":a+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}if(r.sameSite)switch(typeof r.sameSite=="string"?r.sameSite.toLowerCase():r.sameSite){case!0:a+="; SameSite=Strict";break;case"lax":a+="; SameSite=Lax";break;case"strict":a+="; SameSite=Strict";break;case"none":a+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return a}function yC(o){return o.indexOf("%")!==-1?decodeURIComponent(o):o}function xC(o){return encodeURIComponent(o)}var zy;function Ml(o){if(o)try{let e=decodeURIComponent(zy(o.split(".")[1]).split("").map(function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(e)||{}}catch(e){}return{}}function Ky(o,e=0){let t=Ml(o);return!(Object.keys(t).length>0&&(!t.exp||t.exp-e>Date.now()/1e3))}zy=typeof atob=="function"?atob:o=>{let e=String(o).replace(/=+$/,"");if(e.length%4==1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(var t,r,s=0,n=0,a="";r=e.charAt(n++);~r&&(t=s%4?64*t+r:r,s++%4)?a+=String.fromCharCode(255&t>>(-2*s&6)):0)r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(r);return a};var qy="pb_auth",ja=class{constructor(){this.baseToken="",this.baseModel=null,this._onChangeCallbacks=[]}get token(){return this.baseToken}get model(){return this.baseModel}get isValid(){return!Ky(this.token)}get isAdmin(){return Ml(this.token).type==="admin"}get isAuthRecord(){return Ml(this.token).type==="authRecord"}save(e,t){this.baseToken=e||"",this.baseModel=t||null,this.triggerChange()}clear(){this.baseToken="",this.baseModel=null,this.triggerChange()}loadFromCookie(e,t=qy){let r=gC(e||"")[t]||"",s={};try{s=JSON.parse(r),(typeof s===null||typeof s!="object"||Array.isArray(s))&&(s={})}catch(n){}this.save(s.token||"",s.model||null)}exportToCookie(e,t=qy){var l,f;let r={secure:!0,sameSite:!0,httpOnly:!0,path:"/"},s=Ml(this.token);r.expires=s!=null&&s.exp?new Date(1e3*s.exp):new Date("1970-01-01"),e=Object.assign({},r,e);let n={token:this.token,model:this.model?JSON.parse(JSON.stringify(this.model)):null},a=Vy(t,JSON.stringify(n),e),i=typeof Blob!="undefined"?new Blob([a]).size:a.length;if(n.model&&i>4096){n.model={id:(l=n==null?void 0:n.model)==null?void 0:l.id,email:(f=n==null?void 0:n.model)==null?void 0:f.email};let u=["collectionId","username","verified"];for(let d in this.model)u.includes(d)&&(n.model[d]=this.model[d]);a=Vy(t,JSON.stringify(n),e)}return a}onChange(e,t=!1){return this._onChangeCallbacks.push(e),t&&e(this.token,this.model),()=>{for(let r=this._onChangeCallbacks.length-1;r>=0;r--)if(this._onChangeCallbacks[r]==e)return delete this._onChangeCallbacks[r],void this._onChangeCallbacks.splice(r,1)}}triggerChange(){for(let e of this._onChangeCallbacks)e&&e(this.token,this.model)}},Mu=class extends ja{constructor(e="pocketbase_auth"){super(),this.storageFallback={},this.storageKey=e,this._bindStorageEvent()}get token(){return(this._storageGet(this.storageKey)||{}).token||""}get model(){return(this._storageGet(this.storageKey)||{}).model||null}save(e,t){this._storageSet(this.storageKey,{token:e,model:t}),super.save(e,t)}clear(){this._storageRemove(this.storageKey),super.clear()}_storageGet(e){if(typeof window!="undefined"&&(window!=null&&window.localStorage)){let t=window.localStorage.getItem(e)||"";try{return JSON.parse(t)}catch(r){return t}}return this.storageFallback[e]}_storageSet(e,t){if(typeof window!="undefined"&&(window!=null&&window.localStorage)){let r=t;typeof t!="string"&&(r=JSON.stringify(t)),window.localStorage.setItem(e,r)}else this.storageFallback[e]=t}_storageRemove(e){var t;typeof window!="undefined"&&(window!=null&&window.localStorage)&&((t=window.localStorage)==null||t.removeItem(e)),delete this.storageFallback[e]}_bindStorageEvent(){typeof window!="undefined"&&(window!=null&&window.localStorage)&&window.addEventListener&&window.addEventListener("storage",e=>{if(e.key!=this.storageKey)return;let t=this._storageGet(this.storageKey)||{};super.save(t.token||"",t.model||null)})}},$o=class{constructor(e){this.client=e}},Eu=class extends $o{async getAll(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/settings",e)}async update(e,t){return t=Object.assign({method:"PATCH",body:e},t),this.client.send("/api/settings",t)}async testS3(e="storage",t){return t=Object.assign({method:"POST",body:{filesystem:e}},t),this.client.send("/api/settings/test/s3",t).then(()=>!0)}async testEmail(e,t,r){return r=Object.assign({method:"POST",body:{email:e,template:t}},r),this.client.send("/api/settings/test/email",r).then(()=>!0)}async generateAppleClientSecret(e,t,r,s,n,a){return a=Object.assign({method:"POST",body:{clientId:e,teamId:t,keyId:r,privateKey:s,duration:n}},a),this.client.send("/api/settings/apple/generate-client-secret",a)}},Ya=class extends $o{decode(e){return e}async getFullList(e,t){if(typeof e=="number")return this._getFullList(e,t);let r=500;return(t=Object.assign({},e,t)).batch&&(r=t.batch,delete t.batch),this._getFullList(r,t)}async getList(e=1,t=30,r){return(r=Object.assign({method:"GET"},r)).query=Object.assign({page:e,perPage:t},r.query),this.client.send(this.baseCrudPath,r).then(s=>{var n;return s.items=((n=s.items)==null?void 0:n.map(a=>this.decode(a)))||[],s})}async getFirstListItem(e,t){return(t=Object.assign({requestKey:"one_by_filter_"+this.baseCrudPath+"_"+e},t)).query=Object.assign({filter:e,skipTotal:1},t.query),this.getList(1,1,t).then(r=>{var s;if(!((s=r==null?void 0:r.items)!=null&&s.length))throw new er({status:404,response:{code:404,message:"The requested resource wasn't found.",data:{}}});return r.items[0]})}async getOne(e,t){if(!e)throw new er({url:this.client.buildUrl(this.baseCrudPath+"/"),status:404,response:{code:404,message:"Missing required record id.",data:{}}});return t=Object.assign({method:"GET"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),t).then(r=>this.decode(r))}async create(e,t){return t=Object.assign({method:"POST",body:e},t),this.client.send(this.baseCrudPath,t).then(r=>this.decode(r))}async update(e,t,r){return r=Object.assign({method:"PATCH",body:t},r),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),r).then(s=>this.decode(s))}async delete(e,t){return t=Object.assign({method:"DELETE"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e),t).then(()=>!0)}_getFullList(e=500,t){(t=t||{}).query=Object.assign({skipTotal:1},t.query);let r=[],s=async n=>this.getList(n,e||500,t).then(a=>{let i=a.items;return r=r.concat(i),i.length==a.perPage?s(n+1):r});return s(1)}};function br(o,e,t,r){let s=r!==void 0;return s||t!==void 0?s?(console.warn(o),e.body=Object.assign({},e.body,t),e.query=Object.assign({},e.query,r),e):Object.assign(e,t):e}function Du(o){var e;(e=o._resetAutoRefresh)==null||e.call(o)}var Ru=class extends Ya{get baseCrudPath(){return"/api/admins"}async update(e,t,r){return super.update(e,t,r).then(s=>{var n,a;return((n=this.client.authStore.model)==null?void 0:n.id)===s.id&&((a=this.client.authStore.model)==null?void 0:a.collectionId)===void 0&&this.client.authStore.save(this.client.authStore.token,s),s})}async delete(e,t){return super.delete(e,t).then(r=>{var s,n;return r&&((s=this.client.authStore.model)==null?void 0:s.id)===e&&((n=this.client.authStore.model)==null?void 0:n.collectionId)===void 0&&this.client.authStore.clear(),r})}authResponse(e){let t=this.decode((e==null?void 0:e.admin)||{});return e!=null&&e.token&&(e!=null&&e.admin)&&this.client.authStore.save(e.token,t),Object.assign({},e,{token:(e==null?void 0:e.token)||"",admin:t})}async authWithPassword(e,t,r,s){let n={method:"POST",body:{identity:e,password:t}};n=br("This form of authWithPassword(email, pass, body?, query?) is deprecated. Consider replacing it with authWithPassword(email, pass, options?).",n,r,s);let a=n.autoRefreshThreshold;delete n.autoRefreshThreshold,n.autoRefresh||Du(this.client);let i=await this.client.send(this.baseCrudPath+"/auth-with-password",n);return i=this.authResponse(i),a&&function(f,u,d,m){Du(f);let y=f.beforeSend,h=f.authStore.model,_=f.authStore.onChange((w,v)=>{(!w||(v==null?void 0:v.id)!=(h==null?void 0:h.id)||(v!=null&&v.collectionId||h!=null&&h.collectionId)&&(v==null?void 0:v.collectionId)!=(h==null?void 0:h.collectionId))&&Du(f)});f._resetAutoRefresh=function(){_(),f.beforeSend=y,delete f._resetAutoRefresh},f.beforeSend=async(w,v)=>{var E;let M=f.authStore.token;if((E=v.query)!=null&&E.autoRefresh)return y?y(w,v):{url:w,sendOptions:v};let O=f.authStore.isValid;if(O&&Ky(f.authStore.token,u))try{await d()}catch(R){O=!1}O||await m();let A=v.headers||{};for(let R in A)if(R.toLowerCase()=="authorization"&&M==A[R]&&f.authStore.token){A[R]=f.authStore.token;break}return v.headers=A,y?y(w,v):{url:w,sendOptions:v}}}(this.client,a,()=>this.authRefresh({autoRefresh:!0}),()=>this.authWithPassword(e,t,Object.assign({autoRefresh:!0},n))),i}async authRefresh(e,t){let r={method:"POST"};return r=br("This form of authRefresh(body?, query?) is deprecated. Consider replacing it with authRefresh(options?).",r,e,t),this.client.send(this.baseCrudPath+"/auth-refresh",r).then(this.authResponse.bind(this))}async requestPasswordReset(e,t,r){let s={method:"POST",body:{email:e}};return s=br("This form of requestPasswordReset(email, body?, query?) is deprecated. Consider replacing it with requestPasswordReset(email, options?).",s,t,r),this.client.send(this.baseCrudPath+"/request-password-reset",s).then(()=>!0)}async confirmPasswordReset(e,t,r,s,n){let a={method:"POST",body:{token:e,password:t,passwordConfirm:r}};return a=br("This form of confirmPasswordReset(resetToken, password, passwordConfirm, body?, query?) is deprecated. Consider replacing it with confirmPasswordReset(resetToken, password, passwordConfirm, options?).",a,s,n),this.client.send(this.baseCrudPath+"/confirm-password-reset",a).then(()=>!0)}},bC=["requestKey","$cancelKey","$autoCancel","fetch","headers","body","query","params","cache","credentials","headers","integrity","keepalive","method","mode","redirect","referrer","referrerPolicy","signal","window"];function Gy(o){if(o){o.query=o.query||{};for(let e in o)bC.includes(e)||(o.query[e]=o[e],delete o[e])}}var El=class extends $o{constructor(){super(...arguments),this.clientId="",this.eventSource=null,this.subscriptions={},this.lastSentSubscriptions=[],this.maxConnectTimeout=15e3,this.reconnectAttempts=0,this.maxReconnectAttempts=1/0,this.predefinedReconnectIntervals=[200,300,500,1e3,1200,1500,2e3],this.pendingConnects=[]}get isConnected(){return!!this.eventSource&&!!this.clientId&&!this.pendingConnects.length}async subscribe(e,t,r){var a;if(!e)throw new Error("topic must be set.");let s=e;if(r){Gy(r);let i="options="+encodeURIComponent(JSON.stringify({query:r.query,headers:r.headers}));s+=(s.includes("?")?"&":"?")+i}let n=function(i){let l=i,f;try{f=JSON.parse(l==null?void 0:l.data)}catch(u){}t(f||{})};return this.subscriptions[s]||(this.subscriptions[s]=[]),this.subscriptions[s].push(n),this.isConnected?this.subscriptions[s].length===1?await this.submitSubscriptions():(a=this.eventSource)==null||a.addEventListener(s,n):await this.connect(),async()=>this.unsubscribeByTopicAndListener(e,n)}async unsubscribe(e){var r;let t=!1;if(e){let s=this.getSubscriptionsByTopic(e);for(let n in s)if(this.hasSubscriptionListeners(n)){for(let a of this.subscriptions[n])(r=this.eventSource)==null||r.removeEventListener(n,a);delete this.subscriptions[n],t||(t=!0)}}else this.subscriptions={};this.hasSubscriptionListeners()?t&&await this.submitSubscriptions():this.disconnect()}async unsubscribeByPrefix(e){var r;let t=!1;for(let s in this.subscriptions)if((s+"?").startsWith(e)){t=!0;for(let n of this.subscriptions[s])(r=this.eventSource)==null||r.removeEventListener(s,n);delete this.subscriptions[s]}t&&(this.hasSubscriptionListeners()?await this.submitSubscriptions():this.disconnect())}async unsubscribeByTopicAndListener(e,t){var n;let r=!1,s=this.getSubscriptionsByTopic(e);for(let a in s){if(!Array.isArray(this.subscriptions[a])||!this.subscriptions[a].length)continue;let i=!1;for(let l=this.subscriptions[a].length-1;l>=0;l--)this.subscriptions[a][l]===t&&(i=!0,delete this.subscriptions[a][l],this.subscriptions[a].splice(l,1),(n=this.eventSource)==null||n.removeEventListener(a,t));i&&(this.subscriptions[a].length||delete this.subscriptions[a],r||this.hasSubscriptionListeners(a)||(r=!0))}this.hasSubscriptionListeners()?r&&await this.submitSubscriptions():this.disconnect()}hasSubscriptionListeners(e){var t,r;if(this.subscriptions=this.subscriptions||{},e)return!!((t=this.subscriptions[e])!=null&&t.length);for(let s in this.subscriptions)if((r=this.subscriptions[s])!=null&&r.length)return!0;return!1}async submitSubscriptions(){if(this.clientId)return this.addAllSubscriptionListeners(),this.lastSentSubscriptions=this.getNonEmptySubscriptionKeys(),this.client.send("/api/realtime",{method:"POST",body:{clientId:this.clientId,subscriptions:this.lastSentSubscriptions},requestKey:this.getSubscriptionsCancelKey()}).catch(e=>{if(!(e!=null&&e.isAbort))throw e})}getSubscriptionsCancelKey(){return"realtime_"+this.clientId}getSubscriptionsByTopic(e){let t={};e=e.includes("?")?e:e+"?";for(let r in this.subscriptions)(r+"?").startsWith(e)&&(t[r]=this.subscriptions[r]);return t}getNonEmptySubscriptionKeys(){let e=[];for(let t in this.subscriptions)this.subscriptions[t].length&&e.push(t);return e}addAllSubscriptionListeners(){if(this.eventSource){this.removeAllSubscriptionListeners();for(let e in this.subscriptions)for(let t of this.subscriptions[e])this.eventSource.addEventListener(e,t)}}removeAllSubscriptionListeners(){if(this.eventSource)for(let e in this.subscriptions)for(let t of this.subscriptions[e])this.eventSource.removeEventListener(e,t)}async connect(){if(!(this.reconnectAttempts>0))return new Promise((e,t)=>{this.pendingConnects.push({resolve:e,reject:t}),this.pendingConnects.length>1||this.initConnect()})}initConnect(){this.disconnect(!0),clearTimeout(this.connectTimeoutId),this.connectTimeoutId=setTimeout(()=>{this.connectErrorHandler(new Error("EventSource connect took too long."))},this.maxConnectTimeout),this.eventSource=new EventSource(this.client.buildUrl("/api/realtime")),this.eventSource.onerror=e=>{this.connectErrorHandler(new Error("Failed to establish realtime connection."))},this.eventSource.addEventListener("PB_CONNECT",e=>{let t=e;this.clientId=t==null?void 0:t.lastEventId,this.submitSubscriptions().then(async()=>{let r=3;for(;this.hasUnsentSubscriptions()&&r>0;)r--,await this.submitSubscriptions()}).then(()=>{for(let s of this.pendingConnects)s.resolve();this.pendingConnects=[],this.reconnectAttempts=0,clearTimeout(this.reconnectTimeoutId),clearTimeout(this.connectTimeoutId);let r=this.getSubscriptionsByTopic("PB_CONNECT");for(let s in r)for(let n of r[s])n(e)}).catch(r=>{this.clientId="",this.connectErrorHandler(r)})})}hasUnsentSubscriptions(){let e=this.getNonEmptySubscriptionKeys();if(e.length!=this.lastSentSubscriptions.length)return!0;for(let t of e)if(!this.lastSentSubscriptions.includes(t))return!0;return!1}connectErrorHandler(e){if(clearTimeout(this.connectTimeoutId),clearTimeout(this.reconnectTimeoutId),!this.clientId&&!this.reconnectAttempts||this.reconnectAttempts>this.maxReconnectAttempts){for(let r of this.pendingConnects)r.reject(new er(e));return this.pendingConnects=[],void this.disconnect()}this.disconnect(!0);let t=this.predefinedReconnectIntervals[this.reconnectAttempts]||this.predefinedReconnectIntervals[this.predefinedReconnectIntervals.length-1];this.reconnectAttempts++,this.reconnectTimeoutId=setTimeout(()=>{this.initConnect()},t)}disconnect(e=!1){var t;if(clearTimeout(this.connectTimeoutId),clearTimeout(this.reconnectTimeoutId),this.removeAllSubscriptionListeners(),this.client.cancelRequest(this.getSubscriptionsCancelKey()),(t=this.eventSource)==null||t.close(),this.eventSource=null,this.clientId="",!e){this.reconnectAttempts=0;for(let r of this.pendingConnects)r.resolve();this.pendingConnects=[]}}},Ou=class extends Ya{constructor(e,t){super(e),this.collectionIdOrName=t}get baseCrudPath(){return this.baseCollectionPath+"/records"}get baseCollectionPath(){return"/api/collections/"+encodeURIComponent(this.collectionIdOrName)}async subscribe(e,t,r){if(!e)throw new Error("Missing topic.");if(!t)throw new Error("Missing subscription callback.");return this.client.realtime.subscribe(this.collectionIdOrName+"/"+e,t,r)}async unsubscribe(e){return e?this.client.realtime.unsubscribe(this.collectionIdOrName+"/"+e):this.client.realtime.unsubscribeByPrefix(this.collectionIdOrName)}async getFullList(e,t){if(typeof e=="number")return super.getFullList(e,t);let r=Object.assign({},e,t);return super.getFullList(r)}async getList(e=1,t=30,r){return super.getList(e,t,r)}async getFirstListItem(e,t){return super.getFirstListItem(e,t)}async getOne(e,t){return super.getOne(e,t)}async create(e,t){return super.create(e,t)}async update(e,t,r){return super.update(e,t,r).then(s=>{var n,a,i;return((n=this.client.authStore.model)==null?void 0:n.id)!==(s==null?void 0:s.id)||((a=this.client.authStore.model)==null?void 0:a.collectionId)!==this.collectionIdOrName&&((i=this.client.authStore.model)==null?void 0:i.collectionName)!==this.collectionIdOrName||this.client.authStore.save(this.client.authStore.token,s),s})}async delete(e,t){return super.delete(e,t).then(r=>{var s,n,a;return!r||((s=this.client.authStore.model)==null?void 0:s.id)!==e||((n=this.client.authStore.model)==null?void 0:n.collectionId)!==this.collectionIdOrName&&((a=this.client.authStore.model)==null?void 0:a.collectionName)!==this.collectionIdOrName||this.client.authStore.clear(),r})}authResponse(e){let t=this.decode((e==null?void 0:e.record)||{});return this.client.authStore.save(e==null?void 0:e.token,t),Object.assign({},e,{token:(e==null?void 0:e.token)||"",record:t})}async listAuthMethods(e){return e=Object.assign({method:"GET"},e),this.client.send(this.baseCollectionPath+"/auth-methods",e).then(t=>Object.assign({},t,{usernamePassword:!!(t!=null&&t.usernamePassword),emailPassword:!!(t!=null&&t.emailPassword),authProviders:Array.isArray(t==null?void 0:t.authProviders)?t==null?void 0:t.authProviders:[]}))}async authWithPassword(e,t,r,s){let n={method:"POST",body:{identity:e,password:t}};return n=br("This form of authWithPassword(usernameOrEmail, pass, body?, query?) is deprecated. Consider replacing it with authWithPassword(usernameOrEmail, pass, options?).",n,r,s),this.client.send(this.baseCollectionPath+"/auth-with-password",n).then(a=>this.authResponse(a))}async authWithOAuth2Code(e,t,r,s,n,a,i){let l={method:"POST",body:{provider:e,code:t,codeVerifier:r,redirectUrl:s,createData:n}};return l=br("This form of authWithOAuth2Code(provider, code, codeVerifier, redirectUrl, createData?, body?, query?) is deprecated. Consider replacing it with authWithOAuth2Code(provider, code, codeVerifier, redirectUrl, createData?, options?).",l,a,i),this.client.send(this.baseCollectionPath+"/auth-with-oauth2",l).then(f=>this.authResponse(f))}async authWithOAuth2(...e){if(e.length>1||typeof(e==null?void 0:e[0])=="string")return console.warn("PocketBase: This form of authWithOAuth2() is deprecated and may get removed in the future. Please replace with authWithOAuth2Code() OR use the authWithOAuth2() realtime form as shown in https://pocketbase.io/docs/authentication/#oauth2-integration."),this.authWithOAuth2Code((e==null?void 0:e[0])||"",(e==null?void 0:e[1])||"",(e==null?void 0:e[2])||"",(e==null?void 0:e[3])||"",(e==null?void 0:e[4])||{},(e==null?void 0:e[5])||{},(e==null?void 0:e[6])||{});let t=(e==null?void 0:e[0])||{},r=(await this.listAuthMethods()).authProviders.find(l=>l.name===t.provider);if(!r)throw new er(new Error(`Missing or invalid provider "${t.provider}".`));let s=this.client.buildUrl("/api/oauth2-redirect"),n=new El(this.client),a=null;function i(){a==null||a.close(),n.unsubscribe()}return t.urlCallback||(a=Wy(void 0)),new Promise(async(l,f)=>{var u;try{await n.subscribe("@oauth2",async h=>{let _=n.clientId;try{if(!h.state||_!==h.state)throw new Error("State parameters don't match.");let w=Object.assign({},t);delete w.provider,delete w.scopes,delete w.createData,delete w.urlCallback;let v=await this.authWithOAuth2Code(r.name,h.code,r.codeVerifier,s,t.createData,w);l(v)}catch(w){f(new er(w))}i()});let d={state:n.clientId};(u=t.scopes)!=null&&u.length&&(d.scope=t.scopes.join(" "));let m=this._replaceQueryParams(r.authUrl+s,d);await(t.urlCallback||function(h){a?a.location.href=h:a=Wy(h)})(m)}catch(d){i(),f(new er(d))}})}async authRefresh(e,t){let r={method:"POST"};return r=br("This form of authRefresh(body?, query?) is deprecated. Consider replacing it with authRefresh(options?).",r,e,t),this.client.send(this.baseCollectionPath+"/auth-refresh",r).then(s=>this.authResponse(s))}async requestPasswordReset(e,t,r){let s={method:"POST",body:{email:e}};return s=br("This form of requestPasswordReset(email, body?, query?) is deprecated. Consider replacing it with requestPasswordReset(email, options?).",s,t,r),this.client.send(this.baseCollectionPath+"/request-password-reset",s).then(()=>!0)}async confirmPasswordReset(e,t,r,s,n){let a={method:"POST",body:{token:e,password:t,passwordConfirm:r}};return a=br("This form of confirmPasswordReset(token, password, passwordConfirm, body?, query?) is deprecated. Consider replacing it with confirmPasswordReset(token, password, passwordConfirm, options?).",a,s,n),this.client.send(this.baseCollectionPath+"/confirm-password-reset",a).then(()=>!0)}async requestVerification(e,t,r){let s={method:"POST",body:{email:e}};return s=br("This form of requestVerification(email, body?, query?) is deprecated. Consider replacing it with requestVerification(email, options?).",s,t,r),this.client.send(this.baseCollectionPath+"/request-verification",s).then(()=>!0)}async confirmVerification(e,t,r){let s={method:"POST",body:{token:e}};return s=br("This form of confirmVerification(token, body?, query?) is deprecated. Consider replacing it with confirmVerification(token, options?).",s,t,r),this.client.send(this.baseCollectionPath+"/confirm-verification",s).then(()=>!0)}async requestEmailChange(e,t,r){let s={method:"POST",body:{newEmail:e}};return s=br("This form of requestEmailChange(newEmail, body?, query?) is deprecated. Consider replacing it with requestEmailChange(newEmail, options?).",s,t,r),this.client.send(this.baseCollectionPath+"/request-email-change",s).then(()=>!0)}async confirmEmailChange(e,t,r,s){let n={method:"POST",body:{token:e,password:t}};return n=br("This form of confirmEmailChange(token, password, body?, query?) is deprecated. Consider replacing it with confirmEmailChange(token, password, options?).",n,r,s),this.client.send(this.baseCollectionPath+"/confirm-email-change",n).then(()=>!0)}async listExternalAuths(e,t){return t=Object.assign({method:"GET"},t),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e)+"/external-auths",t)}async unlinkExternalAuth(e,t,r){return r=Object.assign({method:"DELETE"},r),this.client.send(this.baseCrudPath+"/"+encodeURIComponent(e)+"/external-auths/"+encodeURIComponent(t),r).then(()=>!0)}_replaceQueryParams(e,t={}){let r=e,s="";e.indexOf("?")>=0&&(r=e.substring(0,e.indexOf("?")),s=e.substring(e.indexOf("?")+1));let n={},a=s.split("&");for(let i of a){if(i=="")continue;let l=i.split("=");n[decodeURIComponent(l[0].replace(/\+/g," "))]=decodeURIComponent((l[1]||"").replace(/\+/g," "))}for(let i in t)t.hasOwnProperty(i)&&(t[i]==null?delete n[i]:n[i]=t[i]);s="";for(let i in n)n.hasOwnProperty(i)&&(s!=""&&(s+="&"),s+=encodeURIComponent(i.replace(/%20/g,"+"))+"="+encodeURIComponent(n[i].replace(/%20/g,"+")));return s!=""?r+"?"+s:r}};function Wy(o){if(typeof window=="undefined"||!(window!=null&&window.open))throw new er(new Error("Not in a browser context - please pass a custom urlCallback function."));let e=1024,t=768,r=window.innerWidth,s=window.innerHeight;e=e>r?r:e,t=t>s?s:t;let n=r/2-e/2,a=s/2-t/2;return window.open(o,"popup_window","width="+e+",height="+t+",top="+a+",left="+n+",resizable,menubar=no")}var Uu=class extends Ya{get baseCrudPath(){return"/api/collections"}async import(e,t=!1,r){return r=Object.assign({method:"PUT",body:{collections:e,deleteMissing:t}},r),this.client.send(this.baseCrudPath+"/import",r).then(()=>!0)}},$u=class extends $o{async getList(e=1,t=30,r){return(r=Object.assign({method:"GET"},r)).query=Object.assign({page:e,perPage:t},r.query),this.client.send("/api/logs",r)}async getOne(e,t){if(!e)throw new er({url:this.client.buildUrl("/api/logs/"),status:404,response:{code:404,message:"Missing required log id.",data:{}}});return t=Object.assign({method:"GET"},t),this.client.send("/api/logs/"+encodeURIComponent(e),t)}async getStats(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/logs/stats",e)}},Bu=class extends $o{async check(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/health",e)}},Nu=class extends $o{getUrl(e,t,r={}){if(!t||!(e!=null&&e.id)||!(e!=null&&e.collectionId)&&!(e!=null&&e.collectionName))return"";let s=[];s.push("api"),s.push("files"),s.push(encodeURIComponent(e.collectionId||e.collectionName)),s.push(encodeURIComponent(e.id)),s.push(encodeURIComponent(t));let n=this.client.buildUrl(s.join("/"));if(Object.keys(r).length){r.download===!1&&delete r.download;let a=new URLSearchParams(r);n+=(n.includes("?")?"&":"?")+a}return n}async getToken(e){return e=Object.assign({method:"POST"},e),this.client.send("/api/files/token",e).then(t=>(t==null?void 0:t.token)||"")}},Hu=class extends $o{async getFullList(e){return e=Object.assign({method:"GET"},e),this.client.send("/api/backups",e)}async create(e,t){return t=Object.assign({method:"POST",body:{name:e}},t),this.client.send("/api/backups",t).then(()=>!0)}async upload(e,t){return t=Object.assign({method:"POST",body:e},t),this.client.send("/api/backups/upload",t).then(()=>!0)}async delete(e,t){return t=Object.assign({method:"DELETE"},t),this.client.send(`/api/backups/${encodeURIComponent(e)}`,t).then(()=>!0)}async restore(e,t){return t=Object.assign({method:"POST"},t),this.client.send(`/api/backups/${encodeURIComponent(e)}/restore`,t).then(()=>!0)}getDownloadUrl(e,t){return this.client.buildUrl(`/api/backups/${encodeURIComponent(t)}?token=${encodeURIComponent(e)}`)}},Un=class{constructor(e="/",t,r="en-US"){this.cancelControllers={},this.recordServices={},this.enableAutoCancellation=!0,this.baseUrl=e,this.lang=r,this.authStore=t||new Mu,this.admins=new Ru(this),this.collections=new Uu(this),this.files=new Nu(this),this.logs=new $u(this),this.settings=new Eu(this),this.realtime=new El(this),this.health=new Bu(this),this.backups=new Hu(this)}collection(e){return this.recordServices[e]||(this.recordServices[e]=new Ou(this,e)),this.recordServices[e]}autoCancellation(e){return this.enableAutoCancellation=!!e,this}cancelRequest(e){return this.cancelControllers[e]&&(this.cancelControllers[e].abort(),delete this.cancelControllers[e]),this}cancelAllRequests(){for(let e in this.cancelControllers)this.cancelControllers[e].abort();return this.cancelControllers={},this}filter(e,t){if(!t)return e;for(let r in t){let s=t[r];switch(typeof s){case"boolean":case"number":s=""+s;break;case"string":s="'"+s.replace(/'/g,"\\'")+"'";break;default:s=s===null?"null":s instanceof Date?"'"+s.toISOString().replace("T"," ")+"'":"'"+JSON.stringify(s).replace(/'/g,"\\'")+"'"}e=e.replaceAll("{:"+r+"}",s)}return e}getFileUrl(e,t,r={}){return this.files.getUrl(e,t,r)}buildUrl(e){var r;let t=this.baseUrl;return typeof window=="undefined"||!window.location||t.startsWith("https://")||t.startsWith("http://")||(t=(r=window.location.origin)!=null&&r.endsWith("/")?window.location.origin.substring(0,window.location.origin.length-1):window.location.origin||"",this.baseUrl.startsWith("/")||(t+=window.location.pathname||"/",t+=t.endsWith("/")?"":"/"),t+=this.baseUrl),e&&(t+=t.endsWith("/")?"":"/",t+=e.startsWith("/")?e.substring(1):e),t}async send(e,t){t=this.initSendOptions(e,t);let r=this.buildUrl(e);if(this.beforeSend){let s=Object.assign({},await this.beforeSend(r,t));s.url!==void 0||s.options!==void 0?(r=s.url||r,t=s.options||t):Object.keys(s).length&&(t=s,console!=null&&console.warn&&console.warn("Deprecated format of beforeSend return: please use `return { url, options }`, instead of `return options`."))}if(t.query!==void 0){let s=this.serializeQueryParams(t.query);s&&(r+=(r.includes("?")?"&":"?")+s),delete t.query}return this.getHeader(t.headers,"Content-Type")=="application/json"&&t.body&&typeof t.body!="string"&&(t.body=JSON.stringify(t.body)),(t.fetch||fetch)(r,t).then(async s=>{let n={};try{n=await s.json()}catch(a){}if(this.afterSend&&(n=await this.afterSend(s,n)),s.status>=400)throw new er({url:s.url,status:s.status,data:n});return n}).catch(s=>{throw new er(s)})}initSendOptions(e,t){if((t=Object.assign({method:"GET"},t)).body=this.convertToFormDataIfNeeded(t.body),Gy(t),t.query=Object.assign({},t.params,t.query),t.requestKey===void 0&&(t.$autoCancel===!1||t.query.$autoCancel===!1?t.requestKey=null:(t.$cancelKey||t.query.$cancelKey)&&(t.requestKey=t.$cancelKey||t.query.$cancelKey)),delete t.$autoCancel,delete t.query.$autoCancel,delete t.$cancelKey,delete t.query.$cancelKey,this.getHeader(t.headers,"Content-Type")!==null||this.isFormData(t.body)||(t.headers=Object.assign({},t.headers,{"Content-Type":"application/json"})),this.getHeader(t.headers,"Accept-Language")===null&&(t.headers=Object.assign({},t.headers,{"Accept-Language":this.lang})),this.authStore.token&&this.getHeader(t.headers,"Authorization")===null&&(t.headers=Object.assign({},t.headers,{Authorization:this.authStore.token})),this.enableAutoCancellation&&t.requestKey!==null){let r=t.requestKey||(t.method||"GET")+e;delete t.requestKey,this.cancelRequest(r);let s=new AbortController;this.cancelControllers[r]=s,t.signal=s.signal}return t}convertToFormDataIfNeeded(e){if(typeof FormData=="undefined"||e===void 0||typeof e!="object"||e===null||this.isFormData(e)||!this.hasBlobField(e))return e;let t=new FormData;for(let r in e){let s=this.normalizeFormDataValue(e[r]),n=Array.isArray(s)?s:[s];if(n.length)for(let a of n)t.append(r,a);else t.append(r,"")}return t}normalizeFormDataValue(e){return e===null||typeof e!="object"||e instanceof Date||this.hasBlobField({data:e})||Array.isArray(e)&&!e.filter(t=>typeof t!="string").length?e:JSON.stringify(e)}hasBlobField(e){for(let t in e){let r=Array.isArray(e[t])?e[t]:[e[t]];for(let s of r)if(typeof Blob!="undefined"&&s instanceof Blob||typeof File!="undefined"&&s instanceof File)return!0}return!1}getHeader(e,t){e=e||{},t=t.toLowerCase();for(let r in e)if(r.toLowerCase()==t)return e[r];return null}isFormData(e){return e&&(e.constructor.name==="FormData"||typeof FormData!="undefined"&&e instanceof FormData)}serializeQueryParams(e){let t=[];for(let r in e){if(e[r]===null)continue;let s=e[r],n=encodeURIComponent(r);if(Array.isArray(s))for(let a of s)t.push(n+"="+encodeURIComponent(a));else s instanceof Date?t.push(n+"="+encodeURIComponent(s.toISOString())):typeof s!==null&&typeof s=="object"?t.push(n+"="+encodeURIComponent(JSON.stringify(s))):t.push(n+"="+encodeURIComponent(s))}return t.join("&")}};var Rl=class extends Ct{constructor(t){super();this.pb=new Un("https://auth.system3.md",t.loginManager.authStore),this.tokenStore=t.tokenStore}async readFile(t){if(!t.meta)throw new Error("cannot pull file with missing hash");let r=t.meta.hash,s=await this.tokenStore.getFileToken(Tt.encode(t.s3rn),r,t.mimetype,0),i=(await(await Pt(s.baseUrl+"/download-url",{method:"GET",headers:{Authorization:`Bearer ${s.token}`}})).json()).downloadUrl;return(await Pt(i)).arrayBuffer()}async writeFile(t){let r=await t.caf.read(),s=await t.caf.hash();if(this.warn("writeFile",s),!(r&&s))throw new Error("invalid caf");let n=await this.tokenStore.getFileToken(Tt.encode(t.s3rn),s,t.mimetype,r.byteLength),l=(await(await Pt(n.baseUrl+"/upload-url",{method:"POST",headers:{Authorization:`Bearer ${n.token}`}})).json()).uploadUrl;await Pt(l,{method:"PUT",headers:{"Content-Type":t.mimetype},body:r})}destroy(){this.pb.cancelAllRequests(),this.pb=null,this.tokenStore=null}};var fr=class extends Error{constructor(t,r){super(t);this.path=r;this.name="SettingsError"}};var Ol=class extends xt{constructor(t,r){super();this.storage=t;this.defaults=r;this._loaded=!1;this.data={...r}}async load(){let t=await this.storage.loadData();this.data={...this.defaults,...t||{}},this._loaded=!0,this.log("Loaded settings from disk:",this.data)}async save(){if(!this._loaded){this.warn("Attempted to save before loading settings from disk");return}this.log("Saving settings to disk:",this.data),await this.storage.saveData(this.data)}get(){return this.data}async update(t){if(!this._loaded){this.warn("Attempted to update before loading settings from disk");return}let r=t(this.data),s=await this.storage.loadData();if(JSON.stringify(r)===JSON.stringify(s)){this.debug("updated matches disk, no change");return}this.data=r,await this.save(),this.notifyListeners()}notifyListeners(){for(let t of this._listeners)t(this.data)}},wr=class extends xt{constructor(t,r){super();this.settings=t;this.patterns=[];this.validatePath(r),[this.path,this.basePath,this.patterns]=this.processPath(r),this.lastKnown=this.getNestedValue(this.settings.get()),this.setupSubscription()}isWildcardPattern(t){return t.type==="wildcard"}validatePath(t){if(!t)throw new fr("Path cannot be empty");if(t.startsWith("/")||t.endsWith("/"))throw new fr(`Invalid path format: ${t}`)}createPatternRegex(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace("\\*",".*")}setupSubscription(){this.unsub=this.settings.subscribe(()=>{let t=this.getNestedValue(this.settings.get());this.lastKnown===void 0&&t===void 0||JSON.stringify(this.lastKnown)!==JSON.stringify(t)&&(this.lastKnown=t,this.notifyListeners())})}hasArrayPatterns(){return this.patterns.some(t=>t.type==="arrayMatch")}destroy(){this.destroyed||(this.unsub&&(this.unsub(),this.unsub=void 0),this._listeners.clear(),this.destroyed=!0)}get(){if(this.destroyed)throw new fr("Cannot use destroyed settings",this.getPath());let t=this.settings.get();if(!t)return{};let r=this.patterns.find(this.isWildcardPattern);if(r&&this.path.length===1){let n=new RegExp(`^${r.wildcardPattern}$`);return Object.entries(t).filter(([i])=>n.test(i)).reduce((i,[l,f])=>(i[l]=f,i),{})}let s=this.getNestedValue(t);return s===void 0?{}:s}async set(t){if(this.destroyed)throw new fr("Cannot use destroyed settings",this.getPath());if(t===void 0)throw new fr("Cannot set undefined value",this.getPath());try{await this.settings.update(r=>{let s=this.patterns.find(this.isWildcardPattern);if(s){if(this.path.length===1){let l=new RegExp(`^${s.wildcardPattern}$`),f={...r};return Object.entries(t).forEach(([u,d])=>{l.test(u)&&(f[u]=d)}),f}let n={...r},a=n;this.path.forEach(l=>{a[l]=a[l]||{},a=a[l]});let i=new RegExp(`^${s.wildcardPattern}$`);return Object.entries(t).forEach(([l,f])=>{i.test(l)&&(a[l]=f)}),n}return this.setNestedValue(r,t)})}catch(r){let s=r instanceof Error?r.message:"Unknown error";throw new fr(`Failed to set value at path ${this.getPath()}: ${s}`,this.getPath())}}async update(t,r=!1){if(this.destroyed)throw new fr("Cannot use destroyed settings",this.getPath());let s=this.get(),n=t(s);!r&&JSON.stringify(s)===JSON.stringify(n)||await this.set(n)}async flush(){if(this.destroyed)throw new fr("Cannot use destroyed settings",this.getPath());await this.update(t=>t,!0)}processPath(t){let r=t.split("/").filter(i=>i),s=[],n=[],a=[];return r.forEach((i,l)=>{let f=i.match(/^\[(\w+)=(.+)\]$/),u=i.match(/^\((.+?)\)$/);if(f){let[,d,m]=f,y=l>0?n[l-1]:i.split("[")[0];a.push({type:"arrayMatch",key:d,value:m,level:l}),s.push(i),n.push(y)}else if(u){let[,d]=u;a.push({type:"wildcard",wildcardPattern:this.createPatternRegex(d),level:l}),s.push(i),n.push(i)}else s.push(i),n.push(i)}),[s,n,a]}getNestedValue(t){let r=t,s=this.patterns.find(this.isWildcardPattern);if(s&&this.path.length===1){let a=new RegExp(`^${s.wildcardPattern}$`);return Object.entries(r).filter(([l])=>a.test(l)).reduce((l,[f,u])=>(l[f]=u,l),{})}let n=this.patterns[0];if((n==null?void 0:n.type)==="arrayMatch"){let a=this.basePath[0];if(!Array.isArray(r[a]))return;let i=r[a].find(f=>f[n.key]===n.value);if(!i)return;let l=this.basePath.slice(n.level+1);if(l.length>0){let f=i;for(let u of l){if(!f||typeof f!="object")return;f=f[u]}return f}return i}for(let a=0;a<this.basePath.length;a++){if(!r)return;r=r[this.basePath[a]]}return r}setNestedValue(t,r){let s={...t},n=this.patterns.find(l=>l.type==="arrayMatch");if(n){let l=this.basePath[0];s[l]||(s[l]=[]);let f=s[l].findIndex(d=>d[n.key]===n.value),u=this.basePath.slice(n.level+1);if(f>=0)if(u.length>0){let d=s[l][f];for(let y=0;y<u.length-1;y++){let h=u[y];d[h]=d[h]||{},d=d[h]}let m=u[u.length-1];d[m]=r}else s[l][f]={...s[l][f],...r,[n.key]:n.value};else if(u.length>0){let d={[n.key]:n.value},m=d;for(let h=0;h<u.length-1;h++){let _=u[h];m[_]={},m=m[_]}let y=u[u.length-1];m[y]=r,s[l].push(d)}else s[l].push({...r,[n.key]:n.value});return s}let a=s;for(let l=0;l<this.basePath.length-1;l++){let f=this.basePath[l];a[f]=a[f]||{},a=a[f]}let i=this.basePath[this.basePath.length-1];return a[i]=r,s}getParent(){if(this.destroyed)throw new fr("Cannot use destroyed settings",this.getPath());let t=this.path.slice(0,-1).join("/");return new wr(this.settings,t)}getChild(t,r){let s=[...this.path,t].join("/");return r?r(this.settings,s):(this.log("getChild",this.path,t,s,this.patterns),new wr(this.settings,s))}getPath(){return this.path.join("/")}exists(){if(this.destroyed)throw new fr("Cannot use destroyed settings",this.getPath());let t=this.settings.get();return this.getNestedValue(t)!==void 0}async delete(){if(this.destroyed)throw new fr("Cannot use destroyed settings",this.getPath());await this.settings.update(t=>{let r={...t},s=this.patterns.find(l=>l.type==="arrayMatch");if(s){let l=this.basePath[0];return Array.isArray(r[l])&&(r[l]=r[l].filter(f=>f[s.key]!==s.value),r[l].length===0&&delete r[l]),r}let n=r,a=this.basePath.slice(0,-1);for(let l of a){if(!n[l])return r;n=n[l]}let i=this.basePath[this.basePath.length-1];return delete n[i],r})}subscribe(t){if(this.destroyed)throw new fr("Cannot use destroyed settings",this.getPath());return this._listeners.add(t),t(this.get()),()=>{this._listeners.delete(t)}}notifyListeners(){if(this.destroyed)return;let t=this.get();for(let r of this._listeners)r(t)}};var cs=class extends wr{constructor(t,r,s=!0){super(t,r);this.enabled=s}isExtensionEnabled(t){var n,a;let s=(t.split(".").pop()||"").toLowerCase();if(s==="md")return!0;if(!this.enabled||!Xe().enableAttachmentSync)return!1;for(let[i,l]of Object.entries(cs.schema)){let f=i;if(((n=this.get()[f])!=null?n:l.defaultEnabled)&&l.extensions.includes(s))return!0}return(a=this.get().otherTypes)!=null?a:cs.schema.otherTypes.defaultEnabled}getCategory(t){var n;let r=cs.schema[t];return{enabled:(n=this.get()[t])!=null?n:r.defaultEnabled,name:r.name,description:r.description,extensions:r.extensions}}getCategories(){return Object.keys(cs.schema).reduce((t,r)=>(t[r]=this.getCategory(r),t),{})}async toggleCategory(t,r){await this.update(s=>({...s,[t]:r})),this.log(`setting ${t} to ${r}`),this.notifyListeners()}async resetToDefault(){await this.update(()=>({...cs.defaultFlags}))}},fs=cs;fs.schema={images:{name:"Images",description:"Sync image files (.bmp, .png, .jpg, .jpeg, .gif, .svg, .webp, .avif)",extensions:["bmp","png","jpg","jpeg","gif","svg","webp","avif"],defaultEnabled:!0},audio:{name:"Audio",description:"Sync audio files (.mp3, .wav, .m4a, .3gp, .flac, .ogg, .oga, .opus)",extensions:["mp3","wav","m4a","3gp","flac","ogg","oga","opus"],defaultEnabled:!0},videos:{name:"Videos",description:"Sync video files (.mp4, .webm, .ogv, .mov, .mkv)",extensions:["mp4","webm","ogv","mov","mkv"],defaultEnabled:!0},pdfs:{name:"PDFs",description:"Sync PDF files (.pdf)",extensions:["pdf"],defaultEnabled:!0},otherTypes:{name:"Other Files",description:"Sync unsupported file types",extensions:[],defaultEnabled:!1}},fs.defaultFlags=Object.fromEntries(Object.entries(cs.schema).map(([t,r])=>[t,r.defaultEnabled]));var Ja=require("obsidian");async function jy(o){let e=await crypto.subtle.digest("SHA-256",o);return Array.from(new Uint8Array(e)).map(r=>r.toString(16).padStart(2,"0")).join("")}function $n(o){return o instanceof Xa}var Ul=class extends Ct{constructor(t){super();this.db=null;this.setLoggers("[ContentAddressedFileStore]"),this.dbName=`${t}-relay-hashes`,this.ready=this.openDB()}async openDB(){return new Promise((t,r)=>{let s=indexedDB.open(this.dbName,1);s.onupgradeneeded=n=>{let a=s.result;a.objectStoreNames.contains("files")||a.createObjectStore("files",{keyPath:"path"})},s.onsuccess=n=>{this.db=s.result,t()},s.onerror=n=>{this.error("Error opening ContentAddressedFile database:",s.error),r(s.error)}})}async saveHash(t,r,s){if(await this.ready,!!this.db)return new Promise((n,a)=>{if(!this.db)return;let f=this.db.transaction(["files"],"readwrite").objectStore("files").put({path:t,hash:r,modifiedAt:s});f.onsuccess=()=>n(),f.onerror=()=>{this.error("Error saving hash:",f.error),a(f.error)}})}async getHash(t){return await this.ready,this.db?new Promise((r,s)=>{if(!this.db)return null;let i=this.db.transaction(["files"],"readonly").objectStore("files").get(t);i.onsuccess=()=>{r(i.result||null)},i.onerror=()=>{this.error("Error retrieving hash:",i.error),s(i.error)}}):null}async removeHash(t){if(await this.ready,!!this.db)return new Promise((r,s)=>{if(!this.db)return null;let i=this.db.transaction(["files"],"readwrite").objectStore("files").delete(t);i.onsuccess=()=>r(),i.onerror=()=>{this.error("Error removing hash:",i.error),s(i.error)}})}destroy(){this.db&&(this.db.close(),this.db=null)}},Vu=class extends Ct{constructor(t,r,s,n){super();this.vault=t;this.path=r;this.metadataCache=s;this.store=n;this.content=null;this._tfile=null;let a=this.vault.getAbstractFileByPath(r);a&&a instanceof Ja.TFile&&(this._tfile=a)}get tfile(){if(!this._tfile){let t=this.vault.getAbstractFileByPath(this.path);if(t&&t instanceof Ja.TFile)this._tfile=t;else throw new Error("missing tfile")}return this._tfile}async loadHashFromStore(){try{let t=await this.store.getHash(this.path);if(t&&t.modifiedAt===this.tfile.stat.mtime)return t.hash}catch(t){this.warn("Failed to load hash from store:",t)}}get modifiedAt(){if(!this.tfile)throw new Error("missing tfile");return this.tfile.stat.mtime}async read(){this.log("reading content from disk");let t=this.tfile.stat.mtime,r=await this.vault.readBinary(this.tfile),s=await jy(r);try{await this.store.saveHash(this.path,s,t)}catch(n){this.warn("Failed to save hash to store:",n)}return r}exists(){if(this._tfile)return!0;let t=this.vault.getAbstractFileByPath(this.path);return t&&t instanceof Ja.TFile?(this._tfile=t,!0):!1}async clear(){this._tfile=null,this.store.removeHash(this.path).catch(t=>{this.warn("Failed to remove hash from store:",t)})}async hash(){let t=await this.loadHashFromStore();if(t)return t;if(await this.read(),t=await this.loadHashFromStore(),!t)throw new Error("missing hash");return t}destroy(){this.vault=null,this._tfile=null,this.metadataCache=null}},Xa=class extends Ct{constructor(t,r,s,n,a){super();this.path=t;this.guid=r;this.metadataCache=s;this.hashStore=n;this.ready=!1;this.connected=!0;this.offFileInfo=()=>{};this.s3rn=a.relayId?new ns(a.relayId,a.guid,r):new Wa(a.guid,r),this._parent=a,this.setLoggers(`[SharedFile](${this.path})`),this.name=this.path.split("/").pop()||"",this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.vault=this._parent.vault;let i=this.sharedFolder.syncStore.typeRegistry.getTypeForPath(t);if(!i)throw new Error("unexpected synctype");this.type=i,this.caf=new Vu(this.vault,this.sharedFolder.getPath(t),this.metadataCache,this.hashStore),this.log("created")}get mimetype(){return Rn(this.path)}disconnect(){}move(t){t!==this.path&&(this.debug("setting new path",t),this.path=t,this.name=t.split("/").pop()||"",this.extension=this.name.split(".").pop()||"",this.basename=this.name.replace(`.${this.extension}`,""),this.setLoggers(`[SharedFile](${this.path})`))}get lastModified(){return this.stat.mtime}async push(){if(this.log("push"),!this.sharedFolder.syncStore.canSync(this.path))return this.log("skipping push -- filetype is disabled"),"";let t=await this.caf.hash(),r=this.sharedFolder.syncStore.getMeta(this.path);return(!r||t&&r.hash!==t)&&(await this.sharedFolder.cas.writeFile(this),this.sharedFolder.markUploaded(this)),await this.caf.hash()}async sync(){var r;this.log("sync");let t=this.sharedFolder.syncStore.getMeta(this.path);t?await this.caf.hash()!==t.hash&&(t.synctime>this.stat.mtime?(this.warn("synctime",t.synctime,(r=this.meta)==null?void 0:r.synctime,this.stat.mtime),await this.pull()):await this.push()):await this.push()}shouldPull(t){return!this.tfile||t.synctime>this.stat.mtime}async pull(){this.log("pull");let t=this.sharedFolder.syncStore.getMeta(this.path);if(t?this.meta=t:this.warn("meta fail",t),!this.meta)throw new Error("cannot pull without meta");if(this.caf.exists()&&await this.caf.hash()===this.meta.hash)return;let r=await this.sharedFolder.cas.readFile(this);await this.vault.adapter.writeBinary(this.sharedFolder.getPath(this.path),r),await this.caf.hash()}get tfile(){let t=this.vault.getAbstractFileByPath(this.sharedFolder.getPath(this.path));if(t instanceof Ja.TFile)return t;throw new Error("TFile API used before file existed")}get stat(){return this.tfile.stat}get parent(){var t;return((t=this.tfile)==null?void 0:t.parent)||null}get sharedFolder(){return this._parent}async connect(){return this.sharedFolder.s3rn instanceof io?!1:(this.s3rn instanceof Ro&&(this.sharedFolder.relayId?this.s3rn=new ns(this.sharedFolder.relayId,this.sharedFolder.guid,this.guid):this.s3rn=new Wa(this.sharedFolder.guid,this.guid)),this.sharedFolder.shouldConnect&&this.sharedFolder.connect().then(t=>(this.connected=!0,this.connected)))}async read(){return this.vault.read(this.tfile)}async rename(t){this.move(t)}async delete(){return await this.caf.clear(),this.vault.delete(this.tfile)}async write(t){this.vault.adapter.write(this.tfile.path,t),await this.caf.hash()}async append(t){this.vault.append(this.tfile,t),await this.caf.hash()}cleanup(){}destroy(){var t;(t=this.offFileInfo)==null||t.call(this),this.offFileInfo=null,this._parent=null,this.metadataCache=null,this.caf.destroy()}};var qu=class extends ls{constructor(){super(...arguments);this.notifyListeners=(0,ct.debounce)(super.notifyListeners,100)}update(){this.notifyListeners()}add(t,r=!0){let s=this.find(n=>n.guid===t.guid);return s&&s!==t&&(this.error("duplicate guid",s,t),this._set.delete(s)),this._set.add(t),r&&this.notifyListeners(),this}},$l=class extends $s{constructor(t,r,s,n,a,i,l,f,u,d,m,y,h,_=!0){var v;let w=h?new Eo(h,r):new io(r);super(r,w,l,n);this.appId=t;this.metadataCache=u;this.hashStore=d;this.backgroundSync=m;this._settings=y;this.destroyed=!1;this.readyPromise=null;this.whenSyncedPromise=null;this.persistenceSynced=!1;this.syncFileTreePromise=null;this.syncRequestedDuringSync=!1;this.unsubscribes=[];this.addLocalDocs=()=>{let t=this.getSyncFiles(),r=[],s=this.placeHold(t);t.forEach(n=>{let a=this.getVirtualPath(n.path),i=s.contains(a);if(xr.checkPath(a)){let l=this.getSyncFolder(a,!1);r.push(l)}else if(vt.checkExtension(a))if(i){let l=this.uploadDoc(a,!1);r.push(l)}else{let l=this.getDoc(a,!1);r.push(l)}else if(this.syncStore.canSync(a))if(i){let l=this.uploadSyncFile(a,!1);r.push(l)}else{let l=this.downloadSyncFile(a,!1);r.push(l)}}),r.length>0&&this.fset.update()};this.path=s,this.setLoggers(`[SharedFile](${this.path})`),this.fileManager=i,this.vault=a,this.files=new Map,this.fset=new qu,this.pendingUpload=new Uo(`${t}-system3-relay/folders/${this.guid}/pendingUploads`),this.relayManager=f,this.relayId=h,this.diskBufferStore=new Ll,this._shouldConnect=(v=this.settings.connect)!=null?v:!0,this.authoritative=!_,this.syncSettingsManager=this._settings.getChild("sync",(M,O)=>new fs(M,O)),this.syncStore=new Fl(this.ydoc,this.path,this.pendingUpload,this.syncSettingsManager),this.syncStore.on(async()=>{await this.syncFileTree(this.syncStore)}),this.unsubscribes.push(this.relayManager.remoteFolders.subscribe(M=>{this.remote=M.find(O=>O.guid==this.guid)})),this.proxy=My(this,this.path,M=>this.getVirtualPath(M));try{this._persistence=new Cn(this.guid,this.ydoc)}catch(M){throw this.warn("Unable to open persistence.",this.guid),console.error(M),M}n.loggedIn&&this.connect(),this.cas=new Rl(this),this.whenReady().then(()=>{this.destroyed||(this.addLocalDocs(),this.syncFileTree(this.syncStore))}),this.whenSynced().then(async()=>{this.syncStore.start();try{this._persistence.set("path",this.path),this._persistence.set("relay",this.relayId||""),this._persistence.set("appId",this.appId),this._persistence.set("s3rn",Tt.encode(this.s3rn))}catch(M){}}),(async()=>await this.getServerSynced()||(await this.onceProviderSynced(),await this.markSynced()))(),Et.set(this,this.path)}get server(){return this._server}set server(t){if(t===this._server)return;this.warn("server changed -- reinitializing all connections");let r=this.shouldConnect;this.reset();let s=[];this.fset.forEach(n=>{n instanceof $s&&(n.connected&&s.push(n),n.reset())}),this.tokenStore.clear(n=>{var a;return!!(this.relayId&&((a=n.token)!=null&&a.docId.startsWith(this.relayId)))}),r&&(this.connect(),s.forEach(n=>{n.connect()})),this._server=t}get tfolder(){let t=this.vault.getAbstractFileByPath(this.path);if(!(t instanceof ct.TFolder))throw new Error("tfolder is not a folder");return t}isSyncableTFile(t){let r=this.checkPath(t.path);if(t instanceof ct.TFolder&&!xr.checkPath)throw new Error("logical error");let s=this.getVirtualPath(t.path),n=this.syncStore.canSync(s),a=this.syncSettingsManager.isExtensionEnabled(s);return r&&n&&a}getSyncFiles(){let t=this.vault.getAbstractFileByPath(this.path);if(!(t instanceof ct.TFolder))throw new Error(`Could not find shared folders on file system at ${this.path}`);let r=[];return ct.Vault.recurseChildren(t,s=>{s!==t&&r.push(s)}),r.filter(s=>this.isSyncableTFile(s))}get shouldConnect(){return this._shouldConnect}set shouldConnect(t){this._settings.update(r=>({...r,connect:t})),this._shouldConnect=t}async netSync(){await this.whenReady(),this.addLocalDocs(),await this.syncFileTree(this.syncStore),this.backgroundSync.enqueueSharedFolderSync(this)}get settings(){return this._settings.get()}async sync(){await this.syncFileTree(this.syncStore)}connect(){return this.s3rn instanceof Eo&&(this.connected||this.shouldConnect)?super.connect():Promise.resolve(!1)}get name(){return this.path.split("/").pop()||""}get location(){return this.path.split("/").slice(0,-1).join("/")}get remote(){var t;try{(t=this._remote)==null||t.relay}catch(r){return}return this._remote}set remote(t){var r;this._remote!==t&&(this._remote=t,this.relayId=(r=t==null?void 0:t.relay)==null?void 0:r.guid,this.s3rn=this.relayId?new Eo(this.relayId,this.guid):new io(this.guid),this._settings.update(s=>({...s,relay:this.relayId})),t&&(this._server=t.relay.provider,this.unsubscribes.push(t.relay.subscribe(s=>{s.guid===this.relayId&&(this.server=s.provider)}))),this.server=t==null?void 0:t.relay.provider,this.notifyListeners())}get ready(){return this.persistenceSynced&&(this.authoritative||this._serverSynced||this.synced)}async count(){if(this._persistence.db===null)throw new Error("unexpected missing database");if(this._dbsize)return this._dbsize;if(this._persistence._dbsize>3)return this._dbsize=this._persistence._dbsize,this._dbsize;let[t]=no(this._persistence.db,["updates"],"readonly"),r=await Os(t);return this._dbsize=r,this._dbsize}async markSynced(){this._serverSynced=!0,await this._persistence.set("serverSync",1)}async getServerSynced(){return this._serverSynced!==void 0?this._serverSynced:await this._persistence.get("serverSync")===1?(this._serverSynced=!0,this._serverSynced):!1}hasLocalDB(){return this._persistence._dbsize>3||!!(this._dbsize&&this._dbsize>3)}async awaitingUpdates(){return await this.whenSynced(),this.authoritative||await this.getServerSynced()?!1:!this.hasLocalDB()}whenReady(){let t=async()=>await this.awaitingUpdates()?(this.connect(),await this.onceConnected(),await this.onceProviderSynced(),this):this;return this.readyPromise=this.readyPromise||new is(t,()=>[this.ready,this]),this.readyPromise.getPromise()}whenSynced(){let t=async()=>{if(this._persistence.synced){await this.count(),this.persistenceSynced=!0;return}return new Promise(r=>{this._persistence.once("synced",async()=>{await this.count(),this.persistenceSynced=!0,r()})})};return this.whenSyncedPromise=this.whenSyncedPromise||new is(t,()=>(this._persistence.synced&&this._dbsize&&(this.persistenceSynced=!0),[this.persistenceSynced,void 0])),this.whenSyncedPromise.getPromise()}get intent(){return this.shouldConnect?"connected":"disconnected"}async _handleServerRename(t,r,s,n){if(n==null||n.push(`${s.path} was renamed to ${this.getPath(r)}`),s instanceof ct.TFile){let a=(0,_r.dirname)(r);this.existsSync(a)||(await this.mkdir(a),n==null||n.push(`creating directory ${a}`))}await this.fileManager.renameFile(s,(0,ct.normalizePath)(this.getPath(r))).then(()=>{t.move(r)})}async _handleServerCreate(t,r){let s=(0,_r.dirname)(t);if(this.existsSync(s)||(await this.mkdir(s),r==null||r.push(`creating directory ${s}`)),vt.checkExtension(t))return r==null||r.push(`created local file for remotely added doc ${t}`),await this.downloadDoc(t,!1);if(xr.checkPath(t))return this.getSyncFolder(t,!1);if(this.syncStore.canSync(t))return this.downloadSyncFile(t,!1);throw new Error("unexpected file")}_assertNamespacing(t){try{this.assertPath(this.path+t)}catch(r){this.error("Deleting doc (somehow moved outside of shared folder)",t),this.syncStore.delete(t);return}}applyRemoteState(t,r,s,n){let a=this.files.get(t),i=this.syncStore.getMeta(r);if(!i)return this.warn("unknown sync type",r),{op:"noop",path:r,promise:Promise.resolve()};if(this.existsSync(r))return a&&$n(a)&&a.shouldPull(i)?{op:"update",path:r,promise:a.pull()}:{op:"noop",path:r,promise:Promise.resolve()};if(s.has(t)&&a){let f=this.getPath(a.path),u=this.vault.getAbstractFileByPath(f);if(u){let d=this._handleServerRename(a,r,u,n);return{op:"rename",path:r,from:f,to:r,promise:d}}}let l=this._handleServerCreate(r,n);return{op:"create",path:r,promise:l}}cleanupExtraLocalFiles(t,r){let s=this.getSyncFiles(),n=[],a=s.filter(f=>f instanceof ct.TFolder),i=s.filter(f=>f instanceof ct.TFile),l=f=>{var w,v;let u=this.isSyncableTFile(f),d=this.checkPath(f.path),m=t.contains(f.path.slice(this.path.length)),y=this.pendingUpload.has(this.getVirtualPath(f.path)),h=this.getVirtualPath(f.path),_=((w=this._provider)==null?void 0:w.synced)&&((v=this._persistence)==null?void 0:v.synced);if(d&&u&&!m&&!y&&_){r.push(`deleted local file ${h} for remotely deleted doc`);let M=this.vault.adapter.trashLocal(f.path);n.push({op:"delete",path:h,promise:M})}};return i.forEach(l),a.forEach(l),n}syncByType(t,r,s,n){t.forEach((a,i)=>{this._assertNamespacing(i),n.contains(a.type)&&(this._assertNamespacing(i),s.push(this.applyRemoteState(a.id,i,t.remoteIds,r)))})}syncFileTree(t){if(this.syncFileTreePromise){this.syncRequestedDuringSync=!0;let s=this.syncFileTreePromise.getPromise();return s.then(()=>{if(this.syncRequestedDuringSync)return this.syncRequestedDuringSync=!1,this.syncFileTree(t)}),s}let r=async()=>{try{let s=[],n=[];this.ydoc.transact(async()=>{this.syncStore.migrateUp(),this.syncByType(t,n,s,["folder"])},this),await Promise.all(s.map(u=>u.promise)),this.ydoc.transact(async()=>{this.syncByType(t,n,s,this.syncStore.typeRegistry.getEnabledFileSyncTypes()),this.syncStore.commit()},this);let a=s.filter(u=>u.op==="create"),i=s.filter(u=>u.op==="rename"),l=s.map(u=>u.path);await Promise.all([...a,...i].map(u=>Tl(u.promise,u)));let f=this.cleanupExtraLocalFiles(l,n);[...s,...f].every(u=>u.op==="noop")?this.debug("sync: noop"):(this.log("remote paths",l),this.log("operations",[...s,...f])),(i.length>0||a.length>0||f.length>0)&&this.fset.update(),n.length>0&&this.log(`syncFileTree diff:
`+n.join(`
`))}finally{this.syncFileTreePromise=null}};return this.syncFileTreePromise=new Cl(r),this.syncFileTreePromise.getPromise()}move(t){this.path=t,this.setLoggers(`[SharedFile](${this.path})`),this._settings.update(r=>({...r,path:t}))}read(t){let r=(0,_r.join)(this.path,t.path);return this.vault.adapter.read((0,ct.normalizePath)(r))}existsSync(t){let r=(0,ct.normalizePath)((0,_r.join)(this.path,t));return this.vault.getAbstractFileByPath(r)!==null}exists(t){let r=(0,_r.join)(this.path,t.path);return this.vault.adapter.exists((0,ct.normalizePath)(r))}flush(t,r){let s=(0,_r.join)(this.path,t.path);return this.log("writing to ",(0,ct.normalizePath)(s)),this.vault.adapter.write((0,ct.normalizePath)(s),r)}getPath(t){return(0,_r.join)(this.path,t)}assertPath(t){if(!this.checkPath(t))throw new Error("Path is not in shared folder: "+t)}mkdir(t){let r=(0,_r.join)(this.path,t);return this.vault.adapter.mkdir((0,ct.normalizePath)(r))}checkPath(t){return t.startsWith(this.path+_r.sep)}getVirtualPath(t){return this.assertPath(t),t.slice(this.path.length)}getTFile(t){let r=this.vault.getAbstractFileByPath(this.getPath(t.path));return r instanceof ct.TFile?r:null}getDoc(t,r=!0){let s=this.syncStore.get(t);if(s!==void 0){let n=this.files.get(s);if(n!==void 0){if(n.move(t),!Oo(n))throw new Error("unexpected ifile type");return n}else return this.log("[getDoc]: creating doc for shared ID"),this.createDoc(t,r)}else{this.warn("[getDoc]: creating new shared ID for existing tfile");let n=this.vault.getAbstractFileByPath(this.getPath(t));if(!(n instanceof ct.TFile))throw new Error("unexpectedly missing tfile or got tfolder");return this.placeHold([n]).length>0?this.uploadDoc(t):this.createDoc(t,r)}}async markUploaded(t){if(Oo(t)){let r=Ka(t.guid);this.ydoc.transact(()=>{this.syncStore.markUploaded(t.path,r)},this);return}if(Cu(t)){let r=Al(t.guid);this.ydoc.transact(()=>{this.syncStore.markUploaded(t.path,r)},this);return}if($n(t)){let r=this.syncStore.typeRegistry.getTypeForPath(t.path);if(!r)throw new Error("unexpected sync type");let s=await t.caf.hash();if(!s)throw new Error("file hash not yet computed");let n=this.syncStore.getMeta(this.path);if(n&&t.caf.value===n.hash)return;let a=Dy(r,t.guid,t.mimetype,s,t.stat.mtime);this.log("new meta",a),this.ydoc.transact(()=>{this.syncStore.markUploaded(t.path,a)},this);return}}getFile(t,r=!0){let s=this.syncStore.get(t);if(s){let n=this.files.get(s);if(n)return n}return vt.checkExtension(t)?this.getDoc(t):xr.checkPath(t)?this.getSyncFolder(t,r):this.syncStore.canSync(t)?this.getSyncFile(t,r):null}placeHold(t){let r=[];return this.ydoc.transact(()=>{t.forEach(s=>{let n=this.getVirtualPath(s.path);this.syncStore.has(n)||(this.log("place hold new",n),this.syncStore.new(n),r.push(n))})},this),r}viewDoc(t){let r=this.syncStore.get(t);if(!r)return;let s=this.files.get(r);if(!Oo(s))throw new Error("unexpected ifile type");return s}getOrCreateDoc(t,r){let s=this.files.get(t)||new vt(r,t,this.loginManager,this);if(!Oo(s))throw new Error("unexpected ifile type");return s.move(r),s}async downloadDoc(t,r=!0){if(!vt.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let s=this.syncStore.get(t);if(!s)throw new Error(`called download on item that is not in ids ${t}`);let n=this.getOrCreateDoc(s,t);return n.markOrigin("remote"),Tl(this.backgroundSync.enqueueDownload(n),n.path),this.files.set(s,n),this.fset.add(n,r),n}uploadDoc(t,r=!0){if(!vt.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let s=this.syncStore.get(t);if(!s)throw new Error("missing guid");let n=this.getOrCreateDoc(s,t),a=n.getOrigin(),i=this.awaitingUpdates();return(async()=>{if(!await this.exists(n))throw new Error(`Upload failed, doc does not exist at ${t}`);let[f,u,d]=await Promise.all([this.read(n),a,i]),m=n.ydoc.getText("contents");!d&&u===void 0&&(this.log(`[${n.path}] No Known Peers: Syncing file into ytext.`),this.ydoc.transact(()=>{m.insert(0,f)},this._persistence),n.markOrigin("local"),this.log(`[${n.path}] Uploading file`),await this.backgroundSync.enqueueSync(n),this.markUploaded(n))})(),this.files.set(s,n),this.fset.add(n,r),n}createDoc(t,r=!0){if(!vt.checkExtension(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let s=this.syncStore.get(t);if(!s)throw new Error("expected guid");let n=this.getOrCreateDoc(s,t);return(async()=>this.whenReady().then(async()=>{var i;let a=await n.getServerSynced();((i=n.tfile)==null?void 0:i.stat.size)===0&&!a?this.backgroundSync.enqueueDownload(n):this.pendingUpload.get(n.path)&&this.backgroundSync.enqueueSync(n)}))(),this.files.set(s,n),this.fset.add(n,r),n}getOrCreateSyncFolder(t,r){let s=this.files.get(t)||new xr(r,t,this.relayManager,this);if(!Cu(s))throw new Error("unexpected ifile type");return s.move(r),s}getSyncFolder(t,r){if(this.log("[getSyncFolder]","getting syncfolder"),!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let s=this.syncStore.get(t);if(!s)throw new Error("expected guid");let n=this.getOrCreateSyncFolder(s,t);return this.files.set(s,n),this.fset.add(n,r),n}getOrCreateSyncFile(t,r,s){let n=this.files.get(t)||new Xa(r,t,this.metadataCache,this.hashStore,this);if(!$n(n))throw new Error("unexpected ifile type");return n.move(r),this.files.set(t,n),n}downloadSyncFile(t,r){if(!this.syncStore.canSync(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let s=this.syncStore.get(t);if(!s)throw new Error(`called download on item that is not in ids ${t}`);let n=this.syncStore.getMeta(t);if(!n||!n.hash)return this.uploadSyncFile(t,r);let a=this.getOrCreateSyncFile(s,t,n.hash);return Tl(a.pull()),this.files.set(s,a),this.fset.add(a,r),a}uploadSyncFile(t,r=!0){if(!this.syncStore.canSync(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let s=this.syncStore.get(t);if(!s)throw new Error("missing guid");let n=this.vault.getAbstractFileByPath(this.getPath(t));if(!n)throw new Error(`Upload failed, file does not exist at ${t}`);if(!(n instanceof ct.TFile))throw new Error(`Upload failed, expected file at ${t}`);let a=this.getOrCreateSyncFile(s,t,n);return(async()=>{if(!this.existsSync(t))throw new Error(`Upload failed, file does not exist at ${t}`);await a.push()})(),this.fset.add(a,r),a}getSyncFile(t,r=!0){if(!this.syncStore.canSync(t))throw new Error("unexpected extension");if(!this.synced&&!this.syncStore.has(t))throw new Error(`potential for document split at ${t}`);let s=this.syncStore.get(t);if(!s)throw new Error("missing guid");let n=this.vault.getAbstractFileByPath(this.getPath(t));if(!n)throw new Error(`Upload failed, file does not exist at ${t}`);if(!(n instanceof ct.TFile))throw new Error(`Upload failed, expected file at ${t}`);let a=this.getOrCreateSyncFile(s,t,n);return this.syncStore.getMeta(t)?a.pull():(this.log("get syncfile missing meta"),a.push()),this.files.set(s,a),this.fset.add(a,r),a}uploadFile(t,r=!0){if(vt.checkExtension(t))return this.uploadDoc(t,r);if(xr.checkPath(t))return this.getSyncFolder(t,r);if(this.syncStore.canSync(t))return this.uploadSyncFile(t,r);throw new Error("unexpectedly unable to upload")}deleteFile(t){let r=this.syncStore.get(t);r&&this.ydoc.transact(()=>{this.syncStore.delete(t);let s=this.files.get(r);s&&(s.cleanup(),this.fset.delete(s)),this.files.delete(r)},this)}renameFile(t,r){let s=t.path,n="",a="";try{n=this.getVirtualPath(s)}catch(i){this.log("Moving out of shared folder")}try{a=this.getVirtualPath(r)}catch(i){this.log("Moving in from outside of shared folder")}if(!(!n&&!a))if(a){let i=this.syncStore.get(a);if(!i)return;let l=this.files.get(i);if(!n)this.ydoc.transact(()=>{this.syncStore.delete(a)},this),l&&(l.cleanup(),l.destroy(),this.fset.delete(l)),this.files.delete(i);else{if(!this.syncStore.get(a))return;let u=[];l instanceof xr&&this.syncStore.forEach((d,m)=>{if(m.startsWith(a+_r.sep)){let y=m.replace(a,n);u.push([d.id,m,y])}}),this.ydoc.transact(()=>{this.syncStore.move(a,n),l&&l.move(n),u.forEach(d=>{let[m,y,h]=d;this.syncStore.move(y,h);let _=this.files.get(m);_&&_.move(h)})},this),this.syncStore.resolveMove(a)}}else{if(this.assertPath(s),!this.syncStore.canSync(n))return;this.placeHold([t]),this.log("can I has vpath",n,this.syncStore.has(n)),this.uploadFile(n)}}destroy(){var t,r,s;this.destroyed=!0,this.unsubscribes.forEach(n=>{n()}),this.files.forEach(n=>{n.destroy(),this.files.delete(n.guid)}),this.syncStore.destroy(),this.syncSettingsManager.destroy(),super.destroy(),this.ydoc.destroy(),this.fset.clear(),this._settings.destroy(),this._settings=null,this.diskBufferStore=null,this.relayManager=null,this.backgroundSync=null,this.loginManager=null,this.tokenStore=null,this.fileManager=null,this.syncStore=null,this.syncSettingsManager=null,(t=this.whenSyncedPromise)==null||t.destroy(),this.whenSyncedPromise=null,(r=this.readyPromise)==null||r.destroy(),this.readyPromise=null,(s=this.syncFileTreePromise)==null||s.destroy(),this.syncFileTreePromise=null}},Bl=class extends ls{constructor(t,r,s,n){super();this.relayManager=t;this.vault=r;this.settings=n;this.update=(0,ct.debounce)(this.notifyListeners,100);this.folderBuilder=s,this._offRemoteUpdates||(this._offRemoteUpdates=this.relayManager.remoteFolders.subscribe(a=>{let i=!1;this.items().forEach(l=>{let f=a.find(u=>u.guid==l.guid);l.remote!=f&&(i=!0),l.remote=f}),i&&this.update()}))}delete(t){t==null||t.destroy();let r=super.delete(t);return this.settings.update(s=>s.filter(n=>n.guid!==t.guid)),r}lookup(t){let r=this.find(s=>s.checkPath(t));return r||null}destroy(){this.items().forEach(t=>{t.destroy()}),this.clear(),this._offRemoteUpdates&&this._offRemoteUpdates(),this.unsubscribes.forEach(t=>{t()}),this.relayManager=null,this.folderBuilder=null}load(){this._load(this.settings.get())}_load(t){let r=!1;t.forEach(s=>{if(!this.vault.getFolderByPath(s.path)){this.warn(`Invalid settings, ${s.path} does not exist`);return}this._new(s.path,s.guid,s==null?void 0:s.relay),r=!0}),r&&this.notifyListeners()}_new(t,r,s,n){let a=this.find(u=>u.path==t&&u.guid==r);if(a)return a;let i=this.find(u=>u.guid==r);if(i)throw new Error(`This folder is already mounted at ${i.path}.`);if(this.find(u=>u.path==t))throw new Error("Conflict: Tracked folder exists at this location.");let f=this.folderBuilder(t,r,s,n);return this._set.add(f),f}new(t,r,s,n){let a=this._new(t,r,s,n);return this.notifyListeners(),a}};var tc=require("@codemirror/state"),Jn=require("obsidian");function X(){}function ce(o,e){for(let t in e)o[t]=e[t];return o}function Yy(o){return!!o&&(typeof o=="object"||typeof o=="function")&&typeof o.then=="function"}function Wu(o){return o()}function Hl(){return Object.create(null)}function ke(o){o.forEach(Wu)}function dt(o){return typeof o=="function"}function Q(o,e){return o!=o?e==e:o!==e||o&&typeof o=="object"||typeof o=="function"}var Nl;function zu(o,e){return o===e?!0:(Nl||(Nl=document.createElement("a")),Nl.href=e,o===Nl.href)}function Jy(o){return Object.keys(o).length===0}function tr(o,...e){if(o==null){for(let r of e)r(void 0);return X}let t=o.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function he(o,e,t){o.$$.on_destroy.push(tr(e,t))}function ge(o,e,t,r){if(o){let s=Xy(o,e,t,r);return o[0](s)}}function Xy(o,e,t,r){return o[1]&&r?ce(t.ctx.slice(),o[1](r(e))):t.ctx}function ye(o,e,t,r){if(o[2]&&r){let s=o[2](r(t));if(e.dirty===void 0)return s;if(typeof s=="object"){let n=[],a=Math.max(e.dirty.length,s.length);for(let i=0;i<a;i+=1)n[i]=e.dirty[i]|s[i];return n}return e.dirty|s}return e.dirty}function xe(o,e,t,r,s,n){if(s){let a=Xy(e,t,r,n);o.p(a,s)}}function be(o){if(o.ctx.length>32){let e=[],t=o.ctx.length/32;for(let r=0;r<t;r++)e[r]=-1;return e}return-1}function Se(o){let e={};for(let t in o)t[0]!=="$"&&(e[t]=o[t]);return e}function Ku(o,e){let t={};e=new Set(e);for(let r in o)!e.has(r)&&r[0]!=="$"&&(t[r]=o[r]);return t}function Bn(o){return o==null?"":o}function Qy(o,e,t){return o.set(t),e}function Zy(o){return o&&dt(o.destroy)?o.destroy:X}var Bs=typeof window!="undefined"?window:typeof globalThis!="undefined"?globalThis:global;var Nn=class{constructor(e){mt(this,"_listeners","WeakMap"in Bs?new WeakMap:void 0);mt(this,"_observer");mt(this,"options");this.options=e}observe(e,t){return this._listeners.set(e,t),this._getObserver().observe(e,this.options),()=>{this._listeners.delete(e),this._observer.unobserve(e)}}_getObserver(){var e;return(e=this._observer)!=null?e:this._observer=new ResizeObserver(t=>{var r;for(let s of t)Nn.entries.set(s.target,s),(r=this._listeners.get(s.target))==null||r(s)})}};Nn.entries="WeakMap"in Bs?new WeakMap:void 0;var ex=!1;function tx(){ex=!0}function rx(){ex=!1}function S(o,e){o.appendChild(e)}function De(o,e,t){let r=ox(o);if(!r.getElementById(e)){let s=T("style");s.id=e,s.textContent=t,vC(r,s)}}function ox(o){if(!o)return document;let e=o.getRootNode?o.getRootNode():o.ownerDocument;return e&&e.host?e:o.ownerDocument}function vC(o,e){return S(o.head||o,e),e.sheet}function C(o,e,t){o.insertBefore(e,t||null)}function L(o){o.parentNode&&o.parentNode.removeChild(o)}function tt(o,e){for(let t=0;t<o.length;t+=1)o[t]&&o[t].d(e)}function T(o){return document.createElement(o)}function Kr(o){return document.createElementNS("http://www.w3.org/2000/svg",o)}function G(o){return document.createTextNode(o)}function $(){return G(" ")}function Te(){return G("")}function ee(o,e,t,r){return o.addEventListener(e,t,r),()=>o.removeEventListener(e,t,r)}function sx(o){return function(e){return e.stopPropagation(),o.call(this,e)}}function b(o,e,t){t==null?o.removeAttribute(e):o.getAttribute(e)!==t&&o.setAttribute(e,t)}function Qa(o,e){for(let t in e)b(o,t,e[t])}function nx(o){return Array.from(o.childNodes)}function ne(o,e){e=""+e,o.data!==e&&(o.data=e)}function rr(o,e){o.value=e==null?"":e}function pe(o,e,t,r){t==null?o.style.removeProperty(e):o.style.setProperty(e,t,r?"important":"")}function Ve(o,e,t){o.classList.toggle(e,!!t)}function Vl(o,e,{bubbles:t=!1,cancelable:r=!1}={}){return new CustomEvent(o,{detail:e,bubbles:t,cancelable:r})}var Hn=class{constructor(e=!1){mt(this,"is_svg",!1);mt(this,"e");mt(this,"n");mt(this,"t");mt(this,"a");this.is_svg=e,this.e=this.n=null}c(e){this.h(e)}m(e,t,r=null){this.e||(this.is_svg?this.e=Kr(t.nodeName):this.e=T(t.nodeType===11?"TEMPLATE":t.nodeName),this.t=t.tagName!=="TEMPLATE"?t:t.content,this.c(e)),this.i(r)}h(e){this.e.innerHTML=e,this.n=Array.from(this.e.nodeName==="TEMPLATE"?this.e.content.childNodes:this.e.childNodes)}i(e){for(let t=0;t<this.n.length;t+=1)C(this.t,this.n[t],e)}p(e){this.d(),this.h(e),this.i(this.a)}d(){this.n.forEach(L)}};function ax(o){let e={};return o.childNodes.forEach(t=>{e[t.slot||"default"]=!0}),e}function Vn(o,e){return new o(e)}var us;function vr(o){us=o}function Za(){if(!us)throw new Error("Function called outside component initialization");return us}function or(o){Za().$$.on_mount.push(o)}function Gu(o){Za().$$.on_destroy.push(o)}function Ht(){let o=Za();return(e,t,{cancelable:r=!1}={})=>{let s=o.$$.callbacks[e];if(s){let n=Vl(e,t,{cancelable:r});return s.slice().forEach(a=>{a.call(o,n)}),!n.defaultPrevented}return!0}}function Gr(o,e){let t=o.$$.callbacks[e.type];t&&t.slice().forEach(r=>r.call(this,e))}var Ns=[];var Er=[],Wn=[],ix=[],TC=Promise.resolve(),Yu=!1;function lx(){Yu||(Yu=!0,TC.then(ti))}function ei(o){Wn.push(o)}var ju=new Set,qn=0;function ti(){if(qn!==0)return;let o=us;do{try{for(;qn<Ns.length;){let e=Ns[qn];qn++,vr(e),PC(e.$$)}}catch(e){throw Ns.length=0,qn=0,e}for(vr(null),Ns.length=0,qn=0;Er.length;)Er.pop()();for(let e=0;e<Wn.length;e+=1){let t=Wn[e];ju.has(t)||(ju.add(t),t())}Wn.length=0}while(Ns.length);for(;ix.length;)ix.pop()();Yu=!1,ju.clear(),vr(o)}function PC(o){if(o.fragment!==null){o.update(),ke(o.before_update);let e=o.dirty;o.dirty=[-1],o.fragment&&o.fragment.p(o.ctx,e),o.after_update.forEach(ei)}}function cx(o){let e=[],t=[];Wn.forEach(r=>o.indexOf(r)===-1?e.push(r):t.push(r)),t.forEach(r=>r()),Wn=e}var ql=new Set,Hs;function we(){Hs={r:0,c:[],p:Hs}}function _e(){Hs.r||ke(Hs.c),Hs=Hs.p}function I(o,e){o&&o.i&&(ql.delete(o),o.i(e))}function P(o,e,t,r){if(o&&o.o){if(ql.has(o))return;ql.add(o),Hs.c.push(()=>{ql.delete(o),r&&(t&&o.d(1),r())}),o.o(e)}else r&&r()}function zn(o,e){let t=e.token={};function r(s,n,a,i){if(e.token!==t)return;e.resolved=i;let l=e.ctx;a!==void 0&&(l=l.slice(),l[a]=i);let f=s&&(e.current=s)(l),u=!1;e.block&&(e.blocks?e.blocks.forEach((d,m)=>{m!==n&&d&&(we(),P(d,1,1,()=>{e.blocks[m]===d&&(e.blocks[m]=null)}),_e())}):e.block.d(1),f.c(),I(f,1),f.m(e.mount(),e.anchor),u=!0),e.block=f,e.blocks&&(e.blocks[n]=f),u&&ti()}if(Yy(o)){let s=Za();if(o.then(n=>{vr(s),r(e.then,1,e.value,n),vr(null)},n=>{if(vr(s),r(e.catch,2,e.error,n),vr(null),!e.hasCatch)throw n}),e.current!==e.pending)return r(e.pending,0),!0}else{if(e.current!==e.then)return r(e.then,1,e.value,o),!0;e.resolved=o}}function Wl(o,e,t){let r=e.slice(),{resolved:s}=o;o.current===o.then&&(r[o.value]=s),o.current===o.catch&&(r[o.error]=s),o.block.p(r,t)}function Ae(o){return(o==null?void 0:o.length)!==void 0?o:Array.from(o)}function fx(o,e){P(o,1,1,()=>{e.delete(o.key)})}function ux(o,e,t,r,s,n,a,i,l,f,u,d){let m=o.length,y=n.length,h=m,_={};for(;h--;)_[o[h].key]=h;let w=[],v=new Map,M=new Map,O=[];for(h=y;h--;){let F=d(s,n,h),D=t(F),B=a.get(D);B?r&&O.push(()=>B.p(F,e)):(B=f(D,F),B.c()),v.set(D,w[h]=B),D in _&&M.set(D,Math.abs(h-_[D]))}let A=new Set,E=new Set;function R(F){I(F,1),F.m(i,u),a.set(F.key,F),u=F.first,y--}for(;m&&y;){let F=w[y-1],D=o[m-1],B=F.key,q=D.key;F===D?(u=F.first,m--,y--):v.has(q)?!a.has(B)||A.has(B)?R(F):E.has(q)?m--:M.get(B)>M.get(q)?(E.add(B),R(F)):(A.add(q),m--):(l(D,a),m--)}for(;m--;){let F=o[m];v.has(F.key)||l(F,a)}for(;y;)R(w[y-1]);return ke(O),w}function Oe(o,e){let t={},r={},s={$$scope:1},n=o.length;for(;n--;){let a=o[n],i=e[n];if(i){for(let l in a)l in i||(r[l]=1);for(let l in i)s[l]||(t[l]=i[l],s[l]=1);o[n]=i}else for(let l in a)s[l]=1}for(let a in r)a in t||(t[a]=void 0);return t}function qe(o){return typeof o=="object"&&o!==null?o:{}}var AC=["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"],FC=new Set([...AC]);function V(o){o&&o.c()}function N(o,e,t){let{fragment:r,after_update:s}=o.$$;r&&r.m(e,t),ei(()=>{let n=o.$$.on_mount.map(Wu).filter(dt);o.$$.on_destroy?o.$$.on_destroy.push(...n):ke(n),o.$$.on_mount=[]}),s.forEach(ei)}function H(o,e){let t=o.$$;t.fragment!==null&&(cx(t.after_update),ke(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function MC(o,e){o.$$.dirty[0]===-1&&(Ns.push(o),lx(),o.$$.dirty.fill(0)),o.$$.dirty[e/31|0]|=1<<e%31}function te(o,e,t,r,s,n,a=null,i=[-1]){let l=us;vr(o);let f=o.$$={fragment:null,ctx:[],props:n,update:X,not_equal:s,bound:Hl(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:Hl(),dirty:i,skip_bound:!1,root:e.target||l.$$.root};a&&a(f.root);let u=!1;if(f.ctx=t?t(o,e.props||{},(d,m,...y)=>{let h=y.length?y[0]:m;return f.ctx&&s(f.ctx[d],f.ctx[d]=h)&&(!f.skip_bound&&f.bound[d]&&f.bound[d](h),u&&MC(o,d)),m}):[],f.update(),u=!0,ke(f.before_update),f.fragment=r?r(f.ctx):!1,e.target){if(e.hydrate){tx();let d=nx(e.target);f.fragment&&f.fragment.l(d),d.forEach(L)}else f.fragment&&f.fragment.c();e.intro&&I(o.$$.fragment),N(o,e.target,e.anchor),rx(),ti()}vr(l)}var EC;typeof HTMLElement=="function"&&(EC=class extends HTMLElement{constructor(e,t,r){super();mt(this,"$$ctor");mt(this,"$$s");mt(this,"$$c");mt(this,"$$cn",!1);mt(this,"$$d",{});mt(this,"$$r",!1);mt(this,"$$p_d",{});mt(this,"$$l",{});mt(this,"$$l_u",new Map);this.$$ctor=e,this.$$s=t,r&&this.attachShadow({mode:"open"})}addEventListener(e,t,r){if(this.$$l[e]=this.$$l[e]||[],this.$$l[e].push(t),this.$$c){let s=this.$$c.$on(e,t);this.$$l_u.set(t,s)}super.addEventListener(e,t,r)}removeEventListener(e,t,r){if(super.removeEventListener(e,t,r),this.$$c){let s=this.$$l_u.get(t);s&&(s(),this.$$l_u.delete(t))}}async connectedCallback(){if(this.$$cn=!0,!this.$$c){let e=function(n){return()=>{let a;return{c:function(){a=T("slot"),n!=="default"&&b(a,"name",n)},m:function(f,u){C(f,a,u)},d:function(f){f&&L(a)}}}};if(await Promise.resolve(),!this.$$cn||this.$$c)return;let t={},r=ax(this);for(let n of this.$$s)n in r&&(t[n]=[e(n)]);for(let n of this.attributes){let a=this.$$g_p(n.name);a in this.$$d||(this.$$d[a]=Ju(a,n.value,this.$$p_d,"toProp"))}for(let n in this.$$p_d)!(n in this.$$d)&&this[n]!==void 0&&(this.$$d[n]=this[n],delete this[n]);this.$$c=new this.$$ctor({target:this.shadowRoot||this,props:{...this.$$d,$$slots:t,$$scope:{ctx:[]}}});let s=()=>{this.$$r=!0;for(let n in this.$$p_d)if(this.$$d[n]=this.$$c.$$.ctx[this.$$c.$$.props[n]],this.$$p_d[n].reflect){let a=Ju(n,this.$$d[n],this.$$p_d,"toAttribute");a==null?this.removeAttribute(this.$$p_d[n].attribute||n):this.setAttribute(this.$$p_d[n].attribute||n,a)}this.$$r=!1};this.$$c.$$.after_update.push(s),s();for(let n in this.$$l)for(let a of this.$$l[n]){let i=this.$$c.$on(n,a);this.$$l_u.set(a,i)}this.$$l={}}}attributeChangedCallback(e,t,r){var s;this.$$r||(e=this.$$g_p(e),this.$$d[e]=Ju(e,r,this.$$p_d,"toProp"),(s=this.$$c)==null||s.$set({[e]:this.$$d[e]}))}disconnectedCallback(){this.$$cn=!1,Promise.resolve().then(()=>{!this.$$cn&&this.$$c&&(this.$$c.$destroy(),this.$$c=void 0)})}$$g_p(e){return Object.keys(this.$$p_d).find(t=>this.$$p_d[t].attribute===e||!this.$$p_d[t].attribute&&t.toLowerCase()===e)||e}});function Ju(o,e,t,r){var n;let s=(n=t[o])==null?void 0:n.type;if(e=s==="Boolean"&&typeof e!="boolean"?e!=null:e,!r||!t[o])return e;if(r==="toAttribute")switch(s){case"Object":case"Array":return e==null?null:JSON.stringify(e);case"Boolean":return e?"":null;case"Number":return e==null?null:e;default:return e}else switch(s){case"Object":case"Array":return e&&JSON.parse(e);case"Boolean":return e;case"Number":return e!=null?+e:e;default:return e}}var Z=class{constructor(){mt(this,"$$");mt(this,"$$set")}$destroy(){H(this,1),this.$destroy=X}$on(e,t){if(!dt(t))return X;let r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(t),()=>{let s=r.indexOf(t);s!==-1&&r.splice(s,1)}}$set(e){this.$$set&&!Jy(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}};var dx="4";typeof window!="undefined"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(dx);var RC={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"},Xu=RC;function px(o,e,t){let r=o.slice();return r[11]=e[t][0],r[12]=e[t][1],r}function Qu(o){let e,t=[o[12]],r={};for(let s=0;s<t.length;s+=1)r=ce(r,t[s]);return{c(){e=Kr(o[11]),Qa(e,r)},m(s,n){C(s,e,n)},p(s,n){Qa(e,r=Oe(t,[n&32&&s[12]]))},d(s){s&&L(e)}}}function mx(o){let e=o[11],t,r=o[11]&&Qu(o);return{c(){r&&r.c(),t=Te()},m(s,n){r&&r.m(s,n),C(s,t,n)},p(s,n){s[11]?e?Q(e,s[11])?(r.d(1),r=Qu(s),e=s[11],r.c(),r.m(t.parentNode,t)):r.p(s,n):(r=Qu(s),e=s[11],r.c(),r.m(t.parentNode,t)):e&&(r.d(1),r=null,e=s[11])},d(s){s&&L(t),r&&r.d(s)}}}function OC(o){let e,t,r,s,n,a=Ae(o[5]),i=[];for(let m=0;m<a.length;m+=1)i[m]=mx(px(o,a,m));let l=o[10].default,f=ge(l,o,o[9],null),u=[Xu,o[7],{width:o[2]},{height:o[2]},{stroke:o[1]},{"stroke-width":r=o[4]?Number(o[3])*24/Number(o[2]):o[3]},{class:s=o[6]("lucide-icon","lucide",o[0]?`lucide-${o[0]}`:"",o[8].class)}],d={};for(let m=0;m<u.length;m+=1)d=ce(d,u[m]);return{c(){e=Kr("svg");for(let m=0;m<i.length;m+=1)i[m].c();t=Te(),f&&f.c(),Qa(e,d)},m(m,y){C(m,e,y);for(let h=0;h<i.length;h+=1)i[h]&&i[h].m(e,null);S(e,t),f&&f.m(e,null),n=!0},p(m,[y]){if(y&32){a=Ae(m[5]);let h;for(h=0;h<a.length;h+=1){let _=px(m,a,h);i[h]?i[h].p(_,y):(i[h]=mx(_),i[h].c(),i[h].m(e,t))}for(;h<i.length;h+=1)i[h].d(1);i.length=a.length}f&&f.p&&(!n||y&512)&&xe(f,l,m,m[9],n?ye(l,m[9],y,null):be(m[9]),null),Qa(e,d=Oe(u,[Xu,y&128&&m[7],(!n||y&4)&&{width:m[2]},(!n||y&4)&&{height:m[2]},(!n||y&2)&&{stroke:m[1]},(!n||y&28&&r!==(r=m[4]?Number(m[3])*24/Number(m[2]):m[3]))&&{"stroke-width":r},(!n||y&257&&s!==(s=m[6]("lucide-icon","lucide",m[0]?`lucide-${m[0]}`:"",m[8].class)))&&{class:s}]))},i(m){n||(I(f,m),n=!0)},o(m){P(f,m),n=!1},d(m){m&&L(e),tt(i,m),f&&f.d(m)}}}function UC(o,e,t){let r=["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode","mergeClasses"],s=Ku(e,r),{$$slots:n={},$$scope:a}=e,{name:i=void 0}=e,{color:l="currentColor"}=e,{size:f=24}=e,{strokeWidth:u=2}=e,{absoluteStrokeWidth:d=!1}=e,{iconNode:m}=e,y=(...h)=>h.filter((_,w,v)=>Boolean(_)&&v.indexOf(_)===w).join(" ");return o.$$set=h=>{t(8,e=ce(ce({},e),Se(h))),t(7,s=Ku(e,r)),"name"in h&&t(0,i=h.name),"color"in h&&t(1,l=h.color),"size"in h&&t(2,f=h.size),"strokeWidth"in h&&t(3,u=h.strokeWidth),"absoluteStrokeWidth"in h&&t(4,d=h.absoluteStrokeWidth),"iconNode"in h&&t(5,m=h.iconNode),"$$scope"in h&&t(9,a=h.$$scope)},e=Se(e),[i,l,f,u,d,m,y,s,e,a,n]}var Zu=class extends Z{constructor(e){super(),te(this,e,UC,OC,Q,{name:0,color:1,size:2,strokeWidth:3,absoluteStrokeWidth:4,iconNode:5,mergeClasses:6})}get mergeClasses(){return this.$$.ctx[6]}},We=Zu;function $C(o){let e,t=o[2].default,r=ge(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&xe(r,t,s,s[3],e?ye(t,s[3],n,null):be(s[3]),null)},i(s){e||(I(r,s),e=!0)},o(s){P(r,s),e=!1},d(s){r&&r.d(s)}}}function BC(o){let e,t,r=[{name:"arrow-right-left"},o[1],{iconNode:o[0]}],s={$$slots:{default:[$C]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=ce(s,r[n]);return e=new We({props:s}),{c(){V(e.$$.fragment)},m(n,a){N(e,n,a),t=!0},p(n,[a]){let i=a&3?Oe(r,[r[0],a&2&&qe(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(I(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){H(e,n)}}}function NC(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["path",{d:"m16 3 4 4-4 4"}],["path",{d:"M20 7H4"}],["path",{d:"m8 21-4-4 4-4"}],["path",{d:"M4 17h16"}]];return o.$$set=a=>{t(1,e=ce(ce({},e),Se(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=Se(e),[n,e,r,s]}var ed=class extends Z{constructor(e){super(),te(this,e,NC,BC,Q,{})}},td=ed;function HC(o){let e,t=o[2].default,r=ge(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&xe(r,t,s,s[3],e?ye(t,s[3],n,null):be(s[3]),null)},i(s){e||(I(r,s),e=!0)},o(s){P(r,s),e=!1},d(s){r&&r.d(s)}}}function VC(o){let e,t,r=[{name:"arrow-up-down"},o[1],{iconNode:o[0]}],s={$$slots:{default:[HC]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=ce(s,r[n]);return e=new We({props:s}),{c(){V(e.$$.fragment)},m(n,a){N(e,n,a),t=!0},p(n,[a]){let i=a&3?Oe(r,[r[0],a&2&&qe(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(I(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){H(e,n)}}}function qC(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["path",{d:"m21 16-4 4-4-4"}],["path",{d:"M17 20V4"}],["path",{d:"m3 8 4-4 4 4"}],["path",{d:"M7 4v16"}]];return o.$$set=a=>{t(1,e=ce(ce({},e),Se(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=Se(e),[n,e,r,s]}var rd=class extends Z{constructor(e){super(),te(this,e,qC,VC,Q,{})}},od=rd;function WC(o){let e,t=o[2].default,r=ge(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&xe(r,t,s,s[3],e?ye(t,s[3],n,null):be(s[3]),null)},i(s){e||(I(r,s),e=!0)},o(s){P(r,s),e=!1},d(s){r&&r.d(s)}}}function zC(o){let e,t,r=[{name:"chevron-left"},o[1],{iconNode:o[0]}],s={$$slots:{default:[WC]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=ce(s,r[n]);return e=new We({props:s}),{c(){V(e.$$.fragment)},m(n,a){N(e,n,a),t=!0},p(n,[a]){let i=a&3?Oe(r,[r[0],a&2&&qe(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(I(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){H(e,n)}}}function KC(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["path",{d:"m15 18-6-6 6-6"}]];return o.$$set=a=>{t(1,e=ce(ce({},e),Se(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=Se(e),[n,e,r,s]}var sd=class extends Z{constructor(e){super(),te(this,e,KC,zC,Q,{})}},nd=sd;function GC(o){let e,t=o[2].default,r=ge(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&xe(r,t,s,s[3],e?ye(t,s[3],n,null):be(s[3]),null)},i(s){e||(I(r,s),e=!0)},o(s){P(r,s),e=!1},d(s){r&&r.d(s)}}}function jC(o){let e,t,r=[{name:"chevron-right"},o[1],{iconNode:o[0]}],s={$$slots:{default:[GC]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=ce(s,r[n]);return e=new We({props:s}),{c(){V(e.$$.fragment)},m(n,a){N(e,n,a),t=!0},p(n,[a]){let i=a&3?Oe(r,[r[0],a&2&&qe(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(I(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){H(e,n)}}}function YC(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["path",{d:"m9 18 6-6-6-6"}]];return o.$$set=a=>{t(1,e=ce(ce({},e),Se(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=Se(e),[n,e,r,s]}var ad=class extends Z{constructor(e){super(),te(this,e,YC,jC,Q,{})}},id=ad;function JC(o){let e,t=o[2].default,r=ge(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&xe(r,t,s,s[3],e?ye(t,s[3],n,null):be(s[3]),null)},i(s){e||(I(r,s),e=!0)},o(s){P(r,s),e=!1},d(s){r&&r.d(s)}}}function XC(o){let e,t,r=[{name:"circle-check-big"},o[1],{iconNode:o[0]}],s={$$slots:{default:[JC]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=ce(s,r[n]);return e=new We({props:s}),{c(){V(e.$$.fragment)},m(n,a){N(e,n,a),t=!0},p(n,[a]){let i=a&3?Oe(r,[r[0],a&2&&qe(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(I(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){H(e,n)}}}function QC(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}],["path",{d:"m9 11 3 3L22 4"}]];return o.$$set=a=>{t(1,e=ce(ce({},e),Se(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=Se(e),[n,e,r,s]}var ld=class extends Z{constructor(e){super(),te(this,e,QC,XC,Q,{})}},cd=ld;function ZC(o){let e,t=o[2].default,r=ge(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&xe(r,t,s,s[3],e?ye(t,s[3],n,null):be(s[3]),null)},i(s){e||(I(r,s),e=!0)},o(s){P(r,s),e=!1},d(s){r&&r.d(s)}}}function e2(o){let e,t,r=[{name:"circle-help"},o[1],{iconNode:o[0]}],s={$$slots:{default:[ZC]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=ce(s,r[n]);return e=new We({props:s}),{c(){V(e.$$.fragment)},m(n,a){N(e,n,a),t=!0},p(n,[a]){let i=a&3?Oe(r,[r[0],a&2&&qe(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(I(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){H(e,n)}}}function t2(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}],["path",{d:"M12 17h.01"}]];return o.$$set=a=>{t(1,e=ce(ce({},e),Se(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=Se(e),[n,e,r,s]}var fd=class extends Z{constructor(e){super(),te(this,e,t2,e2,Q,{})}},ri=fd;function r2(o){let e,t=o[2].default,r=ge(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&xe(r,t,s,s[3],e?ye(t,s[3],n,null):be(s[3]),null)},i(s){e||(I(r,s),e=!0)},o(s){P(r,s),e=!1},d(s){r&&r.d(s)}}}function o2(o){let e,t,r=[{name:"clock"},o[1],{iconNode:o[0]}],s={$$slots:{default:[r2]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=ce(s,r[n]);return e=new We({props:s}),{c(){V(e.$$.fragment)},m(n,a){N(e,n,a),t=!0},p(n,[a]){let i=a&3?Oe(r,[r[0],a&2&&qe(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(I(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){H(e,n)}}}function s2(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["circle",{cx:"12",cy:"12",r:"10"}],["polyline",{points:"12 6 12 12 16 14"}]];return o.$$set=a=>{t(1,e=ce(ce({},e),Se(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=Se(e),[n,e,r,s]}var ud=class extends Z{constructor(e){super(),te(this,e,s2,o2,Q,{})}},oi=ud;function n2(o){let e,t=o[2].default,r=ge(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&xe(r,t,s,s[3],e?ye(t,s[3],n,null):be(s[3]),null)},i(s){e||(I(r,s),e=!0)},o(s){P(r,s),e=!1},d(s){r&&r.d(s)}}}function a2(o){let e,t,r=[{name:"download"},o[1],{iconNode:o[0]}],s={$$slots:{default:[n2]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=ce(s,r[n]);return e=new We({props:s}),{c(){V(e.$$.fragment)},m(n,a){N(e,n,a),t=!0},p(n,[a]){let i=a&3?Oe(r,[r[0],a&2&&qe(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(I(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){H(e,n)}}}function i2(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}],["polyline",{points:"7 10 12 15 17 10"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3"}]];return o.$$set=a=>{t(1,e=ce(ce({},e),Se(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=Se(e),[n,e,r,s]}var dd=class extends Z{constructor(e){super(),te(this,e,i2,a2,Q,{})}},pd=dd;function l2(o){let e,t=o[2].default,r=ge(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&xe(r,t,s,s[3],e?ye(t,s[3],n,null):be(s[3]),null)},i(s){e||(I(r,s),e=!0)},o(s){P(r,s),e=!1},d(s){r&&r.d(s)}}}function c2(o){let e,t,r=[{name:"folder"},o[1],{iconNode:o[0]}],s={$$slots:{default:[l2]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=ce(s,r[n]);return e=new We({props:s}),{c(){V(e.$$.fragment)},m(n,a){N(e,n,a),t=!0},p(n,[a]){let i=a&3?Oe(r,[r[0],a&2&&qe(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(I(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){H(e,n)}}}function f2(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"}]];return o.$$set=a=>{t(1,e=ce(ce({},e),Se(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=Se(e),[n,e,r,s]}var md=class extends Z{constructor(e){super(),te(this,e,f2,c2,Q,{})}},hd=md;function u2(o){let e,t=o[2].default,r=ge(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&xe(r,t,s,s[3],e?ye(t,s[3],n,null):be(s[3]),null)},i(s){e||(I(r,s),e=!0)},o(s){P(r,s),e=!1},d(s){r&&r.d(s)}}}function d2(o){let e,t,r=[{name:"info"},o[1],{iconNode:o[0]}],s={$$slots:{default:[u2]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=ce(s,r[n]);return e=new We({props:s}),{c(){V(e.$$.fragment)},m(n,a){N(e,n,a),t=!0},p(n,[a]){let i=a&3?Oe(r,[r[0],a&2&&qe(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(I(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){H(e,n)}}}function p2(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M12 16v-4"}],["path",{d:"M12 8h.01"}]];return o.$$set=a=>{t(1,e=ce(ce({},e),Se(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=Se(e),[n,e,r,s]}var gd=class extends Z{constructor(e){super(),te(this,e,p2,d2,Q,{})}},yd=gd;function m2(o){let e,t=o[2].default,r=ge(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&xe(r,t,s,s[3],e?ye(t,s[3],n,null):be(s[3]),null)},i(s){e||(I(r,s),e=!0)},o(s){P(r,s),e=!1},d(s){r&&r.d(s)}}}function h2(o){let e,t,r=[{name:"layers"},o[1],{iconNode:o[0]}],s={$$slots:{default:[m2]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=ce(s,r[n]);return e=new We({props:s}),{c(){V(e.$$.fragment)},m(n,a){N(e,n,a),t=!0},p(n,[a]){let i=a&3?Oe(r,[r[0],a&2&&qe(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(I(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){H(e,n)}}}function g2(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65"}]];return o.$$set=a=>{t(1,e=ce(ce({},e),Se(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=Se(e),[n,e,r,s]}var xd=class extends Z{constructor(e){super(),te(this,e,g2,h2,Q,{})}},Bo=xd;function y2(o){let e,t=o[2].default,r=ge(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&xe(r,t,s,s[3],e?ye(t,s[3],n,null):be(s[3]),null)},i(s){e||(I(r,s),e=!0)},o(s){P(r,s),e=!1},d(s){r&&r.d(s)}}}function x2(o){let e,t,r=[{name:"message-square-heart"},o[1],{iconNode:o[0]}],s={$$slots:{default:[y2]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=ce(s,r[n]);return e=new We({props:s}),{c(){V(e.$$.fragment)},m(n,a){N(e,n,a),t=!0},p(n,[a]){let i=a&3?Oe(r,[r[0],a&2&&qe(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(I(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){H(e,n)}}}function b2(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"}],["path",{d:"M14.8 7.5a1.84 1.84 0 0 0-2.6 0l-.2.3-.3-.3a1.84 1.84 0 1 0-2.4 2.8L12 13l2.7-2.7c.9-.9.8-2.1.1-2.8"}]];return o.$$set=a=>{t(1,e=ce(ce({},e),Se(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=Se(e),[n,e,r,s]}var bd=class extends Z{constructor(e){super(),te(this,e,b2,x2,Q,{})}},wd=bd;function w2(o){let e,t=o[2].default,r=ge(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&xe(r,t,s,s[3],e?ye(t,s[3],n,null):be(s[3]),null)},i(s){e||(I(r,s),e=!0)},o(s){P(r,s),e=!1},d(s){r&&r.d(s)}}}function _2(o){let e,t,r=[{name:"pause"},o[1],{iconNode:o[0]}],s={$$slots:{default:[w2]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=ce(s,r[n]);return e=new We({props:s}),{c(){V(e.$$.fragment)},m(n,a){N(e,n,a),t=!0},p(n,[a]){let i=a&3?Oe(r,[r[0],a&2&&qe(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(I(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){H(e,n)}}}function v2(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1"}]];return o.$$set=a=>{t(1,e=ce(ce({},e),Se(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=Se(e),[n,e,r,s]}var _d=class extends Z{constructor(e){super(),te(this,e,v2,_2,Q,{})}},vd=_d;function S2(o){let e,t=o[2].default,r=ge(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&xe(r,t,s,s[3],e?ye(t,s[3],n,null):be(s[3]),null)},i(s){e||(I(r,s),e=!0)},o(s){P(r,s),e=!1},d(s){r&&r.d(s)}}}function k2(o){let e,t,r=[{name:"play"},o[1],{iconNode:o[0]}],s={$$slots:{default:[S2]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=ce(s,r[n]);return e=new We({props:s}),{c(){V(e.$$.fragment)},m(n,a){N(e,n,a),t=!0},p(n,[a]){let i=a&3?Oe(r,[r[0],a&2&&qe(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(I(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){H(e,n)}}}function I2(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["polygon",{points:"6 3 20 12 6 21 6 3"}]];return o.$$set=a=>{t(1,e=ce(ce({},e),Se(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=Se(e),[n,e,r,s]}var Sd=class extends Z{constructor(e){super(),te(this,e,I2,k2,Q,{})}},kd=Sd;function L2(o){let e,t=o[2].default,r=ge(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&xe(r,t,s,s[3],e?ye(t,s[3],n,null):be(s[3]),null)},i(s){e||(I(r,s),e=!0)},o(s){P(r,s),e=!1},d(s){r&&r.d(s)}}}function C2(o){let e,t,r=[{name:"refresh-cw"},o[1],{iconNode:o[0]}],s={$$slots:{default:[L2]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=ce(s,r[n]);return e=new We({props:s}),{c(){V(e.$$.fragment)},m(n,a){N(e,n,a),t=!0},p(n,[a]){let i=a&3?Oe(r,[r[0],a&2&&qe(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(I(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){H(e,n)}}}function T2(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"}],["path",{d:"M21 3v5h-5"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"}],["path",{d:"M8 16H3v5"}]];return o.$$set=a=>{t(1,e=ce(ce({},e),Se(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=Se(e),[n,e,r,s]}var Id=class extends Z{constructor(e){super(),te(this,e,T2,C2,Q,{})}},Ld=Id;function P2(o){let e,t=o[2].default,r=ge(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&xe(r,t,s,s[3],e?ye(t,s[3],n,null):be(s[3]),null)},i(s){e||(I(r,s),e=!0)},o(s){P(r,s),e=!1},d(s){r&&r.d(s)}}}function A2(o){let e,t,r=[{name:"satellite"},o[1],{iconNode:o[0]}],s={$$slots:{default:[P2]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=ce(s,r[n]);return e=new We({props:s}),{c(){V(e.$$.fragment)},m(n,a){N(e,n,a),t=!0},p(n,[a]){let i=a&3?Oe(r,[r[0],a&2&&qe(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(I(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){H(e,n)}}}function F2(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["path",{d:"M13 7 9 3 5 7l4 4"}],["path",{d:"m17 11 4 4-4 4-4-4"}],["path",{d:"m8 12 4 4 6-6-4-4Z"}],["path",{d:"m16 8 3-3"}],["path",{d:"M9 21a6 6 0 0 0-6-6"}]];return o.$$set=a=>{t(1,e=ce(ce({},e),Se(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=Se(e),[n,e,r,s]}var Cd=class extends Z{constructor(e){super(),te(this,e,F2,A2,Q,{})}},Vs=Cd;function D2(o){let e,t=o[2].default,r=ge(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&xe(r,t,s,s[3],e?ye(t,s[3],n,null):be(s[3]),null)},i(s){e||(I(r,s),e=!0)},o(s){P(r,s),e=!1},d(s){r&&r.d(s)}}}function M2(o){let e,t,r=[{name:"settings"},o[1],{iconNode:o[0]}],s={$$slots:{default:[D2]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=ce(s,r[n]);return e=new We({props:s}),{c(){V(e.$$.fragment)},m(n,a){N(e,n,a),t=!0},p(n,[a]){let i=a&3?Oe(r,[r[0],a&2&&qe(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(I(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){H(e,n)}}}function E2(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"}],["circle",{cx:"12",cy:"12",r:"3"}]];return o.$$set=a=>{t(1,e=ce(ce({},e),Se(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=Se(e),[n,e,r,s]}var Td=class extends Z{constructor(e){super(),te(this,e,E2,M2,Q,{})}},Pd=Td;function R2(o){let e,t=o[2].default,r=ge(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&xe(r,t,s,s[3],e?ye(t,s[3],n,null):be(s[3]),null)},i(s){e||(I(r,s),e=!0)},o(s){P(r,s),e=!1},d(s){r&&r.d(s)}}}function O2(o){let e,t,r=[{name:"triangle-alert"},o[1],{iconNode:o[0]}],s={$$slots:{default:[R2]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=ce(s,r[n]);return e=new We({props:s}),{c(){V(e.$$.fragment)},m(n,a){N(e,n,a),t=!0},p(n,[a]){let i=a&3?Oe(r,[r[0],a&2&&qe(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(I(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){H(e,n)}}}function U2(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3"}],["path",{d:"M12 9v4"}],["path",{d:"M12 17h.01"}]];return o.$$set=a=>{t(1,e=ce(ce({},e),Se(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=Se(e),[n,e,r,s]}var Ad=class extends Z{constructor(e){super(),te(this,e,U2,O2,Q,{})}},si=Ad;function $2(o){let e,t=o[2].default,r=ge(t,o,o[3],null);return{c(){r&&r.c()},m(s,n){r&&r.m(s,n),e=!0},p(s,n){r&&r.p&&(!e||n&8)&&xe(r,t,s,s[3],e?ye(t,s[3],n,null):be(s[3]),null)},i(s){e||(I(r,s),e=!0)},o(s){P(r,s),e=!1},d(s){r&&r.d(s)}}}function B2(o){let e,t,r=[{name:"upload"},o[1],{iconNode:o[0]}],s={$$slots:{default:[$2]},$$scope:{ctx:o}};for(let n=0;n<r.length;n+=1)s=ce(s,r[n]);return e=new We({props:s}),{c(){V(e.$$.fragment)},m(n,a){N(e,n,a),t=!0},p(n,[a]){let i=a&3?Oe(r,[r[0],a&2&&qe(n[1]),a&1&&{iconNode:n[0]}]):{};a&8&&(i.$$scope={dirty:a,ctx:n}),e.$set(i)},i(n){t||(I(e.$$.fragment,n),t=!0)},o(n){P(e.$$.fragment,n),t=!1},d(n){H(e,n)}}}function N2(o,e,t){let{$$slots:r={},$$scope:s}=e,n=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}],["polyline",{points:"17 8 12 3 7 8"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15"}]];return o.$$set=a=>{t(1,e=ce(ce({},e),Se(a))),"$$scope"in a&&t(3,s=a.$$scope)},e=Se(e),[n,e,r,s]}var Fd=class extends Z{constructor(e){super(),te(this,e,N2,B2,Q,{})}},Dd=Fd;function H2(o){De(o,"svelte-1gxdage","button.notebook.svelte-1gxdage{color:var(--color-base-30);background-color:transparent}button.notebook-synced.svelte-1gxdage{color:var(--color-accent)}button.system3-connected.svelte-1gxdage{color:var(--color-accent)}button.system3-disconnected.svelte-1gxdage{color:var(--color-base-40)}")}function V2(o){let e,t,r,s,n,a;return t=new Bo({props:{class:"svg-icon inline-icon"}}),{c(){var i;e=T("button"),V(t.$$.fragment),b(e,"class",r="clickable-icon view-action system3-view-action "+(o[0].tracking?"notebook-synced":"notebook")+" svelte-1gxdage"),b(e,"aria-label",s=o[0].tracking?"Tracking changes: local file and update log are in sync":"Not tracking changes: local file and update log are not in sync"),b(e,"tabindex","0"),b(e,"data-filename",n=(i=o[0].view.file)==null?void 0:i.name)},m(i,l){C(i,e,l),N(t,e,null),a=!0},p(i,l){var f;(!a||l&1&&r!==(r="clickable-icon view-action system3-view-action "+(i[0].tracking?"notebook-synced":"notebook")+" svelte-1gxdage"))&&b(e,"class",r),(!a||l&1&&s!==(s=i[0].tracking?"Tracking changes: local file and update log are in sync":"Not tracking changes: local file and update log are not in sync"))&&b(e,"aria-label",s),(!a||l&1&&n!==(n=(f=i[0].view.file)==null?void 0:f.name))&&b(e,"data-filename",n)},i(i){a||(I(t.$$.fragment,i),a=!0)},o(i){P(t.$$.fragment,i),a=!1},d(i){i&&L(e),H(t)}}}function q2(o){let e,t,r,s,n,a,i,l,f,u,d,m,y;return t=new Bo({props:{class:"svg-icon inline-icon"}}),l=new Vs({props:{class:"svg-icon inline-icon"}}),{c(){var h;e=T("button"),V(t.$$.fragment),a=$(),i=T("button"),V(l.$$.fragment),b(e,"class",r="clickable-icon view-action system3-view-action "+(o[0].tracking?"notebook-synced":"notebook")+" svelte-1gxdage"),b(e,"aria-label",s=o[0].tracking?"Tracking changes: local file and update log are in sync":"Not tracking changes: local file and update log are not in sync"),b(e,"tabindex","0"),b(e,"data-filename",n=(h=o[0].view.file)==null?void 0:h.name),b(i,"class",f="system3-"+o[1].status+" clickable-icon view-action system3-view-action svelte-1gxdage"),b(i,"aria-label",u=`${o[2].relay.name} (${o[1].status})`),b(i,"tabindex","0")},m(h,_){C(h,e,_),N(t,e,null),C(h,a,_),C(h,i,_),N(l,i,null),d=!0,m||(y=[ee(i,"click",o[3]),ee(i,"keypress",o[4])],m=!0)},p(h,_){var w;(!d||_&1&&r!==(r="clickable-icon view-action system3-view-action "+(h[0].tracking?"notebook-synced":"notebook")+" svelte-1gxdage"))&&b(e,"class",r),(!d||_&1&&s!==(s=h[0].tracking?"Tracking changes: local file and update log are in sync":"Not tracking changes: local file and update log are not in sync"))&&b(e,"aria-label",s),(!d||_&1&&n!==(n=(w=h[0].view.file)==null?void 0:w.name))&&b(e,"data-filename",n),(!d||_&2&&f!==(f="system3-"+h[1].status+" clickable-icon view-action system3-view-action svelte-1gxdage"))&&b(i,"class",f),(!d||_&6&&u!==(u=`${h[2].relay.name} (${h[1].status})`))&&b(i,"aria-label",u)},i(h){d||(I(t.$$.fragment,h),I(l.$$.fragment,h),d=!0)},o(h){P(t.$$.fragment,h),P(l.$$.fragment,h),d=!1},d(h){h&&(L(e),L(a),L(i)),H(t),H(l),m=!1,ke(y)}}}function W2(o){let e,t,r,s,n=[q2,V2],a=[];function i(l,f){return l[2]?0:1}return e=i(o,-1),t=a[e]=n[e](o),{c(){t.c(),r=Te()},m(l,f){a[e].m(l,f),C(l,r,f),s=!0},p(l,[f]){let u=e;e=i(l,f),e===u?a[e].p(l,f):(we(),P(a[u],1,1,()=>{a[u]=null}),_e(),t=a[e],t?t.p(l,f):(t=a[e]=n[e](l),t.c()),I(t,1),t.m(r.parentNode,r))},i(l){s||(I(t),s=!0)},o(l){P(t),s=!1},d(l){l&&L(r),a[e].d(l)}}}function z2(o,e,t){let{view:r}=e,{state:s}=e,{remote:n}=e,a={connected:"connected: click to go offline",connecting:"connecting...",disconnected:"disconnected: click to go online",unknown:"unknown status"},i=()=>{r.toggleConnection()},l=f=>{f.key==="Enter"&&i()};return o.$$set=f=>{"view"in f&&t(0,r=f.view),"state"in f&&t(1,s=f.state),"remote"in f&&t(2,n=f.remote)},[r,s,n,i,l]}var Md=class extends Z{constructor(e){super(),te(this,e,z2,W2,Q,{view:0,state:1,remote:2},H2)}},hx=Md;var Kn=class{constructor(e,t,r){this.view=e,this.text=t,this.onClick=r,this.display()}display(){let e=this.view.containerEl,t=this.view.containerEl.querySelector(".view-content");if(!e)return;let r=e.querySelector(".system3-banner-box");r||(r=document.createElement("div"),r.classList.add("system3-banner-box"),e.insertBefore(r,t));let s=e.querySelector(".system3-banner");if(!s){s=document.createElement("div"),s.classList.add("system3-banner");let n=s.createSpan();n.setText(this.text),s.appendChild(n),r.appendChild(s);let a=async()=>{await this.onClick()&&this.destroy()};s.addEventListener("click",a)}return!0}destroy(){let e=this.view.containerEl;if(!e)return;let t=e.querySelector(".system3-banner-box");return t&&t.replaceChildren(),!0}};var zl=require("@codemirror/state"),gx=require("@codemirror/view");function ni(o,e){let t=Object.keys(e).map(r=>K2(o,r,e[r]));return t.length===1?t[0]:function(){t.forEach(r=>r())}}function K2(o,e,t){let r=o[e],s=o.hasOwnProperty(e),n=s?r:function(){return Object.getPrototypeOf(o)[e].apply(this,arguments)},a=t(n);return r&&Object.setPrototypeOf(a,r),Object.setPrototypeOf(i,a),o[e]=i,l;function i(...f){return a===n&&o[e]===i&&l(),a.apply(this,f)}function l(){o[e]===i&&(s?o[e]=n:delete o[e]),a!==n&&(a=n,Object.setPrototypeOf(i,r||Function))}}var yx=vs(Ed());var G2=25,N$=zl.Facet.define({combine(o){return o[o.length-1]}}),Rd=zl.Annotation.define(),Od=class{constructor(e){this.initialSet=!1;this.destroyed=!1;this.keyFrameCounter=0;this.debug=(...e)=>{};this.log=(...e)=>{};this.warn=(...e)=>{};var r,s,n,a;if(this.editor=e,this.connectionManager=this.editor.state.field(ds),this.view=(r=this.connectionManager)==null?void 0:r.findView(e),!this.view||(this.log=Pe(`[LiveCMPluginValue][${(s=this.view.view.file)==null?void 0:s.path}]`,"log"),this.warn=Pe(`[LiveCMPluginValue][${(n=this.view.view.file)==null?void 0:n.path}]`,"warn"),this.debug=Pe(`[LiveCMPluginValue][${(a=this.view.view.file)==null?void 0:a.path}]`,"debug"),this.debug("created"),!this.view.document))return;let t=this;this.uninstallMonkeyPatch=ni(this.view.view,{setViewData(i){return function(l,f){return f&&(No(t.view)&&t.view.document.text===l&&(t.view.tracking=!0),t.resync()),i.call(this,l,f)}}}),this.view.document.connected?this.resync():this.view.document.onceConnected().then(()=>{this.resync()}),this._observer=async(i,l)=>{if(!No(this.view)){this.debug("Recived yjs event against a non-live view");return}if(this.destroyed){this.debug("Recived yjs event but editor was destroyed");return}if(l.origin!==this){let f=i.delta,u=[],d=0;for(let m=0;m<f.length;m++){let y=f[m];y.insert!=null?u.push({from:d,to:d,insert:y.insert}):y.delete!=null?(u.push({from:d,to:d+y.delete,insert:""}),d+=y.delete):y.retain!=null&&(d+=y.retain)}!this.view.tracking||Xe().enableEditorTweens&&this.keyFrameCounter>G2?(this.keyFrameCounter=0,u=await this.getKeyFrame(!0),this.debug("dispatch (full)")):(this.keyFrameCounter+=1,this.debug(`dispatch (incremental + ${this.keyFrameCounter})`)),No(this.view)&&(e.dispatch({changes:u,annotations:[Rd.of(this.editor)]}),this.view.tracking=!0)}},this.observer=(i,l)=>{var f;try{(f=this._observer)==null||f.call(this,i,l)}catch(u){u instanceof RangeError&&No(this.view)&&(this.view.tracking=!1)}},this._ytext=this.view.document.ytext,this._ytext.observe(this.observer)}incrementalBufferChange(e){let t=this.editor.state.doc.toString(),r=new yx.default,s=r.diff_main(t,e);r.diff_cleanupSemantic(s);let n=[],a=0;for(let[i,l]of s)switch(i){case 0:a+=l.length;break;case 1:n.push({from:a,to:a,insert:l}),a+=l.length;break;case-1:n.push({from:a,to:a+l.length,insert:""});break}return n}getBufferChange(e,t=!1){return t?this.incrementalBufferChange(e):[{from:0,to:this.editor.state.doc.length,insert:e}]}async resync(){if(No(this.view)&&!this.view.tracking&&!this.destroyed){await this.view.document.whenSynced();let e=await this.getKeyFrame();No(this.view)&&!this.view.tracking&&!this.destroyed&&this.editor.dispatch({changes:e,annotations:[Rd.of(this.editor)]})}}async getKeyFrame(e=!1){return!No(this.view)||this.destroyed?[]:this.view.document.text===this.view.view.getViewData()?(this.view.tracking=!0,[]):(this.warn(`|${this.view.document.text}|
|${this.view.view.getViewData()}|`),this.warn("ytext and editor buffer need syncing"),!this.view.document.hasLocalDB()&&this.view.document.text===""?(this.warn("local db missing, not setting buffer"),[]):(this.view.tracking||this.view.checkStale(),No(this.view)&&!this.destroyed?[this.getBufferChange(this.view.document.text,e)]:[]))}update(e){var s,n,a,i;if(!e.docChanged||e.transactions.length>0&&e.transactions[0].annotation(Rd)===this.editor)return;let t=e.view;this.view=(s=this.connectionManager)==null?void 0:s.findView(t);let r=(a=(n=this.view)==null?void 0:n.document)==null?void 0:a.ytext;r&&((i=r.doc)==null||i.transact(()=>{let l=0;e.changes.iterChanges((f,u,d,m,y)=>{let h=y.sliceString(0,y.length,`
`);f!==u&&r.delete(f+l,u-f),h.length>0&&r.insert(f+l,h),l+=h.length-(u-f)})},this))}destroy(){var e;this.destroyed=!0,this.observer&&((e=this._ytext)==null||e.unobserve(this.observer)),this.uninstallMonkeyPatch&&(this.uninstallMonkeyPatch(),this.uninstallMonkeyPatch=void 0),this.connectionManager=null,this.view=void 0,this._ytext=void 0,this.editor=null}},xx=gx.ViewPlugin.fromClass(Od);var Kl=require("@codemirror/state"),ur=require("@codemirror/view");var bx=ur.EditorView.baseTheme({".cm-ySelection":{},".cm-yLineSelection":{padding:0,margin:"0px 2px 0px 4px"},".cm-ySelectionCaret":{position:"relative",borderLeft:"1px solid black",borderRight:"1px solid black",marginLeft:"-1px",marginRight:"-1px",boxSizing:"border-box",display:"inline"},".cm-ySelectionCaretDot":{borderRadius:"50%",position:"absolute",width:".4em",height:".4em",top:"-.2em",left:"-.2em",backgroundColor:"inherit",transition:"transform .3s ease-in-out",boxSizing:"border-box"},".cm-ySelectionCaret:hover > .cm-ySelectionCaretDot":{transformOrigin:"bottom center",transform:"scale(0)"},".cm-ySelectionInfo":{position:"absolute",top:"-1.05em",left:"-1px",fontSize:".75em",fontFamily:"serif",fontStyle:"normal",fontWeight:"normal",lineHeight:"normal",userSelect:"none",color:"white",paddingLeft:"2px",paddingRight:"2px",zIndex:101,transition:"opacity .3s ease-in-out",backgroundColor:"inherit",opacity:0,transitionDelay:"0s",whiteSpace:"nowrap"},".cm-ySelectionCaret:hover > .cm-ySelectionInfo":{opacity:1,transitionDelay:"0s"}}),j2=Kl.Annotation.define(),Ud=class extends ur.WidgetType{constructor(t,r){super();this.color=t,this.name=r}toDOM(t){return Ca("span",[Jt("class","cm-ySelectionCaret"),Jt("style",`background-color: ${this.color}; border-color: ${this.color}`)],[yn("\u2060"),Ca("div",[Jt("class","cm-ySelectionCaretDot")]),yn("\u2060"),Ca("div",[Jt("class","cm-ySelectionInfo")],[yn(this.name)]),yn("\u2060")])}eq(t){return t.color===this.color}compare(t){return t.color===this.color}updateDOM(){return!1}get estimatedHeight(){return-1}ignoreEvent(){return!0}},$d=class{constructor(e){var r,s;this.editor=e,this.decorations=Kl.RangeSet.of([]),this.connectionManager=this.editor.state.field(ds);let t=(r=this.connectionManager)==null?void 0:r.findView(e);if(t&&t instanceof ps){this.view=t;let n=(s=this.view.document)==null?void 0:s._provider;this._listener=({added:a,updated:i,removed:l},f,u)=>{a.concat(i).concat(l).findIndex(m=>{var y;return m!==((y=this._awareness)==null?void 0:y.doc.clientID)})>=0&&e.dispatch({annotations:[j2.of([])]})},n&&(this._awareness=n.awareness,this._awareness.on("change",this._listener))}}destroy(){var e;this._listener&&((e=this._awareness)==null||e.off("change",this._listener),this._listener=void 0),this.connectionManager=null,this.view=null,this.editor=null}update(e){var f,u,d,m;let t=e.view;this.view=(f=this.connectionManager)==null?void 0:f.findView(t);let r=(d=(u=this.view)==null?void 0:u.document)==null?void 0:d.ytext;if(!(this.view&&r&&r.doc))return;let s=(m=this.view.document)==null?void 0:m._provider;if(!s)return;this._awareness=s.awareness;let n=this._awareness,a=r.doc,i=[],l=this._awareness.getLocalState();if(l!=null){let y=e.view.hasFocus&&e.view.dom.ownerDocument.hasFocus(),h=y?e.state.selection.main:null,_=l.cursor==null?null:eu(l.cursor.anchor),w=l.cursor==null?null:eu(l.cursor.head);if(h!=null){let v=tu(r,h.anchor),M=tu(r,h.head);(l.cursor==null||!ou(_,v)||!ou(w,M))&&n.setLocalStateField("cursor",{anchor:v,head:M})}else l.cursor!=null&&y&&n.setLocalStateField("cursor",null)}n.getStates().forEach((y,h)=>{if(h===n.doc.clientID)return;let _=y.cursor;if(_==null||_.anchor==null||_.head==null)return;let w=ru(_.anchor,a),v=ru(_.head,a);if(w==null||v==null||w.type!==r||v.type!==r)return;if(w.index>e.state.doc.length||v.index>e.state.doc.length){Pe("[RemoteSelections]","warn")(`cursor positions (${w.index}, ${v.index}) out of range of document length: ${e.state.doc.length}`),this.decorations=ur.Decoration.none;return}let{color:M="#30bced",name:O="Anonymous"}=y.user||{},A=y.user&&y.user.colorLight||M+"33",E=sn(w.index,v.index),R=Br(w.index,v.index),F=e.view.state.doc.lineAt(E),D=e.view.state.doc.lineAt(R);if(F.number===D.number)i.push({from:E,to:R,value:ur.Decoration.mark({attributes:{style:`background-color: ${A}`},class:"cm-ySelection"})});else{i.push({from:E,to:F.from+F.length,value:ur.Decoration.mark({attributes:{style:`background-color: ${A}`},class:"cm-ySelection"})}),i.push({from:D.from,to:R,value:ur.Decoration.mark({attributes:{style:`background-color: ${A}`},class:"cm-ySelection"})});for(let B=F.number+1;B<D.number;B++){let q=e.view.state.doc.line(B).from;i.push({from:q,to:q,value:ur.Decoration.line({attributes:{style:`background-color: ${A}`,class:"cm-yLineSelection"}})})}}i.push({from:v.index,to:v.index,value:ur.Decoration.widget({side:v.index-w.index>0?-1:1,block:!1,widget:new Ud(M,O)})})}),this.decorations=ur.Decoration.set(i,!0)}},wx=ur.ViewPlugin.fromClass($d,{decorations:o=>o.decorations});var Gl=require("@codemirror/state"),Ho=require("@codemirror/view"),_x=require("@codemirror/view");var Z$=Gl.Annotation.define(),Nd=class extends _x.WidgetType{toDOM(){let e=document.createElement("span");return e.style.display="inline-flex",e.addClass("invalid-link"),e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-file-warning"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg>',e.title="This link points outside the shared folder and may not be accessible to other users.",e}},Bd=Gl.StateEffect.define(),Hd=class{constructor(e){this.log=e=>{};var t;if(this.editor=e,this.connectionManager=this.editor.state.field(ds),this.decorations=Ho.Decoration.none,this.decorationAnchors=[],this.metadata=new Map,this.cb=(r,s)=>{this.updateFromMetadata(s),this.editor.dispatch({effects:Bd.of(null)})},!this.connectionManager){Pe("[InvalidLinkPluginValue]","warn")("ConnectionManager not found in InvalidLinkPlugin");return}this.app=this.connectionManager.app,this.view=this.connectionManager.findView(e),this.view&&(this.log=Pe(`[InvalidLinkPluginValue][${(t=this.view.view.file)==null?void 0:t.path}]`,"debug"),this.log("created"),this.view.document&&this.view.document.whenSynced().then(()=>{var r,s;if(this.connectionManager&&this.app&&((s=(r=this.view)==null?void 0:r.document)!=null&&s.tfile)){this.connectionManager.onMeta(this.view.document.tfile,this.cb);let n=this.app.metadataCache.getFileCache(this.view.document.tfile);n&&(this.updateFromMetadata(n),this.editor.dispatch({effects:Bd.of(null)}))}else this.log("unable to subscribe to metadata updates")}))}findInternalLinks(e){let t=[];return e.state.facet(Ho.EditorView.decorations).forEach(s=>{(typeof s=="function"?s(e):s).between(0,e.state.doc.length,(a,i,l)=>{var d;(((d=l.spec)==null?void 0:d.class)||"").contains("cm-formatting-link-end")&&t.push({from:a,to:i})})}),t}updateFromMetadata(e){var r,s,n,a;if(this.connectionManager&&(this.view=this.connectionManager.findView(this.editor)),!this.view||!this.view.document||!this.app||!((s=(r=this.view)==null?void 0:r.document)!=null&&s.sharedFolder)||!((a=(n=this.view)==null?void 0:n.document)!=null&&a.tfile))return;let t=new Map;for(let i of(e==null?void 0:e.links)||[]){let l=this.app.metadataCache.getFirstLinkpathDest(i.link,this.view.document.path);l&&!this.view.document.sharedFolder.checkPath(l.path)&&t.set(i.position.start.offset,{from:i.position.start.offset,to:i.position.end.offset,link:i.link,original:i.original})}for(let i of(e==null?void 0:e.embeds)||[]){let l=this.app.metadataCache.getFirstLinkpathDest(i.link,this.view.document.path);l&&!this.view.document.sharedFolder.checkPath(l.path)&&t.set(i.position.start.offset,{from:i.position.start.offset,to:i.position.end.offset,link:i.link,original:i.original})}this.metadata=t}updateMetadataPositions(e){for(let[t,r]of this.metadata)try{this.metadata.set(t,{from:e.changes.mapPos(r.from),to:e.changes.mapPos(r.to),link:r.link,original:r.original})}catch(s){this.metadata.delete(t)}}updateFromEditor(e){var n,a,i,l;if(this.connectionManager&&(this.view=this.connectionManager.findView(this.editor)),!this.view||!this.view.document||!this.app||!((a=(n=this.view)==null?void 0:n.document)!=null&&a.sharedFolder)||!((l=(i=this.view)==null?void 0:i.document)!=null&&l.tfile))return;let t=[],r=new Map(this.metadata),s=this.findInternalLinks(this.editor);for(let f of s){let u=null;for(let[y,h]of r)if(f.from<=h.to&&f.to>=h.from){u=h,r.delete(y);break}if(!u)continue;let d=this.app.metadataCache.getFirstLinkpathDest(u.link,this.view.document.path);d&&!this.view.document.sharedFolder.checkPath(d.path)&&t.push(f.from)}t.filter(f=>f<=e.state.doc.length),this.decorationAnchors=t}updateDecorations(){this.decorationAnchors.sort();let e=this.decorationAnchors.map(t=>Ho.Decoration.widget({widget:new Nd,side:1}).range(t));e.length>0?this.decorations=Ho.Decoration.set(e,!0):this.decorations=Ho.Decoration.none}update(e){let t=!1;return e.transactions.forEach(r=>{r.effects.some(s=>s.is(Bd))&&(t=!0)}),(e.docChanged||e.viewportChanged||t)&&(t||this.updateMetadataPositions(e),this.updateFromEditor(e),this.updateDecorations()),this.decorations}destroy(){var e,t;this.connectionManager&&((t=(e=this.view)==null?void 0:e.document)!=null&&t.tfile)&&this.connectionManager.offMeta(this.view.document.tfile),this.connectionManager=null,this.view=void 0,this.metadata.clear(),this.metadata=null,this.editor=null}},vx=Ho.ViewPlugin.fromClass(Hd,{decorations:o=>o.decorations});function Vo(){}Vo.prototype={diff:function(e,t){var r,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=s.callback;typeof s=="function"&&(n=s,s={}),this.options=s;var a=this;function i(A){return n?(setTimeout(function(){n(void 0,A)},0),!0):A}e=this.castInput(e),t=this.castInput(t),e=this.removeEmpty(this.tokenize(e)),t=this.removeEmpty(this.tokenize(t));var l=t.length,f=e.length,u=1,d=l+f;s.maxEditLength&&(d=Math.min(d,s.maxEditLength));var m=(r=s.timeout)!==null&&r!==void 0?r:1/0,y=Date.now()+m,h=[{oldPos:-1,lastComponent:void 0}],_=this.extractCommon(h[0],t,e,0);if(h[0].oldPos+1>=f&&_+1>=l)return i([{value:this.join(t),count:t.length}]);var w=-1/0,v=1/0;function M(){for(var A=Math.max(w,-u);A<=Math.min(v,u);A+=2){var E=void 0,R=h[A-1],F=h[A+1];R&&(h[A-1]=void 0);var D=!1;if(F){var B=F.oldPos-A;D=F&&0<=B&&B<l}var q=R&&R.oldPos+1<f;if(!D&&!q){h[A]=void 0;continue}if(!q||D&&R.oldPos+1<F.oldPos?E=a.addToPath(F,!0,void 0,0):E=a.addToPath(R,void 0,!0,1),_=a.extractCommon(E,t,e,A),E.oldPos+1>=f&&_+1>=l)return i(Y2(a,E.lastComponent,t,e,a.useLongestToken));h[A]=E,E.oldPos+1>=f&&(v=Math.min(v,A-1)),_+1>=l&&(w=Math.max(w,A+1))}u++}if(n)(function A(){setTimeout(function(){if(u>d||Date.now()>y)return n();M()||A()},0)})();else for(;u<=d&&Date.now()<=y;){var O=M();if(O)return O}},addToPath:function(e,t,r,s){var n=e.lastComponent;return n&&n.added===t&&n.removed===r?{oldPos:e.oldPos+s,lastComponent:{count:n.count+1,added:t,removed:r,previousComponent:n.previousComponent}}:{oldPos:e.oldPos+s,lastComponent:{count:1,added:t,removed:r,previousComponent:n}}},extractCommon:function(e,t,r,s){for(var n=t.length,a=r.length,i=e.oldPos,l=i-s,f=0;l+1<n&&i+1<a&&this.equals(t[l+1],r[i+1]);)l++,i++,f++;return f&&(e.lastComponent={count:f,previousComponent:e.lastComponent}),e.oldPos=i,l},equals:function(e,t){return this.options.comparator?this.options.comparator(e,t):e===t||this.options.ignoreCase&&e.toLowerCase()===t.toLowerCase()},removeEmpty:function(e){for(var t=[],r=0;r<e.length;r++)e[r]&&t.push(e[r]);return t},castInput:function(e){return e},tokenize:function(e){return e.split("")},join:function(e){return e.join("")}};function Y2(o,e,t,r,s){for(var n=[],a;e;)n.push(e),a=e.previousComponent,delete e.previousComponent,e=a;n.reverse();for(var i=0,l=n.length,f=0,u=0;i<l;i++){var d=n[i];if(d.removed){if(d.value=o.join(r.slice(u,u+d.count)),u+=d.count,i&&n[i-1].added){var y=n[i-1];n[i-1]=n[i],n[i]=y}}else{if(!d.added&&s){var m=t.slice(f,f+d.count);m=m.map(function(_,w){var v=r[u+w];return v.length>_.length?v:_}),d.value=o.join(m)}else d.value=o.join(t.slice(f,f+d.count));f+=d.count,d.added||(u+=d.count)}}var h=n[l-1];return l>1&&typeof h.value=="string"&&(h.added||h.removed)&&o.equals("",h.value)&&(n[l-2].value+=h.value,n.pop()),n}var t6=new Vo;function J2(o,e){if(typeof o=="function")e.callback=o;else if(o)for(var t in o)o.hasOwnProperty(t)&&(e[t]=o[t]);return e}var Sx=/^[A-Za-z\xC0-\u02C6\u02C8-\u02D7\u02DE-\u02FF\u1E00-\u1EFF]+$/,kx=/\S/,Kd=new Vo;Kd.equals=function(o,e){return this.options.ignoreCase&&(o=o.toLowerCase(),e=e.toLowerCase()),o===e||this.options.ignoreWhitespace&&!kx.test(o)&&!kx.test(e)};Kd.tokenize=function(o){for(var e=o.split(/([^\S\r\n]+|[()[\]{}'"\r\n]|\b)/),t=0;t<e.length-1;t++)!e[t+1]&&e[t+2]&&Sx.test(e[t])&&Sx.test(e[t+2])&&(e[t]+=e[t+2],e.splice(t+1,2),t--);return e};function Ix(o,e,t){return t=J2(t,{ignoreWhitespace:!0}),Kd.diff(o,e,t)}var Gd=new Vo;Gd.tokenize=function(o){this.options.stripTrailingCr&&(o=o.replace(/\r\n/g,`
`));var e=[],t=o.split(/(\n|\r\n)/);t[t.length-1]||t.pop();for(var r=0;r<t.length;r++){var s=t[r];r%2&&!this.options.newlineIsToken?e[e.length-1]+=s:(this.options.ignoreWhitespace&&(s=s.trim()),e.push(s))}return e};function X2(o,e,t){return Gd.diff(o,e,t)}var Q2=new Vo;Q2.tokenize=function(o){return o.split(/(\S.+?[.!?])(?=\s+|$)/)};var Z2=new Vo;Z2.tokenize=function(o){return o.split(/([{}:;,]|\s+)/)};function jl(o){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?jl=function(e){return typeof e}:jl=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},jl(o)}function Vd(o){return eT(o)||tT(o)||rT(o)||oT()}function eT(o){if(Array.isArray(o))return qd(o)}function tT(o){if(typeof Symbol!="undefined"&&Symbol.iterator in Object(o))return Array.from(o)}function rT(o,e){if(o){if(typeof o=="string")return qd(o,e);var t=Object.prototype.toString.call(o).slice(8,-1);if(t==="Object"&&o.constructor&&(t=o.constructor.name),t==="Map"||t==="Set")return Array.from(o);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return qd(o,e)}}function qd(o,e){(e==null||e>o.length)&&(e=o.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=o[t];return r}function oT(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var sT=Object.prototype.toString,ai=new Vo;ai.useLongestToken=!0;ai.tokenize=Gd.tokenize;ai.castInput=function(o){var e=this.options,t=e.undefinedReplacement,r=e.stringifyReplacer,s=r===void 0?function(n,a){return typeof a=="undefined"?t:a}:r;return typeof o=="string"?o:JSON.stringify(Wd(o,null,null,s),s,"  ")};ai.equals=function(o,e){return Vo.prototype.equals.call(ai,o.replace(/,([\r\n])/g,"$1"),e.replace(/,([\r\n])/g,"$1"))};function Wd(o,e,t,r,s){e=e||[],t=t||[],r&&(o=r(s,o));var n;for(n=0;n<e.length;n+=1)if(e[n]===o)return t[n];var a;if(sT.call(o)==="[object Array]"){for(e.push(o),a=new Array(o.length),t.push(a),n=0;n<o.length;n+=1)a[n]=Wd(o[n],e,t,r,s);return e.pop(),t.pop(),a}if(o&&o.toJSON&&(o=o.toJSON()),jl(o)==="object"&&o!==null){e.push(o),a={},t.push(a);var i=[],l;for(l in o)o.hasOwnProperty(l)&&i.push(l);for(i.sort(),n=0;n<i.length;n+=1)l=i[n],a[l]=Wd(o[l],e,t,r,l);e.pop(),t.pop()}else a=o;return a}var zd=new Vo;zd.tokenize=function(o){return o.slice()};zd.join=zd.removeEmpty=function(o){return o};function Lx(o,e,t,r,s,n,a){a||(a={}),typeof a.context=="undefined"&&(a.context=4);var i=X2(t,r,a);if(!i)return;i.push({value:"",lines:[]});function l(v){return v.map(function(M){return" "+M})}for(var f=[],u=0,d=0,m=[],y=1,h=1,_=function(M){var O=i[M],A=O.lines||O.value.replace(/\n$/,"").split(`
`);if(O.lines=A,O.added||O.removed){var E;if(!u){var R=i[M-1];u=y,d=h,R&&(m=a.context>0?l(R.lines.slice(-a.context)):[],u-=m.length,d-=m.length)}(E=m).push.apply(E,Vd(A.map(function(W){return(O.added?"+":"-")+W}))),O.added?h+=A.length:y+=A.length}else{if(u)if(A.length<=a.context*2&&M<i.length-2){var F;(F=m).push.apply(F,Vd(l(A)))}else{var D,B=Math.min(A.length,a.context);(D=m).push.apply(D,Vd(l(A.slice(0,B))));var q={oldStart:u,oldLines:y-u+B,newStart:d,newLines:h-d+B,lines:m};if(M>=i.length-2&&A.length<=a.context){var J=/\n$/.test(t),K=/\n$/.test(r),z=A.length==0&&m.length>q.oldLines;!J&&z&&t.length>0&&m.splice(q.oldLines,0,"\\ No newline at end of file"),(!J&&!z||!K)&&m.push("\\ No newline at end of file")}f.push(q),u=0,d=0,m=[]}y+=A.length,h+=A.length}},w=0;w<i.length;w++)_(w);return{oldFileName:o,newFileName:e,oldHeader:s,newHeader:n,hunks:f}}var Px=require("obsidian");var Yl=class{constructor(e){this.file1Start=e.file1Start,this.file2Start=e.file2Start,this.file1Lines=e.file1Lines,this.file2Lines=e.file2Lines}};var Jl=class{constructor(e){this.file1Name=e.file1Name,this.file2Name=e.file2Name,this.differences=e.differences}static fromParsedDiff(e){let t=[];return e.hunks.forEach(r=>{let s=0,n=0;for(let a=0;a<r.lines.length;a+=1){let i=r.lines[a];if(i.startsWith("+")||i.startsWith("-")){let l=a,f=l;for(;f<r.lines.length-1&&(r.lines[f+1].startsWith("+")||r.lines[f+1].startsWith("-"));)f+=1;let u=r.lines.slice(l,f+1).filter(m=>m.startsWith("-")).map(m=>m.slice(1)),d=r.lines.slice(l,f+1).filter(m=>m.startsWith("+")).map(m=>m.slice(1));t.push(new Yl({file1Start:r.oldStart+l-n-1,file2Start:r.newStart+l-s-1,file1Lines:u,file2Lines:d})),s+=u.length,n+=d.length,a+=f-l}}}),new this({file1Name:e.oldFileName,file2Name:e.newFileName,differences:t})}};function jd(o){let e=o.fullText.split(`
`);return e.splice(o.position,0,o.newLine),e.join(`
`)}function ii(o){let e=o.fullText.split(`
`);return o.newLine===""?e.splice(o.position,o.linesToReplace):e.splice(o.position,o.linesToReplace,o.newLine),e.join(`
`)}function li(o){let e=o.fullText.split(`
`);return e.splice(o.position,o.count),e.join(`
`)}function jn(o){return o!==""?o:"\u200E"}var dr=class{constructor(e){this.text=e.text,this.onClick=e.onClick}build(e){e.createEl("a",{text:this.text,cls:"no-decoration text-xxs file-diff__action-line"}).onClickEvent(this.onClick)}};var fo=class{static build(e){e.createEl("span",{text:"|",cls:"text-xxs file-diff__action-line"})}};var Jd=require("obsidian");var Cx=vs(Ed());var pr=class extends xt{constructor(t){super();this.observableName=t;this._map=new Map,this._derivedMaps=new WeakMap}set(t,r){return this._map.set(t,r),this.notifyListeners(),this}delete(t){let r=this._map.delete(t);return r&&this.notifyListeners(),r}clear(){this._map.clear(),this.notifyListeners()}has(t){return this._map.has(t)}get(t){return this._map.get(t)}keys(){return[...this._map.keys()]}values(){return[...this._map.values()]}entries(){return[...this._map.entries()]}get size(){return this._map.size}forEach(t){this._map.forEach(t)}find(t){for(let[r,s]of this._map)if(t(s,r))return s}some(t){for(let[r,s]of this._map)if(t(s,r))return!0;return!1}filter(t){let r=this._derivedMaps.get(t);if(r)return r;let s=new Yd(this,t);return this._derivedMaps.set(t,s),s}},Yd=class extends pr{constructor(t,r){super();this.parentMap=t;this.predicate=r;this.sub(),this.observableName=t.observableName+"(filter: "+r.toString()+")"}sub(){this.unsub||(this.unsub=this.parentMap.subscribe(()=>{let t=new Map;this.parentMap.forEach((r,s)=>{this.predicate(r,s)&&t.set(s,r)}),this._map=t,this.notifyListeners()}))}subscribe(t){return this.sub(),super.subscribe(t),()=>{this.unsubscribe(t)}}unsubscribe(t){super.unsubscribe(t),this._listeners.size===0&&this.unsub&&(this.unsub(),this.unsub=void 0)}destroy(){this.unsub&&this.unsub()}};function ci(o,e){let t=o.path.split("/"),r=e.path.split("/");if(t.length===2&&r.length>2)return 1;if(r.length===2&&t.length>2)return-1;let s=Math.min(t.length,r.length);for(let n=0;n<s;n++)if(t[n]!==r[n]){if(n===t.length-1){let a=t[n].match(/\d+/g),i=r[n].match(/\d+/g);if(a&&i){let l=parseInt(a[0]),f=parseInt(i[0]);if(l!==f)return l-f}}return t[n].localeCompare(r[n])}return t.length-r.length}function Tx(o,e){let t=o.getText("contents"),r=t.toString(),s=new Cx.diff_match_patch,n=s.diff_main(r,e);s.diff_cleanupSemantic(n);let a=0,i=Pe("[updateYDocFromDiskBuffer]","debug");i("Updating YDoc:"),i("Current content length:",r.length),i("Disk buffer length:",e.length),n.length!=0&&(o.transact(()=>{for(let[l,f]of n)switch(l){case 1:i(`Inserting "${f}" at position ${a}`),t.insert(a,f),a+=f.length;break;case 0:i(`Keeping "${f}" (length: ${f.length})`),a+=f.length;break;case-1:i(`Deleting "${f}" at position ${a}`),t.delete(a,f.length);break}}),i("Update complete. New content length:",t.toString().length))}var Xl=class extends Ct{constructor(t,r,s,n=3){super();this.loginManager=t;this.timeProvider=r;this.sharedFolders=s;this.concurrency=n;this.activeSync=new ls;this.activeDownloads=new ls;this.syncGroups=new pr;this.syncQueue=[];this.downloadQueue=[];this.isProcessingSync=!1;this.isProcessingDownloads=!1;this.isPaused=!0;this.inProgressSyncs=new Set;this.inProgressDownloads=new Set;this.syncCompletionCallbacks=new Map;this.downloadCompletionCallbacks=new Map;this.loggedItems=new Map;this.subscriptions=[];this.start=this.resume;Et.set(this,"BackgroundSync"),this.timeProvider.setInterval(()=>{this.processSyncQueue(),this.processDownloadQueue()},1e3)}get pendingSyncs(){return this.syncQueue}get pendingDownloads(){return this.downloadQueue}getOverallProgress(){let t=0,r=0,s=0,n=0,a=0,i=0;this.syncGroups.forEach(d=>{t+=d.total,r+=d.completed,s+=d.syncs,n+=d.completedSyncs,a+=d.downloads,i+=d.completedDownloads});let l=t>0?r/t*100:0,f=s>0?n/s*100:0,u=a>0?i/a*100:0;return{totalPercent:Math.round(l),syncPercent:Math.round(f),downloadPercent:Math.round(u),totalItems:t,completedItems:r,syncItems:s,completedSyncs:n,downloadItems:a,completedDownloads:i}}getGroupProgress(t){let r=this.syncGroups.get(t);if(!r)return null;let s=r.total>0?r.completed/r.total*100:0,n=r.syncs>0?r.completedSyncs/r.syncs*100:0,a=r.downloads>0?r.completedDownloads/r.downloads*100:0;return{percent:Math.round(s),syncPercent:Math.round(n),downloadPercent:Math.round(a),sharedFolder:t,status:r.status}}getAllGroupsProgress(){let t=[];return this.syncGroups.forEach((r,s)=>{let n=this.getGroupProgress(s);n&&t.push(n)}),t}async processSyncQueue(){if(this.isPaused||this.isProcessingSync)return;this.isProcessingSync=!0;let t=this.syncQueue.filter(r=>r.sharedFolder.connected);for(;t.length>0&&this.activeSync.size<this.concurrency;){let r=t.shift();if(!r)break;this.syncQueue=this.syncQueue.filter(s=>s.guid!==r.guid),r.status="running",this.activeSync.add(r);try{let s=r.doc;await this.syncDocument(s),r.status="completed";let n=this.syncCompletionCallbacks.get(r.guid);n&&(n.resolve(),this.syncCompletionCallbacks.delete(r.guid));let a=this.syncGroups.get(r.sharedFolder);a&&(this.debug(`[Sync Progress] Before: completed=${a.completed}, total=${a.total}, syncs=${a.syncs}, completedSyncs=${a.completedSyncs}`),a.completedSyncs++,a.completed++,this.debug(`[Sync Progress] After: completed=${a.completed}, total=${a.total}, syncs=${a.syncs}, completedSyncs=${a.completedSyncs}`),a.completed===a.total&&(a.status="completed",this.debug("[Sync Progress] Group completed!")),this.syncGroups.set(r.sharedFolder,a))}catch(s){r.status="failed";let n=this.syncCompletionCallbacks.get(r.guid);n&&(n.reject(s instanceof Error?s:new Error(String(s))),this.syncCompletionCallbacks.delete(r.guid));let a=this.syncGroups.get(r.sharedFolder);a&&(this.error("[Sync Failed]",s),a.status="failed",this.syncGroups.set(r.sharedFolder,a))}finally{this.activeSync.delete(r),this.inProgressSyncs.delete(r.guid)}}this.isProcessingSync=!1,this.syncQueue.length>0&&!this.isPaused&&this.syncQueue.some(s=>s.sharedFolder.connected)&&this.processSyncQueue()}async processDownloadQueue(){if(this.isPaused||this.isProcessingDownloads)return;this.isProcessingDownloads=!0;let t=this.downloadQueue.filter(r=>r.sharedFolder.connected);for(;t.length>0&&this.activeDownloads.size<this.concurrency;){let r=t.shift();if(!r)break;this.downloadQueue=this.downloadQueue.filter(s=>s.guid!==r.guid),r.status="running",this.activeDownloads.add(r);try{await this.getDocument(r.doc),r.status="completed";let s=this.downloadCompletionCallbacks.get(r.guid);s&&(s.resolve(),this.downloadCompletionCallbacks.delete(r.guid));let n=this.syncGroups.get(r.sharedFolder);n&&(n.completedDownloads++,n.completed++,n.completed===n.total&&(n.status="completed"),this.syncGroups.set(r.sharedFolder,n))}catch(s){r.status="failed";let n=this.downloadCompletionCallbacks.get(r.guid);n&&(n.reject(s instanceof Error?s:new Error(String(s))),this.downloadCompletionCallbacks.delete(r.guid));let a=this.syncGroups.get(r.sharedFolder);a&&(a.status="failed",this.syncGroups.set(r.sharedFolder,a)),this.error("[processDownloadQueue]",s)}finally{this.activeDownloads.delete(r),this.inProgressDownloads.delete(r.guid)}}this.isProcessingDownloads=!1,this.downloadQueue.length>0&&!this.isPaused&&this.downloadQueue.some(s=>s.sharedFolder.connected)&&this.processDownloadQueue()}async enqueueSync(t){if(this.inProgressSyncs.has(t.guid)){this.debug(`[enqueueSync] Item ${t.guid} already in progress, skipping`);let i=this.syncCompletionCallbacks.get(t.guid);return i?new Promise((l,f)=>{i.resolve=l,i.reject=f}):(this.processSyncQueue(),Promise.resolve())}let r=t.sharedFolder,s={guid:t.guid,path:r.getPath(t.path),doc:t,status:"pending",sharedFolder:r},n=this.syncGroups.get(r);n?(n.total++,n.syncs++):n={sharedFolder:r,total:1,completed:0,status:"pending",downloads:0,syncs:1,completedDownloads:0,completedSyncs:0},this.syncGroups.set(r,n),this.inProgressSyncs.add(t.guid);let a=new Promise((i,l)=>{this.syncCompletionCallbacks.set(t.guid,{resolve:i,reject:l})});return this.syncQueue.push(s),this.syncQueue.sort(ci),this.processSyncQueue(),a}enqueueDownload(t){if(this.inProgressDownloads.has(t.guid)){this.debug(`[enqueueDownload] Item ${t.guid} already in progress, skipping`);let i=this.downloadCompletionCallbacks.get(t.guid);return i?(this.processDownloadQueue(),new Promise((l,f)=>{i.resolve=l,i.reject=f})):(this.processDownloadQueue(),Promise.resolve())}let r=t.sharedFolder,s=this.syncGroups.get(r);s||(s={sharedFolder:r,total:0,completed:0,status:"pending",downloads:0,syncs:0,completedDownloads:0,completedSyncs:0}),s.downloads++,s.total++,this.syncGroups.set(r,s);let n={guid:t.guid,path:r.getPath(t.path),doc:t,status:"pending",sharedFolder:r};this.inProgressDownloads.add(t.guid);let a=new Promise((i,l)=>{this.downloadCompletionCallbacks.set(t.guid,{resolve:i,reject:l})});return this.downloadQueue.push(n),this.downloadQueue.sort(ci),this.processDownloadQueue(),a}enqueueSharedFolderSync(t){let r=[...t.files.values()].filter(Oo),s={sharedFolder:t,total:r.length,completed:0,status:"pending",downloads:0,syncs:r.length,completedDownloads:0,completedSyncs:0};this.syncGroups.set(t,s);let n=[...r].sort(ci);for(let a of n)this.enqueueDocumentForGroupSync(a);s.status="running",this.syncGroups.set(t,s)}async enqueueDocumentForGroupSync(t){if(this.inProgressSyncs.has(t.guid)){this.debug(`[enqueueDocumentForGroupSync] Item ${t.guid} already in progress, skipping`);let a=this.syncCompletionCallbacks.get(t.guid);return a?(this.processSyncQueue(),new Promise((i,l)=>{a.resolve=i,a.reject=l})):Promise.resolve()}let r=t.sharedFolder,s={guid:t.guid,path:r.getPath(t.path),doc:t,status:"pending",sharedFolder:r};this.inProgressSyncs.add(t.guid);let n=new Promise((a,i)=>{this.syncCompletionCallbacks.set(t.guid,{resolve:a,reject:i})});return this.syncQueue.push(s),this.syncQueue.sort(ci),this.processSyncQueue(),n}getAuthHeader(t){var r;return{Authorization:Xe().enableDocumentServer?`Bearer ${t.token}`:`Bearer ${(r=this.loginManager.user)==null?void 0:r.token}`}}getBaseUrl(t,r){var i;let s=new URL(t.url);s.protocol="https:";let n=s.pathname.split("/");n.pop(),n.push(t.docId),s.pathname=n.join("/");let a=((i=t.baseUrl)==null?void 0:i.replace(/\/$/,""))||s.toString();return Xe().enableDocumentServer?a:`https://api.system3.md/relay/${r.relayId}/doc/${r.documentId}`}async downloadItem(t){let r=t.s3rn;if(this.log("[downloadItem]",t.path,`${Tt.encode(r)}`),!(r instanceof zr))throw new Error("Unable to decode S3RN");let s=await t.getProviderToken(),n=this.getAuthHeader(s),a=this.getBaseUrl(s,r),i=`${a}/as-update`,l=await(0,Jd.requestUrl)({url:i,method:"GET",headers:n});return l.status===200?this.debug("[downloadItem]",r.documentId,l.status):this.error("[downloadItem]",r.documentId,a,l.status,l.text),l}async syncDocumentWebsocket(t){let r=t.text,s="";try{s=await t.sharedFolder.read(t)}catch(l){}if(!(r===s)&&s)return this.log("file is not tracking local disk. resolve merge conflicts before syncing."),!1;let a=t.onceProviderSynced(),i=t.intent;return t.connect(),i==="disconnected"&&!t.userLock&&await a,i==="disconnected"&&!t.userLock&&(t.disconnect(),t.sharedFolder.tokenStore.removeFromRefreshQueue(Tt.encode(t.s3rn))),!0}async uploadItem(t){let r=t.s3rn;if(this.log("[uploadItem]",`${Tt.encode(r)}`),!(r instanceof zr))throw new Error("Unable to decode S3RN");if(!this.loginManager.loggedIn)throw new Error("Not logged in");let s=await t.getProviderToken(),n={"Content-Type":"application/octet-stream",...this.getAuthHeader(s)},a=Es(t.ydoc),l=`${this.getBaseUrl(s,r)}/update`,f=await(0,Jd.requestUrl)({url:l,method:"POST",headers:n,body:a.buffer,throw:!1});return f.status===200?this.debug("[uploadItem]",r.documentId,f.status,f.text):this.error("[uploadItem]",r.documentId,l,f.status,f.text),f}async getDocument(t,r=3,s=3e3){try{let n=t.text,a="";try{a=await t.sharedFolder.read(t)}catch(_){}let i=n===a,l=a!=="",u=(await this.downloadItem(t)).arrayBuffer,d=new Uint8Array(u),m=new yr;Mo(m,d);let y=m.getMap("users");if(m.getText("contents").toString()===""){if(y.size===0){this.log("[getDocument] Server contains uninitialized document. Waiting for peer to upload.",y.size,r,s),r>0&&this.timeProvider.setTimeout(()=>{this.getDocument(t,r-1,s*2)},s);return}if(t.text){this.log("[getDocument] local crdt has contents, but remote is empty"),this.enqueueSync(t);return}}if(this.log("[getDocument] applying content from server"),Mo(t.ydoc,d),l&&!i){this.log("Skipping flush - file requires merge conflict resolution.");return}t.sharedFolder.syncStore.has(t.path)&&(t.sharedFolder.flush(t,t.text),this.log("[getDocument] flushed"))}catch(n){throw this.error(n),n}}async syncItem(t){let r=t.text,s="";try{s=await t.sharedFolder.read(t)}catch(m){}if(!(r===s))return this.log("file is not tracking local disk. resolve merge conflicts before syncing."),!1;let a=await this.downloadItem(t);if(a.status!==200)return this.log("server returned an error."),!1;let i=a.arrayBuffer,l=new Uint8Array(i),f=new yr;Mo(f,l);let u=f.getText("contents").toString();return f.getMap("users").size>0&&u===r||(Mo(t.ydoc,l),t.sharedFolder.flush(t,t.text),this.uploadItem(t)),!0}async syncDocument(t){var r;try{Xe().enableHTTPSync&&((r=t.sharedFolder.remote)!=null&&r.relay.provider)?await this.syncItem(t):(this.debug("fallback to websocket sync"),await this.syncDocumentWebsocket(t))}catch(s){console.error(s);return}}subscribeToSync(t){return this.activeSync.subscribe(t)}subscribeToDownloads(t){return this.activeDownloads.subscribe(t)}subscribeToSyncGroups(t){return this.syncGroups.subscribe(t)}subscribeToProgress(t){let r=()=>{t(this.getOverallProgress())},s=this.activeSync.subscribe(()=>r()),n=this.activeDownloads.subscribe(()=>r()),a=this.syncGroups.subscribe(()=>r());return()=>{s(),n(),a()}}subscribeToGroupProgress(t,r){return this.syncGroups.subscribe(()=>{r(this.getGroupProgress(t))})}pause(){this.isPaused=!0}resume(){this.debug("starting"),this.isPaused=!1,this.processSyncQueue(),this.processDownloadQueue()}getQueueStatus(){return{syncsQueued:this.syncQueue.length,syncsActive:this.activeSync.size,downloadsQueued:this.downloadQueue.length,downloadsActive:this.activeDownloads.size,isPaused:this.isPaused}}destroy(){for(let[t,r]of this.syncCompletionCallbacks)r.reject(new Error("BackgroundSync destroyed")),this.syncCompletionCallbacks.delete(t);for(let[t,r]of this.downloadCompletionCallbacks)r.reject(new Error("BackgroundSync destroyed")),this.downloadCompletionCallbacks.delete(t);this.activeSync.destroy(),this.activeDownloads.destroy(),this.syncGroups.destroy(),this.syncQueue=[],this.downloadQueue=[],this.inProgressSyncs.clear(),this.inProgressDownloads.clear(),this.loggedItems.clear(),this.loginManager=null,this.timeProvider=null,this.subscriptions.forEach(t=>t())}};var Ql=class{constructor(e,t){this.app=e;this.difference=t.difference,this.file1=t.file1,this.file2=t.file2,this.file1Content=t.file1Content,this.file2Content=t.file2Content,this.triggerRebuild=t.triggerRebuild}async modify(e,t){if(e instanceof vt){Tx(e.ydoc,t);return}else if(e instanceof as){e.contents=t;return}await this.app.vault.modify(e,t)}build(e){let t=e.createDiv({cls:"flex flex-row gap-1 py-0-5"}),r=this.difference.file1Lines.length>0,s=this.difference.file2Lines.length>0;s&&r?(new dr({text:"Accept Top (Editor)",onClick:n=>this.acceptTopClick(n,this.difference)}).build(t),fo.build(t),new dr({text:"Accept Bottom (Local Disk)",onClick:n=>this.acceptBottomClick(n,this.difference)}).build(t),fo.build(t),new dr({text:"Accept All",onClick:n=>this.acceptAllClick(n,this.difference)}).build(t),fo.build(t),new dr({text:"Accept None",onClick:n=>this.acceptNoneClick(n,this.difference)}).build(t)):r?(new dr({text:"Keep in Editor",onClick:n=>this.insertFile1Difference(n,this.difference)}).build(t),fo.build(t),new dr({text:"Discard in Editor",onClick:n=>this.discardFile1Difference(n,this.difference)}).build(t)):s&&(new dr({text:"Accept from Local Disk",onClick:n=>this.insertFile2Difference(n,this.difference)}).build(t),fo.build(t),new dr({text:"Discard on Disk",onClick:n=>this.discardFile2Difference(n,this.difference)}).build(t))}async acceptTopClick(e,t){e.preventDefault();let r=t.file1Lines.join(`
`),s=ii({fullText:this.file2Content,newLine:r,position:t.file2Start,linesToReplace:t.file2Lines.length});await this.modify(this.file2,s),this.triggerRebuild()}async acceptBottomClick(e,t){e.preventDefault();let r=t.file2Lines.join(`
`),s=ii({fullText:this.file1Content,newLine:r,position:t.file1Start,linesToReplace:t.file1Lines.length});await this.modify(this.file1,s),this.triggerRebuild()}async acceptAllClick(e,t){e.preventDefault();let r=[...t.file1Lines,...t.file2Lines].join(`
`),s=ii({fullText:this.file1Content,newLine:r,position:t.file1Start,linesToReplace:t.file1Lines.length});await this.modify(this.file1,s);let n=ii({fullText:this.file2Content,newLine:r,position:t.file2Start,linesToReplace:t.file2Lines.length});await this.modify(this.file2,n),this.triggerRebuild()}async acceptNoneClick(e,t){e.preventDefault();let r=li({fullText:this.file1Content,position:t.file1Start,count:t.file1Lines.length});await this.modify(this.file1,r);let s=li({fullText:this.file2Content,position:t.file2Start,count:t.file2Lines.length});await this.modify(this.file2,s),this.triggerRebuild()}async insertFile1Difference(e,t){e.preventDefault();let r=t.file1Lines.join(`
`),s=jd({fullText:this.file2Content,newLine:r,position:t.file2Start});await this.modify(this.file2,s),this.triggerRebuild()}async insertFile2Difference(e,t){e.preventDefault();let r=t.file2Lines.join(`
`),s=jd({fullText:this.file1Content,newLine:r,position:t.file1Start});await this.modify(this.file1,s),this.triggerRebuild()}async discardFile1Difference(e,t){e.preventDefault();let r=li({fullText:this.file1Content,position:t.file1Start,count:t.file1Lines.length});await this.modify(this.file1,r),this.triggerRebuild()}async discardFile2Difference(e,t){e.preventDefault();let r=li({fullText:this.file2Content,position:t.file2Start,count:t.file2Lines.length});await this.modify(this.file2,r),this.triggerRebuild()}};var Yn="system3-differences-view";async function Ax(o,e){o.detachLeavesOfType(Yn);let t=o.getLeaf(!0);t.setViewState({type:Yn,active:!0,state:e}),o.revealLeaf(t)}var Zl=class extends Px.ItemView{constructor(t){super(t);this.file1Lines=[];this.file2Lines=[]}async getContent(t){return t instanceof vt?t.text:t instanceof as?t.contents:await this.app.vault.cachedRead(t)}getViewType(){return Yn}getDisplayText(){var t,r;return(t=this.state)!=null&&t.file1&&((r=this.state)!=null&&r.file2)?`File Diff: ${this.state.file1.name} and ${this.state.file2.name}`:"File Diff"}async setState(t,r){super.setState(t,r),this.state=t,await this.updateState(),this.build()}async onunload(){var t,r;(r=(t=this.state)==null?void 0:t.onResolve)==null||r.call(t)}async updateState(){var r,s;if(((r=this.state)==null?void 0:r.file1)==null||((s=this.state)==null?void 0:s.file2)==null)return;this.file1Content=await this.getContent(this.state.file1),this.file2Content=await this.getContent(this.state.file2),this.file1Lines=this.file1Content.concat(`
`).split(`
`).map(n=>n.trimEnd()),this.file2Lines=this.file2Content.concat(`
`).split(`
`).map(n=>n.trimEnd());let t=Lx(this.state.file1.path,this.state.file2.path,this.file1Lines.join(`
`),this.file2Lines.join(`
`));this.fileDifferences=Jl.fromParsedDiff(t),this.fileDifferences.differences.length===0&&this.leaf.detach()}build(){this.contentEl.empty();let t=this.contentEl.createDiv({cls:"file-diff__container"});this.buildHeader(t),this.buildLines(t),this.scrollToFirstDifference()}update(){let t=this.contentEl.scrollTop;this.contentEl.empty();let r=this.contentEl.createDiv({cls:"file-diff__container"});this.buildHeader(r),this.buildLines(r),this.contentEl.scrollTop=t}buildHeader(t){let r=t.createDiv({cls:"flex flex-row gap-1 py-0-5"});new dr({text:"Keep Editor Contents",onClick:async s=>{s.preventDefault(),await this.acceptAllFromLeft()}}).build(r),fo.build(r),new dr({text:"Accept All from Local Disk",onClick:async s=>{s.preventDefault(),await this.acceptAllFromRight()}}).build(r)}async acceptAllFromLeft(){!this.state||!this.fileDifferences||(await this.app.vault.modify(this.state.file2,this.file1Content||""),this.leaf.detach())}async acceptAllFromRight(){!this.state||!this.fileDifferences||(await this.app.vault.modify(this.state.file1,this.file2Content||""),this.leaf.detach())}buildLines(t){var a,i,l;let r=0,s=0,n=Math.max(((a=this.file1Lines)==null?void 0:a.length)||0,((i=this.file2Lines)==null?void 0:i.length)||0);for(;r<=n||s<=n;){let f=(l=this.fileDifferences)==null?void 0:l.differences.find(u=>u.file1Start===r&&u.file2Start===s);if(f!=null){let u=t.createDiv({cls:"difference"});this.buildDifferenceVisualizer(u,f),r+=f.file1Lines.length,s+=f.file2Lines.length}else{let u=r<=s?this.file1Lines[r]:this.file2Lines[s];t.createDiv({text:jn(u),cls:"file-diff__line"}),r+=1,s+=1}}}buildDifferenceVisualizer(t,r){var s;(s=this.state)!=null&&s.showMergeOption&&new Ql(this.app,{difference:r,file1:this.state.file1,file2:this.state.file2,file1Content:this.file1Content||"",file2Content:this.file2Content||"",triggerRebuild:async()=>{await this.updateState(),this.update()}}).build(t);for(let n=0;n<r.file1Lines.length;n+=1){let a=r.file1Lines[n],i=r.file2Lines[n],l=t.createDiv({cls:"file-diff__line file-diff__top-line__bg"}),f=this.buildDiffLine(a,i,"file-diff_top-line__character");(n<r.file1Lines.length-1||r.file2Lines.length!==0)&&l.classList.add("file-diff__no-bottom-border"),n!==0&&l.classList.add("file-diff__no-top-border"),l.appendChild(f)}for(let n=0;n<r.file2Lines.length;n+=1){let a=r.file1Lines[n],i=r.file2Lines[n],l=t.createDiv({cls:"file-diff__line file-diff__bottom-line__bg"}),f=this.buildDiffLine(i,a,"file-diff_bottom-line__character");(n==0&&r.file1Lines.length>0||n>0)&&l.classList.add("file-diff__no-top-border"),n<r.file2Lines.length-1&&l.classList.add("file-diff__no-bottom-border"),l.appendChild(f)}}buildDiffLine(t,r,s){let n=document.createElement("div");if(t!=null&&t.length===0)n.textContent=jn(t);else if(t!=null&&r!=null){let a=Ix(r,t);for(let i of a){if(i.removed)continue;let l=document.createElement("span");l.textContent=jn(i.value),i.added&&l.classList.add(s),n.appendChild(l)}}else if(t!=null&&r==null){let a=document.createElement("span");a.textContent=jn(t),a.classList.add(s),n.appendChild(a)}else n.textContent=jn(t);return n}scrollToFirstDifference(){var s;if(((s=this.fileDifferences)==null?void 0:s.differences.length)===0)return;let t=this.contentEl.getElementsByClassName("file-diff__container")[0].getBoundingClientRect(),r=this.contentEl.getElementsByClassName("difference")[0].getBoundingClientRect();this.contentEl.scrollTo({top:r.top-t.top-100,behavior:"smooth"})}};var iT=3;function Xd(o,e){o.iterateAllLeaves(t=>{t.view instanceof Jn.MarkdownView&&e(t.view)})}function lT(o,e){var t,r,s,n;if(o.length!==e.length)return!1;for(let a=0;a<o.length;a++)if(((t=o[a].view.file)==null?void 0:t.path)!==((r=e[a].view.file)==null?void 0:r.path)||((s=o[a].document)==null?void 0:s.path)!==((n=e[a].document)==null?void 0:n.path))return!1;return!0}var Qd=class{constructor(e,t,r){this.document=null;this.canConnect=!1;this._parent=e,this.view=t,this.login=r}attach(){return this.banner=new Kn(this.view,"Login to enable Live edits",async()=>await this.login()),Promise.resolve(this)}release(){var e;(e=this.banner)==null||e.destroy()}destroy(){this.release(),this.banner=void 0,this.view=null}};function No(o){return o instanceof ps&&o.document!==void 0&&o.document.text!==void 0}var ps=class{constructor(e,t,r,s=!0,n=!0){this._parent=e,this.view=t,this.document=r,this._tracking=!1,this.shouldConnect=s,this.canConnect=n,e.networkStatus.online||this.offlineBanner()}toggleConnection(){this.shouldConnect=!this.shouldConnect,this.shouldConnect?this.document.connect().then(e=>{e||(this.shouldConnect=!1)}):this.document.disconnect()}get tracking(){return this._tracking}set tracking(e){let t=this._tracking;this._tracking=e,this._tracking!==t&&this.attach()}get ytext(){return this.document.ytext}mergeBanner(){return this._banner=new Kn(this.view,"Merge conflict -- click to resolve",async()=>{let e=await this.document.diskBuffer();return await this.document.checkStale()&&this._parent.openDiffView({file1:this.document,file2:e,showMergeOption:!0,onResolve:async()=>{this.document.clearDiskBuffer()}}),!0}),()=>{}}offlineBanner(){if(this.shouldConnect){let e=new Kn(this.view,"You're offline -- click to reconnect",async()=>(this._parent.networkStatus.checkStatus(),this.connect(),this._parent.networkStatus.online));this._parent.networkStatus.onceOnline(()=>{this.connect(),e.destroy()})}return()=>{}}setConnectionDot(){let e=this.view.containerEl.querySelector(".view-actions");e&&e.firstChild&&(this._viewActions||(this.clearViewActions(),this.offConnectionStatusSubscription&&this.offConnectionStatusSubscription(),this._viewActions=new hx({target:e,anchor:e.firstChild,props:{view:this,state:this.document.state,remote:this.document.sharedFolder.remote}}),this.offConnectionStatusSubscription=this.document.subscribe(e,t=>{var r;(r=this._viewActions)==null||r.$set({view:this,state:t,remote:this.document.sharedFolder.remote})})),this._viewActions.$set({view:this,state:this.document.state,remote:this.document.sharedFolder.remote}))}clearViewActions(){let e=this.view.containerEl.querySelector(".view-actions");if(e&&e.firstChild){let t=this.view.containerEl.querySelectorAll(".system3-view-action");t.length>0&&t.forEach(r=>{r.remove()})}}async checkStale(){var t,r;let e=await this.document.checkStale();return e&&((t=this.document._diskBuffer)!=null&&t.contents)?this.mergeBanner():((r=this._banner)==null||r.destroy(),this._banner=void 0),e}attach(){return this.document.userLock=!0,this.setConnectionDot(),new Promise(e=>this.document.whenReady().then(t=>{this._parent.networkStatus.online&&this.document.sharedFolder.shouldConnect&&this.shouldConnect&&this.canConnect?this.connect():this.document.disconnect(),e(this)}).catch(()=>{this.offlineBanner()}))}connect(){this.document.connect()}release(){var e,t;(e=this._viewActions)==null||e.$destroy(),this._viewActions=void 0,(t=this._banner)==null||t.destroy(),this._banner=void 0,this.offConnectionStatusSubscription&&(this.offConnectionStatusSubscription(),this.offConnectionStatusSubscription=void 0),this.document.disconnect(),this.document.userLock=!1}destroy(){this.release(),this.clearViewActions(),this.view.leaf.rebuildView(),this._parent=null,this.view=null,this.document=null}},ec=class{constructor(e,t,r,s){this.app=e;this.destroyed=!1;this.offListeners=[];this.folderListeners=new Map;this.workspace=e.workspace,this.sharedFolders=t,this.views=[],this.extensions=[],this._activePromise=null,this.loginManager=r,this.networkStatus=s,this.refreshQueue=[],this._compartment=new tc.Compartment,this.log=Pe("[LiveViews]","log"),this.warn=Pe("[LiveViews]","warn"),this.metadataListeners=new Map;let n=(l,f,u)=>{let d=this.metadataListeners.get(l);d==null||d(f,u)},a=this.app.metadataCache.on("changed",n);this.offListeners.push(()=>{this.app.metadataCache.offref(a)}),this.offListeners.push(this.loginManager.on(()=>{this.refresh("[LoginManager]")}));let i=l=>(l.ready||(async()=>l.whenReady().then(()=>{this.refresh("[Shared Folder Ready]")}).catch(f=>{this.views.forEach(u=>{var d;((d=u.document)==null?void 0:d.sharedFolder)===l&&u.offlineBanner()})}))(),l.fset.on(()=>{this.refresh("[Docset]")}));this.offListeners.push(this.sharedFolders.subscribe(()=>{this.refresh("[Shared Folders]"),this.folderListeners.forEach((l,f)=>{this.sharedFolders.has(f)||(l(),this.folderListeners.delete(f))}),this.sharedFolders.forEach(l=>{this.folderListeners.has(l)||this.folderListeners.set(l,i(l))})})),Et.set(this,"LiveViewManager")}reconfigure(e){e.dispatch({effects:this._compartment.reconfigure([ds.init(()=>this)])})}onMeta(e,t){this.metadataListeners.set(e,t)}offMeta(e){this.metadataListeners.delete(e)}openDiffView(e){Ax(this.workspace,e)}goOffline(){this.log("[System 3][Relay][Live Views] going offline"),this.views.forEach(e=>{var t;return(t=e.document)==null?void 0:t.disconnect()}),this.refresh("[NetworkStatus]")}goOnline(){this.log("[System 3][Relay][Live Views] going online"),this.refresh("[NetworkStatus]"),this.sharedFolders.items().forEach(e=>{e.connect()}),this.viewsAttachedWithConnectionPool(this.views)}docIsOpen(e){return this.views.some(t=>t.document===e)}releaseViews(e){e.forEach(t=>{t.release()})}findFolders(){let e=new Set;return Xd(this.workspace,t=>{var n;let r=(n=t.file)==null?void 0:n.path;if(!r)return;let s=this.sharedFolders.lookup(r);s&&e.add(s)}),e.size==0?[]:[...e]}async foldersReady(){let e=new Set;if(Xd(this.workspace,r=>{var a;let s=(a=r.file)==null?void 0:a.path;if(!s)return;let n=this.sharedFolders.lookup(s);n&&e.add(n)}),e.size===0)return[];let t=[...e].map(r=>r.whenReady());return Promise.all(t)}async getViews(){let e=[];return Xd(this.workspace,async t=>{var n;let r=(n=t.file)==null?void 0:n.path;if(!r)return;let s=this.sharedFolders.lookup(r);if(s)if(this.loginManager.loggedIn)if(s.ready){let a=s.proxy.getDoc(r),i=new ps(this,t,a);e.push(i)}else this.log(`Folder not ready, skipping views. folder=${s.path}`);else{let a=new Qd(this,t,()=>this.loginManager.openLoginPage());e.push(a)}}),e}findView(e){return this.views.find(t=>t.view.editor.cm===e)}async viewsReady(e){return await Promise.all(e.filter(t=>t instanceof ps).map(async t=>t.document.whenReady().then(r=>t)))}async viewsAttachedWithConnectionPool(e,t=iT){let r=this.workspace.getActiveViewOfType(Jn.MarkdownView),s=0,n=e.sort((i,l)=>l.view.leaf.activeTime-i.view.leaf.activeTime),a=new Set;for(let i of n)i instanceof ps&&(i.view===r||a.has(i.document)?(i.canConnect=!0,a.add(i.document)):s<t?(i.canConnect=!0,a.add(i.document),s++):i.canConnect=!1);return s>t&&this.warn(`[System 3][Relay][Live Views] connection pool (max ${t}): rejected connections for ${s-t} views`),this.viewsAttached(e)}async viewsAttached(e){return await Promise.all(e.map(async t=>t.attach()))}deduplicate(e){let t=[],r=[];return this.views.forEach(s=>{let n=e.find(a=>{if(s.document==a.document&&s.view==a.view)return!0});n?(r.push(s),e.remove(n)):t.push(s)}),e.forEach(s=>{r.push(s)}),[r,t]}async _refreshViews(e,t){let r=`[LiveViews][${e}]`,s=Pe(r,"debug"),n=(d,m)=>{s(d,m.map(y=>{var h;return{type:y.constructor.name,file:(h=y.document)==null?void 0:h.path,canConnect:y.canConnect}}))};if(s("Refresh"),this.destroyed)return!1;await this.foldersReady();let a=[];try{a=await this.getViews()}catch(d){return this.warn("[System 3][Relay][Live Views] error getting views",d),!1}let i=this.findFolders();if(i.length===0&&a.length===0)return this.extensions.length!==0&&(s("Unexpected plugins loaded."),this.wipe()),n("Releasing Views",this.views),this.releaseViews(this.views),this.views=[],!0;this.loginManager.loggedIn&&this.networkStatus.online?i.forEach(d=>{d.connect()}):this.sharedFolders.forEach(d=>{d.disconnect()});let[l,f]=this.deduplicate(a);if(n("Releasing Views",f),this.releaseViews(f),f.length===0&&lT(l,this.views)){let d=await this.viewsAttachedWithConnectionPool(this.views);n("Attached Views",d)}else{let d=await this.viewsReady(l);n("Ready Views",d);let m=await this.viewsAttachedWithConnectionPool(d);n("Attached Views",m),this.views=l}s("loading plugins"),this.load();let u=Jn.moment.utc();return s(`refresh completed in ${u.diff(t)}ms`,r),!0}async refresh(e){if(this.destroyed)return!1;let t=Pe(e,"warn"),r=Jn.moment.utc();if(this.refreshQueue.push(()=>this._refreshViews(e,r)),this._activePromise!==null)return!1;for(;this.refreshQueue.length>0;){if(this.destroyed)return!1;this.refreshQueue.length>2&&t("refreshQueue size:",this.refreshQueue.length);let s=this.refreshQueue.pop();this.refreshQueue.length=0,this._activePromise=s().finally(()=>{this._activePromise=null}),await this._activePromise}return!0}wipe(){this.extensions.length=0,this.workspace.updateOptions()}load(){this.wipe(),this.views.length>0&&(this.extensions.push([this._compartment.of(ds.init(()=>this)),xx,bx,wx,vx]),this.workspace.updateOptions())}destroy(){this.destroyed=!0,this.releaseViews(this.views),this.offListeners.forEach(e=>e()),this.offListeners.length=0,this.metadataListeners.clear(),this.metadataListeners=null,this.folderListeners.forEach(e=>e()),this.folderListeners.clear(),this.folderListeners=null,this.views.forEach(e=>e.destroy()),this.views=[],this.wipe(),this.sharedFolders=null,this.refreshQueue=null,this.networkStatus=null,this._activePromise=null,this.loginManager=null,this.app=null,this.workspace=null}},ds=tc.StateField.define({create(o){},update(o,e){return o}});var Xn=require("obsidian");function cT(o){De(o,"svelte-1siabfk",".system3-folder-icons.svelte-1siabfk{display:inline-flex;align-items:center;vertical-align:middle;border-radius:var(--radius-m);transition:width 0.3s ease;margin-right:0.6em;padding-left:0.2em;padding-right:0.2em;background-color:var(--color-base-05);position:relative}.system3-icon.svelte-1siabfk{margin-right:0.2em;margin-left:0.2em;width:1em;display:flex;transition:display 0.3s ease}span.system3-connected.svelte-1siabfk{color:var(--color-accent)}span.system3-disconnected.svelte-1siabfk{color:var(--color-base-40)}span.notebook.svelte-1siabfk{color:var(--color-accent)}span.hidden.svelte-1siabfk{display:none}.system3-progress-text.svelte-1siabfk{margin-right:0.4em;font-size:0.8em;color:var(--color-accent);opacity:1;transition:opacity 0.3s ease}.system3-progress-text.completed.svelte-1siabfk{animation:svelte-1siabfk-fadeOutDelay 0.3s ease forwards}.system3-progress-text.failed.svelte-1siabfk{color:var(--color-red)}@keyframes svelte-1siabfk-fadeOutDelay{0%,50%{opacity:1}100%{opacity:0;display:none}}")}function Fx(o){let e,t,r,s;return{c(){e=T("span"),t=G(o[3]),r=G("%"),b(e,"class",s="system3-progress-text system3-"+o[4]+" svelte-1siabfk"),pe(e,"opacity","1")},m(n,a){C(n,e,a),S(e,t),S(e,r)},p(n,a){a&8&&ne(t,n[3]),a&16&&s!==(s="system3-progress-text system3-"+n[4]+" svelte-1siabfk")&&b(e,"class",s)},d(n){n&&L(e)}}}function fT(o){let e,t,r;return t=new Bo({props:{class:"inline-icon",style:"width: 0.8em"}}),{c(){e=T("span"),V(t.$$.fragment),b(e,"class","notebook system3-icon svelte-1siabfk"),b(e,"aria-label","Tracking Changes")},m(s,n){C(s,e,n),N(t,e,null),r=!0},p:X,i(s){r||(I(t.$$.fragment,s),r=!0)},o(s){P(t.$$.fragment,s),r=!1},d(s){s&&L(e),H(t)}}}function uT(o){let e,t,r,s,n,a,i,l;return t=new Bo({props:{class:"inline-icon",style:"width: 0.8em"}}),n=new Vs({props:{class:"inline-icon"}}),{c(){var f;e=T("span"),V(t.$$.fragment),r=$(),s=T("span"),V(n.$$.fragment),b(e,"class","notebook system3-icon hidden svelte-1siabfk"),b(e,"aria-label","Tracking Changes"),b(s,"class",a="satellite system3-icon system3-"+o[0]+" svelte-1siabfk"),b(s,"aria-label",i=`${((f=o[2])==null?void 0:f.relay.name)||"Relay Server"} (${o[0]})`)},m(f,u){C(f,e,u),N(t,e,null),C(f,r,u),C(f,s,u),N(n,s,null),l=!0},p(f,u){var d;(!l||u&1&&a!==(a="satellite system3-icon system3-"+f[0]+" svelte-1siabfk"))&&b(s,"class",a),(!l||u&5&&i!==(i=`${((d=f[2])==null?void 0:d.relay.name)||"Relay Server"} (${f[0]})`))&&b(s,"aria-label",i)},i(f){l||(I(t.$$.fragment,f),I(n.$$.fragment,f),l=!0)},o(f){P(t.$$.fragment,f),P(n.$$.fragment,f),l=!1},d(f){f&&(L(e),L(r),L(s)),H(t),H(n)}}}function dT(o){let e,t,r,s,n,a=o[5]&&Fx(o),i=[uT,fT],l=[];function f(u,d){return u[1]?0:1}return r=f(o,-1),s=l[r]=i[r](o),{c(){e=T("div"),a&&a.c(),t=$(),s.c(),b(e,"class","system3-folder-icons svelte-1siabfk")},m(u,d){C(u,e,d),a&&a.m(e,null),S(e,t),l[r].m(e,null),n=!0},p(u,[d]){u[5]?a?a.p(u,d):(a=Fx(u),a.c(),a.m(e,t)):a&&(a.d(1),a=null);let m=r;r=f(u,d),r===m?l[r].p(u,d):(we(),P(l[m],1,1,()=>{l[m]=null}),_e(),s=l[r],s?s.p(u,d):(s=l[r]=i[r](u),s.c()),I(s,1),s.m(e,null))},i(u){n||(I(s),n=!0)},o(u){P(s),n=!1},d(u){u&&L(e),a&&a.d(),l[r].d()}}}function pT(o,e,t){let r,{status:s="disconnected"}=e,{relayId:n}=e,{remote:a}=e,{progress:i=0}=e,{syncStatus:l="pending"}=e;return o.$$set=f=>{"status"in f&&t(0,s=f.status),"relayId"in f&&t(1,n=f.relayId),"remote"in f&&t(2,a=f.remote),"progress"in f&&t(3,i=f.progress),"syncStatus"in f&&t(4,l=f.syncStatus)},o.$$.update=()=>{if(o.$$.dirty&24){e:t(5,r=(l!=="completed"||i<100)&&i>0)}},[s,n,a,i,l,r]}var Zd=class extends Z{constructor(e){super(),te(this,e,pT,dT,Q,{status:0,relayId:1,remote:2,progress:3,syncStatus:4},cT)}},Dx=Zd;function mT(o){De(o,"svelte-1swndfj",".system3-filepill.svelte-1swndfj{text-wrap:nowrap}")}function hT(o){let e,t,r;return{c(){e=T("div"),t=T("span"),r=G(o[0]),b(e,"class","nav-file-tag system3-filepill svelte-1swndfj"),b(e,"aria-label",o[1])},m(s,n){C(s,e,n),S(e,t),S(t,r)},p(s,[n]){n&1&&ne(r,s[0]),n&2&&b(e,"aria-label",s[1])},i:X,o:X,d(s){s&&L(e)}}}function gT(o,e,t){let{text:r}=e,{label:s}=e;return o.$$set=n=>{"text"in n&&t(0,r=n.text),"label"in n&&t(1,s=n.label)},[r,s]}var ep=class extends Z{constructor(e){super(),te(this,e,gT,hT,Q,{text:0,label:1},mT)}},fi=ep;var tp=class{constructor(e,t){this.el=e,this.mutationObserver=new MutationObserver((r,s)=>{for(let n of r)n.type==="childList"&&e.nextSibling&&(t(e),s.disconnect())}),this.mutationObserver.observe(e.parentElement,{childList:!0,subtree:!0})}destroy(){var e;(e=this.mutationObserver)==null||e.disconnect(),this.mutationObserver=null}},qo=class{visitFolder(e,t,r,s){return null}visitFile(e,t,r,s){return null}},rp=class{constructor(e,t){this.el=e,this.sharedFolder=t,this.siblingWatcher=new tp(this.el,r=>{this.add()}),this.add()}add(){var e;(e=this.el.nextSibling)==null||e.addClass("system3-live")}remove(){var e;(e=this.el.nextSibling)==null||e.removeClass("system3-live")}destroy(){this.siblingWatcher.destroy(),this.remove()}},op=class extends qo{visitFolder(e,t,r,s){return s&&s.path===e.path?r||new rp(t.selfEl,s):(r&&r.destroy(),null)}},sp=class{constructor(e,t){this.sharedFolder=t;let r=e.querySelectorAll(".system3-folder-icons");r.length>1&&(r==null||r.forEach(n=>{n.remove()})),this.el=e,this.el.addClass("system3-pill"),this.pill=new Dx({target:this.el,props:{status:this.sharedFolder.state.status,relayId:this.sharedFolder.relayId,remote:this.sharedFolder.remote,progress:0,syncStatus:"pending"}});let s=[];s.push(this.sharedFolder.subscribe(this.el,n=>{this.pill.$set({status:n.status,relayId:this.sharedFolder.relayId,remote:this.sharedFolder.remote})})),s.push(this.sharedFolder.backgroundSync.subscribeToGroupProgress(this.sharedFolder,n=>{n&&this.pill.$set({progress:n.percent,syncStatus:n.status})})),this.unsubscribe=()=>s.forEach(n=>n())}destroy(){this.pill.$destroy(),this.unsubscribe(),this.el.removeClass("system3-pill")}},np=class extends qo{visitFolder(e,t,r,s){return s&&s.path===e.path?r||new sp(t.selfEl,s):(r&&r.destroy(),null)}},ap=class{constructor(e,t,r,s){this.el=e;this.path=t;this.activeSync=r;this.activeDownloads=s;this.unsubscribers=[];this.titleEl=e.querySelector(".nav-file-title")||e,this.unsubscribers.push(this.activeSync.subscribe(()=>this.checkStatus()),this.activeDownloads.subscribe(()=>this.checkStatus())),this.checkStatus()}checkStatus(){let e=this.activeSync.some(r=>r.path===this.path),t=this.activeDownloads.some(r=>r.path===this.path);e?this.titleEl.addClass("system3-syncing"):this.titleEl.removeClass("system3-syncing"),t?this.titleEl.addClass("system3-downloading"):this.titleEl.removeClass("system3-downloading")}destroy(){this.titleEl.removeClass("system3-uploading"),this.titleEl.removeClass("system3-downloading"),this.unsubscribers.forEach(e=>e())}},ip=class extends qo{constructor(t,r){super();this.activeSync=t;this.activeDownloads=r}visitFile(t,r,s,n){return n&&n.ready&&n.checkPath(t.path)&&vt.checkExtension(t.path)?s||new ap(r.el,t.path,this.activeSync,this.activeDownloads):(s&&s.destroy(),null)}},lp=class{constructor(e,t){this.el=e;this.file=t;if(this.el.querySelectorAll(".system3-filepill").forEach(r=>{r.remove()}),t instanceof vt){this.pill=new fi({target:this.el,props:{text:`${t.guid.slice(0,3)} ${t.dbsize}`}});let r=()=>{this.pill.$set({text:`${t.guid.slice(0,3)} ${t.dbsize}`})};t.whenReady().then(()=>{t.ydoc.on("update",r),r()}),this.unsubscribe=()=>{t.ydoc.off("update",r)}}else this.pill=new fi({target:this.el,props:{text:`${t.guid.slice(0,4)}`}})}destroy(){var e;this.pill.$destroy(),(e=this.unsubscribe)==null||e.call(this),this.el.querySelectorAll(".system3-filepill").forEach(t=>{t.remove()})}},cp=class extends qo{visitFile(e,t,r,s){if(s&&s.ready){if(!Xe().enableDebugFileTag)return null;let n=s.proxy.viewDoc(e.path);return!Oo(n)&&!n||!n.ready?null:r||new lp(t.selfEl,n)}return r&&r.destroy(),null}},fp=class{constructor(e){this.el=e;this.el.querySelectorAll(".system3-filepill").forEach(t=>{t.remove()}),this.pill=new fi({target:this.el,props:{text:"NOT SYNCED",label:"Syncing this file type is disabled"}})}destroy(){this.pill.$destroy(),this.el.querySelectorAll(".system3-filepill").forEach(e=>{e.remove()})}},up=class extends qo{visitFile(e,t,r,s){return s&&!s.isSyncableTFile(e)?r||new fp(t.selfEl):(r&&r.destroy(),null)}},dp=class{constructor(e,t,r){this.el=e,this.document=t,this.document.subscribe(e,s=>{this.docStatus(s)}),this.docStatus(this.document.state)}docStatus(e){(e==null?void 0:e.status)==="connected"?(this.el.removeClass("system3-connecting"),this.el.addClass("system3-connected"),this.el.addClass("system3-live")):(e==null?void 0:e.status)==="connecting"?(this.el.removeClass("system3-connected"),this.el.addClass("system3-connecting"),this.el.addClass("system3-live")):(e==null?void 0:e.status)==="disconnected"?(this.el.addClass("system3-live"),this.el.removeClass("system3-connected"),this.el.removeClass("system3-connecting")):(this.el.removeClass("system3-connected"),this.el.removeClass("system3-connecting"),this.el.removeClass("system3-live"))}destroy(){var e;(e=this.document)==null||e.unsubscribe(this.el),this.docStatus()}},pp=class extends qo{visitFile(e,t,r,s){if(s)try{let n=s.getVirtualPath(e.path),a=s.syncStore.get(n);if(!a)return null;let i=s.files.get(a);return!(i instanceof vt)||!i?null:r||new dp(t.el,i,e)}catch(n){return null}return r&&r.destroy(),null}},mp=class{constructor(e){this.el=e;this.el.querySelectorAll(".system3-filepill").forEach(t=>{t.remove()}),this.pill=new fi({target:this.el,props:{text:"DESYNC",label:"File content does not match document content"}})}destroy(){this.pill.$destroy(),this.el.querySelectorAll(".system3-filepill").forEach(e=>{e.remove()})}},hp=class extends qo{visitFile(e,t,r,s){if(s&&vt.checkExtension(e.path)){let n=s.proxy.viewDoc(e.path);if(!n||!n.ready)return null;if(e.stat.size!==n.stat.size)return r||new mp(t.selfEl)}return r&&r.destroy(),null}},rc=class{constructor(e,t,r){this.fileExplorer=e,this.sharedFolders=t,this.visitors=r,this.storage=new Map;for(let s of this.visitors)this.storage.set(s,new Map)}_getFileExplorerItem(e){try{return this.fileExplorer.view.fileItems[e]}catch(t){return null}}getFileExplorerItem(e,t){return typeof t=="string"?this._getFileExplorerItem(t):this._getFileExplorerItem(t.path)}walk(e,t){if(this.fileExplorer.view.getViewType()!=="file-explorer")return;let r=this.sharedFolders.find(n=>n.path===e.path)||t,s=this.getFileExplorerItem(this.fileExplorer,e);s&&this.storage.forEach((n,a)=>{let i=n.get(s),l=a.visitFolder(e,s,i,r);i&&!l?n.delete(s):l&&n.set(s,l)}),e.children.forEach(n=>{if(n instanceof Xn.TFolder)this.walk(n,r);else if(n instanceof Xn.TFile){let a=this.getFileExplorerItem(this.fileExplorer,n);if(!a)return;this.storage.forEach((i,l)=>{let f=i.get(a),u=l.visitFile(n,a,f,r);f&&!u?i.delete(a):u&&i.set(a,u)})}})}destroy(){this.storage.forEach(e=>{e.forEach(t=>{t.destroy()})})}},oc=class{constructor(e,t,r,s){this.layoutReady=!1;this.vault=e,this.workspace=t,this.sharedFolders=r,this.backgroundSync=s,this.treeState=new Map,this.workspace.onLayoutReady(()=>{this.layoutReady=!0,this.refresh()}),this.unsubscribes=[],this.unsubscribes.push(s.activeSync.subscribe(()=>this.quickRefresh()),s.activeDownloads.subscribe(()=>this.quickRefresh()),s.syncGroups.subscribe(()=>this.quickRefresh())),this.offDocumentListeners=new Map,this.offFolderListener=this.sharedFolders.subscribe(()=>{this.sharedFolders.forEach(n=>{Ty([Dr.enableDocumentStatus,Dr.enableDebugFileTag],()=>{this.offDocumentListeners.get(n)||this.offDocumentListeners.set(n,n.fset.on(()=>{this.refresh()}))}),n.whenReady().then(()=>{this.refresh()}),this.unsubscribes.push(n.syncSettingsManager.subscribe(a=>{this.quickRefresh()}))}),this.refresh()}),this.offLayoutChange=(()=>{let n=this.workspace.on("layout-change",()=>this.quickRefresh());return()=>{this.workspace.offref(n)}})()}makeVisitors(){let e=[];return e.push(new op),e.push(new np),lo(Dr.enableDocumentStatus,()=>{e.push(new pp),e.push(new ip(this.backgroundSync.activeSync,this.backgroundSync.activeDownloads))}),lo(Dr.enableDebugFileTag,()=>{e.push(new cp)}),lo(Dr.enableDesyncPill,()=>{e.push(new hp)}),e.push(new up),e}getFileExplorers(){let e=[];return this.workspace.iterateAllLeaves(t=>{t.view.getViewType()==="file-explorer"&&(e.includes(t)||e.push(t))}),e}quickRefresh(){if(!this.layoutReady)return;let e=this.getFileExplorers(),t=this.sharedFolders.map(r=>r.path);for(let r of e){let s=this.treeState.get(r)||new rc(r,this.sharedFolders,this.makeVisitors());this.treeState.set(r,s);for(let n of t){let a=this.vault.getAbstractFileByPath(n);a instanceof Xn.TFolder&&s.walk(a)}}}refresh(){if(!this.layoutReady)return;let e=this.getFileExplorers();for(let t of e){let r=this.treeState.get(t)||new rc(t,this.sharedFolders,this.makeVisitors());this.treeState.set(t,r);let s=this.vault.getAbstractFileByPath("/");s instanceof Xn.TFolder&&r.walk(s)}}destroy(){var e;(e=this.offFolderListener)==null||e.call(this),this.offDocumentListeners.forEach(t=>t()),this.offDocumentListeners.clear(),this.unsubscribes.forEach(t=>t()),this.unsubscribes.length=0,this.treeState.forEach(t=>{t.destroy()}),this.treeState.clear(),this.offLayoutChange(),this.vault=null,this.workspace=null,this.sharedFolders=null,this.backgroundSync=null,this.offFolderListener=null}};var Bb=require("obsidian");function Ge(o,e,t,r){function s(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function i(u){try{f(r.next(u))}catch(d){a(d)}}function l(u){try{f(r.throw(u))}catch(d){a(d)}}function f(u){u.done?n(u.value):s(u.value).then(i,l)}f((r=r.apply(o,e||[])).next())})}var ms=require("obsidian");function yT(o){let e,t,r;return{c(){e=Kr("svg"),t=Kr("g"),r=Kr("path"),b(r,"d","M216.856339,16.5966031 C200.285002,8.84328665 182.566144,3.2084988 164.041564,0 C161.766523,4.11318106 159.108624,9.64549908 157.276099,14.0464379 C137.583995,11.0849896 118.072967,11.0849896 98.7430163,14.0464379 C96.9108417,9.64549908 94.1925838,4.11318106 91.8971895,0 C73.3526068,3.2084988 55.6133949,8.86399117 39.0420583,16.6376612 C5.61752293,67.146514 -3.4433191,116.400813 1.08711069,164.955721 C23.2560196,181.510915 44.7403634,191.567697 65.8621325,198.148576 C71.0772151,190.971126 75.7283628,183.341335 79.7352139,175.300261 C72.104019,172.400575 64.7949724,168.822202 57.8887866,164.667963 C59.7209612,163.310589 61.5131304,161.891452 63.2445898,160.431257 C105.36741,180.133187 151.134928,180.133187 192.754523,160.431257 C194.506336,161.891452 196.298154,163.310589 198.110326,164.667963 C191.183787,168.842556 183.854737,172.420929 176.223542,175.320965 C180.230393,183.341335 184.861538,190.991831 190.096624,198.16893 C211.238746,191.588051 232.743023,181.531619 254.911949,164.955721 C260.227747,108.668201 245.831087,59.8662432 216.856339,16.5966031 Z M85.4738752,135.09489 C72.8290281,135.09489 62.4592217,123.290155 62.4592217,108.914901 C62.4592217,94.5396472 72.607595,82.7145587 85.4738752,82.7145587 C98.3405064,82.7145587 108.709962,94.5189427 108.488529,108.914901 C108.508531,123.290155 98.3405064,135.09489 85.4738752,135.09489 Z M170.525237,135.09489 C157.88039,135.09489 147.510584,123.290155 147.510584,108.914901 C147.510584,94.5396472 157.658606,82.7145587 170.525237,82.7145587 C183.391518,82.7145587 193.761324,94.5189427 193.539891,108.914901 C193.539891,123.290155 183.391518,135.09489 170.525237,135.09489 Z"),b(r,"fill","#5865F2"),b(r,"fill-rule","nonzero"),b(e,"width",o[0]),b(e,"height",o[0]),b(e,"viewBox","0 -28.5 256 256"),b(e,"version","1.1"),b(e,"xmlns","http://www.w3.org/2000/svg"),b(e,"xmlns:xlink","http://www.w3.org/1999/xlink"),b(e,"preserveAspectRatio","xMidYMid")},m(s,n){C(s,e,n),S(e,t),S(t,r)},p(s,[n]){n&1&&b(e,"width",s[0]),n&1&&b(e,"height",s[0])},i:X,o:X,d(s){s&&L(e)}}}function xT(o,e,t){let{size:r="1em"}=e;return o.$$set=s=>{"size"in s&&t(0,r=s.size)},[r]}var gp=class extends Z{constructor(e){super(),te(this,e,xT,yT,Q,{size:0})}},sc=gp;function bT(o){De(o,"svelte-4t8k3t",`.menu-container.svelte-4t8k3t{display:inline-block;position:relative}.menu-button.svelte-4t8k3t{box-shadow:none;padding:8px;border:none;background:transparent;color:var(--text-muted)}.menu-button.svelte-4t8k3t:hover{color:var(--icon-color-hover)}.menu-button.svelte-4t8k3t:focus{color:var(--icon-color-focus)}.menu-dropdown.svelte-4t8k3t{position:absolute;right:0;margin-top:8px;width:224px;background:var(--color-base-10);border-radius:6px;box-shadow:0 4px 6px -1px rgba(0, 0, 0, 0.1),
			0 2px 4px -1px rgba(0, 0, 0, 0.06);border:1px solid rgba(0, 0, 0, 0.1)}.arrow.svelte-4t8k3t{position:absolute;top:-5px;right:12px;width:10px;height:10px;background:var(--color-base-10);border-left:1px solid rgba(0, 0, 0, 0.1);border-top:1px solid rgba(0, 0, 0, 0.1);transform:rotate(45deg)}.menu-content.svelte-4t8k3t{display:flex;flex-direction:column;gap:8px;padding:8px}.menu-item.svelte-4t8k3t{display:flex;width:100%;align-items:center;gap:12px;padding:8px;border-radius:4px;text-decoration:none;color:var(--text-muted);transition:background-color 0.2s;font-size:14px}.menu-item.svelte-4t8k3t:hover{background-color:var(--background-modifier-hover)}.menu-item.svelte-4t8k3t:focus{background-color:var(--background-modifier-hover)}`)}function Mx(o){let e,t,r,s,n,a,i,l,f,u,d,m,y;return i=new sc({props:{size:20}}),{c(){e=T("div"),t=T("div"),r=$(),s=T("div"),n=T("span"),a=T("a"),V(i.$$.fragment),l=$(),f=T("span"),f.textContent="Join the community",b(t,"class","arrow svelte-4t8k3t"),b(a,"href","https://discord.system3.md"),b(a,"target","_blank"),b(a,"rel","noopener noreferrer"),b(a,"class","menu-item svelte-4t8k3t"),pe(n,"text-align","center"),pe(n,"display","flex"),b(s,"class","menu-content svelte-4t8k3t"),b(e,"class","menu-dropdown svelte-4t8k3t")},m(h,_){C(h,e,_),S(e,t),S(e,r),S(e,s),S(s,n),S(n,a),N(i,a,null),S(a,l),S(a,f),d=!0,m||(y=Zy(u=o[1].call(null,e)),m=!0)},i(h){d||(I(i.$$.fragment,h),d=!0)},o(h){P(i.$$.fragment,h),d=!1},d(h){h&&L(e),H(i),m=!1,y()}}}function wT(o){let e,t,r,s,n,a,i;r=new wd({props:{size:"20px"}});let l=o[0]&&Mx(o);return{c(){e=T("div"),t=T("button"),V(r.$$.fragment),s=$(),l&&l.c(),b(t,"class","menu-button svelte-4t8k3t"),b(e,"class","menu-container svelte-4t8k3t")},m(f,u){C(f,e,u),S(e,t),N(r,t,null),S(e,s),l&&l.m(e,null),n=!0,a||(i=ee(t,"click",sx(o[2])),a=!0)},p(f,[u]){f[0]?l?u&1&&I(l,1):(l=Mx(f),l.c(),I(l,1),l.m(e,null)):l&&(we(),P(l,1,1,()=>{l=null}),_e())},i(f){n||(I(r.$$.fragment,f),I(l),n=!0)},o(f){P(r.$$.fragment,f),P(l),n=!1},d(f){f&&L(e),H(r),l&&l.d(),a=!1,i()}}}function _T(o,e,t){let r=!1;function s(a){let i=l=>{let f=document.querySelector(".menu-button");!a.contains(l.target)&&l.target!==f&&!(f!=null&&f.contains(l.target))&&t(0,r=!1)};return setTimeout(()=>{document.addEventListener("click",i)},0),{destroy(){document.removeEventListener("click",i)}}}function n(a){a.stopPropagation(),t(0,r=!r)}return[r,s,n]}var yp=class extends Z{constructor(e){super(),te(this,e,_T,wT,Q,{},bT)}},Ex=yp;function vT(o){De(o,"svelte-ycfe1d",".relay-text.svelte-ycfe1d{fill:var(--text-normal)}")}function ST(o){let e,t;return{c(){e=Kr("svg"),t=Kr("path"),b(t,"d","m112.88679 65.94517c-1.8219-.6498-2.8316-1.9996-2.8205-3.7707.019-2.9692 4.2679-9.1564 8.5532-12.4538.8896-.6846 3.2865-2.0796 5.3264-3.1002l3.7089-1.8555 1.1034-2.1157c.6069-1.1636 1.0788-2.1403 1.0487-2.1704-.03-.03-.7517.2969-1.6037.7266-1.7893.9026-3.4923 1.0179-5.6348.3816-1.2664-.376-2.6971-1.5724-3.0511-2.5512-.1036-.2865-.2262-.2926-.6259-.031-1.6133 1.0551-3.9805 2.2931-5.3124 2.7783-3.2045 1.1672-7.1579.5507-8.5509-1.3335l-.5903-.7983-1.2238.7491c-3.1246 1.9126-7.5052 2.5576-9.6905 1.4268-1.3209-.6835-2.1336-1.8529-2.3663-3.405-.099-.6587-.2706-1.1976-.3819-1.1976-.1112 0-.4909.3082-.8437.685-1.1393 1.2168-4.3891 3.211-6.2437 3.8314-4.3168 1.4441-8.0424.1949-8.8532-2.9684-.1823-.7114-.3977-1.2593-.4786-1.2177-8.2088 4.2188-13.1666 5.5617-17.3451 4.6983-7.2318-1.4943-8.5363-7.633-3.2721-15.3969 3.43-5.0586 8.1226-8.1393 12.5368-8.2303 4.2661-.088 6.1851 2.8612 4.6067 7.0798-1.4639 3.9129-6.6553 7.7738-11.3995 8.4781l-1.2322.183-.173.9219c-.2449 1.3054.055 2.3726.8414 2.9909 1.4773 1.162 5.3481.4499 9.169-1.6869 4.0877-2.286 9.2494-6.7459 10.2254-8.8353 2.1729-4.6512 10.3391-19.4528 12.6199-22.8741 1.9649-2.9472 2.9544-3.913 4.6877-4.575 2.2454-.8575 3.8556.1204 3.8556 2.3418 0 1.0627-.8749 2.8756-5.2398 10.8581-4.5459 8.3134-10.5554 20.346-10.9601 21.9446-.372 1.4696-.093 1.8547 1.0954 1.5137 3.1691-.9088 8.5727-5.615 10.728-9.3431 3.192-5.5215 7.5241-8.5901 12.516-8.8657 1.3396-.074 2.6532.01 3.3914.2166 1.585.4437 3.5318 2.2009 3.7762 3.4083.1003.4954.3584.9822.5736 1.0817 1.6112.7453 1.9862 1.0047 2.0682 1.4307.051.2665-.9529 2.6236-2.2318 5.238-1.8799 3.8432-2.328 4.9899-2.3404 5.9886l-.015 1.2352.9261.077c1.132.094 3.2883-1.1349 5.6894-3.243 2.3304-2.0459 3.4794-3.659 6.2257-8.7403 1.3371-2.4739 2.6529-4.8096 2.924-5.1906.7068-.9931 1.8337-1.3742 3.6712-1.2413 1.7839.1291 2.6563.7039 2.6563 1.7502 0 .3631-1.6536 3.8273-3.6747 7.698-3.6147 6.9231-4.2241 8.2285-3.8408 8.2285.3864 0 2.6593-1.4351 4.2082-2.6571 2.9724-2.3449 4.1289-3.8334 6.7129-8.64 3.2167-5.9836 4.0513-6.6961 7.4599-6.3685 1.5037.1444 2.3637.7781 2.3637 1.7416 0 .6971-3.7642 8.1283-7.3844 14.5783-1.1774 2.0975-2.1406 3.9288-2.1406 4.0695 0 1.0032 6.4569-2.0079 10.373-4.8373 1.75083-1.265 2.80833-1.8553 3.32363-1.8553.8396 0 1.9138.8456 1.9138 1.5065 0 1.6136-6.83683 5.3607-15.31743 8.3952l-3.0144 1.0785-3.1147 4.959c-6.6125 10.5277-11.2414 15.4863-16.0267 17.1682-1.6492.5797-2.5036.6042-3.8855.1114zm3.4676-4.0874c2.3533-1.2035 5.0029-4.3759 7.0335-8.4211 1.4729-2.9341 1.2858-3.2801-1.0497-1.9405-2.6054 1.4944-6.0792 5.1835-7.6115 8.0833-1.3391 2.5343-.6792 3.458 1.6277 2.2783zm-13.7433-25.7067c2.0798-1.3888 2.707-2.2251 5.1929-6.9235 1.1337-2.1427 2.4702-4.3736 2.9701-4.9576.4999-.5839.8343-1.1823.7432-1.3297-.3028-.49-1.5733-.2724-2.9201.5001-3.9 2.237-10.6318 12.1845-9.2087 13.6076.4489.4489 1.7491.087 3.2226-.8969zm-39.6413-6.7383c1.4951-.7532 3.4914-2.3885 4.373-3.5822.8778-1.1886.8303-2.7169-.089-2.8472-.9504-.1348-2.84 1.147-4.3353 2.9408-1.4368 1.7237-2.8652 3.8321-2.8652 4.2293 0 .3431 1.5421-.048 2.916-.7407zm-15.7519 34.9397c-7.7618-1.6901-14.6809-7.6649-17.3519-14.9834-1.0082-2.7626-2.5946-8.8926-3.6898-14.2584-.7621-3.7334-1.4567-5.8195-2.0623-6.1938-.1258-.078-.173.4384-.1049 1.147l.1238 1.2883-2.6916 5.648c-3.9954 8.3841-5.3958 10.566-7.4555 11.6168-1.4222.7256-3.7417.6896-5.2712-.082-1.0729-.541-1.1779-.6797-1.1514-1.5213.017-.5465.8143-2.6067 1.945-5.0271 3.1568-6.7568 12.4018-25.1754 13.3068-26.5105 1.1089-1.6358 2.3136-2.186 4.3772-1.9989 1.8988.1722 3.7575 1.0556 3.7575 1.7858 0 .685-.9801 3.23-2.4839 6.4499-.6712 1.437-1.2203 2.6574-1.2203 2.712 0 .2508 2.423.059 3.8048-.3005 2.1083-.5492 3.5885-1.4764 5.2895-3.3138 2.9831-3.2221 3.5133-7.5609 1.1835-9.6842-3.8351-3.4952-12.7275-2.9971-21.5226 1.2055-6.4797 3.0962-10.7971 8.141-11.8606 13.8587-.5183 2.7868-1.354 3.618-2.8384 2.8236-2.234-1.1956-1.5337-5.997 1.651-11.3196 5.1483-8.6044 15.656-14.9768 26.6996-16.192 9.3582-1.0298 17.2345 3.5198 17.8697 10.322.3469 3.7147-1.5827 8.0493-5.1855 11.6487-2.6104 2.6078-4.969 3.9861-7.9877 4.6679l-1.94.4381.8512.2875c1.5709.5307 1.8619 1.0923 3.1019 5.988 2.5245 9.9665 4.9471 14.9264 9.4592 19.3659 6.055 5.9576 14.0611 6.1192 19.4354.3922.7131-.7598 2.2084-2.7055 3.323-4.3238 1.1145-1.6182 2.2218-3.0172 2.4606-3.1088 2.1176-.8126 2.9615 1.5236 1.6137 4.4675-2.2327 4.877-6.6161 9.1629-11.4944 11.2387-4.1481 1.7652-9.8251 2.3621-13.9414 1.4657z"),b(e,"class","relay-text svelte-ycfe1d"),b(e,"width",o[0]),b(e,"height",o[1]),b(e,"viewBox","0 0 154.24573 66.293579"),b(e,"xmlns","http://www.w3.org/2000/svg")},m(r,s){C(r,e,s),S(e,t)},p:X,i:X,o:X,d(r){r&&L(e)}}}function kT(o,e,t){let{size:r=64}=e,s=r,n=r/2;return o.$$set=a=>{"size"in a&&t(2,r=a.size)},[s,n,r]}var xp=class extends Z{constructor(e){super(),te(this,e,kT,ST,Q,{size:2},vT)}},nc=xp;function IT(o){De(o,"svelte-120r7kg",".subtitle.svelte-120r7kg{color:var(--text-muted);font-size:1.25rem;margin:0}.description.svelte-120r7kg{color:var(--text-muted);font-size:1rem;max-width:480px;margin:0}")}function LT(o){let e,t,r,s,n,a;return e=new nc({props:{size:140}}),{c(){V(e.$$.fragment),t=$(),r=T("p"),r.textContent="Real-time collaboration in Obsidian",s=$(),n=T("p"),n.textContent=`Share folders with your team, edit together in real time, and keep your
	knowledge library exactly how you want it.`,b(r,"class","subtitle svelte-120r7kg"),b(n,"class","description svelte-120r7kg")},m(i,l){N(e,i,l),C(i,t,l),C(i,r,l),C(i,s,l),C(i,n,l),a=!0},p:X,i(i){a||(I(e.$$.fragment,i),a=!0)},o(i){P(e.$$.fragment,i),a=!1},d(i){i&&(L(t),L(r),L(s),L(n)),H(e,i)}}}var bp=class extends Z{constructor(e){super(),te(this,e,null,LT,Q,{},IT)}},Rx=bp;var ac=require("obsidian");function CT(o){De(o,"svelte-1kvxms3",`.help-section.svelte-1kvxms3{width:100%;padding:0 2rem;margin-bottom:2rem}.footer.svelte-1kvxms3{padding:0 2rem;margin-bottom:2rem;text-align:center}.help-container.svelte-1kvxms3{position:relative;max-width:640px;margin:0 auto}.why-google.svelte-1kvxms3:hover{background-color:transparent !important;box-shadow:none;color:var(--text-modifier-hover)}.why-google.svelte-1kvxms3{outline:0;color:var(--text-muted);font-size:0.875rem;margin:0;background-color:transparent !important;box-shadow:none;text-decoration-line:var(--link-decoration);padding:0;border:none;cursor:pointer;width:100%;text-align:left}.why-google.svelte-1kvxms3:hover{color:var(--text-normal)}.help-content.svelte-1kvxms3{margin-top:8px;padding:12px 16px;background:var(--color-base-05);border-radius:4px;font-size:0.9em;color:var(--text-muted);box-shadow:inset 0 1px 3px rgba(0, 0, 0, 0.1);text-align:left}.popover.svelte-1kvxms3{position:absolute;z-index:50;width:256px;padding-left:1em;padding-right:1em;font-size:0.875rem;background-color:var(--background-primary);border:1px solid var(--background-modifier-border);border-radius:4px;box-shadow:var(--shadow-s);top:calc(100% + 8px);text-align:left;left:50%;transform:translateX(-50%);opacity:0;visibility:hidden;transition:opacity 0.3s ease,
			visibility 0.3s ease;transition-delay:0.1s}.popover.visible.svelte-1kvxms3{opacity:1;visibility:visible}.popover.svelte-1kvxms3:not(.visible){transition-delay:0s}.arrow.svelte-1kvxms3{position:absolute;width:8px;height:8px;background-color:var(--background-primary);border-top:1px solid var(--background-modifier-border);border-left:1px solid var(--background-modifier-border);transform:rotate(45deg);top:-5px;right:40px}.discord-link.svelte-1kvxms3{display:inline-flex;align-items:center;justify-content:center;gap:0.5rem;color:var(--text-muted);font-size:0.875rem;margin:0}`)}function TT(o){let e,t,r,s;return{c(){e=T("div"),t=T("div"),r=$(),s=T("p"),s.textContent=`${Ux}`,b(t,"class","arrow svelte-1kvxms3"),b(e,"class","popover svelte-1kvxms3"),Ve(e,"visible",o[0])},m(n,a){C(n,e,a),S(e,t),S(e,r),S(e,s),o[9](e)},p(n,a){a&1&&Ve(e,"visible",n[0])},d(n){n&&L(e),o[9](null)}}}function PT(o){let e,t=o[0]&&Ox(o);return{c(){t&&t.c(),e=Te()},m(r,s){t&&t.m(r,s),C(r,e,s)},p(r,s){r[0]?t?t.p(r,s):(t=Ox(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&L(e),t&&t.d(r)}}}function Ox(o){let e,t;return{c(){e=T("div"),t=T("p"),t.textContent=`${Ux}`,b(e,"class","help-content svelte-1kvxms3")},m(r,s){C(r,e,s),S(e,t)},p:X,d(r){r&&L(e)}}}function AT(o){let e,t,r,s,n,a,i,l,f,u,d,m;function y(w,v){return w[1]?PT:TT}let h=y(o,-1),_=h(o);return l=new sc({}),{c(){e=T("div"),t=T("div"),r=T("button"),r.textContent="Why sign in with Google?",s=$(),_.c(),n=$(),a=T("div"),i=T("a"),V(l.$$.fragment),f=G(`
		Join the project on Discord`),b(r,"class","why-google svelte-1kvxms3"),Ve(r,"mobile",o[1]),b(t,"class","help-container svelte-1kvxms3"),b(e,"class","help-section svelte-1kvxms3"),b(i,"href","https://discord.system3.md"),b(i,"class","discord-link svelte-1kvxms3"),b(a,"class","footer svelte-1kvxms3")},m(w,v){C(w,e,v),S(e,t),S(t,r),o[8](r),S(t,s),_.m(t,null),C(w,n,v),C(w,a,v),S(a,i),N(l,i,null),S(i,f),u=!0,d||(m=[ee(r,"mouseenter",o[4]),ee(r,"mouseleave",o[5]),ee(r,"click",o[6])],d=!0)},p(w,[v]){(!u||v&2)&&Ve(r,"mobile",w[1]),h===(h=y(w,v))&&_?_.p(w,v):(_.d(1),_=h(w),_&&(_.c(),_.m(t,null)))},i(w){u||(I(l.$$.fragment,w),u=!0)},o(w){P(l.$$.fragment,w),u=!1},d(w){w&&(L(e),L(n),L(a)),o[8](null),_.d(),H(l),d=!1,ke(m)}}}var Ux="We require sign-in because your vault needs to communicate securely with Relay servers for syncing. An identity provider like Google helps to prevent spam accounts. We may add more sign-in options based on user feedback \u2014 let us know in Discord.";function FT(o,e,t){var r;let s=!1,n=!1,a,i;function l(){n||t(0,s=!0)}function f(){n||t(0,s=!1)}function u(){n&&t(0,s=!s)}function d(y){Er[y?"unshift":"push"](()=>{a=y,t(2,a)})}function m(y){Er[y?"unshift":"push"](()=>{i=y,t(3,i)})}return o.$$.update=()=>{if(o.$$.dirty&128){e:t(1,n=t(7,r=ac.Platform===null||ac.Platform===void 0?void 0:ac.Platform.isMobile)!==null&&r!==void 0?r:!1)}},[s,n,a,i,l,f,u,r,d,m]}var wp=class extends Z{constructor(e){super(),te(this,e,FT,AT,Q,{},CT)}},$x=wp;var Bx=[{color:"#30bced",light:"#30bced33"},{color:"#6eeb83",light:"#6eeb8333"},{color:"#ffbc42",light:"#ffbc4233"},{color:"#ecd444",light:"#ecd44433"},{color:"#ee6352",light:"#ee635233"},{color:"#9ac2c9",light:"#9ac2c933"},{color:"#8acb88",light:"#8acb8833"},{color:"#1be7ff",light:"#1be7ff33"}],ic=class{constructor(e,t,r,s,n){this.id=e;this.name=t;this.email=r;this.picture=s;this.token=n;this.color=Bx[Sa()%Bx.length]}};function DT(o){De(o,"svelte-1ym1y1w",".avatar.svelte-1ym1y1w{position:relative;border-radius:50%;overflow:hidden;display:flex;align-items:center;justify-content:center;background-color:var(--color-base-30)}.initial.svelte-1ym1y1w{color:var(--text-on-accent)}img.svelte-1ym1y1w{width:100%;height:100%;object-fit:cover}")}function MT(o){let e,t;return{c(){e=T("span"),t=G(o[5]),b(e,"class","initial svelte-1ym1y1w"),pe(e,"font-size",o[4])},m(r,s){C(r,e,s),S(e,t)},p(r,s){s&32&&ne(t,r[5]),s&16&&pe(e,"font-size",r[4])},d(r){r&&L(e)}}}function ET(o){let e,t,r,s;return{c(){e=T("img"),zu(e.src,t=o[0].picture)||b(e,"src",t),b(e,"alt",o[1]),b(e,"class","svelte-1ym1y1w")},m(n,a){C(n,e,a),r||(s=ee(e,"error",o[6]),r=!0)},p(n,a){a&1&&!zu(e.src,t=n[0].picture)&&b(e,"src",t),a&2&&b(e,"alt",n[1])},d(n){n&&L(e),r=!1,s()}}}function RT(o){let e;function t(n,a){return!n[3]&&n[0].picture?ET:MT}let r=t(o,-1),s=r(o);return{c(){e=T("div"),s.c(),b(e,"class","avatar svelte-1ym1y1w"),pe(e,"width",o[2]),pe(e,"height",o[2])},m(n,a){C(n,e,a),s.m(e,null)},p(n,[a]){r===(r=t(n,a))&&s?s.p(n,a):(s.d(1),s=r(n),s&&(s.c(),s.m(e,null))),a&4&&pe(e,"width",n[2]),a&4&&pe(e,"height",n[2])},i:X,o:X,d(n){n&&L(e),s.d()}}}function OT(o){var e;return((e=o.match(/[a-z]+$/i))===null||e===void 0?void 0:e[0])||"px"}function UT(o,e,t){let r,s,n,{user:a}=e,{alt:i="Profile picture"}=e,{size:l="40px"}=e,f=!1;function u(){t(3,f=!0)}return o.$$set=d=>{"user"in d&&t(0,a=d.user),"alt"in d&&t(1,i=d.alt),"size"in d&&t(2,l=d.size)},o.$$.update=()=>{if(o.$$.dirty&1){e:t(5,r=a.name?a.name.charAt(0).toUpperCase():"?")}if(o.$$.dirty&4){e:t(7,s=OT(l))}if(o.$$.dirty&132){e:t(4,n=`${parseFloat(l)/2}${s}`)}},[a,i,l,f,n,r,u,s]}var _p=class extends Z{constructor(e){super(),te(this,e,UT,RT,Q,{user:0,alt:1,size:2},DT)}},Nx=_p;function $T(o){let e,t,r,s,n,a=(o[0].name||"")+"",i,l,f,u,d=(o[0].email||"")+"",m,y,h,_;t=new Nx({props:{size:"2.5em",user:o[0]}});let w=o[2].default,v=ge(w,o,o[1],null);return{c(){e=T("div"),V(t.$$.fragment),r=$(),s=T("div"),n=T("div"),i=G(a),l=$(),f=T("br"),u=$(),m=G(d),y=$(),h=T("div"),v&&v.c(),b(n,"class","setting-item-description"),b(s,"class","setting-item-info"),pe(s,"display","grid"),b(h,"class","setting-item-control"),b(e,"class","setting-item")},m(M,O){C(M,e,O),N(t,e,null),S(e,r),S(e,s),S(s,n),S(n,i),S(n,l),S(n,f),S(n,u),S(n,m),S(e,y),S(e,h),v&&v.m(h,null),_=!0},p(M,[O]){let A={};O&1&&(A.user=M[0]),t.$set(A),(!_||O&1)&&a!==(a=(M[0].name||"")+"")&&ne(i,a),(!_||O&1)&&d!==(d=(M[0].email||"")+"")&&ne(m,d),v&&v.p&&(!_||O&2)&&xe(v,w,M,M[1],_?ye(w,M[1],O,null):be(M[1]),null)},i(M){_||(I(t.$$.fragment,M),I(v,M),_=!0)},o(M){P(t.$$.fragment,M),P(v,M),_=!1},d(M){M&&L(e),H(t),v&&v.d(M)}}}function BT(o,e,t){let{$$slots:r={},$$scope:s}=e,{user:n}=e;return o.$$set=a=>{"user"in a&&t(0,n=a.user),"$$scope"in a&&t(1,s=a.$$scope)},[n,s,r]}var vp=class extends Z{constructor(e){super(),te(this,e,BT,$T,Q,{user:0})}},Hx=vp;var lc=require("obsidian");function NT(o){De(o,"svelte-5zjjwa",".help-container.svelte-5zjjwa{position:relative;display:inline-block}button.svelte-5zjjwa{display:flex;align-items:center;justify-content:center;width:24px;height:24px;padding:2px;margin:0;background:transparent;border:none;color:var(--text-muted);box-shadow:none;border-radius:50%}button.svelte-5zjjwa:hover{box-shadow:none;color:var(--icon-color-hover);opacity:var(--icon-opacity-hover);background-color:transparent;border-radius:0}button.svelte-5zjjwa:focus{outline:none;box-shadow:none;color:var(--icon-color-focus)}.popover.svelte-5zjjwa{position:absolute;z-index:50;width:256px;padding:8px;font-size:0.875rem;background-color:var(--background-primary);border:1px solid var(--background-modifier-border);border-radius:4px;box-shadow:var(--shadow-s);top:32px;transition-delay:0.1s}.popover.left.svelte-5zjjwa{right:100%;margin-right:8px}.popover.right.svelte-5zjjwa{left:0}.arrow.svelte-5zjjwa{position:absolute;width:8px;height:8px;background-color:var(--background-primary);border-top:1px solid var(--background-modifier-border);border-left:1px solid var(--background-modifier-border);transform:rotate(45deg);top:-5px}.arrow.left.svelte-5zjjwa{right:8px}.arrow.right.svelte-5zjjwa{left:8px}p.svelte-5zjjwa{margin:0;color:var(--text-normal)}")}function Vx(o){let e,t,r,s,n;return{c(){e=T("div"),t=T("div"),r=$(),s=T("p"),n=G(o[0]),b(t,"class","arrow svelte-5zjjwa"),Ve(t,"left",o[4]==="left"),Ve(t,"right",o[4]==="right"),b(s,"class","svelte-5zjjwa"),b(e,"class","popover svelte-5zjjwa"),Ve(e,"left",o[4]==="left"),Ve(e,"right",o[4]==="right")},m(a,i){C(a,e,i),S(e,t),S(e,r),S(e,s),S(s,n),o[9](e)},p(a,i){i&16&&Ve(t,"left",a[4]==="left"),i&16&&Ve(t,"right",a[4]==="right"),i&1&&ne(n,a[0]),i&16&&Ve(e,"left",a[4]==="left"),i&16&&Ve(e,"right",a[4]==="right")},d(a){a&&L(e),o[9](null)}}}function HT(o){let e,t,r,s,n,a,i;r=new ri({props:{size:16}});let l=o[1]&&Vx(o);return{c(){e=T("div"),t=T("button"),V(r.$$.fragment),s=$(),l&&l.c(),b(t,"type","button"),b(t,"class","svelte-5zjjwa"),b(e,"class","help-container svelte-5zjjwa")},m(f,u){C(f,e,u),S(e,t),N(r,t,null),o[8](t),S(e,s),l&&l.m(e,null),n=!0,a||(i=[ee(t,"mouseenter",o[5]),ee(t,"mouseleave",o[6]),ee(t,"click",o[7])],a=!0)},p(f,[u]){f[1]?l?l.p(f,u):(l=Vx(f),l.c(),l.m(e,null)):l&&(l.d(1),l=null)},i(f){n||(I(r.$$.fragment,f),n=!0)},o(f){P(r.$$.fragment,f),n=!1},d(f){f&&L(e),H(r),o[8](null),l&&l.d(),a=!1,ke(i)}}}function VT(o,e,t){let{helpText:r}=e,s=!1,n="right",a,i;function l(){t(1,s=!0)}function f(){t(1,s=!1)}function u(){t(1,s=!s)}function d(y){Er[y?"unshift":"push"](()=>{a=y,t(2,a)})}function m(y){Er[y?"unshift":"push"](()=>{i=y,t(3,i)})}return o.$$set=y=>{"helpText"in y&&t(0,r=y.helpText)},o.$$.update=()=>{if(o.$$.dirty&14){e:if(s&&a&&i){let y=a.getBoundingClientRect(),h=i.getBoundingClientRect(),_=window.innerWidth;t(4,n=y.right+h.width>_-20?"left":"right")}}},[r,s,a,i,n,l,f,u,d,m]}var Sp=class extends Z{constructor(e){super(),te(this,e,VT,HT,Q,{helpText:0},NT)}},qx=Sp;function qT(o){De(o,"svelte-1v3t6m3",".setting-item-name.svelte-1v3t6m3{display:flex;align-items:center;gap:8px}.help-button.svelte-1v3t6m3{display:flex;align-items:center;justify-content:center;width:24px;height:24px;padding:2px !important;margin:0;background:transparent;border:none;color:var(--text-muted);border-radius:50%;-webkit-tap-highlight-color:transparent}@media(hover: hover){.help-button.svelte-1v3t6m3:hover{box-shadow:none;color:var(--text-normal);background:transparent;border-radius:0}}.help-button.svelte-1v3t6m3:active{color:var(--text-normal)}.help-content.svelte-1v3t6m3{margin-top:8px;padding:12px 16px;background:var(--color-base-05);border-radius:4px;font-size:0.9em;color:var(--text-muted);box-shadow:inset 0 1px 3px rgba(0, 0, 0, 0.1)}p.svelte-1v3t6m3{margin:0}")}var WT=o=>({}),Wx=o=>({}),zT=o=>({}),zx=o=>({}),KT=o=>({}),Kx=o=>({});function GT(o){let e;return{c(){e=G(o[0])},m(t,r){C(t,e,r)},p(t,r){r&1&&ne(e,t[0])},d(t){t&&L(e)}}}function Gx(o){let e,t,r,s,n=[YT,jT],a=[];function i(l,f){return l[3]?0:1}return e=i(o,-1),t=a[e]=n[e](o),{c(){t.c(),r=Te()},m(l,f){a[e].m(l,f),C(l,r,f),s=!0},p(l,f){let u=e;e=i(l,f),e===u?a[e].p(l,f):(we(),P(a[u],1,1,()=>{a[u]=null}),_e(),t=a[e],t?t.p(l,f):(t=a[e]=n[e](l),t.c()),I(t,1),t.m(r.parentNode,r))},i(l){s||(I(t),s=!0)},o(l){P(t),s=!1},d(l){l&&L(r),a[e].d(l)}}}function jT(o){let e,t;return e=new qx({props:{helpText:o[1]}}),{c(){V(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let n={};s&2&&(n.helpText=r[1]),e.$set(n)},i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function YT(o){let e,t,r,s,n;return t=new ri({props:{size:16}}),{c(){e=T("button"),V(t.$$.fragment),b(e,"class","help-button svelte-1v3t6m3"),b(e,"aria-expanded",o[2])},m(a,i){C(a,e,i),N(t,e,null),r=!0,s||(n=ee(e,"click",o[4]),s=!0)},p(a,i){(!r||i&4)&&b(e,"aria-expanded",a[2])},i(a){r||(I(t.$$.fragment,a),r=!0)},o(a){P(t.$$.fragment,a),r=!1},d(a){a&&L(e),H(t),s=!1,n()}}}function JT(o){let e,t,r=o[7].description,s=ge(r,o,o[6],Wx);return{c(){e=T("div"),s&&s.c(),b(e,"class","setting-item-description")},m(n,a){C(n,e,a),s&&s.m(e,null),t=!0},p(n,a){s&&s.p&&(!t||a&64)&&xe(s,r,n,n[6],t?ye(r,n[6],a,WT):be(n[6]),Wx)},i(n){t||(I(s,n),t=!0)},o(n){P(s,n),t=!1},d(n){n&&L(e),s&&s.d(n)}}}function jx(o){let e,t,r;return{c(){e=T("div"),t=T("p"),r=G(o[1]),b(t,"class","svelte-1v3t6m3"),b(e,"class","help-content svelte-1v3t6m3"),Ve(e,"expanded",o[2])},m(s,n){C(s,e,n),S(e,t),S(t,r)},p(s,n){n&2&&ne(r,s[1]),n&4&&Ve(e,"expanded",s[2])},d(s){s&&L(e)}}}function XT(o){let e,t,r,s,n,a,i,l,f,u=o[7].name,d=ge(u,o,o[6],Kx),m=d||GT(o),y=o[1]&&Gx(o),h=o[7].description,_=ge(h,o,o[6],zx),w=_||JT(o),v=o[1]&&o[2]&&o[3]&&jx(o),M=o[7].default,O=ge(M,o,o[6],null);return{c(){e=T("div"),t=T("div"),r=T("div"),m&&m.c(),s=$(),y&&y.c(),n=$(),w&&w.c(),a=$(),v&&v.c(),i=$(),l=T("div"),O&&O.c(),b(r,"class","setting-item-name svelte-1v3t6m3"),b(t,"class","setting-item-info"),b(l,"class","setting-item-control"),b(e,"class","setting-item setting-item-heading")},m(A,E){C(A,e,E),S(e,t),S(t,r),m&&m.m(r,null),S(r,s),y&&y.m(r,null),S(t,n),w&&w.m(t,null),S(t,a),v&&v.m(t,null),S(e,i),S(e,l),O&&O.m(l,null),f=!0},p(A,[E]){d?d.p&&(!f||E&64)&&xe(d,u,A,A[6],f?ye(u,A[6],E,KT):be(A[6]),Kx):m&&m.p&&(!f||E&1)&&m.p(A,f?E:-1),A[1]?y?(y.p(A,E),E&2&&I(y,1)):(y=Gx(A),y.c(),I(y,1),y.m(r,null)):y&&(we(),P(y,1,1,()=>{y=null}),_e()),_?_.p&&(!f||E&64)&&xe(_,h,A,A[6],f?ye(h,A[6],E,zT):be(A[6]),zx):w&&w.p&&(!f||E&64)&&w.p(A,f?E:-1),A[1]&&A[2]&&A[3]?v?v.p(A,E):(v=jx(A),v.c(),v.m(t,null)):v&&(v.d(1),v=null),O&&O.p&&(!f||E&64)&&xe(O,M,A,A[6],f?ye(M,A[6],E,null):be(A[6]),null)},i(A){f||(I(m,A),I(y),I(w,A),I(O,A),f=!0)},o(A){P(m,A),P(y),P(w,A),P(O,A),f=!1},d(A){A&&L(e),m&&m.d(A),y&&y.d(),w&&w.d(A),v&&v.d(),O&&O.d(A)}}}function QT(o,e,t){let{$$slots:r={},$$scope:s}=e;var n;let{name:a=""}=e,{helpText:i=void 0}=e,l=!1,f=!1;function u(){f&&t(2,l=!l)}return o.$$set=d=>{"name"in d&&t(0,a=d.name),"helpText"in d&&t(1,i=d.helpText),"$$scope"in d&&t(6,s=d.$$scope)},o.$$.update=()=>{if(o.$$.dirty&32){e:t(3,f=t(5,n=lc.Platform===null||lc.Platform===void 0?void 0:lc.Platform.isMobile)!==null&&n!==void 0?n:!1)}},[a,i,l,f,u,n,s,r]}var kp=class extends Z{constructor(e){super(),te(this,e,QT,XT,Q,{name:0,helpText:1},qT)}},Je=kp;var Qn=[];function ZT(o,e){return{subscribe:ve(o,e).subscribe}}function ve(o,e=X){let t,r=new Set;function s(i){if(Q(o,i)&&(o=i,t)){let l=!Qn.length;for(let f of r)f[1](),Qn.push(f,o);if(l){for(let f=0;f<Qn.length;f+=2)Qn[f][0](Qn[f+1]);Qn.length=0}}}function n(i){s(i(o))}function a(i,l=X){let f=[i,l];return r.add(f),r.size===1&&(t=e(s,n)||X),i(o),()=>{r.delete(f),r.size===0&&t&&(t(),t=null)}}return{set:s,update:n,subscribe:a}}function uo(o,e,t){let r=!Array.isArray(o),s=r?[o]:o;if(!s.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");let n=e.length<2;return ZT(t,(a,i)=>{let l=!1,f=[],u=0,d=X,m=()=>{if(u)return;d();let h=e(r?f[0]:f,a,i);n?a(h):d=dt(h)?h:X},y=s.map((h,_)=>tr(h,w=>{f[_]=w,u&=~(1<<_),l&&m()},()=>{u|=1<<_}));return l=!0,m(),function(){ke(y),d(),l=!1}})}function eP(o){De(o,"svelte-xcpzqp",`.continue.svelte-xcpzqp{font-weight:600;font-size:larger;margin-top:0;margin-bottom:0px}.link.svelte-xcpzqp{color:var(--text-muted)}.link.svelte-xcpzqp:hover{color:var(--text-normal)}.not-working.svelte-xcpzqp{margin-top:0px;margin-bottom:0px;color:var(--text-faint);font-size:0.75em}.link-button.svelte-xcpzqp{box-shadow:none;background:none;border:none;padding:0;font:inherit;text-decoration:underline}button.link-button.svelte-xcpzqp:hover{box-shadow:none;color:var(--text-normal)}button.link.link-button.svelte-xcpzqp{height:auto;padding:0;color:var(--text-faint)}.welcome.svelte-xcpzqp{display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:7rem 2rem 1rem 2rem;max-width:640px;margin:0 auto;gap:2rem}.google-sign-in-button.svelte-xcpzqp{height:unset;padding:12px 16px 12px 42px !important;border:none;border-radius:3px;box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 1px 1px rgba(0, 0, 0, 0.25);color:var(--text-color);font-size:14px;font-weight:500;font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu,
			Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;background-image:url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48cGF0aCBkPSJNMTcuNiA5LjJsLS4xLTEuOEg5djMuNGg0LjhDMTMuNiAxMiAxMyAxMyAxMiAxMy42djIuMmgzYTguOCA4LjggMCAwIDAgMi42LTYuNnoiIGZpbGw9IiM0Mjg1RjQiIGZpbGwtcnVsZT0ibm9uemVybyIvPjxwYXRoIGQ9Ik05IDE4YzIuNCAwIDQuNS0uOCA2LTIuMmwtMy0yLjJhNS40IDUuNCAwIDAgMS04LTIuOUgxVjEzYTkgOSAwIDAgMCA4IDV6IiBmaWxsPSIjMzRBODUzIiBmaWxsLXJ1bGU9Im5vbnplcm8iLz48cGF0aCBkPSJNNCAxMC43YTUuNCA1LjQgMCAwIDEgMC0zLjRWNUgxYTkgOSAwIDAgMCAwIDhsMy0yLjN6IiBmaWxsPSIjRkJCQzA1IiBmaWxsLXJ1bGU9Im5vbnplcm8iLz48cGF0aCBkPSJNOSAzLjZjMS4zIDAgMi41LjQgMy40IDEuM0wxNSAyLjNBOSA5IDAgMCAwIDEgNWwzIDIuNGE1LjQgNS40IDAgMCAxIDUtMy43eiIgZmlsbD0iI0VBNDMzNSIgZmlsbC1ydWxlPSJub256ZXJvIi8+PHBhdGggZD0iTTAgMGgxOHYxOEgweiIvPjwvZz48L3N2Zz4=);background-color:var(--background-secondary);background-repeat:no-repeat;background-position:12px 11px}.google-sign-in-button.svelte-xcpzqp:hover{box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 2px 4px rgba(0, 0, 0, 0.25)}.google-sign-in-button.svelte-xcpzqp:disabled{cursor:unset;filter:grayscale(100%);box-shadow:0 -1px 0 rgba(0, 0, 0, 0.04),
			0 1px 1px rgba(0, 0, 0, 0.25)}`)}function tP(o){let e,t,r,s,n,a,i;t=new Rx({});function l(h,_){return h[3]?sP:oP}let f=l(o,[-1,-1]),u=f(o);function d(h,_){if(h[5])return aP;if(h[4])return nP}let m=d(o,[-1,-1]),y=m&&m(o);return a=new $x({}),{c(){e=T("div"),V(t.$$.fragment),r=$(),u.c(),s=$(),y&&y.c(),n=$(),V(a.$$.fragment),b(e,"class","welcome svelte-xcpzqp")},m(h,_){C(h,e,_),N(t,e,null),S(e,r),u.m(e,null),S(e,s),y&&y.m(e,null),C(h,n,_),N(a,h,_),i=!0},p(h,_){f===(f=l(h,_))&&u?u.p(h,_):(u.d(1),u=f(h),u&&(u.c(),u.m(e,s))),m===(m=d(h,_))&&y?y.p(h,_):(y&&y.d(1),y=m&&m(h),y&&(y.c(),y.m(e,null)))},i(h){i||(I(t.$$.fragment,h),I(a.$$.fragment,h),i=!0)},o(h){P(t.$$.fragment,h),P(a.$$.fragment,h),i=!1},d(h){h&&(L(e),L(n)),H(t),u.d(),y&&y.d(),H(a,h)}}}function rP(o){let e,t,r,s,n,a,i;e=new Je({props:{$$slots:{name:[lP],default:[iP]},$$scope:{ctx:o}}}),r=new Je({props:{name:"Account"}}),n=new Hx({props:{user:o[2].user,$$slots:{default:[cP]},$$scope:{ctx:o}}});let l=o[18].default,f=ge(l,o,o[25],null);return{c(){V(e.$$.fragment),t=$(),V(r.$$.fragment),s=$(),V(n.$$.fragment),a=$(),f&&f.c()},m(u,d){N(e,u,d),C(u,t,d),N(r,u,d),C(u,s,d),N(n,u,d),C(u,a,d),f&&f.m(u,d),i=!0},p(u,d){let m={};d[0]&33554432&&(m.$$scope={dirty:d,ctx:u}),e.$set(m);let y={};d[0]&4&&(y.user=u[2].user),d[0]&33554432&&(y.$$scope={dirty:d,ctx:u}),n.$set(y),f&&f.p&&(!i||d[0]&33554432)&&xe(f,l,u,u[25],i?ye(l,u[25],d,null):be(u[25]),null)},i(u){i||(I(e.$$.fragment,u),I(r.$$.fragment,u),I(n.$$.fragment,u),I(f,u),i=!0)},o(u){P(e.$$.fragment,u),P(r.$$.fragment,u),P(n.$$.fragment,u),P(f,u),i=!1},d(u){u&&(L(t),L(s),L(a)),H(e,u),H(r,u),H(n,u),f&&f.d(u)}}}function oP(o){let e,t,r,s,n;return{c(){e=T("a"),t=T("button"),r=G("Sign in with Google"),b(t,"class","google-sign-in-button svelte-xcpzqp"),t.disabled=o[4],b(e,"href",o[1]),b(e,"target","_blank")},m(a,i){C(a,e,i),S(e,t),S(t,r),s||(n=ee(t,"click",o[21]),s=!0)},p(a,i){i[0]&16&&(t.disabled=a[4]),i[0]&2&&b(e,"href",a[1])},d(a){a&&L(e),s=!1,n()}}}function sP(o){let e,t,r,s;return{c(){e=T("button"),t=G("Sign in with Google"),b(e,"class","google-sign-in-button svelte-xcpzqp"),e.disabled=o[4]},m(n,a){C(n,e,a),S(e,t),r||(s=ee(e,"click",(0,ms.debounce)(o[20])),r=!0)},p(n,a){a[0]&16&&(e.disabled=n[4])},d(n){n&&L(e),r=!1,s()}}}function nP(o){let e,t,r,s,n,a,i,l;return{c(){e=T("div"),t=T("p"),t.textContent="Continue in your browser...",r=$(),s=T("p"),n=G(`Not working?
					`),a=T("button"),a.textContent="(try again)",b(t,"class","continue svelte-xcpzqp"),b(a,"class","link link-button svelte-xcpzqp"),b(s,"class","not-working svelte-xcpzqp")},m(f,u){C(f,e,u),S(e,t),S(e,r),S(e,s),S(s,n),S(s,a),i||(l=ee(a,"click",o[24]),i=!0)},p:X,d(f){f&&L(e),i=!1,l()}}}function aP(o){let e,t,r,s,n,a,i,l,f,u,d,m=o[6]&&Yx(o);return{c(){e=T("p"),t=G(o[5]),r=G("."),s=T("br"),n=$(),m&&m.c(),a=$(),i=T("p"),l=G(`Not working?
				`),f=T("button"),f.textContent="(try again)",b(f,"class","link link-button svelte-xcpzqp"),b(i,"class","not-working svelte-xcpzqp")},m(y,h){C(y,e,h),S(e,t),S(e,r),S(e,s),S(e,n),m&&m.m(e,null),C(y,a,h),C(y,i,h),S(i,l),S(i,f),u||(d=ee(f,"click",o[23]),u=!0)},p(y,h){h[0]&32&&ne(t,y[5]),y[6]?m?m.p(y,h):(m=Yx(y),m.c(),m.m(e,null)):m&&(m.d(1),m=null)},d(y){y&&(L(e),L(a),L(i)),m&&m.d(),u=!1,d()}}}function Yx(o){let e,t,r,s;return{c(){e=G("Already logged in? "),t=T("button"),t.textContent="(click here)",b(t,"class","link link-button svelte-xcpzqp")},m(n,a){C(n,e,a),C(n,t,a),r||(s=ee(t,"click",(0,ms.debounce)(o[22])),r=!0)},p:X,d(n){n&&(L(e),L(t)),r=!1,s()}}}function iP(o){let e,t;return e=new Ex({}),{c(){V(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function lP(o){let e,t;return e=new nc({props:{slot:"name"}}),{c(){V(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p:X,i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function cP(o){let e,t,r;return{c(){e=T("button"),e.textContent="Logout"},m(s,n){C(s,e,n),t||(r=ee(e,"click",(0,ms.debounce)(o[19])),t=!0)},p:X,d(s){s&&L(e),t=!1,r()}}}function fP(o){let e,t,r,s,n=[rP,tP],a=[];function i(l,f){return l[2].hasUser&&l[2].user?0:1}return e=i(o,[-1,-1]),t=a[e]=n[e](o),{c(){t.c(),r=Te()},m(l,f){a[e].m(l,f),C(l,r,f),s=!0},p(l,f){let u=e;e=i(l,f),e===u?a[e].p(l,f):(we(),P(a[u],1,1,()=>{a[u]=null}),_e(),t=a[e],t?t.p(l,f):(t=a[e]=n[e](l),t.c()),I(t,1),t.m(r.parentNode,r))},i(l){s||(I(t),s=!0)},o(l){P(t),s=!1},d(l){l&&L(r),a[e].d(l)}}}function uP(o,e,t){let r,s,n,a=X,i=()=>(a(),a=tr(_,fe=>t(2,n=fe)),_),l,f,u,d;o.$$.on_destroy.push(()=>a());let{$$slots:m={},$$scope:y}=e,{plugin:h}=e,_,w=ve(!ms.Platform.isIosApp);he(o,w,fe=>t(3,l=fe));let v=ve(!1);he(o,v,fe=>t(4,f=fe)),i(_=h.loginManager);let M=ve(!1);he(o,M,fe=>t(6,d=fe));let O=ve(!1),A=ve(!0);he(o,A,fe=>t(28,r=fe));let E=ve("please wait...");he(o,E,fe=>t(1,s=fe));let R,F,D=ve("");he(o,D,fe=>t(5,u=fe));function B(){return Ge(this,void 0,void 0,function*(){h.loginManager.logout(),O.set(!1),M.set(!1)})}function q(){return Ge(this,void 0,void 0,function*(){try{yield h.loginManager.login()}catch(fe){w.set(!1),O.set(!1),s&&s!=="please wait..."&&(window.open(s,"_blank"),W())}})}let J=ve(h.loginManager.pb);function K(){J.set(h.loginManager.pb)}function z(){try{let fe=r?Pt:fetch;R=void 0,E.set("please wait..."),_.initiateManualOAuth2CodeFlow(fe).then(([oe,Be,At])=>{R=Be,F=At,E.set(oe)}).catch(oe=>{let Be=oe.message;throw Be=Be,D.set(Be),O.set(!1),oe})}catch(fe){D.set(fe.message)}}or(()=>{O.set(!1),z()});function W(){return Ge(this,void 0,void 0,function*(){if(!(!R||!F))return yield h.loginManager.poll(R,F).then(fe=>{O.set(!0),v.set(!1),D.set("")}).catch(fe=>{M.set(!0),v.set(!1),O.set(!1),D.set(fe.message)})})}function re(fe){let oe=fe.target;oe.focus(),oe.select(),navigator.clipboard.writeText(oe.value).then(()=>new ms.Notice("Invite link copied")).catch(Be=>{}),W()}let Le=()=>{B()},le=async()=>{v.set(!0),await q()},Ce=()=>{v.set(!0),W()},Ke=()=>{W()},Re=()=>{v.set(!1),w.set(!1),D.set(""),z()},de=()=>{v.set(!1),w.set(!1)};return o.$$set=fe=>{"plugin"in fe&&t(17,h=fe.plugin),"$$scope"in fe&&t(25,y=fe.$$scope)},[_,s,n,l,f,u,d,w,v,M,A,E,D,B,q,z,W,h,m,Le,le,Ce,Ke,Re,de,y]}var Ip=class extends Z{constructor(e){super(),te(this,e,uP,fP,Q,{plugin:17},eP,[-1,-1])}},Jx=Ip;function Xx(o,e,t){let r=o.slice();return r[5]=e[t],r}var dP=o=>({}),Qx=o=>({}),pP=o=>({}),Zx=o=>({});function mP(o){let e;return{c(){e=G(o[0])},m(t,r){C(t,e,r)},p(t,r){r&1&&ne(e,t[0])},d(t){t&&L(e)}}}function hP(o){let e,t=Ae(o[1]),r=[];for(let s=0;s<t.length;s+=1)r[s]=eb(Xx(o,t,s));return{c(){for(let s=0;s<r.length;s+=1)r[s].c();e=Te()},m(s,n){for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(s,n);C(s,e,n)},p(s,n){if(n&2){t=Ae(s[1]);let a;for(a=0;a<t.length;a+=1){let i=Xx(s,t,a);r[a]?r[a].p(i,n):(r[a]=eb(i),r[a].c(),r[a].m(e.parentNode,e))}for(;a<r.length;a+=1)r[a].d(1);r.length=t.length}},d(s){s&&L(e),tt(r,s)}}}function eb(o){let e;return{c(){e=T("div"),e.textContent=`${o[5]} `},m(t,r){C(t,e,r)},p:X,d(t){t&&L(e)}}}function gP(o){let e,t=o[1].length>0&&hP(o);return{c(){t&&t.c(),e=Te()},m(r,s){t&&t.m(r,s),C(r,e,s)},p(r,s){r[1].length>0&&t.p(r,s)},d(r){r&&L(e),t&&t.d(r)}}}function yP(o){let e,t,r,s,n,a,i,l,f=o[4].name,u=ge(f,o,o[3],Zx),d=u||mP(o),m=o[4].description,y=ge(m,o,o[3],Qx),h=y||gP(o),_=o[4].default,w=ge(_,o,o[3],null);return{c(){e=T("div"),t=T("div"),r=T("div"),d&&d.c(),s=$(),n=T("div"),h&&h.c(),a=$(),i=T("div"),w&&w.c(),b(r,"class","setting-item-name"),pe(r,"display","grid"),pe(r,"align-items","center"),b(n,"class","setting-item-description"),b(t,"class","setting-item-info"),pe(t,"display","grid"),b(i,"class","setting-item-control"),b(e,"class","setting-item")},m(v,M){C(v,e,M),S(e,t),S(t,r),d&&d.m(r,null),S(t,s),S(t,n),h&&h.m(n,null),S(e,a),S(e,i),w&&w.m(i,null),l=!0},p(v,[M]){u?u.p&&(!l||M&8)&&xe(u,f,v,v[3],l?ye(f,v[3],M,pP):be(v[3]),Zx):d&&d.p&&(!l||M&1)&&d.p(v,l?M:-1),y&&y.p&&(!l||M&8)&&xe(y,m,v,v[3],l?ye(m,v[3],M,dP):be(v[3]),Qx),w&&w.p&&(!l||M&8)&&xe(w,_,v,v[3],l?ye(_,v[3],M,null):be(v[3]),null)},i(v){l||(I(d,v),I(h,v),I(w,v),l=!0)},o(v){P(d,v),P(h,v),P(w,v),l=!1},d(v){v&&L(e),d&&d.d(v),h&&h.d(v),w&&w.d(v)}}}function xP(o,e,t){let{$$slots:r={},$$scope:s}=e,{name:n=""}=e,{description:a}=e,i=a!==void 0?a.split(`
`):[];return o.$$set=l=>{"name"in l&&t(0,n=l.name),"description"in l&&t(2,a=l.description),"$$scope"in l&&t(3,s=l.$$scope)},[n,i,a,s,r]}var Lp=class extends Z{constructor(e){super(),te(this,e,xP,yP,Q,{name:0,description:2})}},$e=Lp;function bP(o){De(o,"svelte-tyruzk",".setting-item-control.svelte-tyruzk{width:unset !important;margin-top:unset !important}.setting-item.svelte-tyruzk{flex-direction:unset !important;align-items:flex-start}.setting-item-info.svelte-tyruzk{min-width:0;margin-top:auto;margin-bottom:auto}.setting-item-name.svelte-tyruzk{min-width:0}.truncate.svelte-tyruzk *{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}")}var wP=o=>({}),tb=o=>({}),_P=o=>({}),rb=o=>({});function vP(o){let e;return{c(){e=G(o[0])},m(t,r){C(t,e,r)},p(t,r){r&1&&ne(e,t[0])},d(t){t&&L(e)}}}function SP(o){let e,t,r,s,n,a,i,l=o[2].name,f=ge(l,o,o[1],rb),u=f||vP(o),d=o[2].description,m=ge(d,o,o[1],tb),y=o[2].default,h=ge(y,o,o[1],null);return{c(){e=T("div"),t=T("div"),r=T("div"),u&&u.c(),s=$(),m&&m.c(),n=$(),a=T("div"),h&&h.c(),b(r,"class","setting-item-name truncate svelte-tyruzk"),b(t,"class","setting-item-info svelte-tyruzk"),b(a,"class","setting-item-control svelte-tyruzk"),b(e,"class","setting-item svelte-tyruzk")},m(_,w){C(_,e,w),S(e,t),S(t,r),u&&u.m(r,null),S(e,s),m&&m.m(e,null),S(e,n),S(e,a),h&&h.m(a,null),i=!0},p(_,[w]){f?f.p&&(!i||w&2)&&xe(f,l,_,_[1],i?ye(l,_[1],w,_P):be(_[1]),rb):u&&u.p&&(!i||w&1)&&u.p(_,i?w:-1),m&&m.p&&(!i||w&2)&&xe(m,d,_,_[1],i?ye(d,_[1],w,wP):be(_[1]),tb),h&&h.p&&(!i||w&2)&&xe(h,y,_,_[1],i?ye(y,_[1],w,null):be(_[1]),null)},i(_){i||(I(u,_),I(m,_),I(h,_),i=!0)},o(_){P(u,_),P(m,_),P(h,_),i=!1},d(_){_&&L(e),u&&u.d(_),m&&m.d(_),h&&h.d(_)}}}function kP(o,e,t){let{$$slots:r={},$$scope:s}=e,{name:n=""}=e;return o.$$set=a=>{"name"in a&&t(0,n=a.name),"$$scope"in a&&t(1,s=a.$$scope)},[n,s,r]}var Cp=class extends Z{constructor(e){super(),te(this,e,kP,SP,Q,{name:0},bP)}},mr=Cp;function IP(o){De(o,"svelte-y529x8",".extra-setting-button.svelte-y529x8:focus{outline:none;box-shadow:none;color:var(--icon-color-focus)}.extra-setting-button.svelte-y529x8:hover{box-shadow:none;opacity:var(--icon-opacity-hover);color:var(--icon-color-hover);background-color:var(--background-modifier-hover)}")}function LP(o){let e,t,r,s,n;return t=new Pd({props:{class:"svg-icon lucide-settings",props:{class:"svg-icon lucide-settings"}}}),{c(){e=T("div"),V(t.$$.fragment),b(e,"class","clickable-icon extra-setting-button svelte-y529x8"),b(e,"aria-label","Options"),b(e,"role","button"),b(e,"tabindex","0")},m(a,i){C(a,e,i),N(t,e,null),r=!0,s||(n=[ee(e,"click",o[0]),ee(e,"keydown",o[0])],s=!0)},p:X,i(a){r||(I(t.$$.fragment,a),r=!0)},o(a){P(t.$$.fragment,a),r=!1},d(a){a&&L(e),H(t),s=!1,ke(n)}}}function CP(o){let e=Ht();function t(r){(r instanceof MouseEvent||r instanceof KeyboardEvent&&(r.key==="Enter"||r.key===" "))&&e("settings")}return[t]}var Tp=class extends Z{constructor(e){super(),te(this,e,CP,LP,Q,{},IP)}},qs=Tp;function TP(o){let e,t,r,s,n,a;t=new Vs({props:{class:"svg-icon",style:"margin-right: .2em; flex-shrink: 0;"}});let i=o[3].default,l=ge(i,o,o[2],null);return{c(){e=T("span"),V(t.$$.fragment),r=$(),l&&l.c(),b(e,"role","button"),b(e,"tabindex","0"),pe(e,"display","flex"),pe(e,"align-items","center"),pe(e,"width","100%")},m(f,u){C(f,e,u),N(t,e,null),S(e,r),l&&l.m(e,null),s=!0,n||(a=[ee(e,"keypress",o[0]),ee(e,"click",o[0])],n=!0)},p(f,[u]){l&&l.p&&(!s||u&4)&&xe(l,i,f,f[2],s?ye(i,f[2],u,null):be(f[2]),null)},i(f){s||(I(t.$$.fragment,f),I(l,f),s=!0)},o(f){P(t.$$.fragment,f),P(l,f),s=!1},d(f){f&&L(e),H(t),l&&l.d(f),n=!1,ke(a)}}}function PP(o,e,t){let{$$slots:r={},$$scope:s}=e,{relay:n=void 0}=e,a=Ht();function i(){n&&a("manageRelay",{relay:n})}return o.$$set=l=>{"relay"in l&&t(1,n=l.relay),"$$scope"in l&&t(2,s=l.$$scope)},[i,n,s,r]}var Pp=class extends Z{constructor(e){super(),te(this,e,PP,TP,Q,{relay:1})}},hs=Pp;function AP(o){let e,t,r,s,n,a;t=new hd({props:{class:"svg-icon",style:"margin-right: .2em; flex-shrink: 0"}});let i=o[3].default,l=ge(i,o,o[2],null);return{c(){e=T("span"),V(t.$$.fragment),r=$(),l&&l.c(),b(e,"role","button"),b(e,"tabindex","0"),pe(e,"display","inline-flex"),pe(e,"align-items","center"),pe(e,"width","100%")},m(f,u){C(f,e,u),N(t,e,null),S(e,r),l&&l.m(e,null),s=!0,n||(a=[ee(e,"keypress",o[0]),ee(e,"click",o[0])],n=!0)},p(f,[u]){l&&l.p&&(!s||u&4)&&xe(l,i,f,f[2],s?ye(i,f[2],u,null):be(f[2]),null)},i(f){s||(I(t.$$.fragment,f),I(l,f),s=!0)},o(f){P(t.$$.fragment,f),P(l,f),s=!1},d(f){f&&L(e),H(t),l&&l.d(f),n=!1,ke(a)}}}function FP(o,e,t){let{$$slots:r={},$$scope:s}=e,{folder:n=void 0}=e,a=Ht();function i(){var l;n&&a("manageSharedFolder",{folder:n,relay:(l=n.remote)===null||l===void 0?void 0:l.relay})}return o.$$set=l=>{"folder"in l&&t(1,n=l.folder),"$$scope"in l&&t(2,s=l.$$scope)},[i,n,s,r]}var Ap=class extends Z{constructor(e){super(),te(this,e,FP,AP,Q,{folder:1})}},po=Ap;function DP(o){let e,t=o[0].name+"",r;return{c(){e=T("span"),r=G(t),pe(e,"overflow","hidden"),pe(e,"text-overflow","ellipsis"),pe(e,"white-space","nowrap")},m(s,n){C(s,e,n),S(e,r)},p(s,n){n&1&&t!==(t=s[0].name+"")&&ne(r,t)},d(s){s&&L(e)}}}function ob(o){let e,t,r,s,n;return t=new td({props:{size:16,class:"svg-icon"}}),s=new hs({props:{relay:o[1],$$slots:{default:[MP]},$$scope:{ctx:o}}}),s.$on("manageRelay",o[3]),{c(){e=T("span"),V(t.$$.fragment),r=$(),V(s.$$.fragment),pe(e,"width","16px"),pe(e,"flex-shrink","0"),pe(e,"display","flex"),pe(e,"justify-content","center")},m(a,i){C(a,e,i),N(t,e,null),C(a,r,i),N(s,a,i),n=!0},p(a,i){let l={};i&2&&(l.relay=a[1]),i&17&&(l.$$scope={dirty:i,ctx:a}),s.$set(l)},i(a){n||(I(t.$$.fragment,a),I(s.$$.fragment,a),n=!0)},o(a){P(t.$$.fragment,a),P(s.$$.fragment,a),n=!1},d(a){a&&(L(e),L(r)),H(t),H(s,a)}}}function MP(o){let e,t=o[0].remote.relay.name+"",r;return{c(){e=T("span"),r=G(t),pe(e,"flex","1"),pe(e,"min-width","0"),pe(e,"text-overflow","ellipsis"),pe(e,"white-space","nowrap")},m(s,n){C(s,e,n),S(e,r)},p(s,n){n&1&&t!==(t=s[0].remote.relay.name+"")&&ne(r,t)},d(s){s&&L(e)}}}function EP(o){let e,t,r,s,n;r=new po({props:{folder:o[0],$$slots:{default:[DP]},$$scope:{ctx:o}}}),r.$on("manageSharedFolder",o[2]);let a=o[0].remote&&ob(o);return{c(){e=T("span"),t=T("span"),V(r.$$.fragment),s=$(),a&&a.c(),pe(t,"display","inline-flex"),pe(t,"align-items","center"),pe(t,"width","200px"),pe(t,"min-width","200px"),pe(t,"flex-shrink","0"),pe(e,"display","inline-flex"),pe(e,"align-items","center"),pe(e,"width","100%"),pe(e,"gap","8px")},m(i,l){C(i,e,l),S(e,t),N(r,t,null),S(e,s),a&&a.m(e,null),n=!0},p(i,[l]){let f={};l&1&&(f.folder=i[0]),l&17&&(f.$$scope={dirty:l,ctx:i}),r.$set(f),i[0].remote?a?(a.p(i,l),l&1&&I(a,1)):(a=ob(i),a.c(),I(a,1),a.m(e,null)):a&&(we(),P(a,1,1,()=>{a=null}),_e())},i(i){n||(I(r.$$.fragment,i),I(a),n=!0)},o(i){P(r.$$.fragment,i),P(a),n=!1},d(i){i&&L(e),H(r),a&&a.d()}}}function RP(o,e,t){let{folder:r}=e,{relay:s}=e;function n(i){Gr.call(this,o,i)}function a(i){Gr.call(this,o,i)}return o.$$set=i=>{"folder"in i&&t(0,r=i.folder),"relay"in i&&t(1,s=i.relay)},[r,s,n,a]}var Fp=class extends Z{constructor(e){super(),te(this,e,RP,EP,Q,{folder:0,relay:1})}},sb=Fp;var Zn=require("obsidian");function OP(o){De(o,"svelte-yg42fv","input.system3-input-invalid.svelte-yg42fv{border:1px solid var(--color-red) !important}span.faint.svelte-yg42fv{color:var(--text-faint)}")}function nb(o,e,t){let r=o.slice();return r[21]=e[t],r}function ab(o,e,t){let r=o.slice();return r[24]=e[t],r}function UP(o){let e,t,r,s,n,a;return{c(){e=T("input"),r=$(),s=T("button"),s.textContent="Join",b(e,"type","text"),b(e,"placeholder","Enter share key"),b(e,"class",t=Bn(o[2]?"system3-input-invalid":"")+" svelte-yg42fv"),b(s,"class","mod-cta")},m(i,l){C(i,e,l),rr(e,o[1]),C(i,r,l),C(i,s,l),n||(a=[ee(e,"input",o[12]),ee(e,"input",o[8]),ee(s,"click",function(){dt((0,Zn.debounce)(o[13]))&&(0,Zn.debounce)(o[13]).apply(this,arguments)})],n=!0)},p(i,l){o=i,l&4&&t!==(t=Bn(o[2]?"system3-input-invalid":"")+" svelte-yg42fv")&&b(e,"class",t),l&2&&e.value!==o[1]&&rr(e,o[1])},d(i){i&&(L(e),L(r),L(s)),n=!1,ke(a)}}}function $P(o){let e;return{c(){e=T("span"),e.textContent="Relay Servers",b(e,"slot","name"),pe(e,"display","inline-flex"),pe(e,"align-items","center")},m(t,r){C(t,e,r)},p:X,d(t){t&&L(e)}}}function BP(o){let e,t;function r(){return o[15](o[24])}return e=new qs({}),e.$on("settings",r),{c(){V(e.$$.fragment)},m(s,n){N(e,s,n),t=!0},p(s,n){o=s},i(s){t||(I(e.$$.fragment,s),t=!0)},o(s){P(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function NP(o){let e;return{c(){e=T("span"),e.textContent="(Untitled Relay Server)",b(e,"class","faint svelte-yg42fv")},m(t,r){C(t,e,r)},p:X,d(t){t&&L(e)}}}function HP(o){let e=o[24].name+"",t;return{c(){t=G(e)},m(r,s){C(r,t,s)},p(r,s){s&8&&e!==(e=r[24].name+"")&&ne(t,e)},d(r){r&&L(t)}}}function VP(o){let e;function t(n,a){return n[24].name?HP:NP}let r=t(o,-1),s=r(o);return{c(){s.c(),e=Te()},m(n,a){s.m(n,a),C(n,e,a)},p(n,a){r===(r=t(n,a))&&s?s.p(n,a):(s.d(1),s=r(n),s&&(s.c(),s.m(e.parentNode,e)))},d(n){n&&L(e),s.d(n)}}}function qP(o){let e,t;return e=new hs({props:{slot:"name",relay:o[24],t:"name",$$slots:{default:[VP]},$$scope:{ctx:o}}}),e.$on("manageRelay",o[14]),{c(){V(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let n={};s&8&&(n.relay=r[24]),s&134217736&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function ib(o){let e,t;return e=new mr({props:{$$slots:{name:[qP],default:[BP]},$$scope:{ctx:o}}}),{c(){V(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let n={};s&134217736&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function WP(o){let e,t,r;return{c(){e=T("button"),e.textContent="Create",b(e,"class","mod-cta")},m(s,n){C(s,e,n),t||(r=ee(e,"click",(0,Zn.debounce)(o[16])),t=!0)},p:X,d(s){s&&L(e),t=!1,r()}}}function lb(o){let e,t;return e=new $e({props:{description:"Go to a Relay Server's settings page above to share existing folders, or add Shared Folders to your vault."}}),{c(){V(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function zP(o){let e,t,r;function s(){return o[19](o[21])}return e=new qs({}),e.$on("settings",function(){dt((0,Zn.debounce)(s))&&(0,Zn.debounce)(s).apply(this,arguments)}),{c(){V(e.$$.fragment),t=$()},m(n,a){N(e,n,a),C(n,t,a),r=!0},p(n,a){o=n},i(n){r||(I(e.$$.fragment,n),r=!0)},o(n){P(e.$$.fragment,n),r=!1},d(n){n&&L(t),H(e,n)}}}function KP(o){var r;let e,t;return e=new sb({props:{folder:o[21],relay:(r=o[21].remote)==null?void 0:r.relay,slot:"name"}}),e.$on("manageRelay",o[17]),e.$on("manageSharedFolder",o[18]),{c(){V(e.$$.fragment)},m(s,n){N(e,s,n),t=!0},p(s,n){var i;let a={};n&16&&(a.folder=s[21]),n&16&&(a.relay=(i=s[21].remote)==null?void 0:i.relay),e.$set(a)},i(s){t||(I(e.$$.fragment,s),t=!0)},o(s){P(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function cb(o){let e,t;return e=new mr({props:{$$slots:{name:[KP],default:[zP]},$$scope:{ctx:o}}}),{c(){V(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let n={};s&134217752&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function GP(o){let e,t,r,s,n,a,i,l,f,u,d,m=o[4].items().length===0,y,h,_;e=new Je({props:{name:"Join a Relay Server"}}),r=new $e({props:{name:"Share key",description:"Enter the code that was shared with you.",$$slots:{default:[UP]},$$scope:{ctx:o}}}),n=new Je({props:{helpText:"A Relay Server coordinates real-time updates between collaborators. You can add collaborators and share folders on the Relay Server's settings page.",$$slots:{name:[$P]},$$scope:{ctx:o}}});let w=Ae(o[3].values().sort(fb)),v=[];for(let F=0;F<w.length;F+=1)v[F]=ib(ab(o,w,F));let M=F=>P(v[F],1,1,()=>{v[F]=null});l=new $e({props:{name:"",description:"",$$slots:{default:[WP]},$$scope:{ctx:o}}}),u=new Je({props:{name:"Shared Folders",helpText:"Shared Folders enhance local folders by tracking edits. You can see what Relay Server a Shared Folder is connected to below."}});let O=m&&lb(o),A=Ae(o[4].items()),E=[];for(let F=0;F<A.length;F+=1)E[F]=cb(nb(o,A,F));let R=F=>P(E[F],1,1,()=>{E[F]=null});return{c(){V(e.$$.fragment),t=$(),V(r.$$.fragment),s=$(),V(n.$$.fragment),a=$();for(let F=0;F<v.length;F+=1)v[F].c();i=$(),V(l.$$.fragment),f=$(),V(u.$$.fragment),d=$(),O&&O.c(),y=$();for(let F=0;F<E.length;F+=1)E[F].c();h=Te()},m(F,D){N(e,F,D),C(F,t,D),N(r,F,D),C(F,s,D),N(n,F,D),C(F,a,D);for(let B=0;B<v.length;B+=1)v[B]&&v[B].m(F,D);C(F,i,D),N(l,F,D),C(F,f,D),N(u,F,D),C(F,d,D),O&&O.m(F,D),C(F,y,D);for(let B=0;B<E.length;B+=1)E[B]&&E[B].m(F,D);C(F,h,D),_=!0},p(F,[D]){let B={};D&134217734&&(B.$$scope={dirty:D,ctx:F}),r.$set(B);let q={};if(D&134217728&&(q.$$scope={dirty:D,ctx:F}),n.$set(q),D&72){w=Ae(F[3].values().sort(fb));let K;for(K=0;K<w.length;K+=1){let z=ab(F,w,K);v[K]?(v[K].p(z,D),I(v[K],1)):(v[K]=ib(z),v[K].c(),I(v[K],1),v[K].m(i.parentNode,i))}for(we(),K=w.length;K<v.length;K+=1)M(K);_e()}let J={};if(D&134217728&&(J.$$scope={dirty:D,ctx:F}),l.$set(J),D&16&&(m=F[4].items().length===0),m?O?D&16&&I(O,1):(O=lb(F),O.c(),I(O,1),O.m(y.parentNode,y)):O&&(we(),P(O,1,1,()=>{O=null}),_e()),D&152){A=Ae(F[4].items());let K;for(K=0;K<A.length;K+=1){let z=nb(F,A,K);E[K]?(E[K].p(z,D),I(E[K],1)):(E[K]=cb(z),E[K].c(),I(E[K],1),E[K].m(h.parentNode,h))}for(we(),K=A.length;K<E.length;K+=1)R(K);_e()}},i(F){if(!_){I(e.$$.fragment,F),I(r.$$.fragment,F),I(n.$$.fragment,F);for(let D=0;D<w.length;D+=1)I(v[D]);I(l.$$.fragment,F),I(u.$$.fragment,F),I(O);for(let D=0;D<A.length;D+=1)I(E[D]);_=!0}},o(F){P(e.$$.fragment,F),P(r.$$.fragment,F),P(n.$$.fragment,F),v=v.filter(Boolean);for(let D=0;D<v.length;D+=1)P(v[D]);P(l.$$.fragment,F),P(u.$$.fragment,F),P(O),E=E.filter(Boolean);for(let D=0;D<E.length;D+=1)P(E[D]);_=!1},d(F){F&&(L(t),L(s),L(a),L(i),L(f),L(d),L(y),L(h)),H(e,F),H(r,F),H(n,F),tt(v,F),H(l,F),H(u,F),O&&O.d(F),tt(E,F)}}}function fb(o,e){return o.owner&&!e.owner?-1:e.owner&&!o.owner||o.name>e.name?1:-1}function jP(o,e,t){let r,s=X,n=()=>(s(),s=tr(l,q=>t(3,r=q)),l),a;o.$$.on_destroy.push(()=>s());let{plugin:i}=e,{relays:l}=e;n();let f=i.sharedFolders;he(o,f,q=>t(4,a=q));let u="",d=!1,m=Ht();function y(q){q&&m("manageRelay",{relay:q})}function h(q,J){q&&m("manageSharedFolder",{folder:q,relay:J})}function _(){t(2,d=!1)}function w(q){return Ge(this,void 0,void 0,function*(){try{let J=yield i.relayManager.acceptInvitation(q);m("joinRelay",{relay:J})}catch(J){t(2,d=!0)}})}function v(){m("createRelay")}function M(){u=this.value,t(1,u)}let O=()=>w(u);function A(q){Gr.call(this,o,q)}let E=q=>{y(q)},R=()=>v();function F(q){Gr.call(this,o,q)}function D(q){Gr.call(this,o,q)}let B=q=>{let J=r.values().find(K=>{var z;return((z=q.remote)==null?void 0:z.relay.guid)===K.guid});h(q,J)};return o.$$set=q=>{"plugin"in q&&t(11,i=q.plugin),"relays"in q&&n(t(0,l=q.relays))},[l,u,d,r,a,f,y,h,_,w,v,i,M,O,A,E,R,F,D,B]}var Dp=class extends Z{constructor(e){super(),te(this,e,jP,GP,Q,{plugin:11,relays:0},OP)}},mo=Dp;var ht=require("obsidian");var Pb=vs(xa());function YP(o){let e,t,r,s,n,a,i,l,f;s=new id({props:{size:16}});let u=o[3].default,d=ge(u,o,o[4],null);return{c(){e=T("span"),t=G(o[1]),r=$(),V(s.$$.fragment),n=$(),a=T("span"),d&&d.c(),b(e,"tabindex","0"),b(e,"role","button"),pe(a,"flex","1"),pe(a,"min-width","0"),pe(a,"text-overflow","ellipsis"),pe(a,"white-space","nowrap"),pe(a,"overflow","hidden")},m(m,y){C(m,e,y),S(e,t),C(m,r,y),N(s,m,y),C(m,n,y),C(m,a,y),d&&d.m(a,null),i=!0,l||(f=[ee(e,"click",o[2]),ee(e,"keypress",o[2])],l=!0)},p(m,y){(!i||y&2)&&ne(t,m[1]),d&&d.p&&(!i||y&16)&&xe(d,u,m,m[4],i?ye(u,m[4],y,null):be(m[4]),null)},i(m){i||(I(s.$$.fragment,m),I(d,m),i=!0)},o(m){P(s.$$.fragment,m),P(d,m),i=!1},d(m){m&&(L(e),L(r),L(n),L(a)),H(s,m),d&&d.d(m),l=!1,ke(f)}}}function JP(o){let e,t,r;var s=o[0];function n(a,i){return{props:{$$slots:{default:[YP]},$$scope:{ctx:a}}}}return s&&(t=Vn(s,n(o))),{c(){e=T("h4"),t&&V(t.$$.fragment)},m(a,i){C(a,e,i),t&&N(t,e,null),r=!0},p(a,[i]){if(i&1&&s!==(s=a[0])){if(t){we();let l=t;P(l.$$.fragment,1,0,()=>{H(l,1)}),_e()}s?(t=Vn(s,n(a,i)),V(t.$$.fragment),I(t.$$.fragment,1),N(t,e,null)):t=null}else if(s){let l={};i&18&&(l.$$scope={dirty:i,ctx:a}),t.$set(l)}},i(a){r||(t&&I(t.$$.fragment,a),r=!0)},o(a){t&&P(t.$$.fragment,a),r=!1},d(a){a&&L(e),t&&H(t)}}}function XP(o,e,t){let{$$slots:r={},$$scope:s}=e,{category:n}=e,{categoryText:a}=e,i=Ht();function l(){i("goBack")}return o.$$set=f=>{"category"in f&&t(0,n=f.category),"categoryText"in f&&t(1,a=f.categoryText),"$$scope"in f&&t(4,s=f.$$scope)},[n,a,l,r,s]}var Mp=class extends Z{constructor(e){super(),te(this,e,XP,JP,Q,{category:0,categoryText:1})}},cc=Mp;var uc=require("obsidian");function QP(o){let e,t,r=o[0].shared&&ub(o);return{c(){e=T("div"),r&&r.c(),b(e,"class","suggestion-icon")},m(s,n){C(s,e,n),r&&r.m(e,null),t=!0},p(s,n){s[0].shared?r?n&1&&I(r,1):(r=ub(s),r.c(),I(r,1),r.m(e,null)):r&&(we(),P(r,1,1,()=>{r=null}),_e())},i(s){t||(I(r),t=!0)},o(s){P(r),t=!1},d(s){s&&L(e),r&&r.d()}}}function ZP(o){let e;return{c(){e=T("span"),e.textContent="Enter to create",b(e,"class","suggestion-action")},m(t,r){C(t,e,r)},p:X,i:X,o:X,d(t){t&&L(e)}}}function ub(o){let e,t;return e=new Bo({props:{class:"svg-icon"}}),{c(){V(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function eA(o){let e,t,r=o[0].folder+"",s,n,a,i,l,f,u=[ZP,QP],d=[];function m(y,h){return y[0].exists?1:0}return i=m(o,-1),l=d[i]=u[i](o),{c(){e=T("div"),t=T("div"),s=G(r),n=$(),a=T("div"),l.c(),b(t,"class","suggestion-title"),b(e,"class","suggestion-content"),b(a,"class","suggestion-aux")},m(y,h){C(y,e,h),S(e,t),S(t,s),C(y,n,h),C(y,a,h),d[i].m(a,null),f=!0},p(y,[h]){(!f||h&1)&&r!==(r=y[0].folder+"")&&ne(s,r);let _=i;i=m(y,h),i===_?d[i].p(y,h):(we(),P(d[_],1,1,()=>{d[_]=null}),_e(),l=d[i],l?l.p(y,h):(l=d[i]=u[i](y),l.c()),I(l,1),l.m(a,null))},i(y){f||(I(l),f=!0)},o(y){P(l),f=!1},d(y){y&&(L(e),L(n),L(a)),d[i].d()}}}function tA(o,e,t){let{suggestion:r}=e;return o.$$set=s=>{"suggestion"in s&&t(0,r=s.suggestion)},[r]}var Ep=class extends Z{constructor(e){super(),te(this,e,tA,eA,Q,{suggestion:0})}},db=Ep;var fc=class extends uc.SuggestModal{constructor(t,r,s){super(t);this.sharedFolders=r;this.onChoose=s;this.components=[];this.sharedPaths=new Set(this.sharedFolders.map(n=>n.path)),this.hasRemotes=new Set(this.sharedFolders.filter(n=>n.remote!==void 0).map(n=>n.path)),this.setInstructions([{command:"\u2191/\u2193",purpose:"Navigate"},{command:"Enter",purpose:"Choose and share folder"},{command:"Esc",purpose:"Cancel"}])}sortFn(t,r){return t.exists&&!r.exists?1:!t.exists&&r.exists||t.shared&&!r.shared?-1:r.shared&&!t.shared?1:t.folder.localeCompare(r.folder)}onClose(){super.onClose(),this.components.forEach(t=>{t.$destroy()})}getSuggestions(t){this.components.forEach(i=>{i.$destroy()});let r=t.toLowerCase(),s=[],n=this.app.vault.getAbstractFileByPath(t)!==null;t.length>0&&!n&&s.push({folder:t,exists:!1,shared:!1});let a=i=>{let l=this.sharedPaths.has(i.path),f=this.hasRemotes.has(i.path);if(i.path.toLowerCase().contains(r)&&i.path.length>1&&!f&&s.push({folder:i.path,exists:!0,shared:l}),!l)for(let u of i.children)u instanceof uc.TFolder&&a(u)};return a(this.app.vault.getRoot()),s.sort(this.sortFn)}renderSuggestion(t,r){r.addClass("mod-complex");let s=new db({target:r,props:{suggestion:t}});this.components.push(s)}onChooseSuggestion(t,r){this.onChoose(t.folder)}};var xb=require("obsidian");var Op=require("obsidian");var pb=require("obsidian"),mb=require("obsidian"),dc=class extends mb.AbstractInputSuggest{constructor(t,r,s){super(t,s);this.app=t;this.sharedFolders=r;this.inputEl=s;this.sharedPaths=new Set(this.sharedFolders.map(n=>n.path))}getSuggestions(t){let r=t.toLowerCase(),s=[],n=a=>{if(!this.sharedPaths.has(a.path)){a.path.toLowerCase().contains(r)&&s.push(a.path);for(let l of a.children)l instanceof pb.TFolder&&n(l)}};return n(this.app.vault.getRoot()),s}renderSuggestion(t,r){r.setText(t)}selectSuggestion(t){this.inputEl.value=t,this.inputEl.trigger("input"),this.close()}};function rA(o){let e,t,r,s;return{c(){e=T("div"),t=T("input"),b(t,"type","text"),b(t,"placeholder","/"),b(e,"class","folder-suggest-container")},m(n,a){C(n,e,a),S(e,t),o[5](t),rr(t,o[2]),r||(s=[ee(t,"input",oA),ee(t,"input",o[6])],r=!0)},p(n,[a]){a&4&&t.value!==n[2]&&rr(t,n[2])},i:X,o:X,d(n){n&&L(e),o[5](null),r=!1,ke(s)}}}function oA(){}function sA(o,e,t){let r,s=X,n=()=>(s(),s=tr(u,y=>t(2,r=y)),u);o.$$.on_destroy.push(()=>s());let{app:a}=e,i,l,{sharedFolders:f}=e,{selectedFolder:u=ve()}=e;n(),or(()=>{l=new dc(a,f,i);let y=h=>{n(t(0,u=h.detail.folder.path))};return i.addEventListener("folder-selected",y),()=>{i.removeEventListener("folder-selected",y)}}),Gu(()=>{l&&l.close()});function d(y){Er[y?"unshift":"push"](()=>{i=y,t(1,i)})}function m(){r=this.value,u.set(r)}return o.$$set=y=>{"app"in y&&t(3,a=y.app),"sharedFolders"in y&&t(4,f=y.sharedFolders),"selectedFolder"in y&&n(t(0,u=y.selectedFolder))},[u,i,r,a,f,d,m]}var Rp=class extends Z{constructor(e){super(),te(this,e,sA,rA,Q,{app:3,sharedFolders:4,selectedFolder:0})}},hb=Rp;function nA(o){De(o,"svelte-hgd3zf","span.error.svelte-hgd3zf{flex:auto;align-content:center}")}function aA(o){let e,t,r;return{c(){e=T("input"),b(e,"type","text")},m(s,n){C(s,e,n),rr(e,o[4]),t||(r=ee(e,"input",o[8]),t=!0)},p(s,n){n&16&&e.value!==s[4]&&rr(e,s[4])},d(s){s&&L(e),t=!1,r()}}}function iA(o){let e,t;return e=new hb({props:{app:o[0],sharedFolders:o[2],selectedFolder:o[7]}}),{c(){V(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let n={};s&1&&(n.app=r[0]),s&4&&(n.sharedFolders=r[2]),e.$set(n)},i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function gb(o){let e,t;return{c(){e=T("span"),t=G(o[5]),b(e,"class","mod-warning error svelte-hgd3zf")},m(r,s){C(r,e,s),S(e,t)},p(r,s){s&32&&ne(t,r[5])},d(r){r&&L(e)}}}function lA(o){let e,t,r,s,n,a,i,l,f,u,d,m,y;s=new $e({props:{name:"Folder name",description:"Set the name of the folder to be added.",$$slots:{default:[aA]},$$scope:{ctx:o}}}),a=new $e({props:{name:"Folder location",description:"Set the location in your vault.",$$slots:{default:[iA]},$$scope:{ctx:o}}});let h=o[5]&&gb(o);return{c(){e=T("div"),e.textContent="Add to vault",t=$(),r=T("div"),V(s.$$.fragment),n=$(),V(a.$$.fragment),i=$(),l=T("div"),h&&h.c(),f=$(),u=T("button"),u.textContent="Confirm",b(e,"class","modal-title"),b(u,"class","mod-cta"),b(l,"class","modal-button-container"),b(r,"class","modal-content")},m(_,w){C(_,e,w),C(_,t,w),C(_,r,w),N(s,r,null),S(r,n),N(a,r,null),S(r,i),S(r,l),h&&h.m(l,null),S(l,f),S(l,u),d=!0,m||(y=ee(u,"click",function(){dt((0,Op.debounce)(o[9]))&&(0,Op.debounce)(o[9]).apply(this,arguments)}),m=!0)},p(_,[w]){o=_;let v={};w&1040&&(v.$$scope={dirty:w,ctx:o}),s.$set(v);let M={};w&1029&&(M.$$scope={dirty:w,ctx:o}),a.$set(M),o[5]?h?h.p(o,w):(h=gb(o),h.c(),h.m(l,f)):h&&(h.d(1),h=null)},i(_){d||(I(s.$$.fragment,_),I(a.$$.fragment,_),d=!0)},o(_){P(s.$$.fragment,_),P(a.$$.fragment,_),d=!1},d(_){_&&(L(e),L(t),L(r)),H(s),H(a),h&&h.d(),m=!1,y()}}}function cA(o,e,t){let r,{app:s}=e,{remoteFolder:n}=e,{sharedFolders:a}=e,{onConfirm:i}=e,l=n.name,f=ve();he(o,f,y=>t(6,r=y));let u="";function d(){l=this.value,t(4,l)}let m=async()=>{i(n,l,r||"").catch(y=>{t(5,u=y.message)})};return o.$$set=y=>{"app"in y&&t(0,s=y.app),"remoteFolder"in y&&t(1,n=y.remoteFolder),"sharedFolders"in y&&t(2,a=y.sharedFolders),"onConfirm"in y&&t(3,i=y.onConfirm)},[s,n,a,i,l,u,r,f,d,m]}var Up=class extends Z{constructor(e){super(),te(this,e,cA,lA,Q,{app:0,remoteFolder:1,sharedFolders:2,onConfirm:3},nA)}},yb=Up;var pc=class extends xb.Modal{constructor(t,r,s,n){super(t);this.sharedFolders=r;this.remoteFolder=s;this.onConfirm=n;this.onConfirm=n}onOpen(){let{contentEl:t}=this;this.component=new yb({target:t,props:{remoteFolder:this.remoteFolder,sharedFolders:this.sharedFolders,onConfirm:async(r,s,n)=>{await this.onConfirm(r,s,n),this.close()},app:this.app}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var Bp=vs(bb());function fA(o){De(o,"svelte-xzg7gq",".system3-settings-danger-zone.svelte-xzg7gq{margin-top:6em}input.system3-updating.svelte-xzg7gq{border:1px solid var(--color-accent) !important}input.system3-input-invalid.svelte-xzg7gq{border:1px solid var(--color-red) !important}.faint.svelte-xzg7gq{color:var(--text-faint)}")}function wb(o,e,t){let r=o.slice();return r[50]=e[t],r}function _b(o,e,t){let r=o.slice();return r[53]=e[t],r}function uA(o){let e;return{c(){e=T("span"),e.textContent="(Untitled Relay Server)",b(e,"class","faint svelte-xzg7gq")},m(t,r){C(t,e,r)},p:X,d(t){t&&L(e)}}}function dA(o){let e=o[0].name+"",t;return{c(){t=G(e)},m(r,s){C(r,t,s)},p(r,s){s[0]&1&&e!==(e=r[0].name+"")&&ne(t,e)},d(r){r&&L(t)}}}function pA(o){let e;function t(n,a){return n[0].name?dA:uA}let r=t(o,[-1,-1]),s=r(o);return{c(){s.c(),e=Te()},m(n,a){s.m(n,a),C(n,e,a)},p(n,a){r===(r=t(n,a))&&s?s.p(n,a):(s.d(1),s=r(n),s&&(s.c(),s.m(e.parentNode,e)))},d(n){n&&L(e),s.d(n)}}}function vb(o){let e,t;return e=new $e({props:{name:"Name",description:"Set the Relay Server's name.",$$slots:{default:[mA]},$$scope:{ctx:o}}}),{c(){V(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let n={};s[0]&297|s[1]&33554432&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function mA(o){let e,t,r,s;return{c(){e=T("input"),b(e,"type","text"),b(e,"spellcheck","false"),b(e,"placeholder","Example: Shared Notes"),b(e,"class",t=Bn((o[8]?"system3-updating":"")+(o[5]?"":" system3-input-invalid"))+" svelte-xzg7gq")},m(n,a){C(n,e,a),rr(e,o[0].name),o[35](e),r||(s=[ee(e,"input",o[34]),ee(e,"input",o[26])],r=!0)},p(n,a){a[0]&288&&t!==(t=Bn((n[8]?"system3-updating":"")+(n[5]?"":" system3-input-invalid"))+" svelte-xzg7gq")&&b(e,"class",t),a[0]&1&&e.value!==n[0].name&&rr(e,n[0].name)},d(n){n&&L(e),o[35](null),r=!1,ke(s)}}}function hA(o){let e,t;return e=new mr({props:{$$slots:{name:[bA],default:[yA]},$$scope:{ctx:o}}}),{c(){V(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let n={};s[0]&512|s[1]&33554432&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function gA(o){let e,t;return e=new mr({props:{$$slots:{name:[vA],default:[wA]},$$scope:{ctx:o}}}),{c(){V(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let n={};s[0]&1536|s[1]&33554432&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function yA(o){let e,t,r;function s(){return o[39](o[53])}return{c(){e=T("button"),e.textContent="Add to Vault",b(e,"class","mod-cta"),b(e,"aria-label","Add shared folder to vault")},m(n,a){C(n,e,a),t||(r=ee(e,"click",function(){dt((0,ht.debounce)(s))&&(0,ht.debounce)(s).apply(this,arguments)}),t=!0)},p(n,a){o=n},d(n){n&&L(e),t=!1,r()}}}function xA(o){let e=o[53].name+"",t;return{c(){t=G(e)},m(r,s){C(r,t,s)},p(r,s){s[0]&512&&e!==(e=r[53].name+"")&&ne(t,e)},d(r){r&&L(t)}}}function bA(o){let e,t;return e=new po({props:{slot:"name",$$slots:{default:[xA]},$$scope:{ctx:o}}}),{c(){V(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let n={};s[0]&512|s[1]&33554432&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function wA(o){let e,t;function r(){return o[38](o[53])}return e=new qs({}),e.$on("settings",function(){dt((0,ht.debounce)(r))&&(0,ht.debounce)(r).apply(this,arguments)}),{c(){V(e.$$.fragment)},m(s,n){N(e,s,n),t=!0},p(s,n){o=s},i(s){t||(I(e.$$.fragment,s),t=!0)},o(s){P(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function _A(o){let e=o[53].name+"",t;return{c(){t=G(e)},m(r,s){C(r,t,s)},p(r,s){s[0]&512&&e!==(e=r[53].name+"")&&ne(t,e)},d(r){r&&L(t)}}}function vA(o){let e,t;function r(...s){return o[36](o[53],...s)}return e=new po({props:{folder:o[10].find(r),slot:"name",$$slots:{default:[_A]},$$scope:{ctx:o}}}),e.$on("manageSharedFolder",o[37]),{c(){V(e.$$.fragment)},m(s,n){N(e,s,n),t=!0},p(s,n){o=s;let a={};n[0]&1536&&(a.folder=o[10].find(r)),n[0]&512|n[1]&33554432&&(a.$$scope={dirty:n,ctx:o}),e.$set(a)},i(s){t||(I(e.$$.fragment,s),t=!0)},o(s){P(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function Sb(o){let e,t,r,s,n;function a(...u){return o[33](o[53],...u)}let i=[gA,hA],l=[];function f(u,d){return d[0]&1536&&(e=null),e==null&&(e=!!u[10].find(a)),e?0:1}return t=f(o,[-1,-1]),r=l[t]=i[t](o),{c(){r.c(),s=Te()},m(u,d){l[t].m(u,d),C(u,s,d),n=!0},p(u,d){o=u;let m=t;t=f(o,d),t===m?l[t].p(o,d):(we(),P(l[m],1,1,()=>{l[m]=null}),_e(),r=l[t],r?r.p(o,d):(r=l[t]=i[t](o),r.c()),I(r,1),r.m(s.parentNode,s))},i(u){n||(I(r),n=!0)},o(u){P(r),n=!1},d(u){u&&L(s),l[t].d(u)}}}function SA(o){let e,t,r;return{c(){e=T("button"),e.textContent="Share a folder",b(e,"class","mod-cta"),b(e,"aria-label","Select a folder to share it with this Relay Server")},m(s,n){C(s,e,n),t||(r=ee(e,"click",(0,ht.debounce)(o[40])),t=!0)},p:X,d(s){s&&L(e),t=!1,r()}}}function kA(o){let e=o[11].values().length+"",t,r,s=o[7].userLimit+"",n;return{c(){t=G(e),r=G(" / "),n=G(s)},m(a,i){C(a,t,i),C(a,r,i),C(a,n,i)},p(a,i){i[0]&2048&&e!==(e=a[11].values().length+"")&&ne(t,e),i[0]&128&&s!==(s=a[7].userLimit+"")&&ne(n,s)},d(a){a&&(L(t),L(r),L(n))}}}function kb(o){let e,t,r;function s(){return o[41](o[50])}return{c(){e=T("button"),e.textContent="Kick",b(e,"class","mod-destructive")},m(n,a){C(n,e,a),t||(r=ee(e,"click",function(){dt((0,ht.debounce)(s))&&(0,ht.debounce)(s).apply(this,arguments)}),t=!0)},p(n,a){o=n},d(n){n&&L(e),t=!1,r()}}}function IA(o){let e,t=o[50].role==="Member"&&o[7].owner&&kb(o);return{c(){t&&t.c(),e=$()},m(r,s){t&&t.m(r,s),C(r,e,s)},p(r,s){r[50].role==="Member"&&r[7].owner?t?t.p(r,s):(t=kb(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&L(e),t&&t.d(r)}}}function Ib(o){let e,t;return e=new $e({props:{name:o[50].user.name,description:o[50].role,$$slots:{default:[IA]},$$scope:{ctx:o}}}),{c(){V(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let n={};s[0]&2048&&(n.name=r[50].user.name),s[0]&2048&&(n.description=r[50].role),s[0]&2176|s[1]&33554432&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function LA(o){let e,t,r;return{c(){e=T("input"),e.value=o[4],b(e,"type","text"),e.readOnly=!0,b(e,"id","system3InviteLink")},m(s,n){C(s,e,n),t||(r=ee(e,"click",(0,ht.debounce)(o[30])),t=!0)},p(s,n){n[0]&16&&e.value!==s[4]&&(e.value=s[4])},d(s){s&&L(e),t=!1,r()}}}function CA(o){let e,t,r,s;return e=new Je({props:{name:"Membership"}}),r=new $e({props:{name:"Leave Relay Server",description:"Leave the Relay Server. Local data is preserved.",$$slots:{default:[PA]},$$scope:{ctx:o}}}),{c(){V(e.$$.fragment),t=$(),V(r.$$.fragment)},m(n,a){N(e,n,a),C(n,t,a),N(r,n,a),s=!0},p(n,a){let i={};a[1]&33554432&&(i.$$scope={dirty:a,ctx:n}),r.$set(i)},i(n){s||(I(e.$$.fragment,n),I(r.$$.fragment,n),s=!0)},o(n){P(e.$$.fragment,n),P(r.$$.fragment,n),s=!1},d(n){n&&L(t),H(e,n),H(r,n)}}}function TA(o){let e,t,r,s,n,a,i,l=[FA,AA],f=[];function u(d,m){return d[12]?0:1}return e=u(o,[-1,-1]),t=f[e]=l[e](o),s=new Je({props:{name:"Storage"}}),a=new $e({props:{name:"Destroy Relay Server",description:"This will destroy the Relay Server (deleting all data on the server). Local data is preserved.",$$slots:{default:[NA]},$$scope:{ctx:o}}}),{c(){t.c(),r=$(),V(s.$$.fragment),n=$(),V(a.$$.fragment)},m(d,m){f[e].m(d,m),C(d,r,m),N(s,d,m),C(d,n,m),N(a,d,m),i=!0},p(d,m){let y=e;e=u(d,m),e===y?f[e].p(d,m):(we(),P(f[y],1,1,()=>{f[y]=null}),_e(),t=f[e],t?t.p(d,m):(t=f[e]=l[e](d),t.c()),I(t,1),t.m(r.parentNode,r));let h={};m[0]&64|m[1]&33554432&&(h.$$scope={dirty:m,ctx:d}),a.$set(h)},i(d){i||(I(t),I(s.$$.fragment,d),I(a.$$.fragment,d),i=!0)},o(d){P(t),P(s.$$.fragment,d),P(a.$$.fragment,d),i=!1},d(d){d&&(L(r),L(n)),f[e].d(d),H(s,d),H(a,d)}}}function PA(o){let e,t,r;return{c(){e=T("button"),e.textContent="Leave",b(e,"class","mod-warning")},m(s,n){C(s,e,n),t||(r=ee(e,"click",(0,ht.debounce)(o[45])),t=!0)},p:X,d(s){s&&L(e),t=!1,r()}}}function AA(o){let e,t;return e=new $e({props:{name:`Plan: ${o[7].plan}`,description:"",$$slots:{description:[MA],default:[DA]},$$scope:{ctx:o}}}),{c(){V(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let n={};s[0]&128&&(n.name=`Plan: ${r[7].plan}`),s[0]&128|s[1]&33554432&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function FA(o){let e,t,r=!o[6].values()[0].active||o[6].values()[0].cancelAt,s,n;e=new $e({props:{name:`Plan: ${o[7].plan}`,description:"",$$slots:{description:[RA],default:[EA]},$$scope:{ctx:o}}});let a=r&&Cb(o);return{c(){V(e.$$.fragment),t=$(),a&&a.c(),s=Te()},m(i,l){N(e,i,l),C(i,t,l),a&&a.m(i,l),C(i,s,l),n=!0},p(i,l){let f={};l[0]&128&&(f.name=`Plan: ${i[7].plan}`),l[0]&4288|l[1]&33554432&&(f.$$scope={dirty:l,ctx:i}),e.$set(f),l[0]&64&&(r=!i[6].values()[0].active||i[6].values()[0].cancelAt),r?a?(a.p(i,l),l[0]&64&&I(a,1)):(a=Cb(i),a.c(),I(a,1),a.m(s.parentNode,s)):a&&(we(),P(a,1,1,()=>{a=null}),_e())},i(i){n||(I(e.$$.fragment,i),I(a),n=!0)},o(i){P(e.$$.fragment,i),P(a),n=!1},d(i){i&&(L(t),L(s)),H(e,i),a&&a.d(i)}}}function DA(o){let e,t,r;return{c(){e=T("button"),e.textContent="Upgrade",b(e,"class","mod-cta")},m(s,n){C(s,e,n),t||(r=ee(e,"click",function(){dt((0,ht.debounce)(o[44]))&&(0,ht.debounce)(o[44]).apply(this,arguments)}),t=!0)},p(s,n){o=s},d(s){s&&L(e),t=!1,r()}}}function MA(o){let e,t=(o[7].cta||"Thanks for supporting Relay development <3")+"",r;return{c(){e=T("fragment"),r=G(t),b(e,"slot","description")},m(s,n){C(s,e,n),S(e,r)},p(s,n){n[0]&128&&t!==(t=(s[7].cta||"Thanks for supporting Relay development <3")+"")&&ne(r,t)},d(s){s&&L(e)}}}function Lb(o){let e,t,r;return{c(){e=T("button"),e.textContent="Cancel",b(e,"class","mod-destructive")},m(s,n){C(s,e,n),t||(r=ee(e,"click",function(){dt((0,ht.debounce)(o[43]))&&(0,ht.debounce)(o[43]).apply(this,arguments)}),t=!0)},p(s,n){o=s},d(s){s&&L(e),t=!1,r()}}}function EA(o){let e,t,r=o[6].values()[0].active&&!o[6].values()[0].cancelAt,s,n,a,i=r&&Lb(o);return{c(){e=T("button"),e.textContent="Manage",t=$(),i&&i.c(),s=Te()},m(l,f){C(l,e,f),C(l,t,f),i&&i.m(l,f),C(l,s,f),n||(a=ee(e,"click",function(){dt((0,ht.debounce)(o[42]))&&(0,ht.debounce)(o[42]).apply(this,arguments)}),n=!0)},p(l,f){o=l,f[0]&64&&(r=o[6].values()[0].active&&!o[6].values()[0].cancelAt),r?i?i.p(o,f):(i=Lb(o),i.c(),i.m(s.parentNode,s)):i&&(i.d(1),i=null)},d(l){l&&(L(e),L(t),L(s)),i&&i.d(l),n=!1,a()}}}function RA(o){let e,t=o[7].cta+"",r;return{c(){e=T("fragment"),r=G(t),b(e,"slot","description")},m(s,n){C(s,e,n),S(e,r)},p(s,n){n[0]&128&&t!==(t=s[7].cta+"")&&ne(r,t)},d(s){s&&L(e)}}}function Cb(o){let e,t;return e=new $e({props:{description:"",$$slots:{name:[UA],default:[OA]},$$scope:{ctx:o}}}),{c(){V(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let n={};s[0]&64|s[1]&33554432&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function OA(o){let e=o[14](o[6].values()[0].cancelAt)+"",t;return{c(){t=G(e)},m(r,s){C(r,t,s)},p(r,s){s[0]&64&&e!==(e=r[14](r[6].values()[0].cancelAt)+"")&&ne(t,e)},d(r){r&&L(t)}}}function UA(o){let e;return{c(){e=T("span"),e.textContent="Status: Cancelled",b(e,"slot","name"),b(e,"class","mod-warning")},m(t,r){C(t,e,r)},p:X,d(t){t&&L(e)}}}function $A(o){let e,t,r;return{c(){e=T("button"),e.textContent="Destroy",b(e,"class","mod-warning")},m(s,n){C(s,e,n),t||(r=ee(e,"click",(0,ht.debounce)(o[27])),t=!0)},p:X,d(s){s&&L(e),t=!1,r()}}}function BA(o){let e,t;return{c(){e=T("button"),e.textContent="Destroy",e.disabled=t=!0,b(e,"class","mod-warning"),b(e,"aria-label","Cancel subscription to destroy Relay Server.")},m(r,s){C(r,e,s)},p:X,d(r){r&&L(e)}}}function NA(o){let e,t;function r(a,i){return i[0]&64&&(e=null),e==null&&(e=a[6].values().length>0&&!a[6].values()[0].cancelAt),e?BA:$A}let s=r(o,[-1,-1]),n=s(o);return{c(){n.c(),t=Te()},m(a,i){n.m(a,i),C(a,t,i)},p(a,i){s===(s=r(a,i))&&n?n.p(a,i):(n.d(1),n=s(a),n&&(n.c(),n.m(t.parentNode,t)))},d(a){a&&L(t),n.d(a)}}}function HA(o){let e,t,r,s,n,a,i,l,f,u,d,m,y,h,_,w,v,M,O;e=new cc({props:{category:hs,categoryText:"Relay Servers",$$slots:{default:[pA]},$$scope:{ctx:o}}}),e.$on("goBack",o[23]);let A=o[0].owner&&vb(o);s=new Je({props:{name:"Folders on this Relay Server"}});let E=Ae(o[9].values()),R=[];for(let W=0;W<E.length;W+=1)R[W]=Sb(_b(o,E,W));let F=W=>P(R[W],1,1,()=>{R[W]=null});i=new $e({props:{description:"",name:"",$$slots:{default:[SA]},$$scope:{ctx:o}}}),f=new Je({props:{name:"Users",$$slots:{default:[kA]},$$scope:{ctx:o}}});let D=Ae(o[11].values().sort(Tb)),B=[];for(let W=0;W<D.length;W+=1)B[W]=Ib(wb(o,D,W));let q=W=>P(B[W],1,1,()=>{B[W]=null});m=new Je({props:{name:"Sharing"}}),h=new $e({props:{name:"Share Key",description:"Share this key with your collaborators.",$$slots:{default:[LA]},$$scope:{ctx:o}}});let J=[TA,CA],K=[];function z(W,re){return W[7].owner?0:1}return w=z(o,[-1,-1]),v=K[w]=J[w](o),{c(){V(e.$$.fragment),t=$(),A&&A.c(),r=$(),V(s.$$.fragment),n=$();for(let W=0;W<R.length;W+=1)R[W].c();a=$(),V(i.$$.fragment),l=$(),V(f.$$.fragment),u=$();for(let W=0;W<B.length;W+=1)B[W].c();d=$(),V(m.$$.fragment),y=$(),V(h.$$.fragment),_=$(),v.c(),M=Te()},m(W,re){N(e,W,re),C(W,t,re),A&&A.m(W,re),C(W,r,re),N(s,W,re),C(W,n,re);for(let Le=0;Le<R.length;Le+=1)R[Le]&&R[Le].m(W,re);C(W,a,re),N(i,W,re),C(W,l,re),N(f,W,re),C(W,u,re);for(let Le=0;Le<B.length;Le+=1)B[Le]&&B[Le].m(W,re);C(W,d,re),N(m,W,re),C(W,y,re),N(h,W,re),C(W,_,re),K[w].m(W,re),C(W,M,re),O=!0},p(W,re){let Le={};if(re[0]&1|re[1]&33554432&&(Le.$$scope={dirty:re,ctx:W}),e.$set(Le),W[0].owner?A?(A.p(W,re),re[0]&1&&I(A,1)):(A=vb(W),A.c(),I(A,1),A.m(r.parentNode,r)):A&&(we(),P(A,1,1,()=>{A=null}),_e()),re[0]&570426880){E=Ae(W[9].values());let de;for(de=0;de<E.length;de+=1){let fe=_b(W,E,de);R[de]?(R[de].p(fe,re),I(R[de],1)):(R[de]=Sb(fe),R[de].c(),I(R[de],1),R[de].m(a.parentNode,a))}for(we(),de=E.length;de<R.length;de+=1)F(de);_e()}let le={};re[1]&33554432&&(le.$$scope={dirty:re,ctx:W}),i.$set(le);let Ce={};if(re[0]&2176|re[1]&33554432&&(Ce.$$scope={dirty:re,ctx:W}),f.$set(Ce),re[0]&268437632){D=Ae(W[11].values().sort(Tb));let de;for(de=0;de<D.length;de+=1){let fe=wb(W,D,de);B[de]?(B[de].p(fe,re),I(B[de],1)):(B[de]=Ib(fe),B[de].c(),I(B[de],1),B[de].m(d.parentNode,d))}for(we(),de=D.length;de<B.length;de+=1)q(de);_e()}let Ke={};re[0]&16|re[1]&33554432&&(Ke.$$scope={dirty:re,ctx:W}),h.$set(Ke);let Re=w;w=z(W,re),w===Re?K[w].p(W,re):(we(),P(K[Re],1,1,()=>{K[Re]=null}),_e(),v=K[w],v?v.p(W,re):(v=K[w]=J[w](W),v.c()),I(v,1),v.m(M.parentNode,M))},i(W){if(!O){I(e.$$.fragment,W),I(A),I(s.$$.fragment,W);for(let re=0;re<E.length;re+=1)I(R[re]);I(i.$$.fragment,W),I(f.$$.fragment,W);for(let re=0;re<D.length;re+=1)I(B[re]);I(m.$$.fragment,W),I(h.$$.fragment,W),I(v),O=!0}},o(W){P(e.$$.fragment,W),P(A),P(s.$$.fragment,W),R=R.filter(Boolean);for(let re=0;re<R.length;re+=1)P(R[re]);P(i.$$.fragment,W),P(f.$$.fragment,W),B=B.filter(Boolean);for(let re=0;re<B.length;re+=1)P(B[re]);P(m.$$.fragment,W),P(h.$$.fragment,W),P(v),O=!1},d(W){W&&(L(t),L(r),L(n),L(a),L(l),L(u),L(d),L(y),L(_),L(M)),H(e,W),A&&A.d(W),H(s,W),tt(R,W),H(i,W),H(f,W),tt(B,W),H(m,W),H(h,W),K[w].d(W)}}}function Tb(o,e){return o.role==="Owner"&&e.role!=="Owner"?-1:o.role!=="Owner"&&e.role==="Owner"||o.user.name>e.user.name?1:-1}function VA(o){if(/[\\:*?"<>|]/.test(o))return!1;let t=o.split("/");for(let r of t)if(r===""||r==="."||r==="..")return!1;return!0}function qA(o,e,t){let r,s,n=X,a=()=>(n(),n=tr(R,se=>t(46,s=se)),R),i,l,f=X,u=()=>(f(),f=tr(M,se=>t(7,l=se)),M),d,m,y,h=X,_=()=>(h(),h=tr(E,se=>t(10,y=se)),E),w,v;o.$$.on_destroy.push(()=>n()),o.$$.on_destroy.push(()=>f()),o.$$.on_destroy.push(()=>h());let{relay:M}=e;u();let O=M.folders;he(o,O,se=>t(9,m=se));let{plugin:A}=e,{sharedFolders:E}=e;_();let{relayRoles:R}=e;a();function F(se){if(!se)return"Active";let ze=(0,Bp.default)(),ot=(0,Bp.default)(se).diff(ze,"days");return ot<=0?"Subscription has ended":ot===1?"Active for 1 more day":`Active for ${ot} more days`}let D=l.subscriptions;he(o,D,se=>t(6,i=se));let B=uo(i,se=>{if(se.values().length===0)return;let ze=se.values()[0];return ze.token||A.relayManager.getSubscriptionToken(ze).then(at=>{ze.token=at}),ze});he(o,B,se=>t(12,v=se));let q=s.filter(se=>se.relayId===M.id);he(o,q,se=>t(11,w=se));let J=ve(!0);he(o,J,se=>t(5,r=se));let K;or(()=>{K&&K.value===""&&K.focus()});let z=Ht();function W(se){return Ge(this,void 0,void 0,function*(){var ze;if(!(!((ze=A.loginManager)===null||ze===void 0)&&ze.user))return;let at={relay:se.id,quantity:10,user_email:A.loginManager.user.email},ot=btoa(JSON.stringify(at)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");window.open(A.buildApiUrl(`/subscribe/${ot}`),"_blank")})}function re(se){return Ge(this,void 0,void 0,function*(){let ze=se.token,at=se.id;window.open(A.buildApiUrl(`/subscriptions/${at}/manage?token=${ze}`),"_blank")})}function Le(se){return Ge(this,void 0,void 0,function*(){let ze=se.token,at=se.id;window.open(A.buildApiUrl(`/subscriptions/${at}/cancel?token=${ze}`),"_blank")})}function le(){return Ge(this,void 0,void 0,function*(){A.relayManager.leaveRelay(M),z("goBack",{clear:!0})})}function Ce(){return Ge(this,void 0,void 0,function*(){z("goBack",{clear:!0})})}let Ke;A.relayManager.getRelayInvitationKey(M).then(se=>{t(4,Ke=se)});function Re(se,ze,at){return Ge(this,void 0,void 0,function*(){let ot=(0,ht.normalizePath)((0,Pb.join)(at,ze));A.vault.getFolderByPath(ot)===null&&(yield A.vault.createFolder(ot));let Me=A.sharedFolders.new(ot,se.guid,M.guid,!0);return Me.remote=se,A.sharedFolders.notifyListeners(),Me})}let de=ve(!1);he(o,de,se=>t(8,d=se));let fe=A.timeProvider.debounce(()=>{A.relayManager.updateRelay(M).then(()=>{de.set(!1)})},500),oe=se=>{new pc(A.app,E,se,Re).open()};function Be(){J.set(VA(K.value)),r&&K.value!==""&&(de.set(!0),fe())}function At(){A.relayManager.destroyRelay(M),z("goBack",{})}function Ot(se){A.relayManager.kick(se)}function Ut(se,ze){se&&z("manageSharedFolder",{folder:se,relay:ze,mount:!1})}function gt(se){let ze=se.target;ze.focus(),ze.select(),navigator.clipboard.writeText(ze.value).then(()=>new ht.Notice("Invite link copied")).catch(at=>{})}let yt=new fc(A.app,E,se=>Ge(void 0,void 0,void 0,function*(){let ze=(0,ht.normalizePath)(se),at=E.find(Jr=>Jr.path==se);if(at){let Jr=yield A.relayManager.createRemoteFolder(at,M);at.remote=Jr,at.connect(),A.sharedFolders.notifyListeners();return}A.vault.getFolderByPath(ze)===null&&(yield A.vault.createFolder(ze));let ot=hn(),Me=A.sharedFolders.new((0,ht.normalizePath)(se),ot,M.guid,!0),Yr=yield A.relayManager.createRemoteFolder(Me,M);Me.remote=Yr,A.sharedFolders.notifyListeners()})),pt=(se,ze)=>ze.remote===se;function Gt(){M.name=this.value,u(t(0,M))}function ys(se){Er[se?"unshift":"push"](()=>{K=se,t(3,K)})}let Gs=(se,ze)=>ze.remote===se;function na(se){Gr.call(this,o,se)}let aa=se=>{let ze=y.find(at=>at.remote===se);ze&&Ut(ze,se.relay)},js=se=>{oe(se)},ia=()=>{yt.open()},Ir=se=>{Ot(se)},nt=()=>{re(v)},Wt=()=>{Le(v)},go=()=>{W(l)},xs=()=>{le()};return o.$$set=se=>{"relay"in se&&u(t(0,M=se.relay)),"plugin"in se&&t(32,A=se.plugin),"sharedFolders"in se&&_(t(1,E=se.sharedFolders)),"relayRoles"in se&&a(t(2,R=se.relayRoles))},[M,E,R,K,Ke,r,i,l,d,m,y,w,v,O,F,D,B,q,J,W,re,Le,le,Ce,de,oe,Be,At,Ot,Ut,gt,yt,A,pt,Gt,ys,Gs,na,aa,js,ia,Ir,nt,Wt,go,xs]}var Np=class extends Z{constructor(e){super(),te(this,e,qA,HA,Q,{relay:0,plugin:32,sharedFolders:1,relayRoles:2},fA,[-1,-1])}},ta=Np;function WA(o){let e,t,r,s,n,a;return r=new nd({}),{c(){e=T("div"),t=T("div"),V(r.$$.fragment),b(t,"class","clickable-icon"),b(t,"aria-label","Back"),b(t,"tabindex","0"),b(t,"role","button"),b(e,"class","modal-setting-nav-bar")},m(i,l){C(i,e,l),S(e,t),N(r,t,null),s=!0,n||(a=[ee(t,"click",o[0]),ee(t,"keypress",o[1])],n=!0)},p:X,i(i){s||(I(r.$$.fragment,i),s=!0)},o(i){P(r.$$.fragment,i),s=!1},d(i){i&&L(e),H(r),n=!1,ke(a)}}}function zA(o){let e=Ht();function t(){e("goBack",{})}function r(s){s.key==="Escape"&&(e("goBack",{}),s.stopPropagation())}return[t,r]}var Hp=class extends Z{constructor(e){super(),te(this,e,zA,WA,Q,{})}},Ab=Hp;var ra=require("obsidian");function Fb(o,e,t){let r=o.slice();return r[28]=e[t][0],r[29]=e[t][1],r}function KA(o){let e=o[1].name+"",t;return{c(){t=G(e)},m(r,s){C(r,t,s)},p(r,s){s[0]&2&&e!==(e=r[1].name+"")&&ne(t,e)},d(r){r&&L(t)}}}function GA(o){let e,t;return e=new $e({props:{description:"This folder is tracking edits, but is not connected to a Relay Server."}}),{c(){V(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p:X,i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function jA(o){let e,t;return e=new mr({props:{$$slots:{name:[XA],default:[YA]},$$scope:{ctx:o}}}),{c(){V(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let n={};s[0]&64|s[1]&2&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function YA(o){let e,t;return e=new qs({}),e.$on("settings",function(){dt((0,ra.debounce)(o[19]))&&(0,ra.debounce)(o[19]).apply(this,arguments)}),{c(){V(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){o=r},i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function JA(o){let e=o[6].name+"",t;return{c(){t=G(e)},m(r,s){C(r,t,s)},p(r,s){s[0]&64&&e!==(e=r[6].name+"")&&ne(t,e)},d(r){r&&L(t)}}}function XA(o){let e,t;return e=new hs({props:{slot:"name",relay:o[6],$$slots:{default:[JA]},$$scope:{ctx:o}}}),e.$on("manageRelay",o[18]),{c(){V(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let n={};s[0]&64&&(n.relay=r[6]),s[0]&64|s[1]&2&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function Db(o){let e,t,r,s;e=new Je({props:{name:"Sync Settings"}});let n=Ae(o[4]),a=[];for(let l=0;l<n.length;l+=1)a[l]=Mb(Fb(o,n,l));let i=l=>P(a[l],1,1,()=>{a[l]=null});return{c(){V(e.$$.fragment),t=$();for(let l=0;l<a.length;l+=1)a[l].c();r=Te()},m(l,f){N(e,l,f),C(l,t,f);for(let u=0;u<a.length;u+=1)a[u]&&a[u].m(l,f);C(l,r,f),s=!0},p(l,f){if(f[0]&2200){n=Ae(l[4]);let u;for(u=0;u<n.length;u+=1){let d=Fb(l,n,u);a[u]?(a[u].p(d,f),I(a[u],1)):(a[u]=Mb(d),a[u].c(),I(a[u],1),a[u].m(r.parentNode,r))}for(we(),u=n.length;u<a.length;u+=1)i(u);_e()}},i(l){if(!s){I(e.$$.fragment,l);for(let f=0;f<n.length;f+=1)I(a[f]);s=!0}},o(l){P(e.$$.fragment,l),a=a.filter(Boolean);for(let f=0;f<a.length;f+=1)P(a[f]);s=!1},d(l){l&&(L(t),L(r)),H(e,l),tt(a,l)}}}function QA(o){let e,t,r,s,n,a,i,l,f,u;function d(...h){return o[20](o[28],...h)}function m(){return o[21](o[28])}function y(){return o[22](o[28])}return{c(){e=T("div"),t=T("div"),r=T("input"),n=$(),a=T("div"),l=$(),b(r,"type","checkbox"),r.checked=s=o[7][o[28]],r.disabled=o[3],b(a,"class","checkbox-toggle"),b(t,"role","checkbox"),b(t,"aria-checked",i=o[7][o[28]]),b(t,"tabindex","0"),b(t,"class","checkbox-container"),Ve(t,"is-enabled",o[7][o[28]]),b(e,"class","setting-item-control")},m(h,_){C(h,e,_),S(e,t),S(t,r),S(t,n),S(t,a),C(h,l,_),f||(u=[ee(r,"change",d),ee(t,"keypress",m),ee(t,"click",y)],f=!0)},p(h,_){o=h,_[0]&144&&s!==(s=o[7][o[28]])&&(r.checked=s),_[0]&8&&(r.disabled=o[3]),_[0]&144&&i!==(i=o[7][o[28]])&&b(t,"aria-checked",i),_[0]&144&&Ve(t,"is-enabled",o[7][o[28]])},d(h){h&&(L(e),L(l)),f=!1,ke(u)}}}function Mb(o){let e,t;return e=new $e({props:{name:o[29].name,description:o[29].description,$$slots:{default:[QA]},$$scope:{ctx:o}}}),{c(){V(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let n={};s[0]&16&&(n.name=r[29].name),s[0]&16&&(n.description=r[29].description),s[0]&152|s[1]&2&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function ZA(o){let e,t,r;return{c(){e=T("button"),e.textContent="Delete local",b(e,"class","mod-warning")},m(s,n){C(s,e,n),t||(r=ee(e,"click",(0,ra.debounce)(o[23])),t=!0)},p:X,d(s){s&&L(e),t=!1,r()}}}function eF(o){let e,t,r,s,n,a,i;return{c(){e=T("button"),t=G("Delete metadata"),b(e,"class",r=o[6]?"mod-disabled":"mod-warning"),e.disabled=s=!!o[6],b(e,"aria-label",n=o[6]?"Metadata is required for sharing.":"")},m(l,f){C(l,e,f),S(e,t),a||(i=ee(e,"click",(0,ra.debounce)(o[24])),a=!0)},p(l,f){f[0]&64&&r!==(r=l[6]?"mod-disabled":"mod-warning")&&b(e,"class",r),f[0]&64&&s!==(s=!!l[6])&&(e.disabled=s),f[0]&64&&n!==(n=l[6]?"Metadata is required for sharing.":"")&&b(e,"aria-label",n)},d(l){l&&L(e),a=!1,i()}}}function Eb(o){var s,n,a,i,l;let e,t,r=(((s=o[6])==null?void 0:s.owner)||((i=(a=(n=o[5])==null?void 0:n.remote)==null?void 0:a.creator)==null?void 0:i.id)===((l=o[0].relayManager.user)==null?void 0:l.id))&&Rb(o);return{c(){r&&r.c(),e=Te()},m(f,u){r&&r.m(f,u),C(f,e,u),t=!0},p(f,u){var d,m,y,h,_;(d=f[6])!=null&&d.owner||((h=(y=(m=f[5])==null?void 0:m.remote)==null?void 0:y.creator)==null?void 0:h.id)===((_=f[0].relayManager.user)==null?void 0:_.id)?r?(r.p(f,u),u[0]&97&&I(r,1)):(r=Rb(f),r.c(),I(r,1),r.m(e.parentNode,e)):r&&(we(),P(r,1,1,()=>{r=null}),_e())},i(f){t||(I(r),t=!0)},o(f){P(r),t=!1},d(f){f&&L(e),r&&r.d(f)}}}function Rb(o){let e,t,r,s;return e=new Je({props:{name:"Remote Folder"}}),r=new $e({props:{name:"Remove from relay",description:"Deletes the remote folder from the relay. Local files will be preserved.",$$slots:{default:[tF]},$$scope:{ctx:o}}}),{c(){V(e.$$.fragment),t=$(),V(r.$$.fragment)},m(n,a){N(e,n,a),C(n,t,a),N(r,n,a),s=!0},p(n,a){let i={};a[1]&2&&(i.$$scope={dirty:a,ctx:n}),r.$set(i)},i(n){s||(I(e.$$.fragment,n),I(r.$$.fragment,n),s=!0)},o(n){P(e.$$.fragment,n),P(r.$$.fragment,n),s=!1},d(n){n&&L(t),H(e,n),H(r,n)}}}function tF(o){let e,t,r;return{c(){e=T("button"),e.textContent="Delete remote",b(e,"class","mod-destructive")},m(s,n){C(s,e,n),t||(r=ee(e,"click",(0,ra.debounce)(o[14])),t=!0)},p:X,d(s){s&&L(e),t=!1,r()}}}function rF(o){let e,t,r,s,n,a,i,l=o[6]&&Xe().enableAttachmentSync,f,u,d,m,y,h,_,w,v;e=new cc({props:{category:po,categoryText:"Shared Folders",$$slots:{default:[KA]},$$scope:{ctx:o}}}),e.$on("goBack",o[12]),r=new Je({props:{name:"Relay Server"}});let M=[jA,GA],O=[];function A(F,D){return F[6]?0:1}n=A(o,[-1,-1]),a=O[n]=M[n](o);let E=l&&Db(o);u=new Je({props:{name:"Local folder"}}),m=new $e({props:{name:"Delete from vault",description:"Delete the local Shared Folder and all of its contents.",$$slots:{default:[ZA]},$$scope:{ctx:o}}}),h=new $e({props:{name:"Delete metadata",description:"Deletes edit history and disables change tracking.",$$slots:{default:[eF]},$$scope:{ctx:o}}});let R=o[6]&&Eb(o);return{c(){V(e.$$.fragment),t=$(),V(r.$$.fragment),s=$(),a.c(),i=$(),E&&E.c(),f=$(),V(u.$$.fragment),d=$(),V(m.$$.fragment),y=$(),V(h.$$.fragment),_=$(),R&&R.c(),w=Te()},m(F,D){N(e,F,D),C(F,t,D),N(r,F,D),C(F,s,D),O[n].m(F,D),C(F,i,D),E&&E.m(F,D),C(F,f,D),N(u,F,D),C(F,d,D),N(m,F,D),C(F,y,D),N(h,F,D),C(F,_,D),R&&R.m(F,D),C(F,w,D),v=!0},p(F,D){let B={};D[0]&2|D[1]&2&&(B.$$scope={dirty:D,ctx:F}),e.$set(B);let q=n;n=A(F,D),n===q?O[n].p(F,D):(we(),P(O[q],1,1,()=>{O[q]=null}),_e(),a=O[n],a?a.p(F,D):(a=O[n]=M[n](F),a.c()),I(a,1),a.m(i.parentNode,i)),D[0]&64&&(l=F[6]&&Xe().enableAttachmentSync),l?E?(E.p(F,D),D[0]&64&&I(E,1)):(E=Db(F),E.c(),I(E,1),E.m(f.parentNode,f)):E&&(we(),P(E,1,1,()=>{E=null}),_e());let J={};D[1]&2&&(J.$$scope={dirty:D,ctx:F}),m.$set(J);let K={};D[0]&64|D[1]&2&&(K.$$scope={dirty:D,ctx:F}),h.$set(K),F[6]?R?(R.p(F,D),D[0]&64&&I(R,1)):(R=Eb(F),R.c(),I(R,1),R.m(w.parentNode,w)):R&&(we(),P(R,1,1,()=>{R=null}),_e())},i(F){v||(I(e.$$.fragment,F),I(r.$$.fragment,F),I(a),I(E),I(u.$$.fragment,F),I(m.$$.fragment,F),I(h.$$.fragment,F),I(R),v=!0)},o(F){P(e.$$.fragment,F),P(r.$$.fragment,F),P(a),P(E),P(u.$$.fragment,F),P(m.$$.fragment,F),P(h.$$.fragment,F),P(R),v=!1},d(F){F&&(L(t),L(s),L(i),L(f),L(d),L(y),L(_),L(w)),H(e,F),H(r,F),O[n].d(F),E&&E.d(F),H(u,F),H(m,F),H(h,F),R&&R.d(F)}}}function oF(o,e,t){let r,s,n,a=X,i=()=>(a(),a=tr(m,le=>t(25,n=le)),m),l,f;o.$$.on_destroy.push(()=>a());let{plugin:u}=e,{sharedFolder:d}=e,{sharedFolders:m}=e;i();let{relayRoles:y}=e,h=uo(n,le=>le.find(Ce=>Ce===d));he(o,h,le=>t(5,s=le));let _=d.syncSettingsManager;he(o,_,le=>t(7,f=le));let w=uo([h,y],([le,Ce])=>{var Ke;return(Ke=Ce.find(Re=>{var de;return Re.relay===((de=le==null?void 0:le.remote)===null||de===void 0?void 0:de.relay)}))===null||Ke===void 0?void 0:Ke.relay});he(o,w,le=>t(6,l=le));let v=!1;function M(le,Ce){return Ge(this,void 0,void 0,function*(){if(!v){t(3,v=!0);try{yield _.toggleCategory(le,Ce),t(4,r=Object.entries(_.getCategories()))}catch(Ke){}finally{t(3,v=!1)}}})}let O;or(()=>{!d&&O&&O.value===""&&O.focus()});let A=Ht();function E(){return Ge(this,void 0,void 0,function*(){A("goBack",{clear:!0})})}function R(le){le&&A("manageRelay",{relay:le})}function F(){return Ge(this,void 0,void 0,function*(){yield u.relayManager.deleteRemote(d),u.sharedFolders.notifyListeners()})}function D(){return Ge(this,void 0,void 0,function*(){s&&u.sharedFolders.delete(s),A("goBack",{clear:!0})})}function B(){let le=u.vault.getFolderByPath(d.path);le&&u.app.vault.trash(le,!1),A("goBack",{})}function q(le){Gr.call(this,o,le)}let J=()=>{R(l)},K=(le,Ce)=>M(le,Ce.currentTarget.checked),z=le=>M(le,!f[le]),W=le=>M(le,!f[le]),re=()=>{B()},Le=()=>{D()};o.$$set=le=>{"plugin"in le&&t(0,u=le.plugin),"sharedFolder"in le&&t(1,d=le.sharedFolder),"sharedFolders"in le&&i(t(2,m=le.sharedFolders)),"relayRoles"in le&&t(17,y=le.relayRoles)};e:t(4,r=Object.entries(_.getCategories()));return[u,d,m,v,r,s,l,f,h,_,w,M,E,R,F,D,B,y,q,J,K,z,W,re,Le]}var Vp=class extends Z{constructor(e){super(),te(this,e,oF,rF,Q,{plugin:0,sharedFolder:1,sharedFolders:2,relayRoles:17},null,[-1,-1])}},qp=Vp;function sF(o){let e=[],t="",r=0;for(;r<o.length;)o[r]==="*"&&r+1<o.length&&o[r+1]==="*"?(t&&(e.push({type:"TEXT",value:t}),t=""),e.push({type:"DOUBLE_STAR"}),r+=2):o[r]==="*"?(t&&(e.push({type:"TEXT",value:t}),t=""),e.push({type:"STAR"}),r++):(t+=o[r],r++);return t&&e.push({type:"TEXT",value:t}),e}function nF(o){let e="",t="NORMAL",r=0;for(;r<o.length;){let s=o[r];switch(t){case"NORMAL":s.type==="TEXT"?e+=s.value:s.type==="STAR"?(t="EMPHASIS",e+="<u>"):s.type==="DOUBLE_STAR"&&(t="BOLD",e+="<strong>");break;case"EMPHASIS":s.type==="TEXT"?e+=s.value:s.type==="STAR"?(t="NORMAL",e+="</u>"):s.type==="DOUBLE_STAR"&&(t="BOLD",e+="</u><strong>");break;case"BOLD":s.type==="TEXT"?e+=s.value:s.type==="STAR"?e+="*":s.type==="DOUBLE_STAR"&&(t="NORMAL",e+="</strong>");break}r++}return t==="EMPHASIS"?e+="</u>":t==="BOLD"&&(e+="</strong>"),e}function Wp(o){let e=sF(o);return nF(e)}function aF(o){De(o,"svelte-d22j3",".relay-version.svelte-d22j3{user-select:auto;background:var(--color-base-10);color:var(--text-faint);position:absolute;bottom:0;right:0;font-size:xx-small;padding-right:1em;padding-top:0.3em;padding-left:1em;border-top-left-radius:1em}.vertical-tab-content.svelte-d22j3{max-height:var(--modal-max-height);position:relative}.system3-announcement-banner.svelte-d22j3{padding-left:48px !important}.system3-announcement.svelte-d22j3{color:var(--text-on-accent)}")}function iF(o){let e,t,r,s,n=o[0].networkStatus.status&&Ob(o);return{c(){e=T("div"),t=T("span"),n&&n.c(),b(t,"class","system3-announcement svelte-d22j3"),pe(t,"color",o[0].networkStatus.status.color?o[0].networkStatus.status.color:"var(--text-on-accent)",1),b(e,"class","modal-setting-nav-bar system3-announcement-banner svelte-d22j3"),b(e,"role","button"),b(e,"tabindex","0"),pe(e,"background-color",o[0].networkStatus.status.backgroundColor?o[0].networkStatus.status.backgroundColor:"var(--color-accent)",1)},m(a,i){C(a,e,i),S(e,t),n&&n.m(t,null),r||(s=[ee(e,"click",o[17]),ee(e,"keypress",o[18])],r=!0)},p(a,i){a[0].networkStatus.status?n?n.p(a,i):(n=Ob(a),n.c(),n.m(t,null)):n&&(n.d(1),n=null),i&1&&pe(t,"color",a[0].networkStatus.status.color?a[0].networkStatus.status.color:"var(--text-on-accent)",1),i&1&&pe(e,"background-color",a[0].networkStatus.status.backgroundColor?a[0].networkStatus.status.backgroundColor:"var(--color-accent)",1)},i:X,o:X,d(a){a&&L(e),n&&n.d(),r=!1,ke(s)}}}function lF(o){let e,t;return e=new Ab({}),e.$on("goBack",o[9]),{c(){V(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p:X,i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function Ob(o){let e,t=Wp(o[0].networkStatus.status.status)+"",r;return{c(){e=new Hn(!1),r=Te(),e.a=r},m(s,n){e.m(t,s,n),C(s,r,n)},p(s,n){n&1&&t!==(t=Wp(s[0].networkStatus.status.status)+"")&&e.p(t)},d(s){s&&(L(r),e.d())}}}function cF(o){let e,t;return e=new Jx({props:{plugin:o[0],$$slots:{default:[dF]},$$scope:{ctx:o}}}),{c(){V(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let n={};s&1&&(n.plugin=r[0]),s&8388609&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function fF(o){let e,t;return e=new ta({props:{plugin:o[0],relayRoles:o[3],relay:o[2],sharedFolders:o[5]}}),e.$on("goBack",o[9]),e.$on("close",o[10]),e.$on("manageSharedFolder",o[7]),{c(){V(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let n={};s&1&&(n.plugin=r[0]),s&4&&(n.relay=r[2]),e.$set(n)},i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function uF(o){let e,t;return e=new qp({props:{plugin:o[0],relayRoles:o[3],sharedFolder:o[1],sharedFolders:o[5]}}),e.$on("goBack",o[9]),e.$on("close",o[10]),e.$on("manageRelay",o[6]),{c(){V(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let n={};s&1&&(n.plugin=r[0]),s&2&&(n.sharedFolder=r[1]),e.$set(n)},i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function dF(o){let e,t;return e=new mo({props:{relays:o[4],plugin:o[0]}}),e.$on("manageRelay",o[6]),e.$on("manageSharedFolder",o[7]),e.$on("createRelay",o[8]),e.$on("joinRelay",o[11]),{c(){V(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let n={};s&1&&(n.plugin=r[0]),e.$set(n)},i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function Ub(o){let e,t=o[0].version+"",r;return{c(){e=T("span"),r=G(t),b(e,"class","relay-version svelte-d22j3")},m(s,n){C(s,e,n),S(e,r)},p(s,n){n&1&&t!==(t=s[0].version+"")&&ne(r,t)},d(s){s&&L(e)}}}function pF(o){let e,t,r,s,n,a,i,l,f,u=[lF,iF],d=[];function m(v,M){return v[2]||v[1]?0:v[0].networkStatus.status?1:-1}~(e=m(o,-1))&&(t=d[e]=u[e](o));let y=[uF,fF,cF],h=[];function _(v,M){return v[1]?0:v[2]?1:2}n=_(o,-1),a=h[n]=y[n](o);let w=o[0].manifest.version!==o[0].version&&Ub(o);return{c(){t&&t.c(),r=$(),s=T("div"),a.c(),i=$(),w&&w.c(),l=Te(),b(s,"class","vertical-tab-content svelte-d22j3")},m(v,M){~e&&d[e].m(v,M),C(v,r,M),C(v,s,M),h[n].m(s,null),C(v,i,M),w&&w.m(v,M),C(v,l,M),f=!0},p(v,[M]){let O=e;e=m(v,M),e===O?~e&&d[e].p(v,M):(t&&(we(),P(d[O],1,1,()=>{d[O]=null}),_e()),~e?(t=d[e],t?t.p(v,M):(t=d[e]=u[e](v),t.c()),I(t,1),t.m(r.parentNode,r)):t=null);let A=n;n=_(v,M),n===A?h[n].p(v,M):(we(),P(h[A],1,1,()=>{h[A]=null}),_e(),a=h[n],a?a.p(v,M):(a=h[n]=y[n](v),a.c()),I(a,1),a.m(s,null)),v[0].manifest.version!==v[0].version?w?w.p(v,M):(w=Ub(v),w.c(),w.m(l.parentNode,l)):w&&(w.d(1),w=null)},i(v){f||(I(t),I(a),f=!0)},o(v){P(t),P(a),f=!1},d(v){v&&(L(r),L(s),L(i),L(l)),~e&&d[e].d(v),h[n].d(),w&&w.d(v)}}}function mF(o,e,t){let r,{plugin:s}=e,{path:n=void 0}=e,a=s.app,i=s.relayManager,l=i.relayRoles,f=i.relays;he(o,f,q=>t(16,r=q));let u=s.sharedFolders,d,m=mo,y,h=[{component:mo}],{close:_}=e;function w(q){if(t(2,y=void 0),t(1,d=void 0),q==="/"){t(15,m=mo);return}let J=new URLSearchParams(q.split("?")[1]||""),K=J.get("id");if(q.startsWith("/relays")){K?(t(2,y=i.relays.find(z=>z.guid===K)),t(15,m=ta)):t(15,m=mo);return}if(q.startsWith("/shared-folders")){if(K){t(1,d=u.find(W=>W.guid===K));let z=J.get("relay");z&&t(2,y=i.relays.get(z)),t(15,m=qp)}return}}function v(q){h.push({currentRelay:y,sharedFolder:d,component:m}),t(2,y=q.detail.relay),t(1,d=void 0),t(15,m=ta)}function M(q){h.push({currentRelay:y,sharedFolder:d,component:m}),t(1,d=q.detail.folder),t(2,y=q.detail.relay)}function O(q){return Ge(this,void 0,void 0,function*(){h.push({currentRelay:y,sharedFolder:d,component:m}),t(2,y=yield s.relayManager.createRelay("")),t(15,m=ta)})}function A(q){if(q.detail.clear){h.length=0,t(2,y=void 0),t(1,d=void 0),t(15,m=mo);return}let J=h.pop();if(J)for(;J;){if(!J.currentRelay&&!J.sharedFolder)t(2,y=J.currentRelay),t(1,d=J.sharedFolder),t(15,m=J.component);else if(J.sharedFolder&&u.has(J.sharedFolder)){t(2,y=J.currentRelay),t(1,d=J.sharedFolder),t(15,m=J.component);break}else if(J.currentRelay&&i.relays.get(J.currentRelay.id)){t(2,y=J.currentRelay),t(1,d=J.sharedFolder),t(15,m=J.component);break}J=h.pop()}else t(2,y=void 0),t(1,d=void 0),t(15,m=mo)}function E(q){h.length=0,_()}function R(q){t(2,y=q.detail.relay),t(15,m=ta)}function F(){var q;!((q=s.networkStatus.status)===null||q===void 0)&&q.versions&&(s.releaseSettings.get().channel==="stable"?s.installVersion(s.networkStatus.status.versions.stable):s.releaseSettings.get().channel==="beta"&&s.installVersion(s.networkStatus.status.versions.beta))}let D=()=>{var q,J;(q=s.networkStatus.status)!=null&&q.versions?F():(J=s.networkStatus.status)!=null&&J.link&&window.open(s.networkStatus.status.link)},B=()=>{var q,J;(q=s.networkStatus.status)!=null&&q.versions?F():(J=s.networkStatus.status)!=null&&J.link&&window.open(s.networkStatus.status.link)};return o.$$set=q=>{"plugin"in q&&t(0,s=q.plugin),"path"in q&&t(13,n=q.path),"close"in q&&t(14,_=q.close)},o.$$.update=()=>{if(o.$$.dirty&8192){e:n&&w(n)}if(o.$$.dirty&65540){e:y&&!r.has(y.id)&&(t(2,y=void 0),t(15,m=mo))}if(o.$$.dirty&2){e:d&&!u.has(d)&&(t(1,d=void 0),t(15,m=mo))}if(o.$$.dirty&32774){e:(m||y||d)&&setTimeout(()=>{let q=document.querySelector(".vertical-tab-content");q&&(q.scrollTop=0)},0)}},[s,d,y,l,f,u,v,M,O,A,E,R,F,n,_,m,r,D,B]}var zp=class extends Z{constructor(e){super(),te(this,e,mF,pF,Q,{plugin:0,path:13,close:14},aF)}},$b=zp;var mc=class extends Bb.PluginSettingTab{constructor(t,r){super(t,r);this.plugin=r}display(){let{containerEl:t}=this;this.targetEl=t.parentElement,this.targetEl.empty(),this.plugin.relayManager.update(),this.component=new $b({target:this.targetEl,props:{plugin:this.plugin,close:()=>{this.setting.close()}}})}navigateTo(t){var r;(r=this.component)==null||r.$set({path:t})}hide(){var t;try{(t=this.component)==null||t.$destroy()}catch(r){console.warn(r)}}destroy(){this.hide(),this.plugin=null}};var Nb=require("obsidian");var hc=class extends ja{constructor(t="pocketbase_auth"){super();this.storageFallback={};this._storageChangeHandler=t=>{if(t.key!=this.storageKey)return;let r=this._storageGet(this.storageKey)||{};super.save(r.token||"",r.model||null)};this.storageKey=t,this._bindStorageEvent()}get token(){return(this._storageGet(this.storageKey)||{}).token||""}get model(){return(this._storageGet(this.storageKey)||{}).model||null}save(t,r){this._storageSet(this.storageKey,{token:t,model:r}),super.save(t,r)}clear(){this._storageRemove(this.storageKey),super.clear()}destroy(){this._unbindStorageEvent()}_storageGet(t){if(typeof window!="undefined"&&(window!=null&&window.localStorage)){let r=window.localStorage.getItem(t)||"";try{return JSON.parse(r)}catch(s){return r}}return this.storageFallback[t]}_storageSet(t,r){if(typeof window!="undefined"&&(window!=null&&window.localStorage)){let s=r;typeof r!="string"&&(s=JSON.stringify(r)),window.localStorage.setItem(t,s)}else this.storageFallback[t]=r}_storageRemove(t){var r;typeof window!="undefined"&&(window!=null&&window.localStorage)&&((r=window.localStorage)==null||r.removeItem(t)),delete this.storageFallback[t]}_bindStorageEvent(){if(typeof window=="undefined"||!(window!=null&&window.localStorage)||!window.addEventListener)return()=>{};window.addEventListener("storage",this._storageChangeHandler)}_unbindStorageEvent(){if(typeof window=="undefined"||!(window!=null&&window.localStorage)||!window.addEventListener)return()=>{};window.removeEventListener("storage",this._storageChangeHandler)}};var gc=class extends xt{constructor(t,r,s,n){var i;super();this.beforeLogin=n;let a=Pe("[Pocketbase]","debug");this.authStore=new hc(`pocketbase_auth_${t}`),this.pb=new Un("https://auth.system3.md",this.authStore),this.pb.beforeSend=(l,f)=>(a(l,f),f.fetch=Pt,f.headers=Object.assign({},f.headers,{"Relay-Version":"0.4.10"}),{url:l,options:f}),this.refreshToken(),s.setInterval(()=>this.refreshToken(),864e5),this.openSettings=r,this.pb.authStore.isValid||this.logout(),(i=this.pb.authStore.model)!=null&&i.id&&this.pb.collection("users").getOne(this.pb.authStore.model.id).catch(l=>{l.status===404&&this.logout()}),Et.set(this,"loginManager")}refreshToken(){this.pb.authStore.isValid&&(this.user=this.makeUser(this.pb.authStore),this.pb.collection("users").authRefresh().then(t=>{let r=t.token,[,s]=r.split("."),n=JSON.parse(atob(s)),a=new Date(n.exp*1e3),i=new Date,l=Math.ceil((a.getTime()-i.getTime())/(1e3*60*60*24));this.log("Token Refreshed"),this.log("JWT Info:",{expiresAt:a.toLocaleString(),expiresIn:`${l} days`,userId:n.id,email:n.email})}))}setup(t){var r,s;return this.pb.authStore.isValid?(this.user=this.makeUser(this.pb.authStore,(r=t==null?void 0:t.meta)==null?void 0:r.rawUser),this.notifyListeners(),t&&this.pb.collection("oauth2_response").create({user:t.record.id,oauth_response:(s=t.meta)==null?void 0:s.rawUser}).then(()=>{this.notifyListeners()}).catch(n=>{this.log(n)}),!0):(this.notifyListeners(),!1)}whoami(){let t={Authorization:`Bearer ${this.pb.authStore.token}`};(0,Nb.requestUrl)({url:"https://api.system3.md/whoami",method:"GET",headers:t}).then(r=>{this.log(r.json)}).catch(r=>{this.log(r)})}get loggedIn(){return this.user!==void 0}get hasUser(){return this.user!==void 0}makeUser(t,r){var s,n,a,i;return new ic((s=t.model)==null?void 0:s.id,((n=t.model)==null?void 0:n.name)||(r==null?void 0:r.name),(a=t.model)==null?void 0:a.email,((i=t.model)==null?void 0:i.picture)||(r==null?void 0:r.picture),t.token)}logout(){this.pb.cancelAllRequests(),this.pb.authStore.clear(),this.user=void 0,this.notifyListeners()}webviewIntercept(){let t=this.pb.buildUrl("/api/oauth2-redirect"),r="https:\\/\\/accounts\\.google\\.com\\/o\\/oauth2\\/auth";return new RegExp(`^${r}.*?[?&]redirect_uri=${encodeURIComponent(t)}`,"i")}async initiateManualOAuth2CodeFlow(t){this.beforeLogin();let s=(await this.pb.collection("users").listAuthMethods({fetch:t}).catch(a=>{throw a.originalError})).authProviders[0],n=this.pb.buildUrl("/api/oauth2-redirect");return[s.authUrl+n,s,async a=>this.pb.collection("users").authWithOAuth2Code(s.name,a,s.codeVerifier,n,{fetch:t}).then(i=>(this.setup(i),i))]}async poll(t,r){let s=0,n=1e3;return new Promise((a,i)=>{let l=setInterval(()=>{if(s+=1,s>=30)return clearInterval(l),i(new Error(`Auth timeout: Timed out after ${s*n/1e3} seconds`));this.pb.collection("code_exchange").getOne(t.state.slice(0,15)).then(f=>{if(f)return clearInterval(l),a(r(f.code))}).catch(f=>{})},n)})}async login(){this.beforeLogin();let t=await this.pb.collection("users").authWithOAuth2({provider:"google"});return this.setup(t)}async openLoginPage(){return await this.openSettings(),await new Promise((r,s)=>{let n=()=>{this.loggedIn&&(this.off(n),r(!0)),r(!1)};this.on(n)})}destroy(){this.pb.cancelAllRequests(),this.pb.realtime.unsubscribe(),this.pb=null,this.authStore.destroy(),this.authStore=null,this.user=void 0,this.openSettings=null,super.destroy()}};var Vt=crypto;var ho=new TextEncoder,Sr=new TextDecoder,bH=2**32;var Hb=o=>{let e=o;typeof e=="string"&&(e=ho.encode(e));let t=32768,r=[];for(let s=0;s<e.length;s+=t)r.push(String.fromCharCode.apply(null,e.subarray(s,s+t)));return btoa(r.join(""))},jr=o=>Hb(o).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"),Vb=o=>{let e=atob(o),t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t},Ws=o=>{let e=o;e instanceof Uint8Array&&(e=Sr.decode(e)),e=e.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return Vb(e)}catch(t){throw new TypeError("The input to be decoded is not correctly encoded.")}};var Kp={};lf(Kp,{JOSEAlgNotAllowed:()=>di,JOSEError:()=>Rt,JOSENotSupported:()=>St,JWEDecryptionFailed:()=>pi,JWEInvalid:()=>kr,JWKInvalid:()=>xc,JWKSInvalid:()=>bc,JWKSMultipleMatchingKeys:()=>wc,JWKSNoMatchingKey:()=>mi,JWKSTimeout:()=>_c,JWSInvalid:()=>Wo,JWSSignatureVerificationFailed:()=>hi,JWTClaimValidationFailed:()=>ui,JWTExpired:()=>yc,JWTInvalid:()=>sr});var Rt=class extends Error{static get code(){return"ERR_JOSE_GENERIC"}constructor(e){var t;super(e),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,(t=Error.captureStackTrace)==null||t.call(Error,this,this.constructor)}},ui=class extends Rt{static get code(){return"ERR_JWT_CLAIM_VALIDATION_FAILED"}constructor(e,t="unspecified",r="unspecified"){super(e),this.code="ERR_JWT_CLAIM_VALIDATION_FAILED",this.claim=t,this.reason=r}},yc=class extends Rt{static get code(){return"ERR_JWT_EXPIRED"}constructor(e,t="unspecified",r="unspecified"){super(e),this.code="ERR_JWT_EXPIRED",this.claim=t,this.reason=r}},di=class extends Rt{constructor(){super(...arguments),this.code="ERR_JOSE_ALG_NOT_ALLOWED"}static get code(){return"ERR_JOSE_ALG_NOT_ALLOWED"}},St=class extends Rt{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}static get code(){return"ERR_JOSE_NOT_SUPPORTED"}},pi=class extends Rt{constructor(){super(...arguments),this.code="ERR_JWE_DECRYPTION_FAILED",this.message="decryption operation failed"}static get code(){return"ERR_JWE_DECRYPTION_FAILED"}},kr=class extends Rt{constructor(){super(...arguments),this.code="ERR_JWE_INVALID"}static get code(){return"ERR_JWE_INVALID"}},Wo=class extends Rt{constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}static get code(){return"ERR_JWS_INVALID"}},sr=class extends Rt{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}static get code(){return"ERR_JWT_INVALID"}},xc=class extends Rt{constructor(){super(...arguments),this.code="ERR_JWK_INVALID"}static get code(){return"ERR_JWK_INVALID"}},bc=class extends Rt{constructor(){super(...arguments),this.code="ERR_JWKS_INVALID"}static get code(){return"ERR_JWKS_INVALID"}},mi=class extends Rt{constructor(){super(...arguments),this.code="ERR_JWKS_NO_MATCHING_KEY",this.message="no applicable key found in the JSON Web Key Set"}static get code(){return"ERR_JWKS_NO_MATCHING_KEY"}},wc=class extends Rt{constructor(){super(...arguments),this.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS",this.message="multiple matching keys found in the JSON Web Key Set"}static get code(){return"ERR_JWKS_MULTIPLE_MATCHING_KEYS"}},_c=class extends Rt{constructor(){super(...arguments),this.code="ERR_JWKS_TIMEOUT",this.message="request timed out"}static get code(){return"ERR_JWKS_TIMEOUT"}},hi=class extends Rt{constructor(){super(...arguments),this.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED",this.message="signature verification failed"}static get code(){return"ERR_JWS_SIGNATURE_VERIFICATION_FAILED"}};var vc=Vt.getRandomValues.bind(Vt);function bF(o){return typeof o=="object"&&o!==null}function nr(o){if(!bF(o)||Object.prototype.toString.call(o)!=="[object Object]")return!1;if(Object.getPrototypeOf(o)===null)return!0;let e=o;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(o)===e}var FF=Symbol();var HF,Ic,Zb;(typeof navigator=="undefined"||!((Zb=(Ic=navigator.userAgent)==null?void 0:Ic.startsWith)!=null&&Zb.call(Ic,"Mozilla/5.0 ")))&&(HF="jose/v5.3.0");var Yp={};lf(Yp,{decode:()=>Lc,encode:()=>VF});var VF=jr,Lc=Ws;function Jp(o){if(typeof o!="string")throw new sr("JWTs must use Compact JWS serialization, JWT must be a string");let{1:e,length:t}=o.split(".");if(t===5)throw new sr("Only JWTs using Compact JWS serialization can be decoded");if(t!==3)throw new sr("Invalid JWT");if(!e)throw new sr("JWTs must contain a payload");let r;try{r=Lc(e)}catch(n){throw new sr("Failed to base64url decode the payload")}let s;try{s=JSON.parse(Sr.decode(r))}catch(n){throw new sr("Failed to parse the decoded payload as JSON")}if(!nr(s))throw new sr("Invalid JWT Claims Set");return s}var zs=class extends Error{constructor(e){super(e),this.name="[System3] Relay Error"}};function ew(o){return o<1e3?`${o}ms`:o<6e4?`${Math.round(o/1e3)}s`:o<36e5?`${Math.round(o/6e4)}m`:`${Math.round(o/36e5)}h`}function qF(o){let e=Jp(o.token);if(typeof e=="string")return 0;let t=e==null?void 0:e.exp;return t?t*1e3:0}var Cc=class{constructor(e,t=5){this.expiryMargin=5*60*1e3;this.activeConnections=0;this._activePromises=new Map,e.getStorage?this.tokenMap=e.getStorage():this.tokenMap=new Map,this.callbacks=new Map,this.refreshQueue=new Set,this._log=e.log,this.refresh=e.refresh,this.timeProvider=e.getTimeProvider(),e.getJwtExpiry?this.getJwtExpiry=e.getJwtExpiry:this.getJwtExpiry=qF,this.maxConnections=t,this.refreshInterval=null,Et.set(this,"TokenStore")}onRefresh(e){return new Promise((r,s)=>{let n=i=>{r(i)},a=i=>{this.removeFromRefreshQueue(e),s(i)};this.refresh(e,n,a)})}start(){this.log("starting"),this.report(),this.refreshInterval=this.timeProvider.setInterval(()=>this.checkAndRefreshTokens(),60*1e3),this.checkAndRefreshTokens()}stop(){this.log("stopping"),this.refreshInterval&&(this.timeProvider.clearInterval(this.refreshInterval),this.refreshInterval=null)}_cleanupInvalidTokens(){let e=[];for(let[t,r]of this.tokenMap.entries())this.isTokenValid(r)||e.push(t);for(let t of e)this.tokenMap.delete(t)}checkAndRefreshTokens(){this.log("check and refresh tokens"),this._cleanupInvalidTokens();for(let[e,t]of this.tokenMap.entries())this.callbacks.has(e)&&this.shouldRefresh(t)&&(this.log("adding to refresh queue"),this.addToRefreshQueue(e));this.log(this.report())}dequeue(){if(this.log("getting next item in queue"),this.refreshQueue.size>0){let e=this.refreshQueue.values().next().value;return this.refreshQueue.delete(e),e}return null}addToRefreshQueue(e){if(this.activeConnections<this.maxConnections){this.log(`immediate refresh of ${e}`),this.activeConnections++;let t=s=>{this.onTokenRefreshed(e,s),this.activeConnections--;let n=this.dequeue();n&&this.addToRefreshQueue(n)},r=()=>{this.onRefreshFailure(e),this.activeConnections--;let s=this.dequeue();s&&this.addToRefreshQueue(s)};this.refresh(e,t,r)}else this.log(`enqueued refresh of ${e}`),this.refreshQueue.add(e)}removeFromRefreshQueue(e){return this.log(`removing ${e} from refresh queue`),this.refreshQueue.has(e)?(this.refreshQueue.delete(e),!0):!1}log(e){this._log(e)}onTokenRefreshed(e,t){let r=this.getJwtExpiry(t);if(this.tokenMap.has(e)){let s=this.tokenMap.get(e),n=this.callbacks.get(e);this.log(`new expiry time is ${r}`),this.tokenMap.set(e,{...s,token:t,expiryTime:r}),n(t),this.log(`Token refreshed for ${s.friendlyName} (${e})`)}}onRefreshFailure(e){let t=this.tokenMap.get(e),r=(t==null?void 0:t.attempts)||0+1;r<=3?this.tokenMap.set(e,{...t,attempts:r}):this.tokenMap.delete(e)}isTokenValid(e){return this.timeProvider.getTime()<e.expiryTime}shouldRefresh(e){return this.timeProvider.getTime()+this.expiryMargin>e.expiryTime}getTokenSync(e){var t,r;return(r=(t=this.tokenMap)==null?void 0:t.get(e))==null?void 0:r.token}getTokenFromNetwork(e,t,r){let s=this._activePromises.get(e);if(s)return s;this.tokenMap.set(e,{token:null,friendlyName:t,expiryTime:0,attempts:0}),this.callbacks.set(e,r);let n=this.onRefresh(e).then(a=>(this.onTokenRefreshed(e,a),this._activePromises.delete(e),a)).catch(a=>{throw this.onRefreshFailure(e),this._activePromises.delete(e),a});return this._activePromises.set(e,n),n}async getToken(e,t,r){if(this.log(`getting token ${t}`),this.tokenMap||Promise.reject(new zs("attempted to get token after TokenStore was destroyed.")),this.tokenMap.has(e)){let s=this.tokenMap.get(e);if(s.token&&this.isTokenValid(s))return this.callbacks.set(e,r),s.friendlyName=t,r(s.token),this.log("token was valid, cache hit!"),this._activePromises.delete(e),Promise.resolve(s.token)}return this.getTokenFromNetwork(e,t,r)}_reportWithFilter(e){let t=[],r=this.timeProvider.getTime(),s=Array.from(this.tokenMap.entries()).sort((n,a)=>n[1].expiryTime-a[1].expiryTime);for(let[n,{friendlyName:a,expiryTime:i,attempts:l}]of s){if(!e(n))continue;let f=i-r,u="";f>0?u=`expires in ${ew(f-this.expiryMargin)}`:u="expired",t.push(`${n} (${a}): ${l} attempts, (${u})`)}return t}report(){let e=[];return e.push("Token Store Report:"),e.push(`Expiry Margin: ${ew(this.expiryMargin)}`),e.push("Active Tokens:"),e.push(...this._reportWithFilter(t=>this.callbacks.has(t))),e.push("Stale Tokens:"),e.push(...this._reportWithFilter(t=>!this.callbacks.has(t))),e.push(`Queue size: ${this.refreshQueue.size}`),e.join(`
`)}async waitForQueue(){return new Promise(e=>{setInterval(()=>{if(this.refreshQueue.size==0)return e()},100)})}clearState(){this.refreshQueue.clear();for(let[e,t]of this.tokenMap.entries())this.isTokenValid(t)?this.tokenMap.set(e,{...t,attempts:0}):this.tokenMap.delete(e)}clear(e){e?this.tokenMap.forEach((t,r)=>{e(t)&&(this.tokenMap.delete(r),this.refreshQueue.delete(r))}):(this.tokenMap.clear(),this.refreshQueue.clear())}destroy(){this.clear(),this.timeProvider.destroy(),this.timeProvider=null,this.refresh=null,this.callbacks.clear(),this.callbacks=null,this._activePromises.clear(),this._activePromises=null,this.tokenMap=null}};function WF(o){return o.expiryTime||0}function zF(o,e){return(...t)=>e(o,...t)}async function KF(o,e,t,r){var f;let s=Pe("[TokenStore][Refresh]","debug"),n=Pe("[TokenStore][Refresh]","error");s(`${e}`);let a=Tt.decode(e),i;if(a instanceof zr)i=JSON.stringify({docId:a.documentId,relay:a.relayId,folder:a.folderId});else if(a instanceof Eo)i=JSON.stringify({docId:a.folderId,relay:a.relayId,folder:a.folderId});else{r(new Error("No remote to connect to"));return}if(!o.loggedIn){r(Error("Not logged in"));return}let l={Authorization:`Bearer ${(f=o.user)==null?void 0:f.token}`,"Relay-Version":"0.4.10"};try{let u=await Pt("https://api.system3.md/token",{method:"POST",headers:l,body:i});if(!u.ok){s(u.status,await u.text()),r(Error(`Received status code ${u.status} from an API.`));return}let d=await u.json();t(d)}catch(u){n(u,i),r(u)}}var Tc=class extends Cc{constructor(t,r,s,n=5){super({log:Pe("[LiveTokenStore]","debug"),refresh:zF(t,KF),getJwtExpiry:WF,getStorage:function(){return new Uo("TokenStore/"+s)},getTimeProvider:()=>r},n);this.loginManager=t}async getFileTokenFromNetwork(t,r,s,n){let a=this._activePromises.get(r);if(a)return a;this.tokenMap.set(t,{token:null,expiryTime:0,attempts:0});let i=this.fetchFileToken(t,r,s,n).then(l=>{let f=this.getJwtExpiry(l),u=this.tokenMap.get(r);return this.tokenMap.set(r,{...u,token:l,expiryTime:f}),this._activePromises.delete(r),l}).catch(l=>{throw this._activePromises.delete(r),l});return this._activePromises.set(r,i),i}async fetchFileToken(t,r,s,n){var m;let a=Pe("[TokenStore][Fetch]","debug");a(`${t}`);let i=Tt.decode(t),l;if(i instanceof ns)l=JSON.stringify({docId:i.fileId,relay:i.relayId,folder:i.folderId,hash:r,contentType:s,contentLength:n});else throw new Error("No remote to connect to");if(!this.loginManager.loggedIn)throw new Error("Not logged in");let f={Authorization:`Bearer ${(m=this.loginManager.user)==null?void 0:m.token}`,"Relay-Version":"0.4.10"},u=await Pt("https://api.system3.md/file-token",{method:"POST",headers:f,body:l});if(!u.ok)throw a(u.status,await u.text()),new Error("invalid server response");return await u.json()}async getFileToken(t,r,s,n){let a=this.tokenMap.get(t);return a&&a.token&&this.isTokenValid(a)?(this.log("token was valid, cache hit!"),this._activePromises.delete(t),Promise.resolve(a.token)):this.getFileTokenFromNetwork(t,r,s,n)}};var tw=require("obsidian");var Xp=class{constructor(e,t,r=1e4){this.timeProvider=e;this.onOnline=[];this.onOffline=[];this.online=!0;this._log=Pe("[NetworkStatus]"),this.url=t,this.interval=r,this._onceOnline=new Set}log(e,...t){this._log(e,...t)}start(){this.timer||(this.timer=this.checkStatusRepeatedly())}stop(){this.timer&&clearInterval(this.timer)}checkStatusRepeatedly(){return this.timeProvider.setInterval(this._checkStatus.bind(this),this.interval)}checkStatus(){return this.online?Promise.resolve(!0):new Promise(e=>{this._checkStatus().then(()=>{e(this.online)})})}async _checkStatus(){return(0,tw.requestUrl)({url:this.url,method:"GET",headers:{"Relay-Version":"0.4.10"}}).then(e=>{if(e.status===200){if(e.json&&e.json.status&&(this.status=e.json),!this.online){this.log("back online"),this.online=!0,this.onOnline.forEach(t=>t(this.status)),this._onceOnline.forEach(t=>t(this.status)),this._onceOnline.clear();return}}else if(e.status!==200&&this.online)throw new Error("disconnected")}).catch(e=>{if(e.message.includes("ERR_NETWORK_CHANGED")){this._checkStatus();return}this.online=!1,this.onOffline.forEach(t=>t(this.status))})}onceOnline(e){this._onceOnline.add(e)}addEventListener(e,t){e==="online"?this.onOnline.push(t):e==="offline"&&this.onOffline.push(t)}destroy(){this._onceOnline.clear(),this._onceOnline=null,this.onOnline=null,this.onOffline=null,this.timeProvider=null}},rw=Xp;var nw=require("obsidian");function Qp(o){return typeof o.id=="string"}function GF(o){return typeof o.name=="string"}var Zp=class{constructor(e){this.collectionName="roles";this.roles=e}items(){return this.roles.values()}clear(){this.roles.clear()}get(e){return this.roles.get(e)}ingest(e){return this.roles.set(e.id,e),e}delete(e){this.roles.delete(e)}};function ow(o){return typeof o.aggregate_root=="object"}function sw(o){return typeof o.acl=="object"}var sa=class{get aggregate_root(){}get acl(){}},em=class extends sa{constructor(t,r,s,n){super();this.fileInfo=t;this.relays=r;this.remoteFolders=s;this.pb=n}get id(){return this.fileInfo.id}get guid(){return this.fileInfo.guid}get synchash(){return this.fileInfo.synchash}get synctime(){return this.fileInfo.synctime}get relay(){let t=this.relays.get(this.fileInfo.relay);if(!t)throw new Error("invalid file info");return t}get sharedFolder(){let t=this.remoteFolders.get(this.fileInfo.shared_folder);if(!t)throw new Error("invalid file info");return t}get updated(){return this.fileInfo.updated}get created(){return this.fileInfo.created}get mtime(){return this.fileInfo.mtime}get ctime(){return this.fileInfo.ctime}get name(){return this.fileInfo.name}get parent(){return this.fileInfo.parent}get type(){return this.fileInfo.type}get deletedAt(){return this.fileInfo.deleted_at}get lastParentId(){return this.fileInfo.last_parent_id}get isDirectory(){return this.fileInfo.is_directory}async attachmentUrl(){let t=await this.pb.files.getToken();return this.pb.getFileUrl(this.fileInfo,this.fileInfo.attachment,{token:t})}async getAttachment(){let t=await this.attachmentUrl();return(0,nw.requestUrl)(t)}toDict(){return this.fileInfo}update(t){return this.fileInfo=t,this}get aggregate_root(){return["shared_folders",this.fileInfo.shared_folder]}get acl(){return["relays",this.fileInfo.relay]}},tm=class{constructor(e,t,r,s){this.fileInfo=e;this.remoteFolders=t;this.relays=r;this.pb=s;this.collectionName="file_info"}items(){return this.fileInfo.values()}clear(){this.fileInfo.clear()}get(e){return this.fileInfo.get(e)}ingest(e){let t=this.fileInfo.get(e.id);if(t)return t.update(e),this.fileInfo.notifyListeners(),t;let r=new em(e,this.relays,this.remoteFolders,this.pb);return this.fileInfo.set(e.id,r),r}delete(e){this.remoteFolders.delete(e)}},Pc=class extends sa{constructor(t){super();this.user=t}get id(){return this.user.id}get name(){return this.user.name}update(t){return this.user=t,this}},rm=class extends sa{constructor(t,r,s){super();this.remoteFolder=t;this.relays=r;this.users=s}update(t){return this.remoteFolder=t,this}get id(){return this.remoteFolder.id}get guid(){return this.remoteFolder.guid}get name(){return this.remoteFolder.name}get private(){return this.remoteFolder.private}get creator(){let t=this.users.get(this.remoteFolder.creator);if(!t)throw new Error("invalid remote folder");return t}get relay(){let t=this.relays.get(this.remoteFolder.relay);if(!t)throw new Error("invalid remote folder");return t}get aggregate_root(){return["relays",this.remoteFolder.relay]}get acl(){return["relays",this.remoteFolder.relay]}},om=class{constructor(e,t,r){this.remoteFolders=e;this.relays=t;this.users=r;this.collectionName="shared_folders"}items(){return this.remoteFolders.values()}clear(){this.remoteFolders.clear()}get(e){return this.remoteFolders.get(e)}ingest(e){let t=this.remoteFolders.get(e.id);if(t)return t.update(e),this.remoteFolders.notifyListeners(),t;let r=new rm(e,this.relays,this.users);return this.remoteFolders.set(e.id,r),r}delete(e){this.remoteFolders.delete(e)}},sm=class{constructor(e,t,r,s,n,a,i){this.relays=e;this.roles=t;this.relayRoles=r;this.relayInvitations=s;this.remoteFolders=n;this.subscriptions=a;this.user=i;this.collectionName="relays"}items(){return this.relays.values()}clear(){this.relays.clear()}get(e){return this.relays.get(e)}ingest(e){let t=this.relays.get(e.id);if(t)return t.update(e),this.relays.notifyListeners(),t;let r=new Ac(e,this.relayRoles,this.relayInvitations,this.remoteFolders,this.subscriptions,this.user);return this.relays.set(r.id,r),r}delete(e){this.relays.delete(e)}},nm=class{constructor(e,t,r,s){this.collectionName="relay_roles";this.relayRoles=e,this.relays=t,this.users=r,this.roles=s}items(){return this.relayRoles.values()}clear(){this.relayRoles.clear()}get(e){return this.relayRoles.get(e)}ingest(e){let t=this.relayRoles.get(e.id);if(t)return t.update(e),this.relayRoles.notifyListeners(),t;let r=new fm(e,this.relays,this.users,this.roles);return this.relayRoles.set(r.id,r),r}delete(e){this.relayRoles.get(e)&&this.relayRoles.delete(e)}},am=class{constructor(e,t,r){this.collectionName="relay_invitations";this.relayInvitations=e,this.relays=t,this.roles=r}items(){return this.relayInvitations.values()}clear(){this.relayInvitations.clear()}get(e){return this.relayInvitations.get(e)}ingest(e){let t=this.relayInvitations.get(e.id);if(t)return t.update(e),this.relayInvitations.notifyListeners(),t;let r=new um(e,this.relays,this.roles);return this.relayInvitations.set(r.id,r),r}delete(e){this.relayInvitations.delete(e)}},im=class{constructor(e){this.users=e;this.collectionName="users"}items(){return this.users.values()}clear(){this.users.clear()}get(e){return this.users.get(e)}ingest(e){let t=this.users.get(e.id);if(t)return t.update(e),this.users.notifyListeners(),t;let r=new Pc(e);return this.users.set(e.id,r),r}delete(e){this.users.delete(e)}},lm=class{constructor(e,t,r){this.subscriptions=e;this.relays=t;this.users=r;this.collectionName="subscriptions"}items(){return this.subscriptions.values()}clear(){this.subscriptions.clear()}get(e){return this.subscriptions.get(e)}ingest(e){let t=this.subscriptions.get(e.id);if(t)return t.update(e),this.subscriptions.notifyListeners(),t;let r=new dm(e,this.relays,this.users);return this.subscriptions.set(e.id,r),r}delete(e){this.subscriptions.delete(e)}},cm=class extends Ct{constructor(t){super();this.collections=new Map,this.relationships=new Map;for(let r of t)this.collections.set(r.collectionName,r);Et.set(this,"Store")}getCollection(t){let r=this.collections.get(t);if(!r)throw this.error("No collection found for",t),new Error("No collection found for "+t);return r}clear(){let t=Mr.getInstance();t.beginTransaction(),this.collections.forEach(r=>{r.clear()}),this.collections.clear(),this.relationships.clear(),t.commitTransaction()}destroy(){this.clear(),this.collections=null,this.relationships=null}ingestPage(t){return this.ingestBatch(t==null?void 0:t.items)}ingestBatch(t){if(t)return t.map(r=>this.ingest(r))}ingest(t){let r=Mr.getInstance();r.beginTransaction();let s=this._ingest(t);return r.commitTransaction(),s}_ingest(t){if(!t)return;let r,s=this.collections.get(t.collectionName);if(s?r=s.ingest(t):this.error("No collection found for record",t),ow(r)){let n=r.aggregate_root;if(n){let a=t.id,i=this.relationships.get(n.join(":"))||new Set;i.add([t.collectionName,a].join(":")),this.relationships.set(n.join(":"),i)}}if(sw(r)){let n=r.acl;if(n){let a=t.id,i=this.relationships.get(n.join(":"))||new Set;i.add([t.collectionName,a].join(":")),this.relationships.set(n.join(":"),i)}}if(t.expand)for(let[,n]of Object.entries(t.expand))Array.isArray(n)?this.ingestBatch(n):this.ingest(n);return r}delete(t){this.cascade(t.collectionName,t.id)}graphviz(){let t=`digraph G {
`;for(let[r,s]of this.collections)for(let n of s.items()){if(!Qp(n)){this.warn("record has no id",n);continue}let a=r+"_"+n.id;if(GF(n)&&(a=r+"_"+n.name),t+=`  ${r}_${n.id} [label="${a}"];
`,Qp(n)&&ow(n)&&n.aggregate_root){let[i,l]=n.aggregate_root;t+=`  ${r}_${n.id} -> ${i}_${l};
`}if(Qp(n)&&sw(n)&&n.acl){let[i,l]=n.acl;t+=`  ${r}_${n.id} -> ${i}_${l} [style=dotted];
`}}return t+="}",t}cascade(t,r){let s=this.collections.get(t),n=this.relationships.get([t,r].join(":")),a=Mr.getInstance();a.beginTransaction(),s&&(this.warn("cascade delete parent",t,r),s.delete(r)),this.relationships.delete([t,r].join(":"));for(let i of n||[]){let[l,f]=i.split(":");this.warn("cascade delete child",l,f),this.getCollection(l)&&this.cascade(l,f)}a.commitTransaction()}},fm=class extends sa{constructor(t,r,s,n){super();this.users=s,this.roles=n,this.relays=r,this.relayRole=t}update(t){return this.relayRole=t,this}get id(){return this.relayRole.id}get userId(){return this.relayRole.user}get user(){let t=this.users.get(this.relayRole.user);if(!t)throw new Error(`Unable to find user: ${this.relayRole.user}`);return t}get role(){var t;return(t=this.roles.get(this.relayRole.role))==null?void 0:t.name}get relayId(){return this.relayRole.relay}get relay(){let t=this.relays.get(this.relayRole.relay);if(!t)throw new Error(`invalid role: unable to find relay ${this.relayRole.relay} on role ${this.relayRole.id}`);return t}get aggregate_root(){return["relays",this.relayRole.relay]}get acl(){return["users",this.relayRole.user]}},um=class{constructor(e,t,r){this.relayInvitation=e,this.roles=r,this.relays=t}update(e){return this.relayInvitation=e,this}get key(){return this.relayInvitation.key}get id(){return this.relayInvitation.id}get role(){var e;return(e=this.roles.get(this.relayInvitation.role))==null?void 0:e.name}get relayId(){return this.relayInvitation.relay}get relay(){let e=this.relays.get(this.relayInvitation.relay);if(!e)throw new Error("invalid invitation");return e}get aggregate_root(){return["relays",this.relayInvitation.relay]}},dm=class extends xt{constructor(t,r,s){super();this.subscription=t;this.relays=r;this.users=s}update(t){return this.subscription=t,this.notifyListeners(),this}get id(){return this.subscription.id}get token(){return this.subscription.token}get active(){return this.subscription.active}get user(){let t=this.users.get(this.subscription.user);if(!t)throw new Error("invalid subscription");return t}get relayId(){return this.subscription.relay}get relay(){let t=this.relays.get(this.subscription.relay);if(!t)throw new Error("invalid subscription");return t}get stripe_cancel_at(){return this.subscription.stripe_cancel_at}get cancelAt(){return this.subscription.stripe_cancel_at!==0?new Date(this.subscription.stripe_cancel_at*1e3):null}get quantity(){return this.subscription.stripe_quantity}get aggregate_root(){return["relays",this.subscription.relay]}get acl(){return["users",this.subscription.user]}},Ac=class extends xt{constructor(t,r,s,n,a,i){super();this.relay=t;this.relayRoles=r;this.relayInvitations=s;this.remoteFolders=n;this._subscriptions=a;this.user=i}update(t){return this.relay=t,this.notifyListeners(),this}get cta(){return this.relay.cta}get plan(){return this.relay.plan}get id(){return this.relay.id}get guid(){return this.relay.guid}get name(){return this.relay.name}set name(t){this.relay.name=t}get userLimit(){return this.relay.user_limit}get role(){var s;let t=this.relay.creator===this.user.id,r=(s=this.relayRoles.find(n=>n.relayId===this.relay.id&&n.userId===this.user.id))==null?void 0:s.role;return r||(this.warn("couldn't find role",this.relay.id,this.user,t),t?"Owner":"Member")}get owner(){return this.role==="Owner"}get invitation(){return this.relayInvitations.find(t=>t.relay.id===this.relay.id)}get folders(){return this.remoteFolders.filter(t=>t.relay.id===this.id)}get subscriptions(){return this._subscriptions.filter(t=>t.relay.id===this.id)}get acl(){var r;let t=(r=this.relayRoles.find(s=>s.relayId===this.id&&s.userId===this.user.id))==null?void 0:r.id;if(t)return["relay_roles",t]}get provider(){return this.relay.provider}},Fc=class extends Ct{constructor(t){super();this.loginManager=t;this.destroyed=!1;this.pb=this.loginManager.pb,this.users=new pr("users"),this.relays=new pr("relays"),this.remoteFolders=new pr("remote folders"),this.relayInvitations=new pr("relay invitations"),this.relayRoles=new pr("relay roles"),this.roles=new pr("roles"),this.roles.set("2arnubkcv7jpce8",{name:"Owner",id:"2arnubkcv7jpce8"}),this.roles.set("x6lllh2qsf9lxk6",{name:"Member",id:"x6lllh2qsf9lxk6"}),this.subscriptions=new pr("subscriptions"),this.fileInfo=new pr("file info"),this._offLoginManager=this.loginManager.on(()=>{this.login()}),this.setUser(),this.user&&(Et.set(this,"RelayManager"),this.buildGraph(),this.subscribe(),this.update())}buildGraph(){if(!this.user)return;if(!this.pb){console.warn("no pb!");return}if(this.store)return;let t=new Zp(this.roles),r=new im(this.users),s=new sm(this.relays,this.roles,this.relayRoles,this.relayInvitations,this.remoteFolders,this.subscriptions,this.user),n=new nm(this.relayRoles,this.relays,this.users,this.roles),a=new am(this.relayInvitations,this.relays,this.roles),i=new om(this.remoteFolders,this.relays,this.users),l=new lm(this.subscriptions,this.relays,this.users),f=new tm(this.fileInfo,this.remoteFolders,this.relays,this.pb);this.store=new cm([t,r,s,n,a,i,l,f])}setUser(){var t;this.authUser=(t=this.pb)==null?void 0:t.authStore.model,this.authUser&&(this.user=new Pc(this.authUser),this.users.set(this.user.id,this.user))}login(){this.setUser(),this.buildGraph(),this.subscribe(),this.update()}logout(){var t;(t=this.store)==null||t.clear(),this.user=void 0,this.store=void 0}async getRelayInvitationKey(t){if(!this.pb)return"";let r=this.relayInvitations.find(s=>s.relay.id===t.id);return r!=null&&r.key?r.key:this.pb.collection("relay_invitations").getList(0,200).then(s=>{s.items.forEach(a=>{var i;(i=this.store)==null||i.ingest(a)});let n=this.relayInvitations.find(a=>a.relay.id===t.id);return n?n.key:""})}async getSubscriptionToken(t){if(!this.pb||!this.pb.authStore.isValid)throw new Error("Auth is not valid");let r=`/api/subscription/${t.id}/token`,s=await this.pb.send(r,{method:"POST"});if(s!==200)throw new Error("Token API failed");return s.json().token}async subscribe(){var s;if(!this.pb||!this.pb.authStore.isValid||((s=this.pb.authStore.model)==null?void 0:s.id)===void 0)return;let t=[{name:"relays",expand:["relay_invitations_via_relay","shared_folders_via_relay","shared_folders_via_relay.creator","subscriptions_via_relay","subscriptions_via_relay.relay","creator"]},{name:"relay_invitations",expand:["relay"]},{name:"relay_roles",expand:["user","relay"]},{name:"shared_folders",expand:["relay","creator"]},{name:"subscriptions",expand:["user","relay"]},{name:"file_info",expand:["relay","shared_folder"]}],r=(n,a)=>{var i,l;this.debug(`[Event]: ${n}`,a.action,a.record),a.action==="delete"?(i=this.store)==null||i.delete(a.record):(l=this.store)==null||l.ingest(a.record)};for(let n of t)this.pb.collection(n.name).subscribe("*",a=>r(n.name,a),{expand:n.expand.join(","),fetch:Pt})}async update(){let t=(s,n={})=>{var a;return!this.pb||!this.pb.authStore.isValid||((a=this.pb.authStore.model)==null?void 0:a.id)===void 0?Promise.resolve([]):(typeof n=="function"&&(n=n(this.pb.authStore.model.id)),this.pb.collection(s).getFullList(n))};[t("users",s=>({filter:`id="${s}"`,expand:"relay_roles_via_user,relay_roles_via_user.relay,relay_roles_via_user.role"})),t("relay_roles",{expand:"user"}),t("relay_invitations"),t("shared_folders",{expand:"relay,creator"}),t("subscriptions",{expand:"relay,user"}),t("file_info",{expand:"relay,shared_folder"})].forEach(async s=>{let n=await s;for(let a of n)!this.destroyed&&this.store&&this.store.ingest(a)})}async acceptInvitation(t){var n;if(!this.pb)throw new Error("Failed to accept invitation");let r=await this.pb.send("/api/accept-invitation",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:t})});this.debug("[InviteAccept]",r);let s=(n=this.store)==null?void 0:n.ingest(r);if(!s)throw new Error("Failed to accept invitation");return s}async createRelay(t){var a;let r=On(),s=await((a=this.pb)==null?void 0:a.collection("relays").create({guid:r,name:t,path:null},{expand:"relay_roles_via_relay,relay_invitations_via_relay"}));if(!s)throw new Error("Failed to create Relay");if(!this.user)throw new Error("Not Logged In");let n=new Ac(s,this.relayRoles,this.relayInvitations,this.remoteFolders,this.subscriptions,this.user);return this.relays.set(n.id,n),n}async updateRelay(t){var n;if(!this.pb)throw new Error("Failed to update relay");let r=await this.pb.collection("relays").update(t.id,{name:t.name.trim()}),s=(n=this.store)==null?void 0:n.ingest(r);if(!s)throw new Error("Failed to update relay");return s}async deleteRemote(t){var s;t.remote=void 0;let r=this.remoteFolders.find(n=>n.guid===t.guid);return r?(await((s=this.pb)==null?void 0:s.collection("shared_folders").delete(r.id)),t.remote=void 0,!0):!1}async createRemoteFolder(t,r){var a,i;if(!this.pb)throw new Error("Failed to create folder");let s=await this.pb.collection("shared_folders").create({name:t.name,guid:t.guid,relay:r.id,creator:(a=this.user)==null?void 0:a.id,private:!1},{expand:"relay"}),n=(i=this.store)==null?void 0:i.ingest(s);if(!n)throw new Error("Failed to create folder");return n}async destroyRelay(t){var r,s;return(r=this.store)==null||r.cascade("relays",t.id),await((s=this.pb)==null?void 0:s.collection("relays").delete(t.id)),!0}async leaveRelay(t){var s,n;let r=this.relayRoles.find(a=>{var i;return a.userId===((i=this.user)==null?void 0:i.id)&&a.relayId===t.id});r?await((s=this.pb)==null?void 0:s.collection("relay_roles").delete(r.id)):this.warn("No role found to leave relay"),(n=this.store)==null||n.cascade("relay",t.id)}async kick(t){var r;return(r=this.pb)==null?void 0:r.collection("relay_roles").delete(t.id)}destroy(){var t,r,s;this.destroyed=!0,(t=this._offLoginManager)==null||t.call(this),this._offLoginManager=null,(r=this.pb)==null||r.cancelAllRequests(),this.loginManager=null,(s=this.store)==null||s.destroy(),this.pb=null,this.authUser=null,this.store=null}};var E_=require("obsidian");var fw=require("obsidian");var lw=require("obsidian");function jF(o){De(o,"svelte-4kkvmr",".feature-flag-toggle-modal.svelte-4kkvmr{padding:1rem}.feature-flag-item.svelte-4kkvmr{display:flex;justify-content:space-between;align-items:center;padding:0.5rem 0;border-top:1px solid var(--background-modifier-border)}.checkbox-container.svelte-4kkvmr{cursor:pointer}")}function aw(o,e,t){let r=o.slice();return r[8]=e[t][0],r[9]=e[t][1],r}function iw(o){let e,t,r,s=o[8]+"",n,a,i,l,f=o[8]+"",u,d,m,y,h,_,w,v,M,O,A,E;function R(){return o[6](o[8])}function F(){return o[7](o[8])}return{c(){e=T("div"),t=T("div"),r=T("div"),n=G(s),a=$(),i=T("div"),l=G("Toggle "),u=G(f),d=G(" on or off"),m=$(),y=T("div"),h=T("div"),_=T("input"),v=$(),M=T("div"),b(r,"class","setting-item-name"),b(i,"class","setting-item-description"),b(t,"class","setting-item-info"),b(_,"type","checkbox"),b(_,"tabindex","-1"),_.checked=w=o[9],b(M,"class","checkbox-toggle"),b(h,"role","checkbox"),b(h,"aria-checked",O=o[9]),b(h,"tabindex","0"),b(h,"class","checkbox-container svelte-4kkvmr"),Ve(h,"is-enabled",o[9]),b(y,"class","setting-item-control"),b(e,"class","feature-flag-item setting-item svelte-4kkvmr")},m(D,B){C(D,e,B),S(e,t),S(t,r),S(r,n),S(t,a),S(t,i),S(i,l),S(i,u),S(i,d),S(e,m),S(e,y),S(y,h),S(h,_),S(h,v),S(h,M),A||(E=[ee(h,"keypress",R),ee(h,"click",F)],A=!0)},p(D,B){o=D,B&2&&s!==(s=o[8]+"")&&ne(n,s),B&2&&f!==(f=o[8]+"")&&ne(u,f),B&2&&w!==(w=o[9])&&(_.checked=w),B&2&&O!==(O=o[9])&&b(h,"aria-checked",O),B&2&&Ve(h,"is-enabled",o[9])},d(D){D&&L(e),A=!1,ke(E)}}}function YF(o){let e,t,r,s,n,a,i,l,f,u=Ae(Object.entries(o[1])),d=[];for(let m=0;m<u.length;m+=1)d[m]=iw(aw(o,u,m));return{c(){e=T("div"),t=T("h2"),t.textContent="Feature Flags",r=$();for(let m=0;m<d.length;m+=1)d[m].c();s=$(),n=T("div"),a=T("div"),i=T("button"),i.textContent="Apply",b(i,"aria-label","apply flag settings"),b(i,"tabindex","0"),b(a,"class","setting-item-control"),b(n,"class","setting-item"),b(e,"class","feature-flag-toggle-modal svelte-4kkvmr")},m(m,y){C(m,e,y),S(e,t),S(e,r);for(let h=0;h<d.length;h+=1)d[h]&&d[h].m(e,null);S(e,s),S(e,n),S(n,a),S(a,i),l||(f=[ee(i,"click",function(){dt(o[0])&&o[0].apply(this,arguments)}),ee(i,"keypress",function(){dt(o[0])&&o[0].apply(this,arguments)})],l=!0)},p(m,[y]){if(o=m,y&26){u=Ae(Object.entries(o[1]));let h;for(h=0;h<u.length;h+=1){let _=aw(o,u,h);d[h]?d[h].p(_,y):(d[h]=iw(_),d[h].c(),d[h].m(e,s))}for(;h<d.length;h+=1)d[h].d(1);d.length=u.length}},i:X,o:X,d(m){m&&L(e),tt(d,m),l=!1,ke(f)}}}function JF(o,e,t){let r,s,{reload:n}=e,a=Kt.getInstance();he(o,a,d=>t(5,s=d));function i(d){let m=!r[d];t(1,r[d]=m,r),a.setFlag(d,r[d])}function l(d){return d in r}or(()=>{Object.keys(r).forEach(d=>{let m=document.getElementById(`toggle-${d}`);m&&(0,lw.setIcon)(m,"check")})});let f=d=>{if(!l(d))throw new Error("Unexpected feature flag!");i(d)},u=d=>{if(!l(d))throw new Error("Unexpected feature flag!");i(d)};return o.$$set=d=>{"reload"in d&&t(0,n=d.reload)},o.$$.update=()=>{if(o.$$.dirty&32){e:t(1,r=Object.assign({},s.flags))}},[n,r,a,i,l,s,f,u]}var pm=class extends Z{constructor(e){super(),te(this,e,JF,YF,Q,{reload:0},jF)}},cw=pm;var Dc=class extends fw.Modal{constructor(t,r){super(t);this.reload=r}onOpen(){let{contentEl:t}=this;this.component=new cw({target:t,props:{reload:this.reload}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var ww=require("obsidian");var xw=require("obsidian");function uw(o,e,t){let r=o.slice();return r[13]=e[t],r}function dw(o,e,t){let r=o.slice();return r[16]=e[t],r}function XF(o){let e,t,r;return{c(){e=T("button"),e.textContent="Refresh"},m(s,n){C(s,e,n),t||(r=ee(e,"click",(0,xw.debounce)(o[12])),t=!0)},p:X,d(s){s&&L(e),t=!1,r()}}}function QF(o){let e=navigator.userAgent+"",t;return{c(){t=G(e)},m(r,s){C(r,t,s)},p:X,d(r){r&&L(t)}}}function ZF(o){let e;return{c(){e=G(o[1])},m(t,r){C(t,e,r)},p(t,r){r&2&&ne(e,t[1])},d(t){t&&L(e)}}}function eD(o){let e;return{c(){e=G(o[2])},m(t,r){C(t,e,r)},p(t,r){r&4&&ne(e,t[2])},d(t){t&&L(e)}}}function tD(o){let e;return{c(){e=G(o[3])},m(t,r){C(t,e,r)},p(t,r){r&8&&ne(e,t[3])},d(t){t&&L(e)}}}function rD(o){let e=o[0].loadTime?`${o[0].loadTime}ms`:"unknown",t;return{c(){t=G(e)},m(r,s){C(r,t,s)},p(r,s){s&1&&e!==(e=r[0].loadTime?`${r[0].loadTime}ms`:"unknown")&&ne(t,e)},d(r){r&&L(t)}}}function pw(o){let e,t=`${o[16]}`,r,s;return{c(){e=T("div"),r=G(t),s=$()},m(n,a){C(n,e,a),S(e,r),S(e,s)},p(n,a){a&16&&t!==(t=`${n[16]}`)&&ne(r,t)},d(n){n&&L(e)}}}function oD(o){let e,t=Ae(Object.keys(o[4].cancelControllers)),r=[];for(let s=0;s<t.length;s+=1)r[s]=pw(dw(o,t,s));return{c(){e=T("div");for(let s=0;s<r.length;s+=1)r[s].c();b(e,"slot","description")},m(s,n){C(s,e,n);for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(e,null)},p(s,n){if(n&16){t=Ae(Object.keys(s[4].cancelControllers));let a;for(a=0;a<t.length;a+=1){let i=dw(s,t,a);r[a]?r[a].p(i,n):(r[a]=pw(i),r[a].c(),r[a].m(e,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=t.length}},d(s){s&&L(e),tt(r,s)}}}function mw(o){let e,t=`${o[13]}`,r,s;return{c(){e=T("div"),r=G(t),s=$()},m(n,a){C(n,e,a),S(e,r),S(e,s)},p(n,a){a&32&&t!==(t=`${n[13]}`)&&ne(r,t)},d(n){n&&L(e)}}}function sD(o){let e,t=Ae(o[5]),r=[];for(let s=0;s<t.length;s+=1)r[s]=mw(uw(o,t,s));return{c(){e=T("div");for(let s=0;s<r.length;s+=1)r[s].c();b(e,"slot","description")},m(s,n){C(s,e,n);for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(e,null)},p(s,n){if(n&32){t=Ae(s[5]);let a;for(a=0;a<t.length;a+=1){let i=uw(s,t,a);r[a]?r[a].p(i,n):(r[a]=mw(i),r[a].c(),r[a].m(e,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=t.length}},d(s){s&&L(e),tt(r,s)}}}function nD(o){let e,t,r,s,n,a,i,l,f,u,d,m,y,h,_,w,v,M,O,A,E,R,F;return s=new Je({props:{name:"Environment",$$slots:{default:[XF]},$$scope:{ctx:o}}}),a=new $e({props:{name:"User Agent",description:"",$$slots:{default:[QF]},$$scope:{ctx:o}}}),l=new $e({props:{name:"Fetch",description:"",$$slots:{default:[ZF]},$$scope:{ctx:o}}}),u=new $e({props:{name:"Response",description:"",$$slots:{default:[eD]},$$scope:{ctx:o}}}),m=new $e({props:{name:"Blink Fetch",description:"",$$slots:{default:[tD]},$$scope:{ctx:o}}}),h=new $e({props:{name:"Startup Time",description:"",$$slots:{default:[rD]},$$scope:{ctx:o}}}),w=new Je({props:{name:"Connections"}}),M=new $e({props:{name:"",description:"",$$slots:{description:[oD]},$$scope:{ctx:o}}}),A=new Je({props:{name:"Log Files"}}),R=new $e({props:{name:"",description:"",$$slots:{description:[sD]},$$scope:{ctx:o}}}),{c(){e=T("div"),e.textContent="Debug Info",t=$(),r=T("div"),V(s.$$.fragment),n=$(),V(a.$$.fragment),i=$(),V(l.$$.fragment),f=$(),V(u.$$.fragment),d=$(),V(m.$$.fragment),y=$(),V(h.$$.fragment),_=$(),V(w.$$.fragment),v=$(),V(M.$$.fragment),O=$(),V(A.$$.fragment),E=$(),V(R.$$.fragment),b(e,"class","modal-title"),b(r,"class","modal-content")},m(D,B){C(D,e,B),C(D,t,B),C(D,r,B),N(s,r,null),S(r,n),N(a,r,null),S(r,i),N(l,r,null),S(r,f),N(u,r,null),S(r,d),N(m,r,null),S(r,y),N(h,r,null),S(r,_),N(w,r,null),S(r,v),N(M,r,null),S(r,O),N(A,r,null),S(r,E),N(R,r,null),F=!0},p(D,[B]){let q={};B&524288&&(q.$$scope={dirty:B,ctx:D}),s.$set(q);let J={};B&524288&&(J.$$scope={dirty:B,ctx:D}),a.$set(J);let K={};B&524290&&(K.$$scope={dirty:B,ctx:D}),l.$set(K);let z={};B&524292&&(z.$$scope={dirty:B,ctx:D}),u.$set(z);let W={};B&524296&&(W.$$scope={dirty:B,ctx:D}),m.$set(W);let re={};B&524289&&(re.$$scope={dirty:B,ctx:D}),h.$set(re);let Le={};B&524304&&(Le.$$scope={dirty:B,ctx:D}),M.$set(Le);let le={};B&524320&&(le.$$scope={dirty:B,ctx:D}),R.$set(le)},i(D){F||(I(s.$$.fragment,D),I(a.$$.fragment,D),I(l.$$.fragment,D),I(u.$$.fragment,D),I(m.$$.fragment,D),I(h.$$.fragment,D),I(w.$$.fragment,D),I(M.$$.fragment,D),I(A.$$.fragment,D),I(R.$$.fragment,D),F=!0)},o(D){P(s.$$.fragment,D),P(a.$$.fragment,D),P(l.$$.fragment,D),P(u.$$.fragment,D),P(m.$$.fragment,D),P(h.$$.fragment,D),P(w.$$.fragment,D),P(M.$$.fragment,D),P(A.$$.fragment,D),P(R.$$.fragment,D),F=!1},d(D){D&&(L(e),L(t),L(r)),H(s),H(a),H(l),H(u),H(m),H(h),H(w),H(M),H(A),H(R)}}}function hw(){try{return Response.toString()}catch(o){return"undefined"}}function gw(){try{return fetch.toString()}catch(o){return"undefined"}}function yw(){try{return(globalThis==null?void 0:globalThis.blinkfetch)!==void 0?"Yes":"No"}catch(o){return"No"}}function aD(o,e,t){let r,s,n,a,i,{plugin:l}=e,f=ve(hw());he(o,f,w=>t(2,s=w));let u=ve(gw());he(o,u,w=>t(1,r=w));let d=ve(yw());he(o,d,w=>t(3,n=w));let m=ve(l.loginManager.pb);he(o,m,w=>t(4,a=w));let y=ve([]);he(o,y,w=>t(5,i=w)),kl().then(w=>{y.set(w)});function h(){f.set(hw()),u.set(gw()),d.set(yw()),m.set(l.loginManager.pb)}let _=()=>{h()};return o.$$set=w=>{"plugin"in w&&t(0,l=w.plugin)},[l,r,s,n,a,i,f,u,d,m,y,h,_]}var mm=class extends Z{constructor(e){super(),te(this,e,aD,nD,Q,{plugin:0})}},bw=mm;var Mc=class extends ww.Modal{constructor(t,r){super(t);this.plugin=r}onOpen(){let{contentEl:t}=this;this.component=new bw({target:t,props:{plugin:this.plugin}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var _w=require("obsidian"),Ec=class{notify(e){new _w.Notice(e)}},Rc=class{constructor(e){this.vault=e}async append(e,t){return this.vault.adapter.append(e,t)}async stat(e){return this.vault.adapter.stat(e)}async exists(e){return this.vault.adapter.exists(e)}async remove(e){return this.vault.adapter.remove(e)}async rename(e,t){return this.vault.adapter.rename(e,t)}async write(e,t){return this.vault.adapter.write(e,t)}async read(e){return this.vault.adapter.read(e)}};var Aw=require("obsidian");var Tw=require("obsidian");function iD(o){De(o,"svelte-jmqfac",".system3-bug-report.svelte-jmqfac{display:flex;flex-direction:column;height:100%;min-height:30em}.report-container.svelte-jmqfac{display:flex;flex-direction:column;flex:1}.form-content.svelte-jmqfac{flex:1;overflow-y:auto}textarea.svelte-jmqfac{width:100%;height:300px;resize:vertical}.centered-message.svelte-jmqfac{display:flex;flex:1;align-items:center;justify-content:center;padding-bottom:5em}")}function vw(o,e,t){let r=o.slice();return r[21]=e[t],r}function lD(o){let e,t,r,s,n,a,i,l,f,u,d,m,y;r=new $e({props:{name:"Description",description:"Please describe what went wrong and what you were trying to do."}}),i=new $e({props:{name:"Include Logs",description:"Send logs to the Relay developers to help them debug the issue.",$$slots:{default:[uD]},$$scope:{ctx:o}}});let h=o[4]&&Sw(o);return u=new $e({props:{name:"",description:"",$$slots:{default:[pD]},$$scope:{ctx:o}}}),{c(){e=T("div"),t=T("div"),V(r.$$.fragment),s=$(),n=T("textarea"),a=$(),V(i.$$.fragment),l=$(),h&&h.c(),f=$(),V(u.$$.fragment),b(n,"placeholder","Describe the issue here..."),b(n,"class","svelte-jmqfac"),b(t,"class","form-content svelte-jmqfac"),b(e,"class","report-container svelte-jmqfac")},m(_,w){C(_,e,w),S(e,t),N(r,t,null),S(t,s),S(t,n),rr(n,o[3]),S(t,a),N(i,t,null),S(t,l),h&&h.m(t,null),S(e,f),N(u,e,null),d=!0,m||(y=ee(n,"input",o[13]),m=!0)},p(_,w){w&8&&rr(n,_[3]);let v={};w&16777232&&(v.$$scope={dirty:w,ctx:_}),i.$set(v),_[4]?h?(h.p(_,w),w&16&&I(h,1)):(h=Sw(_),h.c(),I(h,1),h.m(t,null)):h&&(we(),P(h,1,1,()=>{h=null}),_e());let M={};w&16777293&&(M.$$scope={dirty:w,ctx:_}),u.$set(M)},i(_){d||(I(r.$$.fragment,_),I(i.$$.fragment,_),I(h),I(u.$$.fragment,_),d=!0)},o(_){P(r.$$.fragment,_),P(i.$$.fragment,_),P(h),P(u.$$.fragment,_),d=!1},d(_){_&&L(e),H(r),H(i),h&&h.d(),H(u),m=!1,y()}}}function cD(o){let e;return{c(){e=T("div"),e.innerHTML='<div id="spinner" class="d-flex align-items-center"><strong>Sending Bug Report...</strong> <div class="spinner-border ms-auto" role="status" aria-hidden="true"></div></div>',b(e,"class","centered-message svelte-jmqfac")},m(t,r){C(t,e,r)},p:X,i:X,o:X,d(t){t&&L(e)}}}function fD(o){let e,t,r;return t=new $e({props:{name:"Thank you!",description:"Your bug report will help us improve Relay."}}),{c(){e=T("div"),V(t.$$.fragment),b(e,"class","centered-message svelte-jmqfac")},m(s,n){C(s,e,n),N(t,e,null),r=!0},p:X,i(s){r||(I(t.$$.fragment,s),r=!0)},o(s){P(t.$$.fragment,s),r=!1},d(s){s&&L(e),H(t)}}}function uD(o){let e,t,r,s,n,a;return{c(){e=T("div"),t=T("input"),r=$(),s=T("div"),b(t,"type","checkbox"),b(t,"tabindex","-1"),t.checked=o[4],b(s,"class","checkbox-toggle"),b(e,"role","checkbox"),b(e,"aria-checked",o[4]),b(e,"tabindex","0"),b(e,"class","checkbox-container"),Ve(e,"is-enabled",o[4])},m(i,l){C(i,e,l),S(e,t),S(e,r),S(e,s),n||(a=[ee(e,"keypress",hD),ee(e,"click",o[14])],n=!0)},p(i,l){l&16&&(t.checked=i[4]),l&16&&b(e,"aria-checked",i[4]),l&16&&Ve(e,"is-enabled",i[4])},d(i){i&&L(e),n=!1,ke(a)}}}function Sw(o){let e,t;return e=new $e({props:{name:"Logs",description:"",$$slots:{description:[dD]},$$scope:{ctx:o}}}),{c(){V(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let n={};s&16777248&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function kw(o){let e,t=`${o[21]}
`,r,s;return{c(){e=T("div"),r=G(t),s=$()},m(n,a){C(n,e,a),S(e,r),S(e,s)},p(n,a){a&32&&t!==(t=`${n[21]}
`)&&ne(r,t)},d(n){n&&L(e)}}}function dD(o){let e,t=Ae(o[5]),r=[];for(let s=0;s<t.length;s+=1)r[s]=kw(vw(o,t,s));return{c(){e=T("div");for(let s=0;s<r.length;s+=1)r[s].c();b(e,"slot","description")},m(s,n){C(s,e,n);for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(e,null)},p(s,n){if(n&32){t=Ae(s[5]);let a;for(a=0;a<t.length;a+=1){let i=vw(s,t,a);r[a]?r[a].p(i,n):(r[a]=kw(i),r[a].c(),r[a].m(e,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=t.length}},d(s){s&&L(e),tt(r,s)}}}function pD(o){let e,t,r,s;return{c(){e=T("button"),t=G("Send"),e.disabled=o[2]},m(n,a){C(n,e,a),S(e,t),r||(s=ee(e,"click",o[15]),r=!0)},p(n,a){a&4&&(e.disabled=n[2])},d(n){n&&L(e),r=!1,s()}}}function mD(o){let e,t,r,s,n,a,i=[fD,cD,lD],l=[];function f(u,d){return u[1]?0:u[2]&&!u[1]?1:2}return s=f(o,-1),n=l[s]=i[s](o),{c(){e=T("div"),e.textContent="Send Bug Report",t=$(),r=T("div"),n.c(),b(e,"class","modal-title"),b(r,"class","modal-content system3-bug-report svelte-jmqfac")},m(u,d){C(u,e,d),C(u,t,d),C(u,r,d),l[s].m(r,null),a=!0},p(u,[d]){let m=s;s=f(u,d),s===m?l[s].p(u,d):(we(),P(l[m],1,1,()=>{l[m]=null}),_e(),n=l[s],n?n.p(u,d):(n=l[s]=i[s](u),n.c()),I(n,1),n.m(r,null))},i(u){a||(I(n),a=!0)},o(u){P(n),a=!1},d(u){u&&(L(e),L(t),L(r)),l[s].d()}}}function Iw(){try{return Response.toString()}catch(o){return"undefined"}}function Lw(){try{return fetch.toString()}catch(o){return"undefined"}}function Cw(){try{return(globalThis==null?void 0:globalThis.blinkfetch)!==void 0?"Yes":"No"}catch(o){return"No"}}var hD=()=>{};function gD(o,e,t){let r,s,n,a,i,l,{plugin:f}=e,u=ve(Iw()),d=ve(Lw()),m=ve(Cw()),y=ve("");he(o,y,D=>t(3,n=D));let h=ve(!1);he(o,h,D=>t(4,a=D));let _=ve(!1),w=ve(!1);he(o,w,D=>t(2,s=D));let v=ve(!1);he(o,v,D=>t(1,r=D));let M=ve(f.loginManager.pb);he(o,M,D=>t(6,l=D));let O=ve([]);he(o,O,D=>t(5,i=D)),kl().then(D=>{O.set(D)});function A(){u.set(Iw()),d.set(Lw()),m.set(Cw()),M.set(f.loginManager.pb)}function E(){n=this.value,y.set(n)}let R=()=>{let D=!a;h.set(D)},F=async()=>{var B;let D=`Bug Report

`;if(D+=JSON.stringify({userAgent:navigator.userAgent,manifest:f.manifest,user:(B=l==null?void 0:l.authStore.model)==null?void 0:B.id,loadTime:f.loadTime,description:n},null,2),D+=`

`,h){let q=await ky();D+=q}(0,Tw.requestUrl)({url:"https://bug-reports.system3.dev",method:"PUT",body:D,headers:{"Content-Type":"text/plain"}}).then(()=>{v.set(!0)}),w.set(!0)};return o.$$set=D=>{"plugin"in D&&t(0,f=D.plugin)},[f,r,s,n,a,i,l,y,h,w,v,M,O,E,R,F]}var hm=class extends Z{constructor(e){super(),te(this,e,gD,mD,Q,{plugin:0},iD)}},Pw=hm;var Oc=class extends Aw.Modal{constructor(t,r){super(t);this.plugin=r}onOpen(){let{contentEl:t}=this;this.component=new Pw({target:t,props:{plugin:this.plugin}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var Bw=require("obsidian");async function Fw(o){let{appId:e,filterByAppId:t,onProgress:r}=o,s=await window.indexedDB.databases(),n=s.length,a=[],i=0,l=0,f=0,u=0;for(let d of s)if(d.name){try{let m=await new Promise((y,h)=>{let _=indexedDB.open(d.name);_.onerror=()=>h(_.error),_.onsuccess=w=>y(w.target.result)});try{let y=Array.from(m.objectStoreNames);if(!y.includes("updates")||!y.includes("custom"))continue;let h=m.transaction(["updates","custom"],"readonly"),_=h.objectStore("updates"),w=h.objectStore("custom"),v=await new Promise(O=>{let A=w.get("appId");A.onsuccess=()=>O(A.result||"")});i++;let M=await new Promise((O,A)=>{let E=_.count();E.onsuccess=()=>O(E.result),E.onerror=()=>A(E.error)});if(l+=M,M>0){let O=0;if(await new Promise((A,E)=>{let R=_.openCursor();R.onsuccess=F=>{let D=F.target.result;if(D){let B=D.value instanceof Uint8Array?D.value.byteLength:JSON.stringify(D.value).length;O+=B,D.continue()}else A()},R.onerror=()=>E(R.error)}),f+=O,O>1024*1024&&(!t||v===e)){let A=await new Promise(F=>{let D=w.get("path");D.onsuccess=()=>F(D.result||"")}),E=await new Promise(F=>{let D=w.get("relay");D.onsuccess=()=>F(D.result||"")}),R=!d.name.startsWith(`${e}-relay`);a.push({slug:`${d.name}/${_.name}`,path:A,relay:E,appId:v||"unknown",count:M,estimatedSizeMB:Math.round(O/(1024*1024)*100)/100,isLegacy:R})}}}finally{m.close()}}catch(m){console.error(`Error processing database ${d.name}:`,m);continue}u++,r&&r(u/s.length*100)}return{totalStores:i,totalItems:l,totalSizeMB:Math.round(f/(1024*1024)*100)/100,databaseCount:n,largeStores:a.sort((d,m)=>m.estimatedSizeMB-d.estimatedSizeMB)}}async function Dw(o){let[e,t]=o.split("/"),r=await new Promise((s,n)=>{let a=indexedDB.open(e);a.onerror=()=>n(a.error),a.onsuccess=()=>s(a.result)});try{let n=r.transaction(t,"readwrite").objectStore(t);await new Promise((a,i)=>{let l=n.clear();l.onsuccess=()=>a(),l.onerror=()=>i(l.error)})}catch(s){console.error(`Error deleting store: ${o}`,s)}finally{r.close()}}var PG=require("obsidian");function yD(o){De(o,"svelte-1n3w4sk",".system3-dangerous.svelte-1n3w4sk:enabled{background-color:var(--background-modifier-error)}.system3-indexeddb-analysis.svelte-1n3w4sk{padding:1rem;max-height:500px;overflow-y:auto}.system3-loading-container.svelte-1n3w4sk{display:flex;flex-direction:column;align-items:center;justify-content:center;height:200px;gap:1rem}.system3-loading-spinner.svelte-1n3w4sk{border:4px solid var(--background-modifier-border);border-top:4px solid var(--interactive-accent);border-radius:50%;width:40px;height:40px;animation:svelte-1n3w4sk-spin 1s linear infinite}.system3-progress-bar.svelte-1n3w4sk{width:80%;height:8px;border-radius:4px;background-color:var(--background-secondary);overflow:hidden;margin:0 auto}.system3-progress-fill.svelte-1n3w4sk{height:100%;background-color:var(--color-accent);border-radius:4px;transition:width 0.3s ease;min-width:0%;max-width:100%}.system3-error-message.svelte-1n3w4sk{color:var(--text-error);padding:1rem;background-color:var(--mod-error);border-radius:4px}.system3-actions.svelte-1n3w4sk{display:flex;gap:0.5rem}.system3-summary-stats.svelte-1n3w4sk{display:grid;grid-template-columns:repeat(3, 1fr);gap:1rem;margin-bottom:2rem;padding:1rem;background-color:var(--background-secondary);border-radius:4px}.system3-stat-item.svelte-1n3w4sk{text-align:center}.system3-global-count.svelte-1n3w4sk{grid-column:1 / -1;padding-top:0.5rem;margin-top:0.5rem;border-bottom:1px solid var(--background-modifier-border)}.system3-warning.svelte-1n3w4sk{color:var(--text-warning)}.system3-critical.svelte-1n3w4sk{color:var(--text-error)}.system3-warning-text.svelte-1n3w4sk{font-size:0.8em;margin-top:0.5rem;color:var(--text-warning);line-height:1.4}.system3-warning-text.system3-critical.svelte-1n3w4sk{color:var(--text-error);font-weight:bold}.system3-stat-label.svelte-1n3w4sk{font-size:0.9em;color:var(--text-muted);margin-bottom:0.5rem}.system3-stat-value.svelte-1n3w4sk{font-size:1.2em;font-weight:bold}@keyframes svelte-1n3w4sk-spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}")}function Mw(o,e,t){let r=o.slice();return r[18]=e[t][0],r[19]=e[t][1],r}function Ew(o,e,t){let r=o.slice();return r[22]=e[t],r}function xD(o){let e,t,r,s,n,a=o[0].databaseCount.toLocaleString()+"",i,l,f,u,d,m,y,h,_=o[0].totalStores+"",w,v,M,O,A,E,R=o[0].totalItems.toLocaleString()+"",F,D,B,q,J,K,z=o[0].totalSizeMB.toFixed(2)+"",W,re,Le,le,Ce;function Ke(oe,Be){if(oe[0].databaseCount>45e3)return vD;if(oe[0].databaseCount>4e4)return _D}let Re=Ke(o,-1),de=Re&&Re(o),fe=o[0].largeStores.length>0&&Rw(o);return{c(){e=T("div"),t=T("div"),r=T("div"),r.textContent="Global Database Limit",s=$(),n=T("div"),i=G(a),l=G(" / 50,000"),f=$(),de&&de.c(),u=$(),d=T("div"),m=T("div"),m.textContent="Relay Databases",y=$(),h=T("div"),w=G(_),v=$(),M=T("div"),O=T("div"),O.textContent="Document Updates",A=$(),E=T("div"),F=G(R),D=$(),B=T("div"),q=T("div"),q.textContent="Total Size",J=$(),K=T("div"),W=G(z),re=G(" MB"),Le=$(),fe&&fe.c(),le=Te(),b(r,"class","system3-stat-label svelte-1n3w4sk"),b(n,"class","system3-stat-value svelte-1n3w4sk"),Ve(n,"system3-warning",o[0].databaseCount>4e4),Ve(n,"system3-critical",o[0].databaseCount>45e3),b(t,"class","system3-stat-item system3-global-count svelte-1n3w4sk"),b(m,"class","system3-stat-label svelte-1n3w4sk"),b(h,"class","system3-stat-value svelte-1n3w4sk"),b(d,"class","system3-stat-item svelte-1n3w4sk"),b(O,"class","system3-stat-label svelte-1n3w4sk"),b(E,"class","system3-stat-value svelte-1n3w4sk"),b(M,"class","system3-stat-item svelte-1n3w4sk"),b(q,"class","system3-stat-label svelte-1n3w4sk"),b(K,"class","system3-stat-value svelte-1n3w4sk"),b(B,"class","system3-stat-item svelte-1n3w4sk"),b(e,"class","system3-summary-stats svelte-1n3w4sk")},m(oe,Be){C(oe,e,Be),S(e,t),S(t,r),S(t,s),S(t,n),S(n,i),S(n,l),S(t,f),de&&de.m(t,null),S(e,u),S(e,d),S(d,m),S(d,y),S(d,h),S(h,w),S(e,v),S(e,M),S(M,O),S(M,A),S(M,E),S(E,F),S(e,D),S(e,B),S(B,q),S(B,J),S(B,K),S(K,W),S(K,re),C(oe,Le,Be),fe&&fe.m(oe,Be),C(oe,le,Be),Ce=!0},p(oe,Be){(!Ce||Be&1)&&a!==(a=oe[0].databaseCount.toLocaleString()+"")&&ne(i,a),(!Ce||Be&1)&&Ve(n,"system3-warning",oe[0].databaseCount>4e4),(!Ce||Be&1)&&Ve(n,"system3-critical",oe[0].databaseCount>45e3),Re!==(Re=Ke(oe,Be))&&(de&&de.d(1),de=Re&&Re(oe),de&&(de.c(),de.m(t,null))),(!Ce||Be&1)&&_!==(_=oe[0].totalStores+"")&&ne(w,_),(!Ce||Be&1)&&R!==(R=oe[0].totalItems.toLocaleString()+"")&&ne(F,R),(!Ce||Be&1)&&z!==(z=oe[0].totalSizeMB.toFixed(2)+"")&&ne(W,z),oe[0].largeStores.length>0?fe?(fe.p(oe,Be),Be&1&&I(fe,1)):(fe=Rw(oe),fe.c(),I(fe,1),fe.m(le.parentNode,le)):fe&&(we(),P(fe,1,1,()=>{fe=null}),_e())},i(oe){Ce||(I(fe),Ce=!0)},o(oe){P(fe),Ce=!1},d(oe){oe&&(L(e),L(Le),L(le)),de&&de.d(),fe&&fe.d(oe)}}}function bD(o){let e,t;return{c(){e=T("div"),t=G(o[5]),b(e,"class","system3-error-message svelte-1n3w4sk")},m(r,s){C(r,e,s),S(e,t)},p(r,s){s&32&&ne(t,r[5])},i:X,o:X,d(r){r&&L(e)}}}function wD(o){let e,t,r,s,n,a,i;return{c(){e=T("div"),t=T("div"),r=$(),s=T("div"),s.textContent="Analyzing Databases...",n=$(),a=T("div"),i=T("div"),b(t,"class","system3-loading-spinner svelte-1n3w4sk"),b(s,"class","loading-text"),b(i,"class","system3-progress-fill svelte-1n3w4sk"),pe(i,"width",o[4]+"%"),b(a,"class","system3-progress-bar svelte-1n3w4sk"),b(e,"class","system3-loading-container svelte-1n3w4sk")},m(l,f){C(l,e,f),S(e,t),S(e,r),S(e,s),S(e,n),S(e,a),S(a,i)},p(l,f){f&16&&pe(i,"width",l[4]+"%")},i:X,o:X,d(l){l&&L(e)}}}function _D(o){let e;return{c(){e=T("div"),e.innerHTML=`Warning: high number of databases.<br/>
						Consider cleaning up unused databases.`,b(e,"class","system3-warning-text svelte-1n3w4sk")},m(t,r){C(t,e,r)},d(t){t&&L(e)}}}function vD(o){let e;return{c(){e=T("div"),e.innerHTML=`Critical: approaching IndexedDB database limit!<br/>
						Your browser may start deleting old databases soon.`,b(e,"class","system3-warning-text system3-critical svelte-1n3w4sk")},m(t,r){C(t,e,r)},d(t){t&&L(e)}}}function Rw(o){let e,t,r,s;e=new Je({props:{name:"Large Stores (>1MB)"}});let n=Ae(o[2]),a=[];for(let l=0;l<n.length;l+=1)a[l]=Uw(Mw(o,n,l));let i=l=>P(a[l],1,1,()=>{a[l]=null});return{c(){V(e.$$.fragment),t=$();for(let l=0;l<a.length;l+=1)a[l].c();r=Te()},m(l,f){N(e,l,f),C(l,t,f);for(let u=0;u<a.length;u+=1)a[u]&&a[u].m(l,f);C(l,r,f),s=!0},p(l,f){if(f&2052){n=Ae(l[2]);let u;for(u=0;u<n.length;u+=1){let d=Mw(l,n,u);a[u]?(a[u].p(d,f),I(a[u],1)):(a[u]=Uw(d),a[u].c(),I(a[u],1),a[u].m(r.parentNode,r))}for(we(),u=n.length;u<a.length;u+=1)i(u);_e()}},i(l){if(!s){I(e.$$.fragment,l);for(let f=0;f<n.length;f+=1)I(a[f]);s=!0}},o(l){P(e.$$.fragment,l),a=a.filter(Boolean);for(let f=0;f<a.length;f+=1)P(a[f]);s=!1},d(l){l&&(L(t),L(r)),H(e,l),tt(a,l)}}}function SD(o){let e,t,r,s,n;function a(){return o[17](o[22])}return{c(){e=T("div"),t=T("button"),t.textContent="Delete",r=$(),b(t,"class","mod-warning"),b(t,"title","Delete all data in this store"),b(e,"class","system3-actions svelte-1n3w4sk")},m(i,l){C(i,e,l),S(e,t),C(i,r,l),s||(n=ee(t,"click",a),s=!0)},p(i,l){o=i},d(i){i&&(L(e),L(r)),s=!1,n()}}}function Ow(o){let e,t;return e=new $e({props:{name:o[22].path||o[22].slug,description:"Size: "+o[22].estimatedSizeMB+"MB, Items: "+o[22].count,$$slots:{default:[SD]},$$scope:{ctx:o}}}),{c(){V(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let n={};s&4&&(n.name=r[22].path||r[22].slug),s&4&&(n.description="Size: "+r[22].estimatedSizeMB+"MB, Items: "+r[22].count),s&33554436&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function Uw(o){let e,t,r,s;e=new Je({props:{name:o[18]==="local"?"Tracked Documents":`Relay: ${o[18]}`}});let n=Ae(o[19]),a=[];for(let l=0;l<n.length;l+=1)a[l]=Ow(Ew(o,n,l));let i=l=>P(a[l],1,1,()=>{a[l]=null});return{c(){V(e.$$.fragment),t=$();for(let l=0;l<a.length;l+=1)a[l].c();r=Te()},m(l,f){N(e,l,f),C(l,t,f);for(let u=0;u<a.length;u+=1)a[u]&&a[u].m(l,f);C(l,r,f),s=!0},p(l,f){let u={};if(f&4&&(u.name=l[18]==="local"?"Tracked Documents":`Relay: ${l[18]}`),e.$set(u),f&2052){n=Ae(l[19]);let d;for(d=0;d<n.length;d+=1){let m=Ew(l,n,d);a[d]?(a[d].p(m,f),I(a[d],1)):(a[d]=Ow(m),a[d].c(),I(a[d],1),a[d].m(r.parentNode,r))}for(we(),d=n.length;d<a.length;d+=1)i(d);_e()}},i(l){if(!s){I(e.$$.fragment,l);for(let f=0;f<n.length;f+=1)I(a[f]);s=!0}},o(l){P(e.$$.fragment,l),a=a.filter(Boolean);for(let f=0;f<a.length;f+=1)P(a[f]);s=!1},d(l){l&&(L(t),L(r)),H(e,l),tt(a,l)}}}function kD(o){let e,t,r,s,n,a,i,l,f,u,d,m,y,h,_,w,v,M=[wD,bD,xD],O=[];function A(E,R){return E[3]?0:E[5]?1:E[0]?2:-1}return~(y=A(o,-1))&&(h=O[y]=M[y](o)),{c(){e=T("div"),e.textContent="Relay database analysis",t=$(),r=T("div"),s=T("div"),n=T("div"),n.innerHTML=`<div class="setting-item-name">Search across vaults</div> <div class="setting-item-description"><div class="mod-warning">Warning: This is a dangerous setting. It allows you to delete relay
					databases from other vaults.</div></div>`,a=$(),i=T("div"),l=T("div"),f=T("input"),u=$(),d=T("div"),m=$(),h&&h.c(),b(e,"class","modal-title"),b(n,"class","setting-item-info"),b(f,"type","checkbox"),b(f,"tabindex","-1"),f.checked=o[1],b(d,"class","checkbox-toggle"),b(l,"role","checkbox"),b(l,"aria-checked",o[1]),b(l,"tabindex","0"),b(l,"class","checkbox-container system3-dangerous svelte-1n3w4sk"),Ve(l,"is-enabled",o[1]),b(i,"class","setting-item-control"),b(s,"class","setting-item"),b(r,"class","system3-indexeddb-analysis svelte-1n3w4sk")},m(E,R){C(E,e,R),C(E,t,R),C(E,r,R),S(r,s),S(s,n),S(s,a),S(s,i),S(i,l),S(l,f),S(l,u),S(l,d),S(r,m),~y&&O[y].m(r,null),_=!0,w||(v=[ee(l,"keypress",o[15]),ee(l,"click",o[16])],w=!0)},p(E,[R]){(!_||R&2)&&(f.checked=E[1]),(!_||R&2)&&b(l,"aria-checked",E[1]),(!_||R&2)&&Ve(l,"is-enabled",E[1]);let F=y;y=A(E,R),y===F?~y&&O[y].p(E,R):(h&&(we(),P(O[F],1,1,()=>{O[F]=null}),_e()),~y?(h=O[y],h?h.p(E,R):(h=O[y]=M[y](E),h.c()),I(h,1),h.m(r,null)):h=null)},i(E){_||(I(h),_=!0)},o(E){P(h),_=!1},d(E){E&&(L(e),L(t),L(r)),~y&&O[y].d(),w=!1,ke(v)}}}function ID(o,e,t){let r,s,n,a,i,l;var f;let{plugin:u}=e,d=ve(!0);he(o,d,E=>t(3,a=E));let m=ve(0);he(o,m,E=>t(4,i=E));let y=ve(null);he(o,y,E=>t(0,n=E));let h=ve(null);he(o,h,E=>t(5,l=E));let _=!1;function w(){return Ge(this,void 0,void 0,function*(){d.set(!0),h.set(null);try{let E=yield Fw({appId:u.appId,filterByAppId:!_,onProgress:R=>m.set(R)});y.set(E)}catch(E){h.set(`Analysis failed: ${E.message}`)}finally{d.set(!1)}})}function v(E){return Ge(this,void 0,void 0,function*(){try{yield Dw(E),n&&Qy(y,n.largeStores=n.largeStores.filter(R=>R.slug!==E),n)}catch(R){h.set(`Failed to delete ${E}: ${R.message}`)}})}or(()=>{w()});let M=()=>{t(1,_=!_),w()},O=()=>{t(1,_=!_),w()},A=E=>v(E.slug);return o.$$set=E=>{"plugin"in E&&t(12,u=E.plugin)},o.$$.update=()=>{if(o.$$.dirty&8193){e:t(14,r=t(13,f=n==null?void 0:n.largeStores.reduce((E,R)=>{let F=R.relay||"local";return E[F]||(E[F]=[]),E[F].push(R),E},{}))!==null&&f!==void 0?f:{})}if(o.$$.dirty&16384){e:t(2,s=Object.entries(r).sort(([E],[R])=>E==="local"?-1:R==="local"?1:E.localeCompare(R)))}},[n,_,s,a,i,l,d,m,y,h,w,v,u,f,r,M,O,A]}var gm=class extends Z{constructor(e){super(),te(this,e,ID,kD,Q,{plugin:12},yD)}},$w=gm;var Uc=class extends Bw.Modal{constructor(t,r){super(t);this.plugin=r}onOpen(){let{contentEl:t}=this;this.component=new $w({target:t,props:{plugin:this.plugin}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var p_=require("obsidian");var{Boolean:Xw}=Bs;function LD(o){De(o,"svelte-18bqwhy",".file-name.svelte-18bqwhy{display:flex;align-items:center;gap:6px;font-size:0.9rem;flex:1;min-width:0}.details-container.svelte-18bqwhy{margin-left:auto;text-align:right;padding-left:8px;padding-right:8px}.details.svelte-18bqwhy{font-size:0.75rem;color:var(--text-muted)}.error-message.svelte-18bqwhy{color:var(--text-error);margin-top:2px;text-align:right}.more-files.svelte-18bqwhy{font-size:0.8rem;color:var(--text-muted);text-align:center}button.mod-warning.svelte-18bqwhy{display:flex;align-items:center;gap:4px;background-color:var(--background-modifier-error);color:var(--text-error)}.mod-primary{color:var(--interactive-accent)}.mod-success{color:var(--interactive-success)}.mod-warning{color:var(--text-warning)}.show-more-link.svelte-18bqwhy{color:var(--text-accent);cursor:pointer;font-size:0.8rem}.show-more-link.svelte-18bqwhy:hover{text-decoration:underline}")}function Nw(o,e,t){let r=o.slice();return r[20]=e[t],r}function Hw(o,e,t){let r=o.slice();return r[23]=e[t],r}function CD(o){return{c:X,m:X,p:X,i:X,o:X,d:X}}function TD(o){let e,t,r=Ae(Jw(o[19].documents)),s=[];for(let a=0;a<r.length;a+=1)s[a]=Gw(Nw(o,r,a));let n=a=>P(s[a],1,1,()=>{s[a]=null});return{c(){for(let a=0;a<s.length;a+=1)s[a].c();e=Te()},m(a,i){for(let l=0;l<s.length;l+=1)s[l]&&s[l].m(a,i);C(a,e,i),t=!0},p(a,i){if(i&8311){r=Ae(Jw(a[19].documents));let l;for(l=0;l<r.length;l+=1){let f=Nw(a,r,l);s[l]?(s[l].p(f,i),I(s[l],1)):(s[l]=Gw(f),s[l].c(),I(s[l],1),s[l].m(e.parentNode,e))}for(we(),l=r.length;l<s.length;l+=1)n(l);_e()}},i(a){if(!t){for(let i=0;i<r.length;i+=1)I(s[i]);t=!0}},o(a){s=s.filter(Xw);for(let i=0;i<s.length;i+=1)P(s[i]);t=!1},d(a){a&&L(e),tt(s,a)}}}function Vw(o){let e,t=Yw(o[23].queueState.timestamp)+"",r;return{c(){e=G("\u2022 "),r=G(t)},m(s,n){C(s,e,n),C(s,r,n)},p(s,n){n&3&&t!==(t=Yw(s[23].queueState.timestamp)+"")&&ne(r,t)},d(s){s&&(L(e),L(r))}}}function qw(o){let e,t=o[23].queueState.error+"",r;return{c(){e=T("div"),r=G(t),b(e,"class","error-message svelte-18bqwhy")},m(s,n){C(s,e,n),S(e,r)},p(s,n){n&3&&t!==(t=s[23].queueState.error+"")&&ne(r,t)},d(s){s&&L(e)}}}function Ww(o){let e,t,r,s,n,a;t=new Ld({props:{size:14,class:"svg-icon lucide-refresh-cw"}});function i(){return o[10](o[23])}return{c(){e=T("button"),V(t.$$.fragment),r=G(`
							Retry`),b(e,"class","mod-warning svelte-18bqwhy")},m(l,f){C(l,e,f),N(t,e,null),S(e,r),s=!0,n||(a=ee(e,"click",i),n=!0)},p(l,f){o=l},i(l){s||(I(t.$$.fragment,l),s=!0)},o(l){P(t.$$.fragment,l),s=!1},d(l){l&&L(e),H(t),n=!1,a()}}}function PD(o){var y,h,_;let e,t,r=o[5](o[23]).text+"",s,n,a,i,l,f,u=((y=o[23].queueState)==null?void 0:y.timestamp)&&Vw(o),d=((h=o[23].queueState)==null?void 0:h.error)&&qw(o),m=((_=o[23].queueState)==null?void 0:_.status)==="failed"&&Ww(o);return{c(){e=T("div"),t=T("span"),s=G(r),n=$(),u&&u.c(),a=$(),d&&d.c(),i=$(),m&&m.c(),l=Te(),b(t,"class","details svelte-18bqwhy"),b(e,"class","details-container svelte-18bqwhy")},m(w,v){C(w,e,v),S(e,t),S(t,s),S(t,n),u&&u.m(t,null),S(t,a),d&&d.m(t,null),C(w,i,v),m&&m.m(w,v),C(w,l,v),f=!0},p(w,v){var M,O,A;(!f||v&3)&&r!==(r=w[5](w[23]).text+"")&&ne(s,r),(M=w[23].queueState)!=null&&M.timestamp?u?u.p(w,v):(u=Vw(w),u.c(),u.m(t,a)):u&&(u.d(1),u=null),(O=w[23].queueState)!=null&&O.error?d?d.p(w,v):(d=qw(w),d.c(),d.m(t,null)):d&&(d.d(1),d=null),((A=w[23].queueState)==null?void 0:A.status)==="failed"?m?(m.p(w,v),v&3&&I(m,1)):(m=Ww(w),m.c(),I(m,1),m.m(l.parentNode,l)):m&&(we(),P(m,1,1,()=>{m=null}),_e())},i(w){f||(I(m),f=!0)},o(w){P(m),f=!1},d(w){w&&(L(e),L(i),L(l)),u&&u.d(),d&&d.d(),m&&m.d(w)}}}function AD(o){let e,t=o[9].default,r=ge(t,o,o[13],null),s=r||PD(o);return{c(){s&&s.c()},m(n,a){s&&s.m(n,a),e=!0},p(n,a){r?r.p&&(!e||a&8192)&&xe(r,t,n,n[13],e?ye(t,n[13],a,null):be(n[13]),null):s&&s.p&&(!e||a&3)&&s.p(n,e?a:-1)},i(n){e||(I(s,n),e=!0)},o(n){P(s,n),e=!1},d(n){s&&s.d(n)}}}function FD(o){let e,t,r,s,n=o[23].path.split("/").pop()+"",a,i;var l=o[5](o[23]).icon;function f(u,d){return{props:{size:16,class:"svg-icon "+u[5](u[23]).iconClass}}}return l&&(t=Vn(l,f(o))),{c(){e=T("span"),t&&V(t.$$.fragment),r=$(),s=T("span"),a=G(n),b(e,"slot","name"),b(e,"class","file-name svelte-18bqwhy")},m(u,d){C(u,e,d),t&&N(t,e,null),S(e,r),S(e,s),S(s,a),i=!0},p(u,d){if(d&3&&l!==(l=u[5](u[23]).icon)){if(t){we();let m=t;P(m.$$.fragment,1,0,()=>{H(m,1)}),_e()}l?(t=Vn(l,f(u,d)),V(t.$$.fragment),I(t.$$.fragment,1),N(t,e,r)):t=null}else if(l){let m={};d&3&&(m.class="svg-icon "+u[5](u[23]).iconClass),t.$set(m)}(!i||d&3)&&n!==(n=u[23].path.split("/").pop()+"")&&ne(a,n)},i(u){i||(t&&I(t.$$.fragment,u),i=!0)},o(u){t&&P(t.$$.fragment,u),i=!1},d(u){u&&L(e),t&&H(t)}}}function zw(o){let e,t;return e=new mr({props:{$$slots:{name:[FD],default:[AD]},$$scope:{ctx:o}}}),{c(){V(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let n={};s&8195&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function Kw(o){let e,t;return e=new mr({props:{$$slots:{name:[DD]},$$scope:{ctx:o}}}),{c(){V(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let n={};s&8195&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function DD(o){let e,t,r=jw(o[1](o[20]).remainingCount)+"",s,n,a=o[20].title.toLowerCase()+"",i,l,f,u,d,m,y,h;function _(){return o[11](o[20])}function w(...v){return o[12](o[20],...v)}return{c(){var v;e=T("span"),t=G("...and "),s=G(r),n=G(` more
					`),i=G(a),l=$(),f=T("span"),u=G("(show more)"),m=$(),b(f,"class","show-more-link svelte-18bqwhy"),b(f,"role","button"),b(f,"tabindex","0"),b(f,"aria-label",d=`Show ${((v=o[2][o[20].title])==null?void 0:v.incrementCount)||o[2].default.incrementCount} more ${o[20].title.toLowerCase()}`),b(e,"slot","name"),b(e,"class","more-files svelte-18bqwhy")},m(v,M){C(v,e,M),S(e,t),S(e,s),S(e,n),S(e,i),S(e,l),S(e,f),S(f,u),S(e,m),y||(h=[ee(f,"click",_),ee(f,"keydown",w)],y=!0)},p(v,M){var O;o=v,M&3&&r!==(r=jw(o[1](o[20]).remainingCount)+"")&&ne(s,r),M&1&&a!==(a=o[20].title.toLowerCase()+"")&&ne(i,a),M&1&&d!==(d=`Show ${((O=o[2][o[20].title])==null?void 0:O.incrementCount)||o[2].default.incrementCount} more ${o[20].title.toLowerCase()}`)&&b(f,"aria-label",d)},d(v){v&&L(e),y=!1,ke(h)}}}function Gw(o){let e,t,r,s=o[1](o[20]).remainingCount>0,n,a;e=new Je({props:{name:o[20].title}});let i=Ae(o[1](o[20]).visibleDocs),l=[];for(let d=0;d<i.length;d+=1)l[d]=zw(Hw(o,i,d));let f=d=>P(l[d],1,1,()=>{l[d]=null}),u=s&&Kw(o);return{c(){V(e.$$.fragment),t=$();for(let d=0;d<l.length;d+=1)l[d].c();r=$(),u&&u.c(),n=Te()},m(d,m){N(e,d,m),C(d,t,m);for(let y=0;y<l.length;y+=1)l[y]&&l[y].m(d,m);C(d,r,m),u&&u.m(d,m),C(d,n,m),a=!0},p(d,m){let y={};if(m&1&&(y.name=d[20].title),e.$set(y),m&8291){i=Ae(d[1](d[20]).visibleDocs);let h;for(h=0;h<i.length;h+=1){let _=Hw(d,i,h);l[h]?(l[h].p(_,m),I(l[h],1)):(l[h]=zw(_),l[h].c(),I(l[h],1),l[h].m(r.parentNode,r))}for(we(),h=i.length;h<l.length;h+=1)f(h);_e()}m&3&&(s=d[1](d[20]).remainingCount>0),s?u?(u.p(d,m),m&3&&I(u,1)):(u=Kw(d),u.c(),I(u,1),u.m(n.parentNode,n)):u&&(we(),P(u,1,1,()=>{u=null}),_e())},i(d){if(!a){I(e.$$.fragment,d);for(let m=0;m<i.length;m+=1)I(l[m]);I(u),a=!0}},o(d){P(e.$$.fragment,d),l=l.filter(Xw);for(let m=0;m<l.length;m+=1)P(l[m]);P(u),a=!1},d(d){d&&(L(t),L(r),L(n)),H(e,d),tt(l,d),u&&u.d(d)}}}function MD(o){let e;return{c(){e=T("div"),e.textContent="Loading...",b(e,"class","loading")},m(t,r){C(t,e,r)},p:X,i:X,o:X,d(t){t&&L(e)}}}function ED(o){let e,t,r,s={ctx:o,current:null,token:null,hasCatch:!1,pending:MD,then:TD,catch:CD,value:19,blocks:[,,,]};return zn(t=o[0],s),{c(){e=Te(),s.block.c()},m(n,a){C(n,e,a),s.block.m(n,s.anchor=a),s.mount=()=>e.parentNode,s.anchor=e,r=!0},p(n,[a]){o=n,s.ctx=o,a&1&&t!==(t=o[0])&&zn(t,s)||Wl(s,o,a)},i(n){r||(I(s.block),r=!0)},o(n){for(let a=0;a<3;a+=1){let i=s.blocks[a];P(i)}r=!1},d(n){n&&L(e),s.block.d(n),s.token=null,s=null}}}function jw(o){return new Intl.NumberFormat().format(o)}function Yw(o){let e=new Date(o),r=new Date().getTime()-e.getTime(),s=Math.floor(r/(1e3*60));if(s<1)return"just now";if(s===1)return"1 minute ago";if(s<60)return`${s} minutes ago`;let n=Math.floor(s/60);if(n===1)return"1 hour ago";if(n<24)return`${n} hours ago`;let a=Math.floor(n/24);return a===1?"yesterday":`${a} days ago`}function Jw(o){let e=o.filter(n=>{var a;return((a=n.queueState)===null||a===void 0?void 0:a.status)==="running"}),t=o.filter(n=>{var a;return((a=n.queueState)===null||a===void 0?void 0:a.status)==="failed"}),r=o.filter(n=>{var a;return((a=n.queueState)===null||a===void 0?void 0:a.status)==="pending"}),s=o.filter(n=>{var a;return((a=n.queueState)===null||a===void 0?void 0:a.status)==="completed"});return[e.length>0&&{title:"Active Files",documents:e},t.length>0&&{title:"Stuck Files",documents:t},r.length>0&&{title:"Queued Files",documents:r},s.length>0&&{title:"Completed Files",documents:s}].filter(Boolean)}function RD(o,e,t){let r,s,n,a,i,{$$slots:l={},$$scope:f}=e,{folder:u}=e,{backgroundSync:d}=e,m={"Active Files":{initialCount:1/0,incrementCount:100},"Stuck Files":{initialCount:1/0,incrementCount:100},"Queued Files":{initialCount:10,incrementCount:100},"Completed Files":{initialCount:5,incrementCount:100},default:{initialCount:1/0,incrementCount:100}},y=ve({}),h=uo(y,R=>F=>{let D=m[F.title]||m.default,B=R[F.title]||D.initialCount,q=F.documents.slice(0,B),J=F.documents.length-B;return{visibleCount:B,visibleDocs:q,remainingCount:J}});he(o,h,R=>t(1,i=R));function _(R){let F=m[R]||m.default;y.update(D=>Object.assign(Object.assign({},D),{[R]:(D[R]||F.initialCount)+F.incrementCount}))}function w(R){return Ge(this,void 0,void 0,function*(){var F;let D=[],B=Array.from(R.docs.values());for(let q of B){let J=yield q.getOrigin(),K=yield q.getServerSynced(),z={guid:q.guid,path:R.getPath(q.path),doc:q,origin:J||"unknown",serverSynced:K},W=Array.from(r).find(le=>le.guid===q.guid),re=Array.from(s).find(le=>le.guid===q.guid),Le=n.find(le=>le.guid===q.guid);if(W||re||Le){let le=W||re||Le;z.queueState={status:le.status,type:"type"in le?le.type:"sync",error:"error"in le?le.error:void 0,timestamp:"timestamp"in le?le.timestamp:Date.now()}}else J==="local"&&!K?z.queueState={status:"pending",type:"sync",timestamp:Date.now()}:K?z.queueState={status:"completed",type:"sync",timestamp:Date.now()}:z.queueState={status:"pending",type:"sync",timestamp:Date.now()};D.push(z)}return{folder:R,documents:D,progress:((F=d.getGroupProgress(R))===null||F===void 0?void 0:F.percent)||0}})}function v(R){let{origin:F,serverSynced:D,queueState:B}=R,q=(B==null?void 0:B.status)||"completed",J=(B==null?void 0:B.type)||"sync";return F==="remote"&&!D&&q==="running"&&J==="download"?{text:"Downloading",description:"Initial acquisition",icon:pd,iconClass:"mod-primary"}:F==="remote"&&!D&&q==="pending"&&J==="download"?{text:"Queued for Download",description:"Waiting to download",icon:oi,iconClass:""}:F==="remote"&&!D&&q==="failed"&&J==="download"?{text:"Download stuck",description:"Needs retry",icon:si,iconClass:"mod-warning"}:F==="local"&&!D&&q==="running"&&J==="sync"?{text:"Uploading",description:"First-time upload",icon:Dd,iconClass:"mod-primary"}:F==="local"&&!D&&q==="pending"&&J==="sync"?{text:"Queued for Upload",description:"Waiting to upload",icon:oi,iconClass:""}:F==="local"&&!D&&q==="failed"&&J==="sync"?{text:"Upload stuck",description:"Needs retry",icon:si,iconClass:"mod-warning"}:D&&q==="running"&&J==="sync"?{text:"Syncing",description:"Collaborative update",icon:od,iconClass:"mod-primary"}:D&&q==="pending"&&J==="sync"?{text:"Queued for Sync",description:"Waiting to sync",icon:oi,iconClass:""}:D&&q==="failed"&&J==="sync"?{text:"Sync stuck",description:"Needs retry",icon:si,iconClass:"mod-warning"}:D&&q==="completed"?{text:"Complete",description:"Fully synchronized",icon:cd,iconClass:"mod-success"}:{text:"Unknown",description:"Status unknown",icon:yd,iconClass:""}}function M(R){return Ge(this,void 0,void 0,function*(){var F,D;let B={id:R.guid,guid:R.guid,path:R.path,timestamp:((F=R.queueState)===null||F===void 0?void 0:F.timestamp)||Date.now(),type:((D=R.queueState)===null||D===void 0?void 0:D.type)||"sync",status:"failed",sharedFolderGuid:R.doc.sharedFolder.guid};yield d.retryLogItem(B)})}let O=R=>M(R),A=R=>{_(R.title)},E=(R,F)=>F.key==="Enter"&&_(R.title);return o.$$set=R=>{"folder"in R&&t(7,u=R.folder),"backgroundSync"in R&&t(8,d=R.backgroundSync),"$$scope"in R&&t(13,f=R.$$scope)},o.$$.update=()=>{if(o.$$.dirty&256){e:r=new Set(d.activeSync.items())}if(o.$$.dirty&256){e:s=new Set(d.activeDownloads.items())}if(o.$$.dirty&256){e:n=d.getSyncLog()}if(o.$$.dirty&128){e:t(0,a=w(u))}},[a,i,m,h,_,v,M,u,d,l,O,A,E,f]}var ym=class extends Z{constructor(e){super(),te(this,e,RD,ED,Q,{folder:7,backgroundSync:8},LD)}},xm=ym;var{Map:OD}=Bs;function UD(o){De(o,"svelte-ztgdsf",".folder-header.svelte-ztgdsf{display:flex;align-items:center;cursor:pointer;background:none;border:none;padding:0;width:100%;text-align:left;color:inherit;font:inherit}.arrow.svelte-ztgdsf{margin-right:8px;font-size:0.8em;transition:transform 0.15s ease}.arrow.is-expanded.svelte-ztgdsf{transform:rotate(90deg)}.sync-stats.svelte-ztgdsf{margin-left:8px;display:flex;gap:4px}.tag.svelte-ztgdsf{font-size:0.7em;padding:2px 6px;border-radius:4px;background-color:var(--background-modifier-border);color:var(--text-muted)}.tag.mod-success.svelte-ztgdsf{background-color:var(--interactive-success);color:var(--text-on-accent)}.tag.mod-warning.svelte-ztgdsf{background-color:var(--text-warning);color:var(--text-on-accent)}.progress-container.svelte-ztgdsf{display:flex;align-items:center;margin-top:4px;width:100%}.progress-bar.svelte-ztgdsf{flex:1;height:6px;background-color:var(--background-modifier-border);border-radius:3px;overflow:hidden;margin-right:8px}.progress-value.svelte-ztgdsf{height:100%;background-color:var(--interactive-accent);border-radius:3px}.progress-text.svelte-ztgdsf{font-size:0.75rem;color:var(--text-muted)}")}function Qw(o,e,t){let r=o.slice();r[25]=e[t];let s=r[4].get(r[25].guid);return r[26]=s,r}function Zw(o){let e,t;return e=new Je({props:{name:"Sync Status"}}),{c(){V(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function e_(o){let e,t;return e=new $e({props:{name:o[11]?"Sync in Progress":o[10]?"Queued Files":"Sync Complete",description:`${o[2]} active \u2022 ${o[7]} stuck \u2022 ${o[3]} queued \u2022 ${o[8]} complete`,$$slots:{default:[ND]},$$scope:{ctx:o}}}),{c(){V(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let n={};s&3072&&(n.name=r[11]?"Sync in Progress":r[10]?"Queued Files":"Sync Complete"),s&396&&(n.description=`${r[2]} active \u2022 ${r[7]} stuck \u2022 ${r[3]} queued \u2022 ${r[8]} complete`),s&536874496&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function t_(o){let e,t,r,s,n,a,i=[BD,$D],l=[];function f(u,d){return u[9]?0:1}return t=f(o,-1),r=l[t]=i[t](o),{c(){e=T("button"),r.c(),b(e,"class","mod-cta")},m(u,d){C(u,e,d),l[t].m(e,null),s=!0,n||(a=ee(e,"click",o[16]),n=!0)},p(u,d){let m=t;t=f(u,d),t!==m&&(we(),P(l[m],1,1,()=>{l[m]=null}),_e(),r=l[t],r||(r=l[t]=i[t](u),r.c()),I(r,1),r.m(e,null))},i(u){s||(I(r),s=!0)},o(u){P(r),s=!1},d(u){u&&L(e),l[t].d(),n=!1,a()}}}function $D(o){let e,t,r;return e=new vd({props:{size:16,class:"svg-icon lucide-pause",style:"margin-right: 8px;"}}),{c(){V(e.$$.fragment),t=G(`
						Pause`)},m(s,n){N(e,s,n),C(s,t,n),r=!0},i(s){r||(I(e.$$.fragment,s),r=!0)},o(s){P(e.$$.fragment,s),r=!1},d(s){s&&L(t),H(e,s)}}}function BD(o){let e,t,r;return e=new kd({props:{size:16,class:"svg-icon lucide-play",style:"margin-right: 8px;"}}),{c(){V(e.$$.fragment),t=G(`
						Resume`)},m(s,n){N(e,s,n),C(s,t,n),r=!0},i(s){r||(I(e.$$.fragment,s),r=!0)},o(s){P(e.$$.fragment,s),r=!1},d(s){s&&L(t),H(e,s)}}}function ND(o){let e,t,r=(o[11]||o[10])&&t_(o);return{c(){r&&r.c(),e=Te()},m(s,n){r&&r.m(s,n),C(s,e,n),t=!0},p(s,n){s[11]||s[10]?r?(r.p(s,n),n&3072&&I(r,1)):(r=t_(s),r.c(),I(r,1),r.m(e.parentNode,e)):r&&(we(),P(r,1,1,()=>{r=null}),_e())},i(s){t||(I(r),t=!0)},o(s){P(r),t=!1},d(s){s&&L(e),r&&r.d(s)}}}function HD(o){let e=[],t=new OD,r,s,n=Ae(o[6]),a=i=>i[25].guid;for(let i=0;i<n.length;i+=1){let l=Qw(o,n,i),f=a(l);t.set(f,e[i]=i_(f,l))}return{c(){for(let i=0;i<e.length;i+=1)e[i].c();r=Te()},m(i,l){for(let f=0;f<e.length;f+=1)e[f]&&e[f].m(i,l);C(i,r,l),s=!0},p(i,l){l&32851&&(n=Ae(i[6]),we(),e=ux(e,l,a,1,i,n,t,r.parentNode,fx,i_,r,Qw),_e())},i(i){if(!s){for(let l=0;l<n.length;l+=1)I(e[l]);s=!0}},o(i){for(let l=0;l<e.length;l+=1)P(e[l]);s=!1},d(i){i&&L(r);for(let l=0;l<e.length;l+=1)e[l].d(i)}}}function VD(o){let e,t,r,s;return e=new Je({props:{$$slots:{name:[jD],default:[KD]},$$scope:{ctx:o}}}),r=new xm({props:{folder:o[5],backgroundSync:o[0]}}),{c(){V(e.$$.fragment),t=$(),V(r.$$.fragment)},m(n,a){N(e,n,a),C(n,t,a),N(r,n,a),s=!0},p(n,a){let i={};a&536875040&&(i.$$scope={dirty:a,ctx:n}),e.$set(i);let l={};a&32&&(l.folder=n[5]),a&1&&(l.backgroundSync=n[0]),r.$set(l)},i(n){s||(I(e.$$.fragment,n),I(r.$$.fragment,n),s=!0)},o(n){P(e.$$.fragment,n),P(r.$$.fragment,n),s=!1},d(n){n&&L(t),H(e,n),H(r,n)}}}function r_(o){let e,t,r,s,n,a=o[26].progress+"",i,l;return{c(){e=T("div"),t=T("div"),r=T("div"),s=$(),n=T("span"),i=G(a),l=G("%"),b(r,"class","progress-value svelte-ztgdsf"),pe(r,"width",o[26].progress+"%"),b(t,"class","progress-bar svelte-ztgdsf"),b(n,"class","progress-text svelte-ztgdsf"),b(e,"class","progress-container svelte-ztgdsf")},m(f,u){C(f,e,u),S(e,t),S(t,r),S(e,s),S(e,n),S(n,i),S(n,l)},p(f,u){u&80&&pe(r,"width",f[26].progress+"%"),u&80&&a!==(a=f[26].progress+"")&&ne(i,a)},d(f){f&&L(e)}}}function qD(o){let e,t=o[26]&&(o[26].running>0||o[26].failed>0)&&r_(o);return{c(){t&&t.c(),e=Te()},m(r,s){t&&t.m(r,s),C(r,e,s)},p(r,s){r[26]&&(r[26].running>0||r[26].failed>0)?t?t.p(r,s):(t=r_(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&L(e),t&&t.d(r)}}}function o_(o){let e,t=o[26].running+"",r,s;return{c(){e=T("span"),r=G(t),s=G(" active"),b(e,"class","tag mod-success svelte-ztgdsf")},m(n,a){C(n,e,a),S(e,r),S(e,s)},p(n,a){a&80&&t!==(t=n[26].running+"")&&ne(r,t)},d(n){n&&L(e)}}}function s_(o){let e,t=o[26].failed+"",r,s;return{c(){e=T("span"),r=G(t),s=G(" stuck"),b(e,"class","tag mod-warning svelte-ztgdsf")},m(n,a){C(n,e,a),S(e,r),S(e,s)},p(n,a){a&80&&t!==(t=n[26].failed+"")&&ne(r,t)},d(n){n&&L(e)}}}function n_(o){let e,t=o[26].pending+"",r,s;return{c(){e=T("span"),r=G(t),s=G(" queued"),b(e,"class","tag svelte-ztgdsf")},m(n,a){C(n,e,a),S(e,r),S(e,s)},p(n,a){a&80&&t!==(t=n[26].pending+"")&&ne(r,t)},d(n){n&&L(e)}}}function WD(o){var A,E,R;let e,t,r,s,n,a=o[25].name+"",i,l,f,u,d,m,y,h,_=((A=o[26])==null?void 0:A.running)>0&&o_(o),w=((E=o[26])==null?void 0:E.failed)>0&&s_(o),v=((R=o[26])==null?void 0:R.pending)>0&&n_(o);function M(){return o[22](o[25])}function O(...F){return o[23](o[25],...F)}return{c(){e=T("div"),t=T("span"),r=G("\u25B6"),n=$(),i=G(a),l=$(),f=T("span"),_&&_.c(),u=$(),w&&w.c(),d=$(),v&&v.c(),b(t,"class",s="arrow "+(o[1][o[25].guid]?"is-expanded":"")+" svelte-ztgdsf"),b(f,"class","sync-stats svelte-ztgdsf"),b(e,"class","folder-header svelte-ztgdsf"),b(e,"role","button"),b(e,"tabindex","0"),b(e,"aria-expanded",m=!!o[1][o[25].guid])},m(F,D){C(F,e,D),S(e,t),S(t,r),S(e,n),S(e,i),S(e,l),S(e,f),_&&_.m(f,null),S(f,u),w&&w.m(f,null),S(f,d),v&&v.m(f,null),y||(h=[ee(e,"click",M),ee(e,"keydown",O)],y=!0)},p(F,D){var B,q,J;o=F,D&66&&s!==(s="arrow "+(o[1][o[25].guid]?"is-expanded":"")+" svelte-ztgdsf")&&b(t,"class",s),D&64&&a!==(a=o[25].name+"")&&ne(i,a),((B=o[26])==null?void 0:B.running)>0?_?_.p(o,D):(_=o_(o),_.c(),_.m(f,u)):_&&(_.d(1),_=null),((q=o[26])==null?void 0:q.failed)>0?w?w.p(o,D):(w=s_(o),w.c(),w.m(f,d)):w&&(w.d(1),w=null),((J=o[26])==null?void 0:J.pending)>0?v?v.p(o,D):(v=n_(o),v.c(),v.m(f,null)):v&&(v.d(1),v=null),D&66&&m!==(m=!!o[1][o[25].guid])&&b(e,"aria-expanded",m)},d(F){F&&L(e),_&&_.d(),w&&w.d(),v&&v.d(),y=!1,ke(h)}}}function zD(o){let e,t;return e=new po({props:{folder:o[25],$$slots:{default:[WD]},$$scope:{ctx:o}}}),{c(){V(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let n={};s&64&&(n.folder=r[25]),s&536870994&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function a_(o){let e,t;return e=new xm({props:{folder:o[25],backgroundSync:o[0]}}),{c(){V(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let n={};s&64&&(n.folder=r[25]),s&1&&(n.backgroundSync=r[0]),e.$set(n)},i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function i_(o,e){let t,r,s,n,a;r=new Je({props:{$$slots:{name:[zD],default:[qD]},$$scope:{ctx:e}}});let i=e[1][e[25].guid]&&a_(e);return{key:o,first:null,c(){t=Te(),V(r.$$.fragment),s=$(),i&&i.c(),n=Te(),this.first=t},m(l,f){C(l,t,f),N(r,l,f),C(l,s,f),i&&i.m(l,f),C(l,n,f),a=!0},p(l,f){e=l;let u={};f&536870994&&(u.$$scope={dirty:f,ctx:e}),r.$set(u),e[1][e[25].guid]?i?(i.p(e,f),f&66&&I(i,1)):(i=a_(e),i.c(),I(i,1),i.m(n.parentNode,n)):i&&(we(),P(i,1,1,()=>{i=null}),_e())},i(l){a||(I(r.$$.fragment,l),I(i),a=!0)},o(l){P(r.$$.fragment,l),P(i),a=!1},d(l){l&&(L(t),L(s),L(n)),H(r,l),i&&i.d(l)}}}function l_(o){let e,t,r,s,n,a=o[12].progress+"",i,l;return{c(){e=T("div"),t=T("div"),r=T("div"),s=$(),n=T("span"),i=G(a),l=G("%"),b(r,"class","progress-value svelte-ztgdsf"),pe(r,"width",o[12].progress+"%"),b(t,"class","progress-bar svelte-ztgdsf"),b(n,"class","progress-text svelte-ztgdsf"),b(e,"class","progress-container svelte-ztgdsf")},m(f,u){C(f,e,u),S(e,t),S(t,r),S(e,s),S(e,n),S(n,i),S(n,l)},p(f,u){u&4096&&pe(r,"width",f[12].progress+"%"),u&4096&&a!==(a=f[12].progress+"")&&ne(i,a)},d(f){f&&L(e)}}}function KD(o){let e,t=(o[12].running>0||o[12].failed>0)&&l_(o);return{c(){t&&t.c(),e=Te()},m(r,s){t&&t.m(r,s),C(r,e,s)},p(r,s){r[12].running>0||r[12].failed>0?t?t.p(r,s):(t=l_(r),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(r){r&&L(e),t&&t.d(r)}}}function c_(o){let e,t=o[12].running+"",r,s;return{c(){e=T("span"),r=G(t),s=G(" active"),b(e,"class","tag mod-success svelte-ztgdsf")},m(n,a){C(n,e,a),S(e,r),S(e,s)},p(n,a){a&4096&&t!==(t=n[12].running+"")&&ne(r,t)},d(n){n&&L(e)}}}function f_(o){let e,t=o[12].failed+"",r,s;return{c(){e=T("span"),r=G(t),s=G(" stuck"),b(e,"class","tag mod-warning svelte-ztgdsf")},m(n,a){C(n,e,a),S(e,r),S(e,s)},p(n,a){a&4096&&t!==(t=n[12].failed+"")&&ne(r,t)},d(n){n&&L(e)}}}function u_(o){let e,t=o[12].pending+"",r,s;return{c(){e=T("span"),r=G(t),s=G(" queued"),b(e,"class","tag svelte-ztgdsf")},m(n,a){C(n,e,a),S(e,r),S(e,s)},p(n,a){a&4096&&t!==(t=n[12].pending+"")&&ne(r,t)},d(n){n&&L(e)}}}function GD(o){let e,t=o[5].name+"",r,s,n,a,i,l=o[12].running>0&&c_(o),f=o[12].failed>0&&f_(o),u=o[12].pending>0&&u_(o);return{c(){e=T("div"),r=G(t),s=$(),n=T("span"),l&&l.c(),a=$(),f&&f.c(),i=$(),u&&u.c(),b(n,"class","sync-stats svelte-ztgdsf"),b(e,"class","folder-header svelte-ztgdsf")},m(d,m){C(d,e,m),S(e,r),S(e,s),S(e,n),l&&l.m(n,null),S(n,a),f&&f.m(n,null),S(n,i),u&&u.m(n,null)},p(d,m){m&32&&t!==(t=d[5].name+"")&&ne(r,t),d[12].running>0?l?l.p(d,m):(l=c_(d),l.c(),l.m(n,a)):l&&(l.d(1),l=null),d[12].failed>0?f?f.p(d,m):(f=f_(d),f.c(),f.m(n,i)):f&&(f.d(1),f=null),d[12].pending>0?u?u.p(d,m):(u=u_(d),u.c(),u.m(n,null)):u&&(u.d(1),u=null)},d(d){d&&L(e),l&&l.d(),f&&f.d(),u&&u.d()}}}function jD(o){let e,t;return e=new po({props:{folder:o[5],$$slots:{default:[GD]},$$scope:{ctx:o}}}),{c(){V(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let n={};s&32&&(n.folder=r[5]),s&536875040&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function YD(o){let e,t,r,s,n,a,i=!o[5]&&Zw(o),l=!o[5]&&e_(o),f=[VD,HD],u=[];function d(m,y){return m[5]&&m[12]?0:1}return s=d(o,-1),n=u[s]=f[s](o),{c(){e=T("div"),i&&i.c(),t=$(),l&&l.c(),r=$(),n.c(),b(e,"class","setting-item-container")},m(m,y){C(m,e,y),i&&i.m(e,null),S(e,t),l&&l.m(e,null),S(e,r),u[s].m(e,null),a=!0},p(m,[y]){m[5]?i&&(we(),P(i,1,1,()=>{i=null}),_e()):i?y&32&&I(i,1):(i=Zw(m),i.c(),I(i,1),i.m(e,t)),m[5]?l&&(we(),P(l,1,1,()=>{l=null}),_e()):l?(l.p(m,y),y&32&&I(l,1)):(l=e_(m),l.c(),I(l,1),l.m(e,r));let h=s;s=d(m,y),s===h?u[s].p(m,y):(we(),P(u[h],1,1,()=>{u[h]=null}),_e(),n=u[s],n?n.p(m,y):(n=u[s]=f[s](m),n.c()),I(n,1),n.m(e,null))},i(m){a||(I(i),I(l),I(n),a=!0)},o(m){P(i),P(l),P(n),a=!1},d(m){m&&L(e),i&&i.d(),l&&l.d(),u[s].d()}}}function JD(o,e,t){let r,s,n,a,i,l,f,u,d,m,y,{backgroundSync:h}=e,{sharedFolders:_}=e,{focusedFolderGuid:w}=e,v={},M=0,O=0,A=0,E=0,{activeSync:R,activeDownloads:F}=h;he(o,R,K=>t(21,y=K)),he(o,F,K=>t(20,m=K));function D(K){t(1,v[K]=!v[K],v),t(1,v),t(6,r),t(17,_)}function B(){l?h.resume():h.pause()}let q=K=>D(K.guid),J=(K,z)=>z.key==="Enter"&&D(K.guid);return o.$$set=K=>{"backgroundSync"in K&&t(0,h=K.backgroundSync),"sharedFolders"in K&&t(17,_=K.sharedFolders),"focusedFolderGuid"in K&&t(18,w=K.focusedFolderGuid)},o.$$.update=()=>{if(o.$$.dirty&131072){e:t(6,r=_.items().sort((K,z)=>K.name.localeCompare(z.name)))}if(o.$$.dirty&66){e:r.forEach(K=>{K.guid in v||t(1,v[K.guid]=!0,v)}),t(1,v),t(6,r),t(17,_)}if(o.$$.dirty&393216){e:t(5,s=w?_.items().find(K=>K.guid===w):void 0)}if(o.$$.dirty&3145793){e:t(4,n=new Map(r.map(K=>{var z,W;return[K.guid,{progress:((z=h.getGroupProgress(K))===null||z===void 0?void 0:z.percent)||0,running:[...y.items(),...m.items()].filter(re=>re.sharedFolder.guid===K.guid).length,failed:((W=h.syncGroups.get(K))===null||W===void 0?void 0:W.status)==="failed"?1:0,pending:[...h.pendingSyncs,...h.pendingDownloads].filter(re=>re.sharedFolder.guid===K.guid).length,completed:(()=>{let re=h.syncGroups.get(K);return((re==null?void 0:re.completedSyncs)||0)+((re==null?void 0:re.completedDownloads)||0)})(),sharedFolder:K}]})))}if(o.$$.dirty&48){e:t(12,a=s?n.get(s.guid):void 0)}if(o.$$.dirty&1){e:t(19,i=h.getQueueStatus())}if(o.$$.dirty&524288){e:t(9,l=i.isPaused)}if(o.$$.dirty&524288){e:f=i.syncsActive>0||i.downloadsActive>0}if(o.$$.dirty&16){e:{let K=0,z=0,W=0,re=0;for(let Le of n.values())K+=Le.running,z+=Le.failed,W+=Le.pending,re+=Le.completed;t(2,M=K),t(7,O=z),t(3,A=W),t(8,E=re)}}if(o.$$.dirty&4){e:t(11,u=M>0)}if(o.$$.dirty&8){e:t(10,d=A>0)}},[h,v,M,A,n,s,r,O,E,l,d,u,a,R,F,D,B,_,w,i,m,y,q,J]}var bm=class extends Z{constructor(e){super(),te(this,e,JD,YD,Q,{backgroundSync:0,sharedFolders:17,focusedFolderGuid:18},UD)}},d_=bm;var yi=class extends p_.Modal{constructor(t,r,s,n){super(t);this.backgroundSync=r;this.sharedFolders=s;this.focusedFolderGuid=n}onOpen(){let{contentEl:t}=this;t.empty(),this.component=new d_({target:t,props:{backgroundSync:this.backgroundSync,sharedFolders:this.sharedFolders,focusedFolderGuid:this.focusedFolderGuid,closeModal:()=>this.close()}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};function wm(o){return o.startsWith("v")?o.slice(1):o}function XD(o,e){return o.map((t,r)=>[t,e[r]])}function QD(o,e){try{let t=wm(o).split(".").map(parseInt),r=wm(e).split(".").map(parseInt);for(let[s,n]of XD(t,r))if(s>n)return!0}catch(t){}return!1}var $c=class extends xt{constructor(t,r,s){super("UpdateManager");this.plugin=t;this.timeProvider=r;this.releaseSettings=s;this.updateCheckInterval=null;this.lastReleaseCheck=0;this.lastChannelCheck=0;this.CHECK_INTERVAL=1e3*60*60*24;this.githubReleases=new Uo("system3-relay/releases"),this.releaseChannels=new Uo("system3-relay/releaseChannels")}get releases(){return[...this.githubReleases.values()].sort((t,r)=>r.tag_name.localeCompare(t.tag_name,void 0,{numeric:!0,sensitivity:"base"}))}get beta(){return this.releaseChannels.get("beta")}get stable(){return this.releaseChannels.get("stable")}async fetchReleases(){let r=await Pt("https://api.github.com/repos/No-Instructions/Relay/releases",{headers:{Accept:"application/vnd.github.v3+json","User-Agent":"Relay-Obsidian-Plugin"}});if(!r.ok)throw new Error(`GitHub API error: ${r.status}`);let s=await r.json();return Xe().enableNetworkLogging&&this.debug("GitHub releases fetched:",s),s}async fetchLatestRelease(){try{let s="https://api.github.com/repos/No-Instructions/Relay/releases/latest";this.debug(`Fetching latest release from: ${s}`);let n=await Pt(s,{headers:{"User-Agent":"Relay-Obsidian-Plugin"}});if(!n.ok)throw new Error(`GitHub API error: ${n.status}`);return await n.json()}catch(t){return this.error("Failed to fetch latest release:",t),null}}async fetchLatestTagFromChannel(t){try{let r={beta:"manifest-beta.json",stable:"manifest.json"}[t],s=r?await this.fetchRepoManifest(r):null;return s?(this.debug("repo manifest",s),s.version):null}catch(r){this.error("Failed to check for updates:",r)}return null}async getReleases(){try{let t=Date.now();if(t-this.lastReleaseCheck<5*60*1e3&&this.githubReleases.size>0)return[...this.githubReleases.values()];this.lastReleaseCheck=t,(await this.fetchReleases()).forEach(n=>{this.githubReleases.set(n.tag_name,n)});let s=await this.fetchLatestRelease();s&&(s.latest=!0,this.githubReleases.set(s.tag_name,s)),this.notifyListeners()}catch(t){this.error("Failed to fetch GitHub releases:",t)}return[...this.githubReleases.values()]}async getChannelRelease(){let t=Date.now(),r=this.releaseChannels.get(this.releaseSettings.get().channel);if(t-this.lastChannelCheck<5*60*1e3&&r)return r;this.lastReleaseCheck=t;let s=await this.getReleases();if(s.length===0)return this.debug("No releases found"),null;let n=this.releaseSettings.get().channel;if(!n)return null;let a=await this.fetchLatestTagFromChannel(n);if(!a)return null;let i=s.find(l=>wm(l.tag_name)===a);return i?(this.releaseChannels.set(n,i),this.notifyListeners(),i):null}async update(){await this.getReleases(),await this.getChannelRelease()}start(){this.update(),this.updateCheckInterval=this.timeProvider.setInterval(()=>this.update(),this.CHECK_INTERVAL)}stop(){this.updateCheckInterval!==null&&(this.timeProvider.clearInterval(this.updateCheckInterval),this.updateCheckInterval=null)}async fetchRepoManifest(t,r="main"){try{let a=`https://raw.githubusercontent.com/No-Instructions/Relay/${r}/${t}`;this.debug(`Fetching ${a}`);let i=await Pt(a);if(!i.ok)throw new Error("unable to fetch manifest");return await i.json()}catch(s){return this.error("Failed to fetch:",s),null}}async fetchReleaseManifest(t){try{let r=t.assets.find(a=>a.name==="manifest.json");if(!r)return this.debug("No manifest found in release assets"),null;this.debug("Fetching manifest from release asset:",r.browser_download_url);let s=await Pt(r.browser_download_url,{headers:{Accept:"application/octet-stream","User-Agent":"Relay-Obsidian-Plugin"}});if(!s.ok)throw new Error(`Failed to fetch manifest asset: ${s.status}`);let n=await s.json();return Xe().enableNetworkLogging&&this.debug("manifest fetched:",n),n}catch(r){return this.error("Failed to fetch manifest for release:",t,r),null}}getNewRelease(){let t=this.releaseChannels.get(this.releaseSettings.get().channel);if(t&&QD(t.tag_name,this.plugin.version))return t}async installUpdate(t){let r=await this.fetchReleaseManifest(t);try{this.debug(`Installing update from v${this.plugin.version} to v${r.version}...`,r),await this.plugin.app.plugins.installPlugin("No-Instructions/Relay",r.version,r),this.notifyListeners(),this.debug("Update complete. Reloading plugin...");let s="system3-relay",n=this.plugin.app.plugins;return await n.disablePlugin(s),await n.enablePlugin(s),!0}catch(s){return this.error("Failed to install update:",s),!1}}applyAutomaticUpdates(){if(this.releaseSettings.get().automaticUpdates){let t=this.getNewRelease();t&&this.installUpdate(t)}}destroy(){this.stop(),this.githubReleases=null,this.releaseChannels=null,super.destroy()}};var F_=require("obsidian");var P_=require("obsidian");function ZD(o){De(o,"svelte-12doke6",'.modal-content.svelte-12doke6.svelte-12doke6{padding:0;display:flex;flex-direction:column;height:100%}.settings-container.svelte-12doke6.svelte-12doke6{margin:0 1rem;border-bottom:1px solid var(--background-modifier-border);margin-bottom:1rem}.settings-spacer.svelte-12doke6.svelte-12doke6{height:0.5rem}.checkbox-container.svelte-12doke6.svelte-12doke6{cursor:pointer}.loading-text.svelte-12doke6.svelte-12doke6,.no-releases-text.svelte-12doke6.svelte-12doke6{padding:12px;text-align:center;color:var(--text-muted);font-style:italic}.release-tags-container.svelte-12doke6.svelte-12doke6{display:flex;flex-wrap:wrap;column-gap:8px;row-gap:4px;padding:0 1rem 1rem;max-height:160px;overflow-y:auto}.release-tag-item.svelte-12doke6.svelte-12doke6{display:flex;justify-content:center;align-items:center;background-color:var(--background-secondary);border:1px solid var(--background-modifier-border);border-radius:4px;padding:4px 8px;height:24px;cursor:pointer;opacity:0.7;position:relative}.release-tag-item.svelte-12doke6.svelte-12doke6:hover{background-color:var(--background-modifier-hover);opacity:0.9}.release-tag-item[aria-selected="true"].svelte-12doke6.svelte-12doke6{background-color:var(--color-accent);border-color:var(--background-modifier-border);border-bottom-width:2px;opacity:1}.release-tag-item.current-version.svelte-12doke6.svelte-12doke6{border-width:1px}.release-tag-item.development-version.svelte-12doke6.svelte-12doke6{border-width:1px}.release-tag-item.main-branch-version.svelte-12doke6.svelte-12doke6{border-width:1px}.release-tag-item.beta-version.svelte-12doke6.svelte-12doke6{font-weight:bold}.release-tag-item.stable-version.svelte-12doke6.svelte-12doke6{font-weight:bold}.prerelease-badge.svelte-12doke6.svelte-12doke6{font-size:0.7em;color:var(--text-on-accent);border-radius:4px;padding:2px 6px;margin-left:8px;vertical-align:middle;text-transform:uppercase}.channel-badge.svelte-12doke6.svelte-12doke6{font-size:0.7em;border-radius:4px;padding:2px 6px;margin-left:8px;vertical-align:middle;text-transform:uppercase}.beta-badge.svelte-12doke6.svelte-12doke6{background-color:var(--background-modifier-hover);color:var(--text-normal)}.stable-badge.svelte-12doke6.svelte-12doke6{background-color:var(--background-modifier-hover);color:var(--text-normal)}.tag-name.svelte-12doke6.svelte-12doke6{font-weight:bold;font-size:0.8em;display:flex;align-items:center}.manifest-container.svelte-12doke6.svelte-12doke6{flex:1;display:flex;flex-direction:column;border:1px solid var(--background-modifier-border);border-radius:8px;background-color:var(--background-secondary);margin:0 1rem 1rem;overflow:hidden}.manifest-header.svelte-12doke6.svelte-12doke6{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;background-color:var(--background-secondary-alt);border-bottom:1px solid var(--background-modifier-border)}.manifest-header.svelte-12doke6 h3.svelte-12doke6{margin:0;font-size:1.1em;color:var(--text-normal);display:flex;align-items:center}.manifest-header-actions.svelte-12doke6.svelte-12doke6{display:flex;align-items:center;gap:10px}.manifest-close-btn.svelte-12doke6.svelte-12doke6{cursor:pointer;font-size:1.2em;background:transparent;border:none;color:var(--text-normal)}.manifest-content.svelte-12doke6.svelte-12doke6{padding:16px;border-top:1px solid var(--background-modifier-border)}.manifest-field.svelte-12doke6.svelte-12doke6{margin-bottom:8px;display:flex;align-items:flex-start}.manifest-label.svelte-12doke6.svelte-12doke6{font-weight:bold;min-width:120px;color:var(--text-normal)}.manifest-value.svelte-12doke6.svelte-12doke6{flex:1}.manifest-version-mismatch.svelte-12doke6.svelte-12doke6{margin-left:10px;color:var(--text-error);font-size:0.85em;display:flex;align-items:center;gap:4px}.manifest-version-mismatch-icon.svelte-12doke6.svelte-12doke6{font-size:1.2em}.release-changelog.svelte-12doke6.svelte-12doke6{padding:16px;overflow:hidden;display:flex;flex-direction:column;height:320px}.release-changelog-content.svelte-12doke6.svelte-12doke6{overflow-x:auto;margin:0;font-size:0.85em;flex:1;overflow-y:auto;line-height:1.4}.currently-installed.svelte-12doke6.svelte-12doke6{color:var(--interactive-accent);font-weight:bold;padding:4px 8px;border-radius:4px}.install-version-btn.svelte-12doke6.svelte-12doke6{font-size:0.9em;padding:4px 12px;cursor:pointer}.manifest-error.svelte-12doke6.svelte-12doke6{padding:16px;text-align:center;background-color:var(--background-modifier-error);border-radius:6px;color:var(--text-on-accent);margin:0 1rem 1rem}.manifest-error-message.svelte-12doke6.svelte-12doke6{margin-bottom:12px}')}function m_(o,e,t){let r=o.slice();return r[71]=e[t],r}function eM(o){let e,t;return e=new mr({props:{name:"Automatically install updates",$$slots:{default:[tM]},$$scope:{ctx:o}}}),{c(){V(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let n={};s[0]&128|s[2]&4096&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function tM(o){let e,t,r,s,n,a;return{c(){e=T("div"),t=T("input"),r=$(),s=T("div"),b(t,"type","checkbox"),t.checked=o[7],b(s,"class","checkbox-toggle"),b(e,"class","checkbox-container svelte-12doke6"),b(e,"role","checkbox"),b(e,"aria-checked",o[7]),b(e,"tabindex","0"),Ve(e,"is-enabled",o[7])},m(i,l){C(i,e,l),S(e,t),S(e,r),S(e,s),n||(a=[ee(e,"click",o[44]),ee(e,"keydown",o[45])],n=!0)},p(i,l){l[0]&128&&(t.checked=i[7]),l[0]&128&&b(e,"aria-checked",i[7]),l[0]&128&&Ve(e,"is-enabled",i[7])},d(i){i&&L(e),n=!1,ke(a)}}}function h_(o){let e,t;return e=new mr({props:{name:"Show all releases",$$slots:{default:[rM]},$$scope:{ctx:o}}}),{c(){V(e.$$.fragment)},m(r,s){N(e,r,s),t=!0},p(r,s){let n={};s[0]&64|s[2]&4096&&(n.$$scope={dirty:s,ctx:r}),e.$set(n)},i(r){t||(I(e.$$.fragment,r),t=!0)},o(r){P(e.$$.fragment,r),t=!1},d(r){H(e,r)}}}function rM(o){let e,t,r,s,n,a;return{c(){e=T("div"),t=T("input"),r=$(),s=T("div"),b(t,"type","checkbox"),t.checked=o[6],b(s,"class","checkbox-toggle"),b(e,"class","checkbox-container svelte-12doke6"),b(e,"role","checkbox"),b(e,"aria-checked",o[6]),b(e,"tabindex","0"),Ve(e,"is-enabled",o[6])},m(i,l){C(i,e,l),S(e,t),S(e,r),S(e,s),n||(a=[ee(e,"click",o[46]),ee(e,"keydown",o[47])],n=!0)},p(i,l){l[0]&64&&(t.checked=i[6]),l[0]&64&&b(e,"aria-checked",i[6]),l[0]&64&&Ve(e,"is-enabled",i[6])},d(i){i&&L(e),n=!1,ke(a)}}}function oM(o){let e,t,r=(!o[1]||o[7])&&g_(o);function s(i,l){if(i[12])return lM;if(i[17])return iM}let n=s(o,[-1,-1,-1]),a=n&&n(o);return{c(){r&&r.c(),e=$(),a&&a.c(),t=Te()},m(i,l){r&&r.m(i,l),C(i,e,l),a&&a.m(i,l),C(i,t,l)},p(i,l){!i[1]||i[7]?r?r.p(i,l):(r=g_(i),r.c(),r.m(e.parentNode,e)):r&&(r.d(1),r=null),n===(n=s(i,l))&&a?a.p(i,l):(a&&a.d(1),a=n&&n(i),a&&(a.c(),a.m(t.parentNode,t)))},d(i){i&&(L(e),L(t)),r&&r.d(i),a&&a.d(i)}}}function sM(o){let e;return{c(){e=T("div"),e.textContent="No matching releases found with the current filter",b(e,"class","no-releases-text svelte-12doke6")},m(t,r){C(t,e,r)},p:X,d(t){t&&L(e)}}}function nM(o){let e;return{c(){e=T("div"),e.textContent="No GitHub releases found",b(e,"class","no-releases-text svelte-12doke6")},m(t,r){C(t,e,r)},p:X,d(t){t&&L(e)}}}function aM(o){let e;return{c(){e=T("div"),e.textContent="Loading GitHub releases...",b(e,"class","loading-text svelte-12doke6")},m(t,r){C(t,e,r)},p:X,d(t){t&&L(e)}}}function g_(o){let e,t,r,s=!o[7]&&!o[9].some(o[43]),n,a=o[5]&&y_(o),i=o[4]&&x_(o),l=s&&b_(o),f=!o[7]&&!o[1]&&w_(o);return{c(){e=T("div"),a&&a.c(),t=$(),i&&i.c(),r=$(),l&&l.c(),n=$(),f&&f.c(),b(e,"class","release-tags-container svelte-12doke6")},m(u,d){C(u,e,d),a&&a.m(e,null),S(e,t),i&&i.m(e,null),S(e,r),l&&l.m(e,null),S(e,n),f&&f.m(e,null)},p(u,d){u[5]?a?a.p(u,d):(a=y_(u),a.c(),a.m(e,t)):a&&(a.d(1),a=null),u[4]?i?i.p(u,d):(i=x_(u),i.c(),i.m(e,r)):i&&(i.d(1),i=null),d[0]&640&&(s=!u[7]&&!u[9].some(u[43])),s?l?l.p(u,d):(l=b_(u),l.c(),l.m(e,n)):l&&(l.d(1),l=null),!u[7]&&!u[1]?f?f.p(u,d):(f=w_(u),f.c(),f.m(e,null)):f&&(f.d(1),f=null)},d(u){u&&L(e),a&&a.d(),i&&i.d(),l&&l.d(),f&&f.d()}}}function y_(o){let e,t,r,s,n;return{c(){e=T("div"),t=T("div"),t.textContent="Stable",b(t,"class","tag-name svelte-12doke6"),b(e,"class","release-tag-item main-branch-version stable-version svelte-12doke6"),b(e,"role","tab"),b(e,"aria-selected",r=o[10]==="stable"),b(e,"tabindex","0")},m(a,i){C(a,e,i),S(e,t),s||(n=[ee(e,"click",o[48]),ee(e,"keydown",o[49])],s=!0)},p(a,i){i[0]&1024&&r!==(r=a[10]==="stable")&&b(e,"aria-selected",r)},d(a){a&&L(e),s=!1,ke(n)}}}function x_(o){let e,t,r,s,n;return{c(){e=T("div"),t=T("div"),t.textContent="Beta",b(t,"class","tag-name svelte-12doke6"),b(e,"class","release-tag-item main-branch-version beta-version svelte-12doke6"),b(e,"role","tab"),b(e,"aria-selected",r=o[10]==="beta"),b(e,"tabindex","0")},m(a,i){C(a,e,i),S(e,t),s||(n=[ee(e,"click",o[50]),ee(e,"keydown",o[51])],s=!0)},p(a,i){i[0]&1024&&r!==(r=a[10]==="beta")&&b(e,"aria-selected",r)},d(a){a&&L(e),s=!1,ke(n)}}}function b_(o){let e,t,r,s,n;return{c(){e=T("div"),t=T("div"),t.textContent="Dev",b(t,"class","tag-name svelte-12doke6"),b(e,"class","release-tag-item development-version svelte-12doke6"),b(e,"role","tab"),b(e,"aria-selected",r=o[11]===o[0].version),b(e,"tabindex","0")},m(a,i){C(a,e,i),S(e,t),s||(n=[ee(e,"click",o[52]),ee(e,"keydown",o[53])],s=!0)},p(a,i){i[0]&2049&&r!==(r=a[11]===a[0].version)&&b(e,"aria-selected",r)},d(a){a&&L(e),s=!1,ke(n)}}}function w_(o){let e,t=Ae(o[9]),r=[];for(let s=0;s<t.length;s+=1)r[s]=__(m_(o,t,s));return{c(){for(let s=0;s<r.length;s+=1)r[s].c();e=Te()},m(s,n){for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(s,n);C(s,e,n)},p(s,n){if(n[0]&536873472|n[1]&130){t=Ae(s[9]);let a;for(a=0;a<t.length;a+=1){let i=m_(s,t,a);r[a]?r[a].p(i,n):(r[a]=__(i),r[a].c(),r[a].m(e.parentNode,e))}for(;a<r.length;a+=1)r[a].d(1);r.length=t.length}},d(s){s&&L(e),tt(r,s)}}}function __(o){let e,t,r=o[71].tag_name+"",s,n,a,i,l,f;function u(){return o[54](o[71])}function d(...m){return o[55](o[71],...m)}return{c(){e=T("div"),t=T("div"),s=G(r),n=$(),b(t,"class","tag-name svelte-12doke6"),b(e,"class",a="release-tag-item "+(o[29](o[71].tag_name)?"current-version":"")+" "+(T_(o[71])?"pre-release":"")+" svelte-12doke6"),b(e,"role","tab"),b(e,"aria-selected",i=o[11]===o[71].tag_name),b(e,"tabindex","0")},m(m,y){C(m,e,y),S(e,t),S(t,s),S(e,n),l||(f=[ee(e,"click",u),ee(e,"keydown",d)],l=!0)},p(m,y){o=m,y[0]&512&&r!==(r=o[71].tag_name+"")&&ne(s,r),y[0]&512&&a!==(a="release-tag-item "+(o[29](o[71].tag_name)?"current-version":"")+" "+(T_(o[71])?"pre-release":"")+" svelte-12doke6")&&b(e,"class",a),y[0]&2560&&i!==(i=o[11]===o[71].tag_name)&&b(e,"aria-selected",i)},d(m){m&&L(e),l=!1,ke(f)}}}function iM(o){let e,t,r,s,n,a,i;return{c(){e=T("div"),t=T("div"),r=G(o[17]),s=$(),n=T("button"),n.textContent="Close",b(t,"class","manifest-error-message svelte-12doke6"),b(n,"class","manifest-close-btn svelte-12doke6"),b(e,"class","manifest-error svelte-12doke6")},m(l,f){C(l,e,f),S(e,t),S(t,r),S(e,s),S(e,n),a||(i=ee(n,"click",o[40]),a=!0)},p(l,f){f[0]&131072&&ne(r,l[17])},d(l){l&&L(e),a=!1,i()}}}function lM(o){var K;let e,t,r,s,n,a,i=(K=o[41](o[11]))==null?void 0:K.prerelease,l,f,u,d,m,y,h,_,w,v,M=i&&v_(o),O=o[13][o[11]]==="beta-alias"&&S_(o),A=o[13][o[11]]==="stable-alias"&&k_(o);function E(z,W){if(W[0]&18432&&(m=null),W[0]&2048&&(y=null),m==null&&(m=!!((z[41](z[11])||z[14][z[11]]==="stable-alias"||z[14][z[11]]==="beta-alias")&&!z[29](z[11]))),m)return fM;if(y==null&&(y=!!z[29](z[11])),y)return cM}let R=E(o,[-1,-1,-1]),F=R&&R(o);function D(z,W){return z[14][z[11]]==="stable-alias"||z[14][z[11]]==="beta-alias"||z[10]==="development"?hM:z[11]?mM:pM}let B=D(o,[-1,-1,-1]),q=B(o),J=o[16]&&I_(o);return{c(){e=T("div"),t=T("div"),r=T("h3"),s=G("Release Details: "),n=G(o[11]),a=$(),M&&M.c(),l=$(),O&&O.c(),f=$(),A&&A.c(),u=$(),d=T("div"),F&&F.c(),h=$(),_=T("div"),w=T("div"),q.c(),v=$(),J&&J.c(),b(r,"class","svelte-12doke6"),b(d,"class","manifest-header-actions svelte-12doke6"),b(t,"class","manifest-header svelte-12doke6"),b(w,"class","release-changelog-content svelte-12doke6"),b(_,"class","release-changelog svelte-12doke6"),b(e,"class","manifest-container svelte-12doke6")},m(z,W){C(z,e,W),S(e,t),S(t,r),S(r,s),S(r,n),S(r,a),M&&M.m(r,null),S(r,l),O&&O.m(r,null),S(r,f),A&&A.m(r,null),S(t,u),S(t,d),F&&F.m(d,null),S(e,h),S(e,_),S(_,w),q.m(w,null),S(e,v),J&&J.m(e,null)},p(z,W){var re;W[0]&2048&&ne(n,z[11]),W[0]&2048&&(i=(re=z[41](z[11]))==null?void 0:re.prerelease),i?M||(M=v_(z),M.c(),M.m(r,l)):M&&(M.d(1),M=null),z[13][z[11]]==="beta-alias"?O||(O=S_(z),O.c(),O.m(r,f)):O&&(O.d(1),O=null),z[13][z[11]]==="stable-alias"?A||(A=k_(z),A.c(),A.m(r,null)):A&&(A.d(1),A=null),R===(R=E(z,W))&&F?F.p(z,W):(F&&F.d(1),F=R&&R(z),F&&(F.c(),F.m(d,null))),B===(B=D(z,W))&&q?q.p(z,W):(q.d(1),q=B(z),q&&(q.c(),q.m(w,null))),z[16]?J?J.p(z,W):(J=I_(z),J.c(),J.m(e,null)):J&&(J.d(1),J=null)},d(z){z&&L(e),M&&M.d(),O&&O.d(),A&&A.d(),F&&F.d(),q.d(),J&&J.d()}}}function v_(o){let e;return{c(){e=T("span"),e.textContent="Pre-release",b(e,"class","prerelease-badge svelte-12doke6")},m(t,r){C(t,e,r)},d(t){t&&L(e)}}}function S_(o){let e;return{c(){e=T("span"),e.textContent="Beta",b(e,"class","channel-badge beta-badge svelte-12doke6")},m(t,r){C(t,e,r)},d(t){t&&L(e)}}}function k_(o){let e;return{c(){e=T("span"),e.textContent="Stable",b(e,"class","channel-badge stable-badge svelte-12doke6")},m(t,r){C(t,e,r)},d(t){t&&L(e)}}}function cM(o){let e;return{c(){e=T("span"),e.textContent="Installed",b(e,"class","currently-installed svelte-12doke6")},m(t,r){C(t,e,r)},p:X,d(t){t&&L(e)}}}function fM(o){let e,t,r,s;function n(l,f){return l[15]===l[11]?dM:uM}let a=n(o,[-1,-1,-1]),i=a(o);return{c(){e=T("button"),i.c(),b(e,"class","install-version-btn mod-cta svelte-12doke6"),e.disabled=t=o[15]===o[11]||o[2]},m(l,f){C(l,e,f),i.m(e,null),r||(s=ee(e,"click",o[56]),r=!0)},p(l,f){a!==(a=n(l,f))&&(i.d(1),i=a(l),i&&(i.c(),i.m(e,null))),f[0]&34820&&t!==(t=l[15]===l[11]||l[2])&&(e.disabled=t)},d(l){l&&L(e),i.d(),r=!1,s()}}}function uM(o){let e;return{c(){e=G("Install")},m(t,r){C(t,e,r)},d(t){t&&L(e)}}}function dM(o){let e;return{c(){e=G("Installing...")},m(t,r){C(t,e,r)},d(t){t&&L(e)}}}function pM(o){let e;return{c(){e=G('"No changelog available"')},m(t,r){C(t,e,r)},p:X,d(t){t&&L(e)}}}function mM(o){var s;let e,t,r={ctx:o,current:null,token:null,hasCatch:!1,pending:xM,then:yM,catch:gM,value:70};return zn(t=o[37](((s=o[41](o[11]))==null?void 0:s.body)||"No changelog available"),r),{c(){e=Te(),r.block.c()},m(n,a){C(n,e,a),r.block.m(n,r.anchor=a),r.mount=()=>e.parentNode,r.anchor=e},p(n,a){var i;o=n,r.ctx=o,a[0]&2048&&t!==(t=o[37](((i=o[41](o[11]))==null?void 0:i.body)||"No changelog available"))&&zn(t,r)||Wl(r,o,a)},d(n){n&&L(e),r.block.d(n),r.token=null,r=null}}}function hM(o){let e;function t(n,a){if(n[14][n[11]]==="stable-alias")return _M;if(n[14][n[11]]==="beta-alias")return wM;if(n[11]===n[0].version)return bM}let r=t(o,[-1,-1,-1]),s=r&&r(o);return{c(){s&&s.c(),e=Te()},m(n,a){s&&s.m(n,a),C(n,e,a)},p(n,a){r!==(r=t(n,a))&&(s&&s.d(1),s=r&&r(n),s&&(s.c(),s.m(e.parentNode,e)))},d(n){n&&L(e),s&&s.d(n)}}}function gM(o){return{c:X,m:X,p:X,d:X}}function yM(o){let e,t=o[70]+"",r;return{c(){e=new Hn(!1),r=Te(),e.a=r},m(s,n){e.m(t,s,n),C(s,r,n)},p(s,n){n[0]&2048&&t!==(t=s[70]+"")&&e.p(t)},d(s){s&&(L(r),e.d())}}}function xM(o){let e;return{c(){e=G('"loading..."')},m(t,r){C(t,e,r)},p:X,d(t){t&&L(e)}}}function bM(o){let e;return{c(){e=T("p"),e.textContent="Current development version"},m(t,r){C(t,e,r)},d(t){t&&L(e)}}}function wM(o){let e;return{c(){e=T("p"),e.textContent="Current beta release from main branch manifest-beta.json"},m(t,r){C(t,e,r)},d(t){t&&L(e)}}}function _M(o){let e;return{c(){e=T("p"),e.textContent="Current stable release from main branch manifest.json"},m(t,r){C(t,e,r)},d(t){t&&L(e)}}}function I_(o){let e,t,r,s,n,a=o[12].version+"",i,l,f=o[11]!==o[12].version&&!o[11].startsWith("v"+o[12].version),u,d,m,y,h,_=o[12].name+"",w,v,M,O,A,E,R=o[12].author+"",F,D,B,q,J,K,z=o[12].description+"",W,re,Le,le,Ce,Ke,Re=o[12].isDesktopOnly?"Yes":"No",de,fe,oe,Be,At,Ot,Ut=o[12].minAppVersion+"",gt,yt=f&&L_(o);return{c(){e=T("div"),t=T("div"),r=T("span"),r.textContent="Version:",s=$(),n=T("span"),i=G(a),l=$(),yt&&yt.c(),u=$(),d=T("div"),m=T("span"),m.textContent="Name:",y=$(),h=T("span"),w=G(_),v=$(),M=T("div"),O=T("span"),O.textContent="Author:",A=$(),E=T("span"),F=G(R),D=$(),B=T("div"),q=T("span"),q.textContent="Description:",J=$(),K=T("span"),W=G(z),re=$(),Le=T("div"),le=T("span"),le.textContent="isDesktopOnly:",Ce=$(),Ke=T("span"),de=G(Re),fe=$(),oe=T("div"),Be=T("span"),Be.textContent="minAppVersion:",At=$(),Ot=T("span"),gt=G(Ut),b(r,"class","manifest-label svelte-12doke6"),b(n,"class","manifest-value svelte-12doke6"),b(t,"class","manifest-field svelte-12doke6"),b(m,"class","manifest-label svelte-12doke6"),b(h,"class","manifest-value svelte-12doke6"),b(d,"class","manifest-field svelte-12doke6"),b(O,"class","manifest-label svelte-12doke6"),b(E,"class","manifest-value svelte-12doke6"),b(M,"class","manifest-field svelte-12doke6"),b(q,"class","manifest-label svelte-12doke6"),b(K,"class","manifest-value svelte-12doke6"),b(B,"class","manifest-field svelte-12doke6"),b(le,"class","manifest-label svelte-12doke6"),b(Ke,"class","manifest-value svelte-12doke6"),b(Le,"class","manifest-field svelte-12doke6"),b(Be,"class","manifest-label svelte-12doke6"),b(Ot,"class","manifest-value svelte-12doke6"),b(oe,"class","manifest-field svelte-12doke6"),b(e,"class","manifest-content svelte-12doke6")},m(pt,Gt){C(pt,e,Gt),S(e,t),S(t,r),S(t,s),S(t,n),S(n,i),S(t,l),yt&&yt.m(t,null),S(e,u),S(e,d),S(d,m),S(d,y),S(d,h),S(h,w),S(e,v),S(e,M),S(M,O),S(M,A),S(M,E),S(E,F),S(e,D),S(e,B),S(B,q),S(B,J),S(B,K),S(K,W),S(e,re),S(e,Le),S(Le,le),S(Le,Ce),S(Le,Ke),S(Ke,de),S(e,fe),S(e,oe),S(oe,Be),S(oe,At),S(oe,Ot),S(Ot,gt)},p(pt,Gt){Gt[0]&4096&&a!==(a=pt[12].version+"")&&ne(i,a),Gt[0]&6144&&(f=pt[11]!==pt[12].version&&!pt[11].startsWith("v"+pt[12].version)),f?yt||(yt=L_(pt),yt.c(),yt.m(t,null)):yt&&(yt.d(1),yt=null),Gt[0]&4096&&_!==(_=pt[12].name+"")&&ne(w,_),Gt[0]&4096&&R!==(R=pt[12].author+"")&&ne(F,R),Gt[0]&4096&&z!==(z=pt[12].description+"")&&ne(W,z),Gt[0]&4096&&Re!==(Re=pt[12].isDesktopOnly?"Yes":"No")&&ne(de,Re),Gt[0]&4096&&Ut!==(Ut=pt[12].minAppVersion+"")&&ne(gt,Ut)},d(pt){pt&&L(e),yt&&yt.d()}}}function L_(o){let e;return{c(){e=T("span"),e.innerHTML=`<span class="manifest-version-mismatch-icon svelte-12doke6">\u26A0\uFE0F</span>
									Version mismatch`,b(e,"class","manifest-version-mismatch svelte-12doke6")},m(t,r){C(t,e,r)},d(t){t&&L(e)}}}function vM(o){let e,t=o[1]?"Relay installer":"Relay releases",r,s,n,a,i,l,f=Xe().enableAutomaticUpdatesOption,u,d,m,y=f&&eM(o),h=!o[7]&&!o[1]&&h_(o);function _(M,O){return M[8]?aM:M[3].length===0?nM:M[9].length===0?sM:oM}let w=_(o,[-1,-1,-1]),v=w(o);return{c(){e=T("div"),r=G(t),s=$(),n=T("div"),a=T("div"),i=$(),l=T("div"),y&&y.c(),u=$(),h&&h.c(),d=$(),v.c(),b(e,"class","modal-title"),b(a,"class","settings-spacer svelte-12doke6"),b(l,"class","settings-container svelte-12doke6"),b(n,"class","modal-content svelte-12doke6")},m(M,O){C(M,e,O),S(e,r),C(M,s,O),C(M,n,O),S(n,a),S(n,i),S(n,l),y&&y.m(l,null),S(l,u),h&&h.m(l,null),S(n,d),v.m(n,null),m=!0},p(M,O){(!m||O[0]&2)&&t!==(t=M[1]?"Relay installer":"Relay releases")&&ne(r,t),f&&y.p(M,O),!M[7]&&!M[1]?h?(h.p(M,O),O[0]&130&&I(h,1)):(h=h_(M),h.c(),I(h,1),h.m(l,null)):h&&(we(),P(h,1,1,()=>{h=null}),_e()),w===(w=_(M,O))&&v?v.p(M,O):(v.d(1),v=w(M),v&&(v.c(),v.m(n,null)))},i(M){m||(I(y),I(h),m=!0)},o(M){P(y),P(h),m=!1},d(M){M&&(L(e),L(s),L(n)),y&&y.d(),h&&h.d(),v.d()}}}var C_="system3-relay";function Ks(o){return o.startsWith("v")?o.substring(1):o}function T_(o){return(o==null?void 0:o.prerelease)===!0}function SM(o,e,t){let r,s,n,a,i,l,f,u,d,m,y,h,_,w,v,M,O,{plugin:A}=e,{version:E}=e,R=ve(A.manifest.version),F=ve(!1),D=ve(""),B=ve(""),q=ve(!1);he(o,q,Y=>t(8,u=Y));let J=ve(!1);he(o,J,Y=>t(6,l=Y));let K=ve(null);he(o,K,Y=>t(12,h=Y));let z=ve("");he(o,z,Y=>t(11,y=Y));let W=ve(null),re=ve(null);he(o,re,Y=>t(17,O=Y));let Le=ve(!1);he(o,Le,Y=>t(16,M=Y));let le=ve(null);he(o,le,Y=>t(5,n=Y));let Ce=ve(null);he(o,Ce,Y=>t(4,s=Y));let Ke=ve(null);he(o,Ke,Y=>t(58,i=Y));let Re=ve(null);he(o,Re,Y=>t(57,a=Y));let de=ve(!1),fe=!1,oe=ve(null);he(o,oe,Y=>t(15,v=Y));let Be=A.app;function At(Y){let ue=Ks(Y),it=Ks(A.version);return ue===it}let Ot=ve({});he(o,Ot,Y=>t(14,w=Y));let Ut=ve({});he(o,Ut,Y=>t(13,_=Y));let gt=ve(A.releaseSettings.get().channel);he(o,gt,Y=>t(10,m=Y));let yt=ve(!1);he(o,yt,Y=>t(7,f=Y));function pt(Y){return Ge(this,void 0,void 0,function*(){yt.set(Y);let ue=A.releaseSettings.get().channel;gt.set(ue),A.releaseSettings.update(it=>Object.assign(Object.assign({},it),{automaticUpdates:Y})),nt(ue)})}or(()=>{na(),Gt(),!E&&!r.some(Y=>{Y.tag_name,A.version})?(A.releaseSettings.update(Y=>Object.assign(Object.assign({},Y),{automaticUpdates:!1})),gt.set(null)):gt.set(A.releaseSettings.get().channel),K.set({version:E||A.version,name:A.manifest.name,author:A.manifest.author,description:A.manifest.description,isDesktopOnly:A.manifest.isDesktopOnly,minAppVersion:A.manifest.minAppVersion}),z.set(E||A.version)});function Gt(){return Ge(this,void 0,void 0,function*(){de.set(!0);try{let Y=yield A.updateManager.fetchRepoManifest("manifest.json");Y&&(le.set(Y),Ke.set(Y.version));let ue=yield A.updateManager.fetchRepoManifest("manifest-beta.json");ue&&(Ce.set(ue),Re.set(ue.version))}catch(Y){A.error("Error fetching main branch manifests:",Y)}finally{de.set(!1)}})}let ys=uo(A.updateManager,()=>A.updateManager.releases);he(o,ys,Y=>t(3,r=Y));let Gs=uo([ys,J],()=>r&&r.length>0?js(l).sort():[]);he(o,Gs,Y=>t(9,d=Y)),r.forEach(Y=>Ge(void 0,void 0,void 0,function*(){try{let ue=yield A.updateManager.fetchReleaseManifest(Y);ue&&Ot.update(it=>Object.assign(Object.assign({},it),{[Y.tag_name]:ue.version}))}catch(ue){}}));function na(){return Ge(this,void 0,void 0,function*(){q.set(!0);try{yield A.updateManager.getReleases(),js(l)}catch(Y){A.error("Error refreshing GitHub releases:",Y)}finally{q.set(!1)}})}function aa(Y){return Ge(this,void 0,void 0,function*(){let ue=document.createElement("div");return yield P_.MarkdownRenderer.render(A.app,Y,ue,"",A),ue.innerHTML})}function js(Y){return Y?r:E?r.filter(ue=>E===Ks(ue.tag_name)):r.filter(ue=>{let it=ue.tag_name;return ia(ue)})}function ia(Y){if(Y.prerelease||Y.draft)return!1;if(Y.latest||Ks(Y.tag_name)===i||Ks(Y.tag_name)===a)return!0;let ue=new Date(Y.created_at),it=new Date;return it.setMonth(it.getMonth()-3),ue>it}function Ir(Y){return Ge(this,void 0,void 0,function*(){re.set(null),W.set(Y);try{let ue=go(Y);if(!ue){re.set(`Could not find release for ${Y}`);return}let it=yield A.updateManager.fetchReleaseManifest(ue);it?(K.set(it),z.set(Y),Le.set(!1),Ot.update(yo=>Object.assign(Object.assign({},yo),{[Y]:it.version}))):re.set(`Could not find manifest for ${Y}`)}catch(ue){A.error("Error fetching manifest:",ue),re.set(`Error fetching manifest: ${ue.message||"Unknown error"}`)}finally{W.set(null)}})}function nt(Y){let ue=Y==="stable"?n:s;if(ue){let it=ue.version;gt.set(Y);let yo=[...r.values()].find(ar=>Ks(ar.tag_name)===Ks(it));yo?(Y==="stable"?Ut.update(ar=>Object.assign(Object.assign({},ar),{[yo.tag_name]:"stable-alias"})):Ut.update(ar=>Object.assign(Object.assign({},ar),{[yo.tag_name]:"beta-alias"})),Ir(yo.tag_name)):(K.set(ue),z.set(it),Y==="stable"?Ut.update(ar=>Object.assign(Object.assign({},ar),{[it]:"stable-alias"})):Ut.update(ar=>Object.assign(Object.assign({},ar),{[it]:"beta-alias"})),Le.set(!1))}else re.set(`Could not find ${Y} manifest`)}function Wt(){K.set(null),z.set(""),re.set(null)}function go(Y){return[...r.values()].find(ue=>ue.tag_name===Y)}function xs(Y){return Ge(this,void 0,void 0,function*(){try{oe.set(Y);let ue=go(Y);if(!ue)throw new Error(`Could not find release for ${Y}`);let it=yield A.updateManager.fetchReleaseManifest(ue);if(!it)throw new Error(`Could not find manifest for ${Y}`);t(2,fe=!0),yield Be.plugins.installPlugin(A.repo,Y,it),yield Be.plugins.disablePlugin(C_),yield Be.plugins.enablePlugin(C_)}catch(ue){console.error(`Error installing version ${Y}:`,ue),A&&A.error(`Error installing version ${Y}:`,ue)}finally{A&&(t(2,fe=!1),oe.set(null))}})}let se=Y=>At(Y.tag_name),ze=()=>{pt(!f)},at=Y=>{(Y.key==="Enter"||Y.key===" ")&&pt(!f)},ot=()=>{J.update(Y=>!Y)},Me=Y=>{(Y.key==="Enter"||Y.key===" ")&&J.update(ue=>!ue)},Yr=()=>{A.releaseSettings.update(Y=>({...Y,channel:"stable"})),gt.set("stable"),nt("stable")},Jr=Y=>{(Y.key==="Enter"||Y.key===" ")&&(A.releaseSettings.update(ue=>({...ue,channel:"stable"})),gt.set("stable"),nt("stable"))},bi=()=>{A.releaseSettings.update(Y=>({...Y,channel:"beta"})),gt.set("beta"),nt("beta")},Nc=Y=>{(Y.key==="Enter"||Y.key===" ")&&(A.releaseSettings.update(ue=>({...ue,channel:"beta"})),gt.set("beta"),nt("beta"))},Hc=()=>{gt.set(null),K.set({version:A.manifest.version,name:A.manifest.name,author:A.manifest.author,description:A.manifest.description,isDesktopOnly:A.manifest.isDesktopOnly,minAppVersion:A.manifest.minAppVersion}),z.set(A.version),Le.set(!1)},wi=Y=>{(Y.key==="Enter"||Y.key===" ")&&(gt.set(null),K.set({version:A.manifest.version,name:A.manifest.name,author:A.manifest.author,description:A.manifest.description,isDesktopOnly:A.manifest.isDesktopOnly,minAppVersion:A.manifest.minAppVersion}),z.set(A.version),Le.set(!1))},jt=Y=>{gt.set(null),Ir(Y.tag_name)},_i=(Y,ue)=>{(ue.key==="Enter"||ue.key===" ")&&(gt.set(null),Ir(Y.tag_name))},la=async()=>{xs(y)};return o.$$set=Y=>{"plugin"in Y&&t(0,A=Y.plugin),"version"in Y&&t(1,E=Y.version)},[A,E,fe,r,s,n,l,f,u,d,m,y,h,_,w,v,M,O,q,J,K,z,re,Le,le,Ce,Ke,Re,oe,At,Ot,Ut,gt,yt,pt,ys,Gs,aa,Ir,nt,Wt,go,xs,se,ze,at,ot,Me,Yr,Jr,bi,Nc,Hc,wi,jt,_i,la]}var _m=class extends Z{constructor(e){super(),te(this,e,SM,vM,Q,{plugin:0,version:1},ZD,[-1,-1,-1])}},A_=_m;var xi=class extends F_.Modal{constructor(t,r,s){super(t);this.plugin=r;this.version=s}onOpen(){let{contentEl:t}=this;this.component=new A_({target:t,props:{plugin:this.plugin,version:this.version}})}onClose(){var r;let{contentEl:t}=this;t.empty(),(r=this.component)==null||r.$destroy()}};var kM={debugging:!1},IM={release:{channel:"stable",automaticUpdates:!1},sharedFolders:[],...Il,...kM},Bc=class extends E_.Plugin{constructor(){super(...arguments);this.webviewerPatched=!1;this.openModals=[];this.interceptedUrls=[];this.fileDiffMergeWarningKey="file-diff-merge-warning";this.version="0.4.10";this.repo="No-Instructions/Relay"}enableDebugging(t){Sl(!0),console.warn("RelayInstances",Et),t&&this.debugSettings.update(r=>({...r,debugging:!0}))}disableDebugging(t){Sl(!1),t&&this.debugSettings.update(r=>({...r,debugging:!1}))}toggleDebugging(t){let r=!this.debugSettings.get().debugging;return Sl(r),t&&this.debugSettings.update(s=>({...s,debugging:r})),r}buildApiUrl(t){return"https://api.system3.md"+t}async onload(){this.appId=this.app.appId;let t=qt.moment.now();Et.set(this,"plugin"),this.timeProvider=new En,this.register(()=>{this.timeProvider.destroy()}),vy(new Rc(this.app.vault),this.timeProvider,".obsidian/plugins/system3-relay/relay.log",{maxFileSize:5*1024*1024,maxBackups:3,disableConsole:!1}),this.notifier=new Ec,this.toast=Iy(this.notifier),this.debug=Pe("[System 3][Relay]","debug"),this.log=Pe("[System 3][Relay]","log"),this.warn=Pe("[System 3][Relay]","warn"),this.error=Pe("[System 3][Relay]","error"),this.settings=new Ol(this,IM),await this.settings.load(),this.featureSettings=new wr(this.settings,"(enable*)"),this.debugSettings=new wr(this.settings,"(debugging)"),this.folderSettings=new wr(this.settings,"sharedFolders"),this.releaseSettings=new wr(this.settings,"release"),Kt.getInstance().setSettings(this.featureSettings),this.settingsTab=new mc(this.app,this),this.addRibbonIcon("satellite","Relay",()=>{this.openSettings()}),this.updateManager=new $c(this,this.timeProvider,this.releaseSettings),Xe().enableAutomaticUpdatesOption&&this.updateManager.applyAutomaticUpdates(),this.debugSettings.subscribe(n=>{n.debugging?(this.enableDebugging(),this.removeCommand("enable-debugging"),this.addCommand({id:"toggle-feature-flags",name:"Show feature flags",callback:()=>{let a=new Dc(this.app,()=>{this.reload()});this.openModals.push(a),a.open()}}),this.addCommand({id:"send-bug-report",name:"Send bug report",callback:()=>{let a=new Oc(this.app,this);this.openModals.push(a),a.open()}}),this.addCommand({id:"show-debug-info",name:"Show debug info",callback:()=>{let a=new Mc(this.app,this);this.openModals.push(a),a.open()}}),this.addCommand({id:"show-release-manager",name:"Show releases",callback:()=>{let a=new xi(this.app,this);this.openModals.push(a),a.open()}}),this.addCommand({id:"analyze-indexeddb",name:"Analyze database",callback:()=>{let a=new Uc(this.app,this);this.openModals.push(a),a.open()}}),this.addCommand({id:"disable-debugging",name:"Disable debugging",callback:()=>{this.disableDebugging(!0)}}),this.addCommand({id:"show-sync-status",name:"Sync status",callback:()=>{let a=new yi(this.app,this.backgroundSync,this.sharedFolders);this.openModals.push(a),a.open()}})):(this.removeCommand("toggle-feature-flags"),this.removeCommand("send-bug-report"),this.removeCommand("show-debug-info"),this.removeCommand("show-sync-status"),this.removeCommand("show-release-manager"),this.removeCommand("disable-debugging"),this.addCommand({id:"enable-debugging",name:"Enable debugging",callback:()=>{this.enableDebugging(!0)}}))}),this.addCommand({id:"reload",name:"Reload Relay",callback:()=>{this.reload()}}),this.updateManager.subscribe(()=>{let n=this.updateManager.getNewRelease();n?(this.removeCommand("update-plugin"),this.addCommand({id:"update-plugin",name:`Update Plugin (${this.version} \u2192 ${n.tag_name})`,callback:async()=>{await this.updateManager.installUpdate(n)}}),this.log(`Update available: v${this.version} \u2192 ${n.tag_name}`)):this.removeCommand("update-plugin")}),this.vault=this.app.vault;let s=this.vault.getName();this.fileManager=this.app.fileManager,this.hashStore=new Ul(this.appId),this.loginManager=new gc(this.vault.getName(),this.openSettings.bind(this),this.timeProvider,this.patchWebviewer.bind(this)),this.relayManager=new Fc(this.loginManager),this.sharedFolders=new Bl(this.relayManager,this.vault,this._createSharedFolder.bind(this),this.folderSettings),this.tokenStore=new Tc(this.loginManager,this.timeProvider,s,3),this.networkStatus=new rw(this.timeProvider,"https://api.system3.md/health?version=0.4.10"),this.backgroundSync=new Xl(this.loginManager,this.timeProvider,this.sharedFolders),this.loginManager.setup()||new qt.Notice("Please sign in to use relay"),this.app.workspace.onLayoutReady(()=>{this.sharedFolders.load(),this._liveViews=new ec(this.app,this.sharedFolders,this.loginManager,this.networkStatus),this.registerEditorExtension(this._liveViews.extensions),this.register(this.loginManager.on(()=>{this.loginManager.loggedIn?this._onLogin():this._onLogout()})),this.tokenStore.start(),D_.Platform.isIosApp||(this.networkStatus.addEventListener("offline",()=>{this.tokenStore.stop(),this.sharedFolders.forEach(n=>n.disconnect()),this._liveViews.goOffline()}),this.networkStatus.addEventListener("online",()=>{this.tokenStore.start(),this.relayManager.subscribe(),this.relayManager.update(),this._liveViews.goOnline()}),this.networkStatus.start()),this.registerView(Yn,n=>new Zl(n)),this.registerEvent(this.app.workspace.on("file-menu",(n,a)=>{if(a instanceof qt.TFolder){let i=this.sharedFolders.find(l=>l.path===a.path);if(!i)return;i.relayId&&n.addItem(l=>{l.setTitle(i.connected?"Disconnect":"Connect").setIcon("satellite").onClick(()=>{i.connected?(i.shouldConnect=!1,i.disconnect()):(i.shouldConnect=!0,i.connect()),this._liveViews.refresh("folder connection toggle")})}),n.addItem(l=>{l.setTitle("Folder settings").setIcon("gear").onClick(()=>{this.openSettings(`/shared-folders?id=${i.guid}&relay=${i.relayId}`)})}),i.relayId&&Xe().enableSyncModal&&n.addItem(l=>{l.setTitle("Sync Status").setIcon("list-checks").onClick(()=>{let f=new yi(this.app,this.backgroundSync,this.sharedFolders,i.guid);this.openModals.push(f),f.open()})}),Xe().enableSyncMenu&&i.relayId&&i.connected&&n.addItem(l=>{l.setTitle("Sync").setIcon("folder-sync").onClick(()=>{i.netSync()})})}})),this.setup(),this._liveViews.refresh("init"),this.loadTime=qt.moment.now()-t})}async reload(){let t=this.manifest.id,r=this.app.plugins;await r.disablePlugin(t),await r.enablePlugin(t)}_createSharedFolder(t,r,s,n){let a=new wr(this.settings,`sharedFolders/[guid=${r}]`),i={guid:r,path:t};return s&&(i.relay=s),a.update(f=>({...f,path:t,guid:r,...s?{relay:s}:{},sync:f.sync?f.sync:fs.defaultFlags})),a.flush(),new $l(this.appId,r,t,this.loginManager,this.vault,this.fileManager,this.tokenStore,this.relayManager,this.app.metadataCache,this.hashStore,this.backgroundSync,a,s,n)}_onLogout(){var t,r;(t=this.tokenStore)==null||t.clear(),(r=this.relayManager)==null||r.logout(),this._liveViews.refresh("logout")}_onLogin(){var t;this.sharedFolders.load(),(t=this.relayManager)==null||t.login(),this._liveViews.refresh("login")}async openSettings(t="/"){let r=this.app.setting;await r.open(),await r.openTabById("system3-relay"),this.settingsTab.navigateTo(t)}patchWebviewer(){var r,s,n;let t=this;try{if(this.webviewerPatched)return;let a=(s=(r=this.app.internalPlugins)==null?void 0:r.plugins)==null?void 0:s.webviewer;if(!((n=a==null?void 0:a.instance)!=null&&n.options)||!a.enabled){this.warn("Webviewer plugin not found or not initialized");return}let i=a.instance.options,l=Object.getOwnPropertyDescriptor(i,"openExternalURLs");if(!l){this.warn("Could not find openExternalURLs property");return}Object.defineProperty(i,"openExternalURLs",{get(){var m;let d=window.event;if((d==null?void 0:d.type)==="open-url"&&((m=d==null?void 0:d.detail)!=null&&m.url)){let y=d.detail.url;for(let h of t.interceptedUrls)if(typeof h=="string"&&y.startsWith(h)||h instanceof RegExp&&h.test(y))return t.log("Intercepted webviewer, opening in default browser",d.detail.url),!1}return l.value},set(d){l.value=d},configurable:!0}),this.register(()=>{Object.defineProperty(i,"openExternalURLs",l)});let f=this.loginManager.webviewIntercept();this.debug("Intercepting Webviewer for URL pattern",f.source),this.interceptedUrls.push(f);let u=new RegExp("https://api.system3.md".replace("/","\\/")+".*");this.debug("Intercepting Webviewer for URL pattern",u.source),this.interceptedUrls.push(u),this.webviewerPatched=!0,this.debug("patched webviewer options")}catch(a){this.error("Failed to patch webviewer:",a)}}setup(){this.folderNavDecorations=new oc(this.vault,this.app.workspace,this.sharedFolders,this.backgroundSync),this.folderNavDecorations.refresh(),this.addSettingTab(this.settingsTab);let t=Pe("[Live][Workspace]","log");this.registerEvent(this.app.workspace.on("file-open",f=>{t("file-open"),i._liveViews.refresh("file-open")})),this.registerEvent(this.app.workspace.on("layout-change",()=>{t("layout-change"),this._liveViews.refresh("layout-change")}));let r=Pe("[System 3][Relay][Vault]","log"),s=f=>{let u=f.error;u&&u instanceof zs&&this.toast(u)};window.addEventListener("error",s,!0),this.register(()=>window.removeEventListener("error",s,!0));let n=f=>{f.reason instanceof zs&&this.toast(f.reason)},a=f=>n(f);window.addEventListener("unhandledrejection",a,!0),this.register(()=>window.removeEventListener("unhandledrejection",a,!0)),this.registerEvent(this.app.vault.on("create",f=>{let u=this.sharedFolders.lookup(f.path);if(u){let d=u.getVirtualPath(f.path);u.placeHold([f]).length>0?u.uploadFile(d):u.whenReady().then(y=>{y.getFile(d)})}})),this.registerEvent(this.app.vault.on("delete",f=>{if(f instanceof qt.TFolder){let d=this.sharedFolders.find(m=>m.path===f.path);if(d){this.sharedFolders.delete(d);return}}let u=this.sharedFolders.lookup(f.path);u&&(r("Delete",f.path),u.whenReady().then(d=>{d.proxy.deleteFile(f.path)}))})),this.registerEvent(this.app.vault.on("rename",(f,u)=>{if(f instanceof qt.TFolder){let h=this.sharedFolders.find(_=>_.path==u);if(h){h.move(f.path),this.sharedFolders.update();return}}let d=this.sharedFolders.lookup(u),m=this.sharedFolders.lookup(f.path),y=d||m;d&&m?(r("Rename",f.path,u),d.renameFile(f,u),m.renameFile(f,u),this._liveViews.refresh("rename"),this.folderNavDecorations.quickRefresh()):y&&(r("Rename",f,u),y.renameFile(f,u),this._liveViews.refresh("rename"),this.folderNavDecorations.quickRefresh())})),this.registerEvent(this.app.vault.on("modify",f=>{let u=this.sharedFolders.lookup(f.path);if(u){r("Modify",f.path),Xe().enableDesyncPill&&this.folderNavDecorations.quickRefresh();let d=u.proxy.getFile(f.path);d&&$n(d)&&d.sync(),this.app.metadataCache.trigger("resolve",d)}}));let i=this,l=ni(qt.MarkdownView.prototype,{onUnloadFile(f){return function(u){return i._liveViews.wipe(),f.call(this,u)}}});this.register(l),this.patchWebviewer(),lo(Dr.enableNewLinkFormat,()=>{let f=ni(qt.MetadataCache.prototype,{fileToLinktext(u){return function(d,m,y){if(i.sharedFolders.lookup(d.path)){y===void 0&&(y=!0);let _=d.extension==="md"&&y?d.basename:d.name,w=(0,qt.normalizePath)(d.name),v=i.app.metadataCache.uniqueFileLookup.get(w.toLowerCase());if(v&&v.length===1&&v[0]===d)return _;{let M=d.extension==="md"&&y?d.path.slice(0,d.path.length-3):d.path,O=(0,M_.relative)(m,M);return O==="../"+_?"./"+_:O}}return u.call(this,d,m,y)}}});this.register(f)}),this.registerObsidianProtocolHandler("relay/settings/relays",async f=>{let u=f,d=new URLSearchParams({...u}).toString(),m=`/${u.action.split("/").slice(-1)}?${d}`;this.openSettings(m)}),this.registerObsidianProtocolHandler("relay/settings/shared-folders",async f=>{let u=f,d=new URLSearchParams({...u}).toString(),m=`/${u.action.split("/").slice(-1)}?${d}`;this.openSettings(m)}),this.registerObsidianProtocolHandler("relay/upgrade",async f=>{var m;let d=(m=f.version)==null?void 0:m.trim();this.installVersion(d)}),this.backgroundSync.start(),this.updateManager.start()}installVersion(t){let r=new xi(this.app,this,t);this.openModals.push(r),r.open()}removeCommand(t){if((0,qt.requireApiVersion)("1.7.2"))super.removeCommand(t);else{let r=this.app,s=r.commands,n=`system3-relay:${t}`;(s.commands.hasOwnProperty(n)||r.hotkeyManager.removeDefaultHotkeys(n))&&(delete s.commands[n],delete s.editorCommands[n])}}onunload(){var t,r,s,n,a,i,l,f,u,d,m,y,h,_;(t=this.timeProvider)==null||t.destroy(),(r=this.folderNavDecorations)==null||r.destroy(),this.app.workspace.detachLeavesOfType(Yn),this.updateManager&&(this.updateManager.destroy(),this.updateManager=null),(s=this._liveViews)==null||s.destroy(),this._liveViews=null,(n=this.relayManager)==null||n.destroy(),this.relayManager=null,(a=this.tokenStore)==null||a.stop(),(i=this.tokenStore)==null||i.clearState(),(l=this.tokenStore)==null||l.destroy(),this.tokenStore=null,(f=this.networkStatus)==null||f.stop(),(u=this.networkStatus)==null||u.destroy(),this.networkStatus=null,this.openModals.forEach(w=>{w.close()}),this.openModals.length=0,(d=this.sharedFolders)==null||d.destroy(),this.sharedFolders=null,(m=this.settingsTab)==null||m.destroy(),this.settingsTab=null,(y=this.loginManager)==null||y.destroy(),this.loginManager=null,(h=this.backgroundSync)==null||h.destroy(),this.backgroundSync=null,this.hashStore.destroy(),this.hashStore=null,(_=this.app)==null||_.workspace.updateOptions(),this.app=null,this.fileManager=null,this.manifest=null,this.vault=null,this.debugSettings.destroy(),this.debugSettings=null,this.folderSettings.destroy(),this.folderSettings=null,this.featureSettings.destroy(),this.featureSettings=null,this.releaseSettings.destroy(),this.releaseSettings=null,this.interceptedUrls.length=0,Kt.destroy(),Mr.destroy(),this.notifier=null,this.toast=null,Cy(),vu()}async loadSettings(){this.settings.load()}async saveSettings(){await this.settings.save()}};
/*! Bundled license information:

moment/moment.js:
  (*! moment.js *)
  (*! version : 2.29.4 *)
  (*! authors : Tim Wood, Iskren Chernev, Moment.js contributors *)
  (*! license : MIT *)
  (*! momentjs.com *)

lucide-svelte/dist/defaultAttributes.js:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/arrow-right-left.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/arrow-up-down.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/chevron-left.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/chevron-right.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/circle-check-big.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/circle-help.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/clock.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/download.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/folder.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/info.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/layers.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/message-square-heart.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/pause.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/play.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/refresh-cw.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/satellite.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/settings.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/triangle-alert.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/upload.svelte:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/icons/index.js:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)

lucide-svelte/dist/aliases.js:
  (**
   * @license lucide-svelte v0.377.0 - ISC
   *
   * This source code is licensed under the ISC license.
   * See the LICENSE file in the root directory of this source tree.
   *)
*/

/* nosourcemap */